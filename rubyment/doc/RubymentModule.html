<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module RubymentModule - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-array_first_remainder">#array_first_remainder</a>
    
    <li ><a href="#method-i-array_map">#array_map</a>
    
    <li ><a href="#method-i-array_maps">#array_maps</a>
    
    <li ><a href="#method-i-array_unflatten_base">#array_unflatten_base</a>
    
    <li ><a href="#method-i-array_unflatten_base_shallow">#array_unflatten_base_shallow</a>
    
    <li ><a href="#method-i-backtrace">#backtrace</a>
    
    <li ><a href="#method-i-binary_dec">#binary_dec</a>
    
    <li ><a href="#method-i-binary_dec_interactive">#binary_dec_interactive</a>
    
    <li ><a href="#method-i-binary_enc">#binary_enc</a>
    
    <li ><a href="#method-i-binary_input_multi_line">#binary_input_multi_line</a>
    
    <li ><a href="#method-i-binary_input_multi_line_non_echo">#binary_input_multi_line_non_echo</a>
    
    <li ><a href="#method-i-binary_input_single_line">#binary_input_single_line</a>
    
    <li ><a href="#method-i-binary_input_single_line_non_echo">#binary_input_single_line_non_echo</a>
    
    <li ><a href="#method-i-bl">#bl</a>
    
    <li ><a href="#method-i-blea">#blea</a>
    
    <li ><a href="#method-i-blef">#blef</a>
    
    <li ><a href="#method-i-bloe">#bloe</a>
    
    <li ><a href="#method-i-bloef">#bloef</a>
    
    <li ><a href="#method-i-caller_label">#caller_label</a>
    
    <li ><a href="#method-i-caller_labels">#caller_labels</a>
    
    <li ><a href="#method-i-containerize">#containerize</a>
    
    <li ><a href="#method-i-dec">#dec</a>
    
    <li ><a href="#method-i-dec_interactive">#dec_interactive</a>
    
    <li ><a href="#method-i-deserialize_json_metadata">#deserialize_json_metadata</a>
    
    <li ><a href="#method-i-echo">#echo</a>
    
    <li ><a href="#method-i-enc">#enc</a>
    
    <li ><a href="#method-i-expect_equal">#expect_equal</a>
    
    <li ><a href="#method-i-expect_format_string">#expect_format_string</a>
    
    <li ><a href="#method-i-file_backup">#file_backup</a>
    
    <li ><a href="#method-i-file_copy">#file_copy</a>
    
    <li ><a href="#method-i-file_or_url_contents">#file_or_url_contents</a>
    
    <li ><a href="#method-i-file_permissions_octal">#file_permissions_octal</a>
    
    <li ><a href="#method-i-file_read">#file_read</a>
    
    <li ><a href="#method-i-file_read_or_write">#file_read_or_write</a>
    
    <li ><a href="#method-i-filename_replacer">#filename_replacer</a>
    
    <li ><a href="#method-i-filepath_or_contents">#filepath_or_contents</a>
    
    <li ><a href="#method-i-files_basenames_in_paths">#files_basenames_in_paths</a>
    
    <li ><a href="#method-i-files_call_in_paths">#files_call_in_paths</a>
    
    <li ><a href="#method-i-files_dirnames_in_paths">#files_dirnames_in_paths</a>
    
    <li ><a href="#method-i-files_in_paths">#files_in_paths</a>
    
    <li ><a href="#method-i-files_in_paths_reject_dirs">#files_in_paths_reject_dirs</a>
    
    <li ><a href="#method-i-gem_bin_args">#gem_bin_args</a>
    
    <li ><a href="#method-i-gem_build">#gem_build</a>
    
    <li ><a href="#method-i-gem_build_push">#gem_build_push</a>
    
    <li ><a href="#method-i-gem_files_args">#gem_files_args</a>
    
    <li ><a href="#method-i-gem_get_api_key">#gem_get_api_key</a>
    
    <li ><a href="#method-i-gem_install">#gem_install</a>
    
    <li ><a href="#method-i-gem_list">#gem_list</a>
    
    <li ><a href="#method-i-gem_path">#gem_path</a>
    
    <li ><a href="#method-i-gem_push">#gem_push</a>
    
    <li ><a href="#method-i-gem_spec">#gem_spec</a>
    
    <li ><a href="#method-i-gem_uninstall">#gem_uninstall</a>
    
    <li ><a href="#method-i-gem_uninstall_all">#gem_uninstall_all</a>
    
    <li ><a href="#method-i-gem_validate">#gem_validate</a>
    
    <li ><a href="#method-i-gem_validate_args">#gem_validate_args</a>
    
    <li ><a href="#method-i-generate_pbkdf2_key">#generate_pbkdf2_key</a>
    
    <li ><a href="#method-i-http_OK_response">#http_OK_response</a>
    
    <li ><a href="#method-i-http_response_base">#http_response_base</a>
    
    <li ><a href="#method-i-input_multi_line">#input_multi_line</a>
    
    <li ><a href="#method-i-input_multi_line_non_echo">#input_multi_line_non_echo</a>
    
    <li ><a href="#method-i-input_non_empty_filepath_or_contents_or_multiline_prompt">#input_non_empty_filepath_or_contents_or_multiline_prompt</a>
    
    <li ><a href="#method-i-input_non_empty_string_or_multiline_prompt">#input_non_empty_string_or_multiline_prompt</a>
    
    <li ><a href="#method-i-input_shift">#input_shift</a>
    
    <li ><a href="#method-i-input_shift_or_empty_string">#input_shift_or_empty_string</a>
    
    <li ><a href="#method-i-input_single_line">#input_single_line</a>
    
    <li ><a href="#method-i-input_single_line_non_echo">#input_single_line_non_echo</a>
    
    <li ><a href="#method-i-invoke">#invoke</a>
    
    <li ><a href="#method-i-invoke_double">#invoke_double</a>
    
    <li ><a href="#method-i-io_echo">#io_echo</a>
    
    <li ><a href="#method-i-io_forward">#io_forward</a>
    
    <li ><a href="#method-i-io_gets">#io_gets</a>
    
    <li ><a href="#method-i-io_http_OK_response">#io_http_OK_response</a>
    
    <li ><a href="#method-i-io_transform">#io_transform</a>
    
    <li ><a href="#method-i-main">#main</a>
    
    <li ><a href="#method-i-object_method_args_call">#object_method_args_call</a>
    
    <li ><a href="#method-i-output_array_to_shell">#output_array_to_shell</a>
    
    <li ><a href="#method-i-output_dec_file">#output_dec_file</a>
    
    <li ><a href="#method-i-output_enc_file">#output_enc_file</a>
    
    <li ><a href="#method-i-pushdown_operate">#pushdown_operate</a>
    
    <li ><a href="#method-i-rest_request">#rest_request</a>
    
    <li ><a href="#method-i-rest_request_or_open_uri_open">#rest_request_or_open_uri_open</a>
    
    <li ><a href="#method-i-rest_response__request_base">#rest_response__request_base</a>
    
    <li ><a href="#method-i-rubyment_gem_defaults">#rubyment_gem_defaults</a>
    
    <li ><a href="#method-i-rubyment_gem_spec">#rubyment_gem_spec</a>
    
    <li ><a href="#method-i-runea">#runea</a>
    
    <li ><a href="#method-i-runef">#runef</a>
    
    <li ><a href="#method-i-runef_threaded">#runef_threaded</a>
    
    <li ><a href="#method-i-runoe">#runoe</a>
    
    <li ><a href="#method-i-runoe_threaded">#runoe_threaded</a>
    
    <li ><a href="#method-i-save_file">#save_file</a>
    
    <li ><a href="#method-i-serialize_json_metadata">#serialize_json_metadata</a>
    
    <li ><a href="#method-i-shell_dec">#shell_dec</a>
    
    <li ><a href="#method-i-shell_dec_input">#shell_dec_input</a>
    
    <li ><a href="#method-i-shell_dec_output">#shell_dec_output</a>
    
    <li ><a href="#method-i-shell_enc">#shell_enc</a>
    
    <li ><a href="#method-i-shell_enc_input">#shell_enc_input</a>
    
    <li ><a href="#method-i-shell_enc_output">#shell_enc_output</a>
    
    <li ><a href="#method-i-shell_popen2e_command">#shell_popen2e_command</a>
    
    <li ><a href="#method-i-shell_popen3_command">#shell_popen3_command</a>
    
    <li ><a href="#method-i-shell_string_in_columns">#shell_string_in_columns</a>
    
    <li ><a href="#method-i-ssl_make_server">#ssl_make_server</a>
    
    <li ><a href="#method-i-ssl_make_servers">#ssl_make_servers</a>
    
    <li ><a href="#method-i-ssl_sample_self_signed_cert">#ssl_sample_self_signed_cert</a>
    
    <li ><a href="#method-i-ssl_sample_self_signed_cert_encrypted">#ssl_sample_self_signed_cert_encrypted</a>
    
    <li ><a href="#method-i-string_in_columns">#string_in_columns</a>
    
    <li ><a href="#method-i-string_repetition">#string_repetition</a>
    
    <li ><a href="#method-i-system_rubyment">#system_rubyment</a>
    
    <li ><a href="#method-i-tcp_server_plain">#tcp_server_plain</a>
    
    <li ><a href="#method-i-tcp_ssl_server">#tcp_ssl_server</a>
    
    <li ><a href="#method-i-tcp_ssl_servers">#tcp_ssl_servers</a>
    
    <li ><a href="#method-i-test__array_unflatten_base">#test__array_unflatten_base</a>
    
    <li ><a href="#method-i-test__array_unflatten_base_shallow">#test__array_unflatten_base_shallow</a>
    
    <li ><a href="#method-i-test__binary_dec_file_interactive">#test__binary_dec_file_interactive</a>
    
    <li ><a href="#method-i-test__binary_enc_dec">#test__binary_enc_dec</a>
    
    <li ><a href="#method-i-test__binary_enc_dec_file_interactive">#test__binary_enc_dec_file_interactive</a>
    
    <li ><a href="#method-i-test__binary_enc_dec_interactive">#test__binary_enc_dec_interactive</a>
    
    <li ><a href="#method-i-test__binary_enc_dec_nil">#test__binary_enc_dec_nil</a>
    
    <li ><a href="#method-i-test__dec_file_interactive">#test__dec_file_interactive</a>
    
    <li ><a href="#method-i-test__enc_dec">#test__enc_dec</a>
    
    <li ><a href="#method-i-test__enc_dec_file_interactive">#test__enc_dec_file_interactive</a>
    
    <li ><a href="#method-i-test__enc_dec_interactive">#test__enc_dec_interactive</a>
    
    <li ><a href="#method-i-test__enc_dec_interactive__ssl_sample_self_signed_cert">#test__enc_dec_interactive__ssl_sample_self_signed_cert</a>
    
    <li ><a href="#method-i-test__enc_dec_nil">#test__enc_dec_nil</a>
    
    <li ><a href="#method-i-test__enc_dec_shell_programatically">#test__enc_dec_shell_programatically</a>
    
    <li ><a href="#method-i-test__file_backup">#test__file_backup</a>
    
    <li ><a href="#method-i-test__file_backup__but_keep">#test__file_backup__but_keep</a>
    
    <li ><a href="#method-i-test__file_backup__when_file_is_dir">#test__file_backup__when_file_is_dir</a>
    
    <li ><a href="#method-i-test__file_backup__when_file_is_dir__but_keep">#test__file_backup__when_file_is_dir__but_keep</a>
    
    <li ><a href="#method-i-test__file_read__return_on_rescue">#test__file_read__return_on_rescue</a>
    
    <li ><a href="#method-i-test__file_read__uri_root">#test__file_read__uri_root</a>
    
    <li ><a href="#method-i-test__gem_build">#test__gem_build</a>
    
    <li ><a href="#method-i-test__gem_build_install_validate_uninstall">#test__gem_build_install_validate_uninstall</a>
    
    <li ><a href="#method-i-test__gem_complete_flow">#test__gem_complete_flow</a>
    
    <li ><a href="#method-i-test__gem_get_api_key">#test__gem_get_api_key</a>
    
    <li ><a href="#method-i-test__gem_uninstall_extreme_force">#test__gem_uninstall_extreme_force</a>
    
    <li ><a href="#method-i-test__json_metadata_serialization">#test__json_metadata_serialization</a>
    
    <li ><a href="#method-i-test__object_nne">#test__object_nne</a>
    
    <li ><a href="#method-i-test__rest_request">#test__rest_request</a>
    
    <li ><a href="#method-i-test__rubyment_gem_spec">#test__rubyment_gem_spec</a>
    
    <li ><a href="#method-i-test__rune_functions">#test__rune_functions</a>
    
    <li ><a href="#method-i-test__shell_enc_dec">#test__shell_enc_dec</a>
    
    <li ><a href="#method-i-test__shell_send_array__main">#test__shell_send_array__main</a>
    
    <li ><a href="#method-i-test__string_repetition">#test__string_repetition</a>
    
    <li ><a href="#method-i-test__system_rubyment">#test__system_rubyment</a>
    
    <li ><a href="#method-i-test__tcp_server_plain">#test__tcp_server_plain</a>
    
    <li ><a href="#method-i-test__tcp_server_plain__with_http_OK_response">#test__tcp_server_plain__with_http_OK_response</a>
    
    <li ><a href="#method-i-test__tcp_server_plain__with_io_http_response">#test__tcp_server_plain__with_io_http_response</a>
    
    <li ><a href="#method-i-test__tcp_server_plain__with_io_transform">#test__tcp_server_plain__with_io_transform</a>
    
    <li ><a href="#method-i-test__tcp_ssl_server__get_root">#test__tcp_ssl_server__get_root</a>
    
    <li ><a href="#method-i-test__tcp_ssl_server__get_root__plain_redirect">#test__tcp_ssl_server__get_root__plain_redirect</a>
    
    <li ><a href="#method-i-test__tcp_ssl_server__io_method">#test__tcp_ssl_server__io_method</a>
    
    <li ><a href="#method-i-test__tcp_ssl_server__io_transform">#test__tcp_ssl_server__io_transform</a>
    
    <li ><a href="#method-i-test__tcp_ssl_server__non_ssl">#test__tcp_ssl_server__non_ssl</a>
    
    <li ><a href="#method-i-test__tcp_ssl_server__ssl_self_signed">#test__tcp_ssl_server__ssl_self_signed</a>
    
    <li ><a href="#method-i-test__tester">#test__tester</a>
    
    <li ><a href="#method-i-test__transform_call">#test__transform_call</a>
    
    <li ><a href="#method-i-test_enc_dec_interactive__ssl_sample_self_signed_cert">#test_enc_dec_interactive__ssl_sample_self_signed_cert</a>
    
    <li ><a href="#method-i-time_now_hash">#time_now_hash</a>
    
    <li ><a href="#method-i-to_class">#to_class</a>
    
    <li ><a href="#method-i-to_method">#to_method</a>
    
    <li ><a href="#method-i-to_object_method">#to_object_method</a>
    
    <li ><a href="#method-i-url_to_str">#url_to_str</a>
    
    <li ><a href="#method-i-validate_require">#validate_require</a>
    
    <li ><a href="#method-i-version">#version</a>
    
    <li ><a href="#method-i-version_at_least">#version_at_least</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-RubymentModule">
  <h1 id="module-RubymentModule" class="module">
    module RubymentModule
  </h1>

  <section class="description">
    
<p>Collection of Ruby functions</p>
<ul><li>
<p>output</p>
</li></ul>

<p>normally outputs to STDERR, with no mercy STDOUT, just qualified output:
only if the function is expected to output something</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(memory = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 295</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">memory</span> = {}
  <span class="ruby-ivar">@memory</span> = {
    <span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> [],
    <span class="ruby-value">:stderr</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">STDERR</span>,
    <span class="ruby-value">:stdout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">STDOUT</span>,
    <span class="ruby-value">:stdin</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">STDIN</span>,
    <span class="ruby-value">:time</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>,
    <span class="ruby-value">:major_version</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;0.6&quot;</span>,
    <span class="ruby-value">:basic_version</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>  <span class="ruby-operator">/</span> <span class="ruby-value">60</span>), <span class="ruby-comment"># new one every minute</span>
    <span class="ruby-value">:filepath</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">__FILE__</span>,
    <span class="ruby-value">:running_dir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>,
    <span class="ruby-value">:home_dir</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">home</span>,
    <span class="ruby-value">:system_user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;USER&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;USERNAME&#39;</span>],
    <span class="ruby-value">:system_user_is_super</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;USER&#39;</span>]  <span class="ruby-operator">==</span> <span class="ruby-string">&quot;root&quot;</span>, <span class="ruby-comment"># changed plan: platform indenpend.</span>
    <span class="ruby-value">:static_separator_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;strings_having_this&quot;</span>  <span class="ruby-operator">+</span>  <span class="ruby-string">&quot;_string_not_guaranteed_to_work&quot;</span>,
    <span class="ruby-value">:static_end_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;strings_havinng_this_string&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;_also_not_guaranteed_to_work&quot;</span>,
    <span class="ruby-value">:static_separator_key_per_execution</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;strings_having_this&quot;</span>  <span class="ruby-operator">+</span>  <span class="ruby-string">&quot;_string_not_guaranteed_to_work&quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> {}).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>,
    <span class="ruby-value">:threads</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>]
  }
  <span class="ruby-ivar">@memory</span>.<span class="ruby-identifier">update</span> <span class="ruby-identifier">memory</span>.<span class="ruby-identifier">to_h</span>
  <span class="ruby-identifier">invoke</span> <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:invoke</span>].<span class="ruby-identifier">to_a</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-array_first_remainder" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">array_first_remainder</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>this class very often needs to split first argument and remaining elements.
args: args default: ARGV returns:</p>
<dl class="rdoc-list label-list"><dt> <a href="0">args</a>, args[1..-1
<dd>
<p>]</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="array_first_remainder-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">array_first_remainder</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  [ <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-array_map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">array_map</span><span
            class="method-args">(a, method_name, method_args = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns an enumeration of <code>method_name</code> for each element in the
enumeration <code>a</code>. Useful for heterogeneous arrays (like arrays of
Strings, of Hashes, of Arrays and so on</p>
          
          

          
          <div class="method-source-code" id="array_map-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 374</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">array_map</span> <span class="ruby-identifier">a</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">method_args</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">a</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">method</span>(<span class="ruby-identifier">method_name</span>).<span class="ruby-identifier">call</span>  <span class="ruby-operator">*</span><span class="ruby-identifier">method_args</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-array_maps" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">array_maps</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>the same as <a href="RubymentModule.html#method-i-array_map">array_map</a>
(but takes all arguments at once)</p>
          
          

          
          <div class="method-source-code" id="array_maps-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 380</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">array_maps</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">a</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">method_args</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">array_map</span> <span class="ruby-identifier">a</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">method_args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-array_unflatten_base" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">array_unflatten_base</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>will take a flatten array and makes it deeper, starting a new array
everytime it finds the string +“[”+. +“]”+ stops the array (and return to
the upper one). To reserve the possibility of representing “[” or “]”,
everytime a string contains only those chars, repeteaded any number of
times, starting from 2, one of them will be removed. So +“[[”+ will be left
as +“[”+ and +“]]]”+ will be left as +“]]”+. if the provided array is not
flatten, it has an undefined behaviour (it will either a - transverse the
sub-arrays or b - don&#39;t transverse it, leaving it untouched. while the
a is the planned effect, initially only a may will be implemented)
(currently this behaviour is easily configurable by the value
<code>deep</code>, hardcoded in the function. soon, new functions will come
to clarify and specify the proper behaviours) @param [Array]
<code>args</code>, an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>flatten_array</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>the array to be operated.</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if evals to false (or empty string), won&#39;t print debug information</p>
</dd></dl>
</dd><dt><code>shallow</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if evals to false (or empty string), will traverse recursively
<code>flatten_array</code> and apply the rules, in the case it is not
flatten.</p>
</dd></dl>
</dd><dt><code>reserved_tokens</code>
<dd><dl class="rdoc-list label-list"><dt>Array of Arrays
<dd></dd></dl>
</dd><dt><code>inverse</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if calling the object <code>nne</code> method returns a <code>false</code>
value, will operate this function inversely: will take a unflatten array
and flatten it, applying the inverse escaping rules (note that any object
responding to <code>:map</code> will be considered an array in
<code>flatten_array</code>).</p>
</dd></dl>
</dd><dt><code>debug_pushdown</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if evals to false (or empty string), won&#39;t print debug information
about the call pushdown_operated</p>
</dd></dl>
</dd><dt><code>inversion_envelope</code>
<dd>
<p>[Array, nil], if <code>nil</code>, the first colum of
<code>reserved_tokens</code> will be used. if an <code>Array</code> whose
elements are expected to be:</p>
</dd><dt><code>inversion_envelope.prepend</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>when an inversion occurrs, this element will be prepended when a new object
responding to <code>:map</code>, like <code>Array</code> is found.</p>
</dd></dl>
</dd><dt><code>inversion_envelope.append</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>when an inversion occurrs, this element will be prepended when a new object
responding to <code>:map</code>, like <code>Array</code> is found.</p>
</dd></dl>
</dd></dl>

<p>@return [Array] returns the modified, deep, #Array</p>
          
          

          
          <div class="method-source-code" id="array_unflatten_base-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3956</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">array_unflatten_base</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">flatten_array</span>,
    <span class="ruby-identifier">shallow</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">reserved_tokens</span>,
    <span class="ruby-identifier">inverse</span>,
    <span class="ruby-identifier">debug_pushdown</span>,
    <span class="ruby-identifier">inversion_envelope</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">reserved_tokens</span> = <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">nne</span> [
    [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:up</span>],
    [ <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>],
  ]
  <span class="ruby-identifier">inversion_envelope</span> = <span class="ruby-identifier">inversion_envelope</span>.<span class="ruby-identifier">nne</span>(
    <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">transpose</span>.<span class="ruby-identifier">first</span>
  )
  <span class="ruby-identifier">inverse</span> = <span class="ruby-identifier">inverse</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">shallow</span> = <span class="ruby-identifier">shallow</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug_pushdown</span> = <span class="ruby-identifier">debug_pushdown</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;{#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
  <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pushdown_operate</span>
  <span class="ruby-identifier">flatten_array</span>.<span class="ruby-identifier">each_with_index</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">e</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;-------------------&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;[e, index]=#{[e, index].inspect}&quot;</span>)
    <span class="ruby-identifier">shallow</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;e.hash=#{e.hash}&quot;</span>)
      <span class="ruby-identifier">args_recursion</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">clone</span>
      <span class="ruby-identifier">args_recursion</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">e</span> = (<span class="ruby-identifier">send</span> <span class="ruby-identifier">__method__</span>, <span class="ruby-identifier">args_recursion</span>) <span class="ruby-keyword">rescue</span> ( <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} finished with exception }&quot;</span> ) ; <span class="ruby-identifier">e</span>)
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;e.hash=#{e.hash}&quot;</span>)
    )
    <span class="ruby-identifier">operations</span> = <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">reserved_token</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reserved_token=#{reserved_token.inspect}&quot;</span>)
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;array_operands_stack=#{pd[1].inspect}&quot;</span>)
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;array_operand=#{pd.first.inspect}&quot;</span>)
      <span class="ruby-identifier">rtoken</span>, <span class="ruby-identifier">is_up_token</span> = <span class="ruby-identifier">reserved_token</span>

      <span class="ruby-identifier">repetition_test</span> = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-value">1</span>]
      (
        <span class="ruby-comment"># case A: e is exactly the reserved token.</span>
        <span class="ruby-comment"># start or finish an array</span>
        <span class="ruby-comment"># note: if rtoken is false, it will succeed this</span>
        <span class="ruby-comment"># test.</span>
        (<span class="ruby-identifier">repetition_test</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rtoken</span>) <span class="ruby-operator">&amp;&amp;</span> (
          <span class="ruby-identifier">inverse</span>  <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">e</span> = (<span class="ruby-identifier">e</span>.<span class="ruby-identifier">sub!</span> <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">rtoken</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">e</span>)
          <span class="ruby-identifier">is_up_token</span> <span class="ruby-operator">&amp;&amp;</span> (
            <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case is_up_token&quot;</span>)
            [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>(<span class="ruby-identifier">inverse</span>), <span class="ruby-value">:up</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
          ) <span class="ruby-operator">||</span> (
            <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case is_down_token&quot;</span>)
            [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>(<span class="ruby-identifier">inverse</span>), <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
          )
        )
      ) <span class="ruby-operator">||</span> (
        <span class="ruby-comment"># case B: is a a repetition with at least 2</span>
        <span class="ruby-comment"># occurrences of the reserved token. remove one.</span>
        <span class="ruby-comment"># (and add it to the current array)</span>
        <span class="ruby-identifier">repetition_test</span> <span class="ruby-operator">&amp;&amp;</span> (
          <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case escape&quot;</span>)
          <span class="ruby-comment"># room for improvement: and if array had sub! ?</span>
          <span class="ruby-operator">!</span><span class="ruby-identifier">inverse</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">escaped_e</span> = (<span class="ruby-identifier">e</span>.<span class="ruby-identifier">sub!</span> <span class="ruby-identifier">rtoken</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">e</span>)
          [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">escaped_e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
        )
      ) <span class="ruby-operator">||</span> (
        <span class="ruby-comment"># case C: no repetition. (just add e to</span>
        <span class="ruby-comment"># the current array.)</span>
          <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case just add&quot;</span>)
          [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-identifier">inverse</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">inversion_envelope</span> ]
      )
    }
    <span class="ruby-comment"># now operations has |reserved_tokens| operations.</span>
    <span class="ruby-comment"># but only one will be applied: either the first</span>
    <span class="ruby-comment"># one which is a reserved token (:first), or the</span>
    <span class="ruby-comment"># last operation, in case of no reserved tokens.</span>
    <span class="ruby-identifier">operation</span> = <span class="ruby-identifier">operations</span>.<span class="ruby-identifier">lazy</span>.<span class="ruby-identifier">find</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:first</span>) <span class="ruby-operator">||</span> (
      <span class="ruby-identifier">operations</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">to_a</span>
    )
    <span class="ruby-identifier">reserved_token</span>, <span class="ruby-identifier">reservation_type</span>, <span class="ruby-identifier">token</span> = <span class="ruby-identifier">operation</span>
    <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pushdown_operate</span> [<span class="ruby-identifier">pd</span>, <span class="ruby-identifier">operation</span>, <span class="ruby-identifier">debug_pushdown</span>]
  }
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{pd.first}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning}&quot;</span>)
  <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-array_unflatten_base_shallow" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">array_unflatten_base_shallow</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>takes a flatten array and makes it deeper, starting a new array everytime
it finds the string +“[”+. +“]”+ stops the array (and return to the upper
one). To reserve the possibility of representing “[” or “]”, everytime a
string contains only those chars, repeteaded any number of times, starting
from 2, one of them will be removed. So +“[[”+ will be left as +“[”+ and
+“]]]”+ will be left as +“]]”+. if the provided array is not flatten, it
won&#39;t be transversed. @param [Array] <code>args</code>, the array to be
operadated @return [Array] returns the modified, deep, #Array</p>
          
          

          
          <div class="method-source-code" id="array_unflatten_base_shallow-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 4055</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">array_unflatten_base_shallow</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">deep</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">reserved_tokens</span> = [
    [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:up</span>],
    [ <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>],
  ]
  <span class="ruby-comment"># debug = 1</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)

  <span class="ruby-identifier">rv</span> = <span class="ruby-identifier">array_unflatten_base</span> [
    <span class="ruby-identifier">args</span>,
    <span class="ruby-identifier">deep</span>.<span class="ruby-identifier">negate_me</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">reserved_tokens</span>,
  ]

  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{rv}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-identifier">rv</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-backtrace" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">backtrace</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a string having the current backtrace, for debugging.</p>
          
          

          
          <div class="method-source-code" id="backtrace-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 546</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">backtrace</span>
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-binary_dec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">binary_dec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>decipher the data encoded by <a
href="RubymentModule.html#method-i-binary_enc">#binary_enc</a></p>

<p>@param [Array] args, an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password to be used to encryption.</p>
</dd></dl>
</dd><dt><code>base64_iv</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>initialization vectors encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_encrypted</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ciphered data (without metadata) encoded with Base64</p>
</dd></dl>
</dd><dt><code>ending</code>
<dd><dl class="rdoc-list label-list"><dt>nil
<dd>
<p>deprecated</p>
</dd></dl>
</dd><dt><code>base64_salt</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
salt encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_iter</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
iterations encoded with Base64</p>
</dd></dl>
</dd><dt><code>data_is_base64</code>
<dd><dl class="rdoc-list label-list"><dt>true, false, nil
<dd>
<p>return base64 data – the same <code>data_is_base64</code> given for enc
should be used.</p>
</dd></dl>
</dd></dl>

<p>@return [String] decoded data</p>
          
          

          
          <div class="method-source-code" id="binary_dec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1683</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;_binary&quot;</span>
  <span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_salt</span>
  <span class="ruby-identifier">iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_iter</span>
  <span class="ruby-comment"># FIXME: don&#39;t split on \0</span>
  <span class="ruby-identifier">ending</span> = <span class="ruby-identifier">ending</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">static_end_key</span>
  <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> =  (
    <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
  )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

  <span class="ruby-identifier">decipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
  <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">decrypt</span>
  <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">padding</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
  <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_iv</span>
  <span class="ruby-identifier">base64_plain</span> = <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_encrypted</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">final</span>
  <span class="ruby-identifier">plain</span> = <span class="ruby-identifier">data_is_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_plain</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">base64_plain</span>
  <span class="ruby-comment"># split is not the ideal, if ever ending is duplicated it won&#39;t</span>
  <span class="ruby-comment"># work. also may be innefficient.</span>
  (<span class="ruby-identifier">plain</span>.<span class="ruby-identifier">split</span> <span class="ruby-identifier">ending</span>).<span class="ruby-identifier">first</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-binary_dec_interactive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">binary_dec_interactive</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>an alternative interface to <a
href="RubymentModule.html#method-i-binary_dec">#binary_dec</a> – reads
password if nil or empty.</p>

<p>@param [Array] args Defaults to <code>ARGV</code>. Elements:</p>
<ul><li>
<p><code>data</code> [String, nil] data to be encrypted, If empty or nil, read
(without</p>
</li></ul>

<p>echo) from @<a href=":stdin">memory</a>, which defaults to STDIN</p>
<ul><li>
<p><code>password</code> [String, nil] password to be used to encryption.</p>
</li></ul>

<p>If empty or nil, read (without echo) from @<a href=":stdin">memory</a>,
which defaults to STDIN</p>
<dl class="rdoc-list note-list"><dt><code>data_is_base64</code>
<dd><dl class="rdoc-list label-list"><dt>true, false, nil
<dd>
<p>return base64 data – the same <code>data_is_base64</code> given for enc
should be used.</p>
</dd></dl>
</dd></dl>

<p>@return [TrueClass, FalseClass] depending on whether test succeeds.</p>
          
          

          
          <div class="method-source-code" id="binary_dec_interactive-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1723</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>  = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
  <span class="ruby-identifier">password</span> = (<span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>])
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
  <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-binary_enc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">binary_enc</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>encode data into aes-128-cbc cipher protected by a key generated by <a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>,
using given <code>password</code>, <code>salt</code>, <code>iter</code> By
default, must work with binary data. Set <code>data_is_base64</code> to
true (or give data already as base64) to achieve the original behavior of
enc(), and avoid one encoding operation on data.</p>

<p>@param [Array] args, an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password to be used to encryption.</p>
</dd></dl>
</dd><dt><code>data</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>data to be encoded data</p>
</dd></dl>
</dd><dt><code>ending</code>
<dd><dl class="rdoc-list label-list"><dt>nil
<dd>
<p>deprecated</p>
</dd></dl>
</dd><dt><code>salt</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
salt argument</p>
</dd></dl>
</dd><dt><code>iter</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
iterations argument</p>
</dd></dl>
</dd><dt><code>data_is_base64</code>
<dd><dl class="rdoc-list label-list"><dt>true, false, nil
<dd>
<p>data already in base64</p>
</dd></dl>
</dd></dl>

<p>@return @param [Array] an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>base64_encrypted</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ciphered data (without metadata) encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_iv</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>initialization vectors encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_salt</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
salt encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_iter</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
iterations encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_key</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
return value</p>
</dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="binary_enc-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1642</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_enc</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;_binary&quot;</span>
  <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">ending</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_end_key</span>
  <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> = (
    <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
  )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

  <span class="ruby-identifier">cipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
  <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">encrypt</span>

  <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
  <span class="ruby-identifier">iv</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">random_iv</span>
  <span class="ruby-identifier">base64_data</span> = <span class="ruby-identifier">data_is_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">data</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>
  <span class="ruby-identifier">encrypted</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">base64_data</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ending</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">final</span>

  <span class="ruby-identifier">base64_iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iv</span>
  <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>  <span class="ruby-identifier">encrypted</span>
  <span class="ruby-identifier">base64_salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">base64_iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">base64_key</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>

  [<span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>,  <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-binary_input_multi_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">binary_input_multi_line</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens an echoing multiline prompt, if arg1 is nil or empty better prepared
to work with binary input args:</p>
<dl class="rdoc-list label-list"><dt> arg1 (String or nil)
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="binary_input_multi_line-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 805</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_input_multi_line</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
  <span class="ruby-identifier">static_separator_key_per_execution</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:static_separator_key_per_execution</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;multiline[enter + control-D to stop]:&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">b</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">static_separator_key_per_execution</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">join</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-binary_input_multi_line_non_echo" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">binary_input_multi_line_non_echo</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens a non-echoing multiline prompt, if arg1 is nil or empty better
prepared to work with binary input (which can contain 0) args:</p>
<dl class="rdoc-list label-list"><dt> arg1 (String or nil)
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="binary_input_multi_line_non_echo-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 818</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_input_multi_line_non_echo</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
  <span class="ruby-identifier">static_separator_key_per_execution</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:static_separator_key_per_execution</span>]
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;io/console&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;multiline[enter + control-D to stop]:&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">b</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">static_separator_key_per_execution</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">readlines</span>}.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">chomp</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-binary_input_single_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">binary_input_single_line</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens an echoing prompt, if arg1 is nil or empty better prepared to work
with binary input args:</p>
<dl class="rdoc-list label-list"><dt> arg1 (String or nil)
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="binary_input_single_line-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 778</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_input_single_line</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;single line:&quot;</span>
  <span class="ruby-identifier">static_separator_key_per_execution</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:static_separator_key_per_execution</span>]
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">b</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">static_separator_key_per_execution</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-binary_input_single_line_non_echo" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">binary_input_single_line_non_echo</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens a non-echoing prompt, if arg1 is nil or empty better prepared to work
with binary input (which can contain 0) args:</p>
<dl class="rdoc-list label-list"><dt> arg1 (String or nil)
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="binary_input_single_line_non_echo-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 791</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_input_single_line_non_echo</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
  <span class="ruby-identifier">static_separator_key_per_execution</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:static_separator_key_per_execution</span>]
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;io/console&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;non echo single line:&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">b</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">static_separator_key_per_execution</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>}.<span class="ruby-identifier">chomp</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-bl" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bl</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>creates a Proc out of a block</p>
          
          

          
          <div class="method-source-code" id="bl-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bl</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-identifier">block</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">lambda</span> {}
  <span class="ruby-comment"># Proc.new &amp;block</span>
  <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>  <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-blea" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">blea</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>creates a <code>Proc</code> out of a block, where exceptions may be
admissible or not, and to be printed or not. it is an interface for the bl*
methods above @param [splat] <code>args</code>, an splat whose elements are
expected to be <code>blea_args</code> and <code>blocks_args</code>:</p>
<dl class="rdoc-list note-list"><dt><code>blea_args</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>args to be used internally, which are expected to be:</p>
</dd></dl>
</dd><dt><code>exception_admitted</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd></dd></dl>
</dd><dt><code>output_exception</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>note that this only makes sense if exception is admitted – otherwise an
exception will be normally thrown.</p>
</dd></dl>
</dd><dt><code>ret_nil_on_exception</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>enforces that <code>nil</code> will be returned on exception</p>
</dd></dl>
</dd><dt><code>blocks_args</code>
<dd><dl class="rdoc-list label-list"><dt>splat
<dd>
<p>args to be forwarded to the block call</p>
</dd></dl>
</dd></dl>

<p>@return [Proc]</p>
          
          

          
          <div class="method-source-code" id="blea-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 160</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">blea</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-identifier">blea_args</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">block_args</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">blea_args</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">blea_args</span>.<span class="ruby-identifier">nne</span> []
  <span class="ruby-identifier">exception_admitted</span>, <span class="ruby-identifier">output_exception</span>, <span class="ruby-identifier">ret_nil_on_exception</span> = <span class="ruby-identifier">blea_args</span>
  <span class="ruby-identifier">exception_admitted</span> = <span class="ruby-identifier">exception_admitted</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">output_exception</span>   =  <span class="ruby-identifier">output_exception</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">bloe_method</span> = <span class="ruby-identifier">ret_nil_on_exception</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value">:bloef</span> <span class="ruby-operator">||</span> <span class="ruby-value">:bloe</span>
  <span class="ruby-identifier">ble_method</span> = <span class="ruby-identifier">output_exception</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">bloe_method</span> <span class="ruby-operator">||</span> <span class="ruby-value">:blef</span>
  <span class="ruby-identifier">bl_to_call</span> = <span class="ruby-identifier">exception_admitted</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ble_method</span> <span class="ruby-operator">||</span> <span class="ruby-value">:bl</span>
  <span class="ruby-identifier">send</span> <span class="ruby-identifier">bl_to_call</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">block_args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-blef" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">blef</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>creates a Proc out of a block, will capture all exceptions inside that
block and ignore it returns nil</p>
          
          

          
          <div class="method-source-code" id="blef-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 109</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">blef</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-comment"># bl exception free</span>
  <span class="ruby-identifier">block</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">lambda</span> {}
  <span class="ruby-identifier">bl</span> {
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-bloe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bloe</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>creates a Proc out of a block, will capture all exceptions inside that
block and ignore it will return an array having the backtrace (as String)
as the first member and the the exception as the second.</p>
          
          

          
          <div class="method-source-code" id="bloe-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 128</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bloe</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-identifier">block</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">lambda</span> {}
  <span class="ruby-identifier">bl</span> {
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
      <span class="ruby-identifier">rv</span> = [<span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>), <span class="ruby-identifier">e</span>]
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} exception backtrace:&quot;</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">rv</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} exception inspection:&quot;</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">rv</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">inspect</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} exception message:&quot;</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">rv</span>[<span class="ruby-value">1</span>]
      <span class="ruby-identifier">rv</span>
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-bloef" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bloef</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>creates a Proc out of a block, will capture all exceptions inside that
block and ignore it will return nil</p>
          
          

          
          <div class="method-source-code" id="bloef-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">bloef</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-identifier">block</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">lambda</span> {}
  <span class="ruby-identifier">bl</span> {
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
      <span class="ruby-identifier">rv</span> = [<span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>), <span class="ruby-identifier">e</span>]
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} exception backtrace:&quot;</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">rv</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} exception inspection:&quot;</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">rv</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">inspect</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} exception message:&quot;</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">rv</span>[<span class="ruby-value">1</span>]
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-caller_label" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">caller_label</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>return the last_called function</p>
          
          

          
          <div class="method-source-code" id="caller_label-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 555</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">caller_label</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-identifier">default</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-identifier">default</span> <span class="ruby-operator">||=</span> <span class="ruby-value">3</span>
  <span class="ruby-identifier">caller_labels</span>(<span class="ruby-identifier">default</span>, <span class="ruby-value">1</span>)[<span class="ruby-value">0</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-caller_labels" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">caller_labels</span><span
            class="method-args">(begin_range=1, range_size=1)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="caller_labels-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 550</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">caller_labels</span> <span class="ruby-identifier">begin_range</span>=<span class="ruby-value">1</span>, <span class="ruby-identifier">range_size</span>=<span class="ruby-value">1</span>
   <span class="ruby-identifier">caller_locations</span>(<span class="ruby-identifier">begin_range</span>, <span class="ruby-identifier">range_size</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:label</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-containerize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">containerize</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a Class object out of class_name (or itself if it is already a
class)</p>
          
          

          
          <div class="method-source-code" id="containerize-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 366</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  [<span class="ruby-identifier">args</span>].<span class="ruby-identifier">flatten</span> <span class="ruby-value">1</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-dec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>decipher the data encoded by enc</p>

<p>@param [Array] args, an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password to be used to encryption.</p>
</dd></dl>
</dd><dt><code>base64_iv</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>initialization vectors encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_encrypted</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ciphered data (without metadata) encoded with Base64</p>
</dd></dl>
</dd><dt><code>ending</code>
<dd><dl class="rdoc-list label-list"><dt>nil
<dd>
<p>deprecated</p>
</dd></dl>
</dd><dt><code>base64_salt</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
salt encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_iter</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
iterations encoded with Base64</p>
</dd></dl>
</dd><dt><code>data_not_base64</code>
<dd><dl class="rdoc-list label-list"><dt>true, false, nil
<dd>
<p>don&#39;t return base64 data – the same <code>data_not_base64</code> given
for enc should be used.</p>
</dd></dl>
</dd></dl>

<p>@return [String] decoded data</p>
          
          

          
          <div class="method-source-code" id="dec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1092</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>]
  <span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_salt</span>
  <span class="ruby-identifier">iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_iter</span>
  <span class="ruby-identifier">ending</span> = <span class="ruby-identifier">ending</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">static_end_key</span>
  <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> =  (
    <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
  )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

  <span class="ruby-identifier">decipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
  <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">decrypt</span>
  <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">padding</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
  <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_iv</span>
  <span class="ruby-identifier">base64_plain</span> = <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_encrypted</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">final</span>
  <span class="ruby-identifier">plain</span> = <span class="ruby-identifier">data_not_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_plain</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">base64_plain</span>
  <span class="ruby-comment"># split is not the ideal, if ever ending is duplicated it won&#39;t</span>
  <span class="ruby-comment"># work. also may be innefficient.</span>
  (<span class="ruby-identifier">plain</span>.<span class="ruby-identifier">split</span> <span class="ruby-identifier">ending</span>).<span class="ruby-identifier">first</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-dec_interactive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dec_interactive</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>an alternative interface to dec – reads password if nil or empty.</p>

<p>@param [Array] args Defaults to <code>ARGV</code>. Elements:</p>
<ul><li>
<p><code>data</code> [String, nil] data to be encrypted, If empty or nil, read
(without</p>
</li></ul>

<p>echo) from @<a href=":stdin">memory</a>, which defaults to STDIN</p>
<ul><li>
<p><code>password</code> [String, nil] password to be used to encryption.</p>
</li></ul>

<p>If empty or nil, read (without echo) from @<a href=":stdin">memory</a>,
which defaults to STDIN</p>
<dl class="rdoc-list note-list"><dt><code>data_not_base64</code>
<dd><dl class="rdoc-list label-list"><dt>true, false, nil
<dd>
<p>don&#39;t return base64 data – the same <code>data_not_base64</code> given
for enc should be used.</p>
</dd></dl>
</dd></dl>

<p>@return [TrueClass, FalseClass] depending on whether test succeeds.</p>
          
          

          
          <div class="method-source-code" id="dec_interactive-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1434</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span>  = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
  <span class="ruby-identifier">password</span> = (<span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>])
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
  <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_not_base64</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-deserialize_json_metadata" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">deserialize_json_metadata</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="RubymentModule.html#method-i-deserialize_json_metadata">#deserialize_json_metadata</a>
args:</p>
<dl class="rdoc-list label-list"><dt>serialized_string (String), separator (String)
<dd>
<p>undo what <a
href="RubymentModule.html#method-i-serialize_json_metadata">#serialize_json_metadata</a>
returns array:</p>
<dl class="rdoc-list label-list"><dt>payload (String), metadata (Hash or String), separator (String)
<dd>
<p>metadata is returned as Hash after a  JSON.parse, but in case of any
failure, it returns the String itself.</p>
</dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="deserialize_json_metadata-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1361</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">deserialize_json_metadata</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">static_separator</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_separator_key</span>]
  <span class="ruby-identifier">serialized_string</span>, <span class="ruby-identifier">separator</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">separator</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_separator</span>
  <span class="ruby-identifier">metadata_json</span>, <span class="ruby-identifier">payload</span>  = <span class="ruby-identifier">serialized_string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span> <span class="ruby-identifier">separator</span>
  <span class="ruby-identifier">metadata</span> = (<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">metadata_json</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">metadata_json</span>
  [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">separator</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-echo" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">echo</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>echoes the processing arg @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>processing_arg</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd></dl>

<p>@return [String] <code>processing_arg</code></p>
          
          

          
          <div class="method-source-code" id="echo-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2556</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">echo</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-enc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">enc</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>encode data into aes-128-cbc cipher protected by a key generated by <a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>,
using given <code>password</code>, <code>salt</code>, <code>iter</code> By
default, may not work with binary data. Set <code>data_not_base64</code> to
true (or give data already as base64) to make it work.</p>

<p>@param [Array] args, an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password to be used to encryption.</p>
</dd></dl>
</dd><dt><code>data</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>data to be encoded data</p>
</dd></dl>
</dd><dt><code>ending</code>
<dd><dl class="rdoc-list label-list"><dt>nil
<dd>
<p>deprecated</p>
</dd></dl>
</dd><dt><code>salt</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
salt argument</p>
</dd></dl>
</dd><dt><code>iter</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
iterations argument</p>
</dd></dl>
</dd><dt><code>data_not_base64</code>
<dd><dl class="rdoc-list label-list"><dt>true, false, nil
<dd>
<p>data not yet in base64</p>
</dd></dl>
</dd></dl>

<p>@return @param [Array] an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>base64_encrypted</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ciphered data (without metadata) encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_iv</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>initialization vectors encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_salt</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
salt encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_iter</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
iterations encoded with Base64</p>
</dd></dl>
</dd><dt><code>base64_key</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p><a
href="RubymentModule.html#method-i-generate_pbkdf2_key">generate_pbkdf2_key</a>
return value</p>
</dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="enc-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">enc</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>]
  <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">ending</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_end_key</span>
  <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> = (
    <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
  )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

  <span class="ruby-identifier">cipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
  <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">encrypt</span>

  <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
  <span class="ruby-identifier">iv</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">random_iv</span>
  <span class="ruby-identifier">base64_data</span> = <span class="ruby-identifier">data_not_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">data</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>
  <span class="ruby-identifier">encrypted</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">base64_data</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ending</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">final</span>

  <span class="ruby-identifier">base64_iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iv</span>
  <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>  <span class="ruby-identifier">encrypted</span>
  <span class="ruby-identifier">base64_salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">base64_iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">base64_key</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>

  [<span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>,  <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-expect_equal" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">expect_equal</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-expect_equal">#expect_equal</a> args:</p>
<dl class="rdoc-list label-list"><dt> value_before (Object), value_after (Object), value_label (String) 
<dd>
<p>returns the value of testing value_before == value_after, printing to
stderr upon failure</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="expect_equal-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1403</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">expect_equal</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">judgement</span> = (<span class="ruby-identifier">value_before</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">value_after</span>)
  (<span class="ruby-operator">!</span><span class="ruby-identifier">judgement</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>  <span class="ruby-identifier">expect_format_string</span> [<span class="ruby-string">&quot;unexpected&quot;</span>, <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span>, <span class="ruby-string">&quot;!=&quot;</span>])
  <span class="ruby-identifier">judgement</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-expect_format_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">expect_format_string</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>format strings for  <a
href="RubymentModule.html#method-i-expect_format_string">#expect_format_string</a></p>
          
          

          
          <div class="method-source-code" id="expect_format_string-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1390</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">expect_format_string</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:debug</span>]
  <span class="ruby-identifier">prepend_text</span>, <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span>, <span class="ruby-identifier">comparison_text</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-node">&quot;#{prepend_text} #{value_label}: #{value_before} #{comparison_text} #{value_after}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_backup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_backup</span><span
            class="method-args">(file = __FILE__ , dir = '/tmp/', append = ('-' + Time.now.hash.abs.to_s), prepend='/', permissions = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>if file is a nonexisting filepath, or by any reason throws any exception,
it will be treated as contents instead, and the filename will treated as “”
file can be a url, if &#39;open-uri&#39; is available. extension: before
file couldn&#39;t be a directory. now it can. planned improvement: use <a
href="RubymentModule.html#method-i-file_read">#file_read</a> instead @param
[Array] args, an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>file</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>uri or path of the file</p>
</dd></dl>
</dd><dt><code>dir</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>dir where to backup file</p>
</dd></dl>
</dd><dt><code>append</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>append this string to the end of file</p>
</dd></dl>
</dd><dt><code>prepend</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>append this string to the beginning of file</p>
</dd></dl>
</dd><dt><code>permissions</code>
<dd><dl class="rdoc-list label-list"><dt>Integer, nil
<dd>
<p>writes the file with this mode  (preserves if nil)</p>
</dd></dl>
</dd></dl>

<p>@return [String] file contents</p>
          
          

          
          <div class="method-source-code" id="file_backup-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 479</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">file</span> = <span class="ruby-keyword">__FILE__</span> , <span class="ruby-identifier">dir</span> = <span class="ruby-string">&#39;/tmp/&#39;</span>, <span class="ruby-identifier">append</span> = (<span class="ruby-string">&#39;-&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span>), <span class="ruby-identifier">prepend</span>=<span class="ruby-string">&#39;/&#39;</span>, <span class="ruby-identifier">permissions</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-identifier">default_permissions</span> = <span class="ruby-value">0755</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">debug</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:debug</span>]
  (<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;open-uri&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">open_uri</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
  <span class="ruby-identifier">file_is_filename</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">file_is_directory</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">file</span>)
  <span class="ruby-identifier">open_uri</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">file_is_directory</span>) <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-identifier">contents</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>).<span class="ruby-identifier">read</span> <span class="ruby-keyword">rescue</span>  (<span class="ruby-identifier">file_is_filename</span> = <span class="ruby-keyword">false</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span>
  ) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">file_is_directory</span>) <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-identifier">contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword">rescue</span>  (<span class="ruby-identifier">file_is_filename</span> = <span class="ruby-keyword">false</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span>
  )
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;location = dir:#{dir} + prepend:#{prepend} + (#{file_is_filename} &amp;&amp; #{file} || &#39;&#39; ) + #{append}&quot;</span>)
  <span class="ruby-identifier">location</span> = <span class="ruby-identifier">dir</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">prepend</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">file_is_filename</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span> ) <span class="ruby-operator">+</span> <span class="ruby-identifier">append</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;FileUtils.mkdir_p File.dirname #{location}&quot;</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">location</span> <span class="ruby-comment"># note &quot;~&quot; doesn&#39;t work</span>
  <span class="ruby-identifier">file_is_directory</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">location</span>) <span class="ruby-operator">||</span> (
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">location</span>, <span class="ruby-identifier">contents</span>
  )
  <span class="ruby-identifier">permissions</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">file</span>
  <span class="ruby-identifier">permissions</span> <span class="ruby-operator">&amp;&amp;</span> ( <span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-identifier">permissions</span>, <span class="ruby-identifier">location</span> )
  <span class="ruby-identifier">contents</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_copy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_copy</span><span
            class="method-args">(file = __FILE__, dir = '/tmp/', append = '', prepend='', permissions = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>same interface as <a
href="RubymentModule.html#method-i-file_backup">#file_backup</a>, but
append and prepend defaults are empty.</p>
          
          

          
          <div class="method-source-code" id="file_copy-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 506</span>
<span class="ruby-keyword">def</span>  <span class="ruby-identifier">file_copy</span> <span class="ruby-identifier">file</span> = <span class="ruby-keyword">__FILE__</span>, <span class="ruby-identifier">dir</span> = <span class="ruby-string">&#39;/tmp/&#39;</span>, <span class="ruby-identifier">append</span> = <span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">prepend</span>=<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">permissions</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">file</span>, <span class="ruby-identifier">dir</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">default_permissions</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_or_url_contents" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_or_url_contents</span><span
            class="method-args">(file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns the contents of file. file can be a url, if &#39;open-uri&#39; is
available. can throw exceptions</p>
          
          

          
          <div class="method-source-code" id="file_or_url_contents-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 664</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">file</span>
  <span class="ruby-identifier">contents</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  (<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;open-uri&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">open_uri</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
  <span class="ruby-identifier">file</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">file_is_filename</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">open_uri</span> <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-identifier">contents</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>).<span class="ruby-identifier">read</span>
  ) <span class="ruby-operator">||</span> (
    <span class="ruby-identifier">contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>
  )
  <span class="ruby-identifier">contents</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_permissions_octal" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_permissions_octal</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>args: path (String) returns: <a
href="RubymentModule.html#method-i-file_permissions_octal">#file_permissions_octal</a>
(Integer, ready to go to chmod, or nil, if file doesn&#39;t exist)</p>
          
          

          
          <div class="method-source-code" id="file_permissions_octal-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 627</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">path</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">mode</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value">8</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;&quot;</span>)[<span class="ruby-value">-4</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">join</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">8</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_read" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_read</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>reads a uri (if &#39;rest-client&#39; or &#39;open-uri&#39; available and
they don&#39;t throw any exception, otherwise, just do a normal File.read)
@param [Array] args, an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>uri</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>uri or path of the file (empty string is assumed in the case of
<code>nil</code> given)</p>
</dd></dl>
</dd><dt><code>username</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>basic http authentication username</p>
</dd></dl>
</dd><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>basic http authentication password</p>
</dd></dl>
</dd><dt><code>return_on_rescue</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>a default to return in the case of exceptions raised</p>
</dd></dl>
</dd><dt><code>return_on_directory_given</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>a default to return in the case uri is a directory. Defaults to true</p>
</dd></dl>
</dd><dt><code>skip_open_uri</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>don&#39;t bother trying to use &#39;open-uri&#39; (but still tries to open
an uri with &#39;rest-client&#39;). Defaults to <code>false</code> for
open-closed principle respect, but advised to be set to <code>true</code></p>
</dd></dl>
</dd><dt><code>payload</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>verify_ssl</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>defaults to <code>false</code></p>
</dd></dl>
</dd><dt><code>headers</code>
<dd><dl class="rdoc-list label-list"><dt>Hash
<dd>
<p>+“Authorization”+ key will be added to it if <code>auth_user</code> is
given. Defaults to +{}+</p>
</dd></dl>
</dd><dt><code>method</code>
<dd><dl class="rdoc-list label-list"><dt>HTTP method
<dd>
<p>one of <code>:get</code>, <code>:method</code>, <code>:post</code> or
<code>:delete</code>. defaults to <code>:get</code></p>
</dd></dl>
</dd><dt><code>timeout</code>
<dd><dl class="rdoc-list label-list"><dt>Fixnum, nil
<dd>
<p>defaults to <code>nil</code></p>
</dd></dl>
</dd></dl>

<p>@return [String, Object] read data (or <code>return_on_rescue</code>)</p>
          
          

          
          <div class="method-source-code" id="file_read-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 401</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_read</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">uri</span>,
    <span class="ruby-identifier">username</span>,
    <span class="ruby-identifier">password</span>,
    <span class="ruby-identifier">return_on_rescue</span>,
    <span class="ruby-identifier">return_on_directory_given</span>,
    <span class="ruby-identifier">skip_open_uri</span>,
    <span class="ruby-identifier">payload</span>,
    <span class="ruby-identifier">verify_ssl</span>,
    <span class="ruby-identifier">headers</span>,
    <span class="ruby-identifier">method</span>,
    <span class="ruby-identifier">timeout</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">uri</span> = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">file_is_directory</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-identifier">return_on_directory_given</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">contents</span> = <span class="ruby-operator">!</span>(<span class="ruby-identifier">file_is_directory</span>) <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-keyword">begin</span>
      (<span class="ruby-identifier">send</span> <span class="ruby-value">:rest_request_or_open_uri_open</span>, [
          <span class="ruby-identifier">uri</span>,
          <span class="ruby-identifier">payload</span>,
          <span class="ruby-identifier">verify_ssl</span>,
          <span class="ruby-identifier">headers</span>,
          <span class="ruby-identifier">method</span>,
          <span class="ruby-identifier">username</span>,
          <span class="ruby-identifier">password</span>,
          <span class="ruby-identifier">timeout</span>,
          <span class="ruby-identifier">skip_open_uri</span>,
        ]).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e1</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">uri</span>
      <span class="ruby-keyword">rescue</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e2</span>
        <span class="ruby-identifier">return_on_rescue</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  ) <span class="ruby-operator">||</span> (<span class="ruby-identifier">file_is_directory</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">return_on_directory_given</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_read_or_write" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_read_or_write</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>reads the contents of a file. if the file doesn&#39;t exist, writes to the
file. note: the file may get overwritten with the same contents in some
situations (not if <code>contents</code> is <code>nil</code>). @param
[splat] <code>args</code>::, an splat whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>filepath</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>uri (if +&#39;open-uri&#39;+ installed) or local path to a file</p>
</dd></dl>
</dd><dt><code>username</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>basic http authentication username</p>
</dd></dl>
</dd><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>basic http authentication password</p>
</dd></dl>
</dd></dl>

<p>@return [String] file contents at the end of the process.</p>
          
          

          
          <div class="method-source-code" id="file_read_or_write-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 451</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-identifier">filepath</span>, <span class="ruby-identifier">contents</span>, <span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">existing_file</span> = <span class="ruby-identifier">file_read</span> [
    <span class="ruby-identifier">filepath</span>,
    <span class="ruby-identifier">username</span>,
    <span class="ruby-identifier">password</span>,
    <span class="ruby-string">&quot;return on rescue&quot;</span>.<span class="ruby-identifier">to_nil</span>,
    <span class="ruby-string">&quot;return on dir&quot;</span>.<span class="ruby-identifier">to_nil</span>,
  ]
  <span class="ruby-identifier">file_contents</span> <span class="ruby-operator">||=</span>  <span class="ruby-identifier">existing_file</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">contents</span>
  <span class="ruby-identifier">contents</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">filepath</span>, <span class="ruby-identifier">file_contents</span>)
  <span class="ruby-identifier">file_contents</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filename_replacer" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filename_replacer</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="filename_replacer-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 540</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filename_replacer</span>
  [<span class="ruby-regexp">/[^0-9A-Za-z\-\.\/]/</span>,  <span class="ruby-string">&quot;_&quot;</span> ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filepath_or_contents" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filepath_or_contents</span><span
            class="method-args">(file, contents = "")</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns the contents of file (or empty, or a default if a second parameter
is given). if file is a nonexisting filepath, or by any reason throws any
exception, it will be treated as contents instead file can be a url, if
&#39;open-uri&#39; is available.</p>
          
          

          
          <div class="method-source-code" id="filepath_or_contents-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 685</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filepath_or_contents</span> <span class="ruby-identifier">file</span>, <span class="ruby-identifier">contents</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  (<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;open-uri&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">open_uri</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
  <span class="ruby-identifier">file</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">file_is_filename</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">open_uri</span> <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-identifier">contents</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>).<span class="ruby-identifier">read</span> <span class="ruby-keyword">rescue</span>  (<span class="ruby-identifier">file_is_filename</span> = <span class="ruby-keyword">false</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span>
  ) <span class="ruby-operator">||</span> (
    <span class="ruby-identifier">contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">file</span> <span class="ruby-keyword">rescue</span>  (<span class="ruby-identifier">file_is_filename</span> = <span class="ruby-keyword">false</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span>
  )
  <span class="ruby-identifier">contents</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-files_basenames_in_paths" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">files_basenames_in_paths</span><span
            class="method-args">(paths, reject_dirs=false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="files_basenames_in_paths-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 535</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">files_basenames_in_paths</span> <span class="ruby-identifier">paths</span>, <span class="ruby-identifier">reject_dirs</span>=<span class="ruby-keyword">false</span>
  <span class="ruby-identifier">files_call_in_paths</span> <span class="ruby-identifier">paths</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:basename</span>), <span class="ruby-identifier">reject_dirs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-files_call_in_paths" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">files_call_in_paths</span><span
            class="method-args">(paths, method, reject_dirs=false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="files_call_in_paths-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 523</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">files_call_in_paths</span> <span class="ruby-identifier">paths</span>, <span class="ruby-identifier">method</span>, <span class="ruby-identifier">reject_dirs</span>=<span class="ruby-keyword">false</span>
  <span class="ruby-identifier">paths</span> =  <span class="ruby-identifier">reject_dirs</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">files_in_paths_reject_dirs</span> <span class="ruby-identifier">paths</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">paths</span>
  (<span class="ruby-identifier">files_in_paths</span> <span class="ruby-identifier">paths</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>  <span class="ruby-identifier">method</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">path</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-files_dirnames_in_paths" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">files_dirnames_in_paths</span><span
            class="method-args">(paths, reject_dirs=false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="files_dirnames_in_paths-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 529</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">files_dirnames_in_paths</span> <span class="ruby-identifier">paths</span>, <span class="ruby-identifier">reject_dirs</span>=<span class="ruby-keyword">false</span>
 <span class="ruby-comment"># (files_in_paths paths).map {|path|  File.dirname path }</span>
  <span class="ruby-identifier">files_call_in_paths</span> <span class="ruby-identifier">paths</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:dirname</span>), <span class="ruby-identifier">reject_dirs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-files_in_paths" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">files_in_paths</span><span
            class="method-args">(paths, reject_dirs=false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="files_in_paths-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 511</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">files_in_paths</span> <span class="ruby-identifier">paths</span>, <span class="ruby-identifier">reject_dirs</span>=<span class="ruby-keyword">false</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;find&#39;</span>
  <span class="ruby-identifier">paths</span> = <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-constant">Find</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">entries</span>  <span class="ruby-keyword">rescue</span> [] }.<span class="ruby-identifier">flatten</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">reject_dirs</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">path</span>} <span class="ruby-operator">||</span> <span class="ruby-identifier">paths</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-files_in_paths_reject_dirs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">files_in_paths_reject_dirs</span><span
            class="method-args">(paths)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="files_in_paths_reject_dirs-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 518</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">files_in_paths_reject_dirs</span> <span class="ruby-identifier">paths</span>
   <span class="ruby-identifier">files_in_paths</span> <span class="ruby-identifier">paths</span>, <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_bin_args" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_bin_args</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>extract only the arguments referring to the bin file generation from args</p>
          
          

          
          <div class="method-source-code" id="gem_bin_args-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2227</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_bin_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">gem_name</span>,
  <span class="ruby-identifier">gem_version</span>,
  <span class="ruby-identifier">gem_dir</span>,
  <span class="ruby-identifier">gem_ext</span>,
  <span class="ruby-identifier">gem_hifen</span>,
  <span class="ruby-identifier">gem_date</span>,
  <span class="ruby-identifier">gem_summary</span>,
  <span class="ruby-identifier">gem_description</span>,
  <span class="ruby-identifier">gem_authors</span>,
  <span class="ruby-identifier">gem_email</span>,
  <span class="ruby-identifier">gem_files</span>,
  <span class="ruby-identifier">gem_homepage</span>,
  <span class="ruby-identifier">gem_license</span>,
  <span class="ruby-identifier">gem_validate_class</span>,
  <span class="ruby-identifier">gem_validate_class_args</span>,
  <span class="ruby-identifier">gem_validate_class_method</span>,
  <span class="ruby-identifier">gem_is_current_file</span>,
  <span class="ruby-identifier">gem_bin_generate</span>,
  <span class="ruby-identifier">gem_bin_contents</span>,
  <span class="ruby-identifier">gem_bin_executables</span> = <span class="ruby-identifier">args</span>
  [
      <span class="ruby-identifier">gem_bin_generate</span>,
      <span class="ruby-identifier">gem_bin_contents</span>,
      <span class="ruby-identifier">gem_bin_executables</span>,
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_build" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_build</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-gem_build">#gem_build</a> args:</p>
<dl class="rdoc-list label-list"><dt>gem_spec_path (String), gem_spec_contents (String), gem_is_current_file, gem_name
<dd>
<p>returns: console output of gem build (String)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="gem_build-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2048</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_build</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">gem_spec_path</span>,
  <span class="ruby-identifier">gem_spec_contents</span>,
  <span class="ruby-identifier">gem_is_current_file</span>,
  <span class="ruby-identifier">gem_name</span>,
  <span class="ruby-identifier">gem_bin_generate</span>,
  <span class="ruby-identifier">gem_bin_contents</span>,
    <span class="ruby-identifier">quiet</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>

  <span class="ruby-comment"># this supposes that  the current file is listed by the</span>
  <span class="ruby-comment"># s.files</span>
  <span class="ruby-comment"># field of the specification. it is not currently checked.</span>
  <span class="ruby-identifier">gem_is_current_file</span> <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-string">&#39;lib&#39;</span>
    <span class="ruby-identifier">file_backup</span> <span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>, <span class="ruby-string">&quot;lib/&quot;</span>
    <span class="ruby-comment"># quick hack for backwards compatibility</span>
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">gem_is_current_file</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">TrueClass</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">__FILE__</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">gem_is_current_file</span>
    <span class="ruby-identifier">save_file</span> <span class="ruby-identifier">gem_is_current_file</span>, <span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>
  )

  <span class="ruby-comment"># this supposes that  the current file is listed by the</span>
  <span class="ruby-comment"># s.files</span>
  <span class="ruby-comment"># field of the specification. it is not currently checked.</span>
  <span class="ruby-identifier">gem_bin_generate</span> <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_bin_generate</span>
    <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">gem_bin_generate</span>, (<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_bin_generate</span>)
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_bin_generate</span>, <span class="ruby-identifier">gem_bin_contents</span>
    (<span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-value">0755</span>, <span class="ruby-identifier">gem_bin_generate</span>)
  )

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_spec_path</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_spec_path</span>, <span class="ruby-identifier">gem_spec_contents</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">gem_spec_path</span>)
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem build #{gem_spec_path}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_build_push" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_build_push</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>builds, validates and push a gem accordingly to the arguments. if arguments
not given, will do for the defaults (see <a
href="RubymentModule.html#method-i-rubyment_gem_defaults">#rubyment_gem_defaults</a>)
args: args (Array or nil) returns: ignore (will change)</p>
          
          

          
          <div class="method-source-code" id="gem_build_push-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2436</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_build_push</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">running_dir</span>      = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
  <span class="ruby-identifier">home_dir</span>         = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:home_dir</span>]
  <span class="ruby-identifier">gem_username</span>, <span class="ruby-identifier">gem_password</span>, <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-identifier">gem_defaults</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">gem_password</span> = <span class="ruby-identifier">gem_password</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">gem_defaults</span> <span class="ruby-operator">||=</span>  <span class="ruby-identifier">rubyment_gem_defaults</span> []
  <span class="ruby-identifier">gem_api_key_file</span> <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{home_dir}/.gem/credentials&quot;</span>
  <span class="ruby-identifier">permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">gem_api_key_file</span>
  <span class="ruby-identifier">credentials_contents</span> = <span class="ruby-identifier">url_to_str</span> <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-string">&quot;&quot;</span>
  (<span class="ruby-identifier">gem_get_api_key</span> [<span class="ruby-identifier">gem_username</span>, <span class="ruby-identifier">gem_password</span>, <span class="ruby-identifier">gem_api_key_file</span>]) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">validated</span> = (
    <span class="ruby-identifier">gem_validate</span> <span class="ruby-identifier">gem_defaults</span>
  )
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">validated</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_push</span> <span class="ruby-identifier">gem_path</span> <span class="ruby-identifier">gem_defaults</span> )
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-identifier">credentials_contents</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-identifier">permissions</span>, <span class="ruby-identifier">gem_api_key_file</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_files_args" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_files_args</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <pre class="ruby"><span class="ruby-identifier">extract</span> <span class="ruby-identifier">only</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">arguments</span> <span class="ruby-identifier">referring</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">files</span>
</pre>

<p>from args</p>
          
          

          
          <div class="method-source-code" id="gem_files_args-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2258</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_files_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">gem_name</span>,
  <span class="ruby-identifier">gem_version</span>,
  <span class="ruby-identifier">gem_dir</span>,
  <span class="ruby-identifier">gem_ext</span>,
  <span class="ruby-identifier">gem_hifen</span>,
  <span class="ruby-identifier">gem_date</span>,
  <span class="ruby-identifier">gem_summary</span>,
  <span class="ruby-identifier">gem_description</span>,
  <span class="ruby-identifier">gem_authors</span>,
  <span class="ruby-identifier">gem_email</span>,
  <span class="ruby-identifier">gem_files</span>,
  <span class="ruby-identifier">gem_homepage</span>,
  <span class="ruby-identifier">gem_license</span>,
  <span class="ruby-identifier">gem_validate_class</span>,
  <span class="ruby-identifier">gem_validate_class_args</span>,
  <span class="ruby-identifier">gem_validate_class_method</span>,
  <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>
  [
      <span class="ruby-identifier">gem_files</span>,
      <span class="ruby-identifier">gem_is_current_file</span>,
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_get_api_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_get_api_key</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>gets the api key needed to push gems to rubygems. prompts for arguments
when username or password not provided. args: [username (String or nil),
password (String or nil), file_destination (String, “/dev/null” if
empty/nil given)] returns key_contents (String)</p>
          
          

          
          <div class="method-source-code" id="gem_get_api_key-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_get_api_key</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
  <span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">file_destination</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;username - &quot;</span>
  <span class="ruby-identifier">username</span> = <span class="ruby-identifier">input_single_line</span> [<span class="ruby-identifier">username</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;password - &quot;</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
  <span class="ruby-identifier">file_destination</span> = <span class="ruby-identifier">file_destination</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;/dev/null&quot;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">file_destination</span>
  <span class="ruby-identifier">key_contents</span> = <span class="ruby-identifier">save_file</span> <span class="ruby-string">&quot;https://rubygems.org/api/v1/api_key.yaml&quot;</span>,
    <span class="ruby-identifier">file_destination</span>, <span class="ruby-value">0</span>, {<span class="ruby-value">:username</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">username</span>, <span class="ruby-value">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">password</span> }
  (<span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-value">0600</span>, <span class="ruby-identifier">file_destination</span>)
  <span class="ruby-identifier">key_contents</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_install" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_install</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-gem_install">#gem_install</a> args:</p>
<dl class="rdoc-list label-list"><dt><a href="RubymentModule.html#method-i-gem_spec">#gem_spec</a> (String)
<dd>
<p>returns: console output of gem install (String)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="gem_install-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2112</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_install</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">system_user_is_super</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:system_user_is_super</span>]
  <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
  <span class="ruby-identifier">user_install</span> <span class="ruby-operator">||=</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">system_user_is_super</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;--user-install&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem install #{user_install}  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_list</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-gem_list">#gem_list</a> args:</p>
<dl class="rdoc-list label-list"><dt><a href="RubymentModule.html#method-i-gem_spec">#gem_spec</a> (String)
<dd>
<p>returns: console output of gem install (String)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="gem_list-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_list</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">gem_spec</span>,
    <span class="ruby-identifier">quiet</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem list | grep #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_path</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns the gem path given the params. args:</p>
<dl class="rdoc-list label-list"><dt>gem_name, gem_version, gem_dir, gem_ext, gem_hifen
<dd>
<p>all Strings. defaults: [“rubyment”, version [], <a
href=":running_dir">memory</a>, “.gem”, “-”]</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="gem_path-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2001</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_path</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>, <span class="ruby-identifier">gem_dir</span>, <span class="ruby-identifier">gem_ext</span>, <span class="ruby-identifier">gem_hifen</span> = <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
  <span class="ruby-node">&quot;#{gem_dir}/#{gem_name}#{gem_hifen}#{gem_version}#{gem_ext}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_push" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_push</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-gem_push">#gem_push</a> args:</p>
<dl class="rdoc-list label-list"><dt><a href="RubymentModule.html#method-i-gem_spec">#gem_spec</a> (String)
<dd>
<p>returns: console output of gem push (String)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="gem_push-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2129</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_push</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">future_arg</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem push #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_spec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_spec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-gem_spec">#gem_spec</a> args (Array
like the one returned by <a
href="RubymentModule.html#method-i-rubyment_gem_defaults">#rubyment_gem_defaults</a>)
returns: a gem spec string accordingly to args</p>
          
          

          
          <div class="method-source-code" id="gem_spec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1845</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span>,
    <span class="ruby-identifier">gem_bin_generate</span>,
    <span class="ruby-identifier">gem_bin_contents</span>,
    <span class="ruby-identifier">gem_bin_executables</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">contents</span> =<span class="ruby-value">&lt;&lt;-ENDHEREDOC
Gem::Specification.new do |s|
  s.name        = &#39;#{gem_name}&#39;
  s.version     = &#39;#{gem_version}&#39;
  s.date        = &#39;#{gem_date}&#39;
  s.summary     = &#39;#{gem_summary}&#39;
  s.description = &#39;#{gem_description}&#39;
  s.authors     = #{gem_authors.inspect}
  s.email       = &#39;#{gem_email}&#39;
  s.files       = #{gem_files.inspect}
  s.homepage    = &#39;#{gem_homepage}&#39;
  s.license     = &#39;#{gem_license}&#39;
  s.executables += [#{gem_bin_executables}].flatten
end
    ENDHEREDOC</span>
    <span class="ruby-identifier">contents</span>
  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_uninstall" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_uninstall</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-gem_uninstall">#gem_uninstall</a>
args:</p>
<dl class="rdoc-list label-list"><dt><a href="RubymentModule.html#method-i-gem_spec">#gem_spec</a> (String)
<dd>
<p>returns: console output of gem uninstall (String)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="gem_uninstall-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_uninstall</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">system_user_is_super</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:system_user_is_super</span>]
  <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
  <span class="ruby-identifier">all</span> = <span class="ruby-identifier">all</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">user_install</span> <span class="ruby-operator">||=</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">system_user_is_super</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;--user-install&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall #{all} -x #{user_install}  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-comment">#stdin, stdout, stderr, wait_thr = Open3.popen3(&quot;:;&quot; + command)</span>
  <span class="ruby-comment">#stdout</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_uninstall_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_uninstall_all</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>uninstall all versions of a specific gem @param [Array] <code>args</code>,
an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>gem_spect</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>user_install</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd></dd></dl>
</dd><dt><code>quiet</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if calling the object <code>nne</code> method returns a <code>false</code>
value, will print debug information</p>
</dd></dl>
</dd></dl>

<p>@return [String] console output of gem uninstall</p>
          
          

          
          <div class="method-source-code" id="gem_uninstall_all-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2146</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_uninstall_all</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">all</span> = <span class="ruby-string">&quot;-a&quot;</span>
  <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_validate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_validate</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>validate the installation of a gem args <a
href="RubymentModule.html#method-i-rubyment_gem_defaults">#rubyment_gem_defaults</a>
but planned to change. bug detected: require x won&#39;t reload the gem.
args (Array just like the one returned by <a
href="RubymentModule.html#method-i-rubyment_gem_defaults">#rubyment_gem_defaults</a>)
returns: true or false</p>
          
          

          
          <div class="method-source-code" id="gem_validate-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2333</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_validate</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">gem_defaults</span> = <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span> = <span class="ruby-identifier">gem_defaults</span>
  <span class="ruby-identifier">gem_files</span>, <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">gem_files_args</span> <span class="ruby-identifier">gem_defaults</span>
  <span class="ruby-identifier">gem_bin_generate</span>, <span class="ruby-identifier">gem_bin_contents</span> = <span class="ruby-identifier">gem_bin_args</span> <span class="ruby-identifier">gem_defaults</span>

  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_build</span> [
    <span class="ruby-node">&quot;#{gem_name}.spec&quot;</span>,
    <span class="ruby-identifier">gem_spec</span>(<span class="ruby-identifier">gem_defaults</span>),
    <span class="ruby-identifier">gem_is_current_file</span>,
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_bin_generate</span>,
    <span class="ruby-identifier">gem_bin_contents</span>,
  ]
  <span class="ruby-identifier">already_installed</span> = (
    <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">gem_defaults</span>
  )
  <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_uninstall_all</span> [<span class="ruby-identifier">gem_name</span>])
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-identifier">gem_name</span>]
  <span class="ruby-identifier">p</span> (<span class="ruby-identifier">gem_path</span> [<span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>])
  <span class="ruby-identifier">gem_install</span> [(<span class="ruby-identifier">gem_path</span> [<span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>])]
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-identifier">gem_name</span>]
  <span class="ruby-identifier">v</span> = (
    <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">gem_defaults</span>
  )
  <span class="ruby-identifier">gem_uninstall_all</span> [<span class="ruby-identifier">gem_name</span>]
  <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_install</span> [<span class="ruby-identifier">gem_name</span>])
  <span class="ruby-identifier">v</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gem_validate_args" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gem_validate_args</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <pre>extract only the arguments for validation</pre>

<p>from args</p>
          
          

          
          <div class="method-source-code" id="gem_validate_args-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2285</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">gem_name</span>,
  <span class="ruby-identifier">gem_version</span>,
  <span class="ruby-identifier">gem_dir</span>,
  <span class="ruby-identifier">gem_ext</span>,
  <span class="ruby-identifier">gem_hifen</span>,
  <span class="ruby-identifier">gem_date</span>,
  <span class="ruby-identifier">gem_summary</span>,
  <span class="ruby-identifier">gem_description</span>,
  <span class="ruby-identifier">gem_authors</span>,
  <span class="ruby-identifier">gem_email</span>,
  <span class="ruby-identifier">gem_files</span>,
  <span class="ruby-identifier">gem_homepage</span>,
  <span class="ruby-identifier">gem_license</span>,
  <span class="ruby-identifier">gem_validate_class</span>,
  <span class="ruby-identifier">gem_validate_class_args</span>,
  <span class="ruby-identifier">gem_validate_class_method</span>,
  <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>
  [
      <span class="ruby-identifier">gem_name</span>,
      <span class="ruby-identifier">gem_validate_class</span>,
      <span class="ruby-identifier">gem_validate_class_args</span>,
      <span class="ruby-identifier">gem_validate_class_method</span>,
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-generate_pbkdf2_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">generate_pbkdf2_key</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>generates (by default) a 128 bit key for a Cipher (e.g. AES) args:</p>
<dl class="rdoc-list label-list"><dt> password, salt, iter, key_len 
<dd>
<p>returns:</p>
<dl class="rdoc-list label-list"><dt>key, password, salt, iter, key_len
<dd>
<p>planned changes:</p>

<pre>ensure that random_bytes == key_len</pre>
</dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="generate_pbkdf2_key-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1069</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">generate_pbkdf2_key</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
  <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>, <span class="ruby-identifier">key_len</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">iter</span> = (<span class="ruby-identifier">iter</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">||</span> <span class="ruby-value">20000</span>
  <span class="ruby-identifier">key_len</span> = (<span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">||</span> <span class="ruby-value">16</span>)
  <span class="ruby-identifier">salt</span> = <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Random</span>.<span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">key_len</span>)
  <span class="ruby-identifier">key</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS5</span>.<span class="ruby-identifier">pbkdf2_hmac_sha1</span>(<span class="ruby-identifier">password</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">key_len</span>.<span class="ruby-identifier">to_i</span>)
  [<span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>, <span class="ruby-identifier">key_len</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-http_OK_response" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">http_OK_response</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns an HTTP response (1.1 200 OK by default) @param [Array]
<code>args</code>, an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>response</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>response payload (default empty)</p>
</dd></dl>
</dd><dt><code>content_type</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>mime type of payload (default <code>text/plain</code>)</p>
</dd></dl>
</dd><dt><code>version</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>http protocol version (<code>1.1</code> by default)</p>
</dd></dl>
</dd><dt><code>code</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>response code (+“200 OK”+ by default)</p>
</dd></dl>
</dd><dt><code>keep_alive</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>right not unsupported, always close the connection</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if calling the object <code>nne</code> method returns a <code>false</code>
value, won&#39;t print debug information</p>
</dd></dl>
</dd><dt><code>eol</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>response code (+“rn”+ by default/on <code>nil</code>)</p>
</dd></dl>
</dd></dl>

<p>@return [Array] response with proper headers in an array where each element
is a response line</p>
          
          

          
          <div class="method-source-code" id="http_OK_response-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2629</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">payload</span>, <span class="ruby-identifier">content_type</span>, <span class="ruby-identifier">code</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">keep_alive</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">eol</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-identifier">payload</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">payload</span>  = <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">content_type</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;text/plain&quot;</span>
  <span class="ruby-identifier">version</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;1.1&quot;</span>
  <span class="ruby-identifier">code</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;200 OK&quot;</span>
  <span class="ruby-identifier">eol</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;\r\n&quot;</span>
  <span class="ruby-identifier">rv</span> = <span class="ruby-identifier">http_response_base</span> [
    <span class="ruby-identifier">payload</span>,
    <span class="ruby-identifier">content_type</span>,
    <span class="ruby-identifier">code</span>,
    <span class="ruby-identifier">version</span>,
    <span class="ruby-identifier">keep_alive</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">eol</span>,
  ]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-identifier">rv</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-http_response_base" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">http_response_base</span><span
            class="method-args">(args = [])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns an HTTP response @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>response</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>response payload</p>
</dd></dl>
</dd><dt><code>content_type</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>mime type of payload</p>
</dd></dl>
</dd><dt><code>version</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>http protocol version</p>
</dd></dl>
</dd><dt><code>code</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>response code</p>
</dd></dl>
</dd><dt><code>keep_alive</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>right not unsupported, always close the connection</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if calling the object <code>nne</code> method returns a <code>false</code>
value, won&#39;t print debug information</p>
</dd></dl>
</dd><dt><code>eol</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>string to attach to the end of each line in the response</p>
</dd></dl>
</dd></dl>

<p>@return [String] response with headers</p>
          
          

          
          <div class="method-source-code" id="http_response_base-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2591</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">http_response_base</span> <span class="ruby-identifier">args</span> = []
  <span class="ruby-identifier">payload</span>,
    <span class="ruby-identifier">content_type</span>,
    <span class="ruby-identifier">code</span>,
    <span class="ruby-identifier">version</span>,
    <span class="ruby-identifier">keep_alive</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">eol</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-identifier">rv</span> = [
    <span class="ruby-node">&quot;HTTP/#{version} #{code}&quot;</span>,
    <span class="ruby-node">&quot;Content-Type: #{content_type};&quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot; charset=#{payload.encoding.name.downcase}&quot;</span>,
    <span class="ruby-node">&quot;Content-Length: #{payload.bytesize}&quot;</span>,
    <span class="ruby-identifier">keep_alive</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;Connection: close&quot;</span>,
    <span class="ruby-string">&quot;&quot;</span>,
    <span class="ruby-node">&quot;#{payload}&quot;</span>
  ]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} will return #{rv}&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-identifier">rv</span>.<span class="ruby-identifier">join</span> <span class="ruby-identifier">eol</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input_multi_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input_multi_line</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens an echoing multiline prompt, if arg1 is nil or empty not prepared to
work with binary input (which can contain 0) closed for extensions args:</p>
<dl class="rdoc-list label-list"><dt> arg1 (String or nil)
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="input_multi_line-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 752</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input_multi_line</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;multiline[enter + control-D to stop]:&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">join</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input_multi_line_non_echo" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input_multi_line_non_echo</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens a non-echoing multiline prompt, if arg1 is nil or empty not prepared
to work with binary input (which can contain 0) closed for extensions args:</p>
<dl class="rdoc-list label-list"><dt> arg1 (String or nil)
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="input_multi_line_non_echo-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 765</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input_multi_line_non_echo</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;io/console&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;multiline[enter + control-D to stop]:&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">readlines</span>}.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">chomp</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input_non_empty_filepath_or_contents_or_multiline_prompt" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input_non_empty_filepath_or_contents_or_multiline_prompt</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns the <a
href="RubymentModule.html#method-i-filepath_or_contents">#filepath_or_contents</a>
of the first value of args if it is a non empty string, or prompt for a
multi line string. useful for reading file contents, e.g.</p>
          
          

          
          <div class="method-source-code" id="input_non_empty_filepath_or_contents_or_multiline_prompt-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 713</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input_non_empty_filepath_or_contents_or_multiline_prompt</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;multiline[enter + control-D to stop]:&quot;</span>
  (<span class="ruby-identifier">filepath_or_contents</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span>  <span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">join</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input_non_empty_string_or_multiline_prompt" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input_non_empty_string_or_multiline_prompt</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns the first value of args if it is a non empty string, or prompt for
a multi line string. useful for reading file contents, e.g.</p>
          
          

          
          <div class="method-source-code" id="input_non_empty_string_or_multiline_prompt-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 702</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input_non_empty_string_or_multiline_prompt</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;multiline[enter + control-D to stop]:&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span>  <span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">join</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input_shift" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input_shift</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="input_shift-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 832</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input_shift</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input_shift_or_empty_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input_shift_or_empty_string</span><span
            class="method-args">(args=ARGV, default = '')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="input_shift_or_empty_string-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 828</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input_shift_or_empty_string</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>, <span class="ruby-identifier">default</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">default</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input_single_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input_single_line</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens an echoing prompt, if arg1 is nil or empty not prepared to work with
binary input (which can contain 0) closed for extensions args:</p>
<dl class="rdoc-list label-list"><dt> arg1 (String or nil)
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="input_single_line-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 725</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input_single_line</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;single line:&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input_single_line_non_echo" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input_single_line_non_echo</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens a non-echoing prompt, if arg1 is nil or empty not prepared to work
with binary input (which can contain 0) closed for extensions args:</p>
<dl class="rdoc-list label-list"><dt> arg1 (String or nil)
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="input_single_line_non_echo-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 738</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input_single_line_non_echo</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;io/console&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;non echo single line:&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>}.<span class="ruby-identifier">chomp</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-invoke" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invoke</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>invoke first arg with following args used by initialize</p>
          
          

          
          <div class="method-source-code" id="invoke-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 266</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invoke</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">arg_list</span> = <span class="ruby-identifier">array_first_remainder</span> <span class="ruby-identifier">args</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">method_name</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># this condition could become ambiguous only when</span>
    <span class="ruby-comment"># a function has only one argument (if it has</span>
    <span class="ruby-comment"># more, the rescue case would fail anyway. if</span>
    <span class="ruby-comment"># it has zero, both are equally OK).</span>
    <span class="ruby-comment"># In only one argument case, it is better not to</span>
    <span class="ruby-comment"># splat -- because most of the functions takes</span>
    <span class="ruby-comment"># an array as argument. the drawback is that</span>
    <span class="ruby-comment"># functions taking only one argument can&#39;t be</span>
    <span class="ruby-comment"># called from the command line (an array will</span>
    <span class="ruby-comment"># be given to them)</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">method</span>(<span class="ruby-identifier">method_name</span>).<span class="ruby-identifier">call</span> (<span class="ruby-identifier">arg_list</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">method</span>(<span class="ruby-identifier">method_name</span>).<span class="ruby-identifier">call</span> <span class="ruby-operator">*</span>(<span class="ruby-identifier">arg_list</span>)
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e2</span>
      <span class="ruby-comment"># it didn&#39;t work -- the arguments given can&#39;t</span>
      <span class="ruby-comment"># be fit. better just try to let the caller</span>
      <span class="ruby-comment"># figure out when it first called the function.</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">e2</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-invoke_double" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invoke_double</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>enables the possibility to inkove a second method with the results of a
first one. eg, the results of a method</p>

<pre class="ruby"><span class="ruby-identifier">called</span> <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">which</span> <span class="ruby-identifier">returns</span> <span class="ruby-identifier">without</span> <span class="ruby-identifier">output</span>
</pre>

<p>can be output as:</p>
<dl class="rdoc-list label-list"><dt> “puts”, “file_permissions_octal”, “/”
<dd>
<p>TODO; flawed example</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="invoke_double-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 357</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invoke_double</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">second_invokation</span>, <span class="ruby-identifier">first_invokation</span> = [<span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]]
  <span class="ruby-identifier">first_invokation_result</span> = (<span class="ruby-identifier">invoke</span> <span class="ruby-identifier">first_invokation</span>)
  <span class="ruby-identifier">invoke</span> [<span class="ruby-identifier">second_invokation</span>] <span class="ruby-operator">+</span> [<span class="ruby-identifier">first_invokation_result</span>].<span class="ruby-identifier">flatten</span>(<span class="ruby-value">1</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-io_echo" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">io_echo</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>gets an input from <code>io</code> and writes it back to the same
<code>io</code> supports an optional <code>replace</code> and
<code>replacement</code> parameter that can be used to make simple changes
to the echoing output @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>io</code>
<dd><dl class="rdoc-list label-list"><dt>IO
<dd>
<p>any <code>IO</code>, like a <code>Socket</code>, returned by
#TCPServer::accept</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if evals to false (or empty string), won&#39;t print debug information</p>
</dd></dl>
</dd><dt><code>replace</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>replacement</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>happy_with_request</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>if nil, <code>eol</code> is used.</p>
</dd></dl>
</dd></dl>

<p>@return [nil]</p>
          
          

          
          <div class="method-source-code" id="io_echo-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2775</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">io_echo</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>, <span class="ruby-identifier">replace</span>, <span class="ruby-identifier">replacement</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-comment"># this is an inefficient replacement:</span>
  <span class="ruby-identifier">replace</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-identifier">replacement</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">io_transform</span> [
    <span class="ruby-identifier">io</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">happy_with_request</span>,
    <span class="ruby-value">:array_maps</span>,
    [
      <span class="ruby-value">:gsub!</span>, [<span class="ruby-identifier">replace</span>, <span class="ruby-identifier">replacement</span>]
    ],
  ]

  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-io_forward" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">io_forward</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>gets and forwards the input from one IO to a list of IOs @param [Array]
<code>args</code>, an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>ios_out</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>array of <code>IO</code>, where data will be written to.</p>
</dd></dl>
</dd><dt><code>io_in</code>
<dd><dl class="rdoc-list label-list"><dt>IO
<dd>
<p>any <code>IO</code>, like a <code>Socket</code>, returned by
#TCPServer::accept, where data will be read from.</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if evals to false (or empty string), won&#39;t print debug information</p>
</dd></dl>
</dd><dt><code>happy_with_request</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>if nil, <code>eol</code> is used.</p>
</dd></dl>
</dd></dl>

<p>@return [nil]</p>
          
          

          
          <div class="method-source-code" id="io_forward-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2723</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">io_forward</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>

  <span class="ruby-identifier">ios_out</span>,
    <span class="ruby-identifier">io_in</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">happy_with_request</span>,
    <span class="ruby-identifier">reserved</span>,
    <span class="ruby-identifier">processing_method</span>,
    <span class="ruby-identifier">processing_method_args</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">io_gets_args</span> = [<span class="ruby-identifier">io_in</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>]
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-identifier">input</span> = <span class="ruby-identifier">io_gets</span> <span class="ruby-identifier">io_gets_args</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">ios_out</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-identifier">processing_method</span> <span class="ruby-operator">||=</span> <span class="ruby-value">:echo</span>
  <span class="ruby-identifier">processing_method_args</span> <span class="ruby-operator">||=</span> []
  <span class="ruby-identifier">processed_input</span> = <span class="ruby-identifier">to_method</span>(
    [<span class="ruby-identifier">processing_method</span>]).<span class="ruby-identifier">call</span>(
      [<span class="ruby-identifier">input</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">processing_method_args</span>
  )
  <span class="ruby-identifier">ios_out</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">shared_io_out</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">runoe_threaded</span>(<span class="ruby-identifier">shared_io_out</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">io_out</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">io_out</span> = <span class="ruby-identifier">shared_io_out</span>
      <span class="ruby-identifier">io_out</span>.<span class="ruby-identifier">print</span> <span class="ruby-identifier">processed_input</span>
      <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
        <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{io_out}: #{processed_input.size} bytes: response writen.&quot;</span>
      )
      <span class="ruby-identifier">io_out</span>.<span class="ruby-identifier">close</span>
      <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
        <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{io_out}: IO closed.&quot;</span>
      )

    }
  }
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-io_gets" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">io_gets</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>will call gets on  <code>io</code> until line starts with
<code>happy_with_request</code> @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>io</code>
<dd><dl class="rdoc-list label-list"><dt>IO
<dd>
<p>any <code>IO</code>, like a <code>Socket</code>, returned by
#TCPServer::accept</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if evals to false (or empty string), won&#39;t print debug information</p>
</dd></dl>
</dd><dt><code>happy_with_request</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>if nil, <code>eol</code> is used.</p>
</dd></dl>
</dd><dt><code>eol</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>end of line</p>
</dd></dl>
</dd></dl>

<p>@return [Array] array of strings having the lines read from the IO.</p>
          
          

          
          <div class="method-source-code" id="io_gets-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2662</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">io_gets</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">happy_with_request</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;\r\n&quot;</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-identifier">lines</span> = []
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-constant">Float</span><span class="ruby-operator">::</span><span class="ruby-constant">INFINITY</span>).
    <span class="ruby-identifier">lazy</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">r</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">io</span>.<span class="ruby-identifier">gets</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">r</span>)
      <span class="ruby-identifier">r</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">happy_with_request</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">r</span>
    }.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">x</span> }
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-identifier">lines</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-io_http_OK_response" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">io_http_OK_response</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>writes a response to an IO (e.g.: socket) @param [Array] <code>args</code>,
an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if evals to false (or empty string), won&#39;t print debug information</p>
</dd></dl>
</dd><dt><code>reserved</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>for future use</p>
</dd></dl>
</dd><dt><code>args_for_http_OK_response</code>
<dd><dl class="rdoc-list label-list"><dt>splat
<dd>
<p>args to be forwarded to <a
href="RubymentModule.html#method-i-http_OK_response">http_OK_response</a>
(check it for specification)</p>
</dd></dl>
</dd></dl>

<p>@return [nil]</p>
          
          

          
          <div class="method-source-code" id="io_http_OK_response-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2804</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">io_http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">reserved</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args_for_http_OK_response</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
  <span class="ruby-identifier">response</span> = <span class="ruby-identifier">http_OK_response</span> <span class="ruby-identifier">args_for_http_OK_response</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">inspect</span>
  )
  <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;response writen.&quot;</span>)
  <span class="ruby-identifier">io</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;IO closed.&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-io_transform" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">io_transform</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>gets an input from <code>io</code> and writes it back to the same
<code>io</code> supports an optional <code>replace</code> and
<code>replacement</code> parameter that can be used to make simple changes
to the echoing output @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>io</code>
<dd><dl class="rdoc-list label-list"><dt>IO
<dd>
<p>any <code>IO</code>, like a <code>Socket</code>, returned by
#TCPServer::accept</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if evals to false (or empty string), won&#39;t print debug information</p>
</dd></dl>
</dd><dt><code>transform_method_name</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>transform_method_args</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>args to be given to the +<code>transform_method_name</code></p>
</dd></dl>
</dd><dt><code>happy_with_request</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>if nil, <code>eol</code> is used.</p>
</dd></dl>
</dd></dl>

<p>@return [nil]</p>
          
          

          
          <div class="method-source-code" id="io_transform-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2692</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">io</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">happy_with_request</span>,
    <span class="ruby-identifier">transform_method_name</span>,
    <span class="ruby-identifier">transform_method_args</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;transform_method_name: #{transform_method_name}&quot;</span>)
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;transform_method_args: #{transform_method_args.inspect}&quot;</span>)
  <span class="ruby-identifier">io_forward</span> [[<span class="ruby-identifier">io</span>], <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>, <span class="ruby-identifier">reserved</span>,
    <span class="ruby-value">:test__transform_call</span>, [
      <span class="ruby-identifier">transform_method_name</span>,
      <span class="ruby-identifier">transform_method_args</span>,
      <span class="ruby-string">&quot;on_object:true&quot;</span>,
    ]
  ]
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-main" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">main</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>print arguments given</p>
          
          

          
          <div class="method-source-code" id="main-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 869</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">main</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">time</span>   = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:time</span>]
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">join</span> <span class="ruby-string">&quot; &quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-object_method_args_call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">object_method_args_call</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>calls object.method call_args note: function closed for extension. a new
extension if ever made, will  be created with a new function. args:</p>
<dl class="rdoc-list label-list"><dt>method (Method or String), object (Object), call_args (Array)
<dd>
<p>returns:</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="object_method_args_call-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 604</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">object_method_args_call</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">method</span>, <span class="ruby-identifier">object</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">call_args</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">object</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>
  <span class="ruby-identifier">method</span> = <span class="ruby-identifier">to_object_method</span> [<span class="ruby-identifier">method</span>, <span class="ruby-identifier">object</span>]
  <span class="ruby-identifier">call_args</span> = <span class="ruby-identifier">call_args</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">containerize</span> <span class="ruby-identifier">call_args</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">call_args</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">method</span>.<span class="ruby-identifier">call</span> <span class="ruby-operator">*</span><span class="ruby-identifier">call_args</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">method</span>.<span class="ruby-identifier">call</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NameError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nameError</span>
    <span class="ruby-comment"># every object (even nil) has :method,</span>
    <span class="ruby-comment"># and every Method has :call: exception</span>
    <span class="ruby-comment"># is thrown in call</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">nameError</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-output_array_to_shell" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output_array_to_shell</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>outputs in such a way that it can be given as an array of parameters via
bash shell not fully tested, use with caution.</p>
          
          

          
          <div class="method-source-code" id="output_array_to_shell-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 840</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-string">&quot;\&quot;&quot;</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">arg</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\&quot;&quot;</span>
  }.<span class="ruby-identifier">join</span> <span class="ruby-string">&quot; &quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-output_dec_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output_dec_file</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>output encrypted data (and data required to decrypt) into
encrypted_base64_filename</p>
          
          

          
          <div class="method-source-code" id="output_dec_file-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1526</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">output_dec_file</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">base64_json_serialized_data</span> = <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">enc_filename_or_url</span>

  <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_json_serialized_data</span>
  <span class="ruby-identifier">base64_iv</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iv&quot;</span>]
  <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_encrypted&quot;</span>]
  <span class="ruby-identifier">base64_salt</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_salt&quot;</span>]
  <span class="ruby-identifier">base64_iter</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iter&quot;</span>]
  <span class="ruby-identifier">base64_key</span>  = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_key&quot;</span> ]
  <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">pw_plain</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span>]
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">pw_plain</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# File written: \n# #{out_filename}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-output_enc_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output_enc_file</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>output encrypted data (and data required to decrypt) into
encrypted_base64_filename</p>
          
          

          
          <div class="method-source-code" id="output_enc_file-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1506</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">output_enc_file</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">encrypted_base64_filename</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">metadata</span> = {
    <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span>,
    <span class="ruby-string">&quot;base64_iv&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iv</span>,
    <span class="ruby-string">&quot;base64_encrypted&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_encrypted</span>,
    <span class="ruby-string">&quot;base64_salt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_salt</span>,
    <span class="ruby-string">&quot;base64_iter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iter</span>,
  }
  <span class="ruby-identifier">base64_json_serialized_data</span> =  <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">base64_json_serialized_data</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# File written: \n# #{encrypted_base64_filename}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-pushdown_operate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pushdown_operate</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>operates and/or returns a structure similar to an pushdown automaton.
@param [Array] <code>args</code>, an <code>Array</code> whose elements are
expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>pd</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>an <code>Array</code> whose elements are :</p>
</dd></dl>
</dd><dt><code>pd.operand</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>current state</p>
</dd></dl>
</dd><dt><code>pd.stack</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>state stack</p>
</dd></dl>
</dd><dt><code>operation_plan</code>
<dd><dl class="rdoc-list label-list"><dt>Array, <a href="Object.html">Object</a>
<dd>
<p><code>false</code> object is interpreted as no operation (only creates a
pd). Otherwise, it is an <code>Array</code> whose elements are :</p>
</dd></dl>
</dd></dl>

<pre class="ruby"><span class="ruby-identifier">reserved_token</span>, <span class="ruby-identifier">reservation_type</span>, <span class="ruby-identifier">token</span> = <span class="ruby-identifier">operation_plan</span>.<span class="ruby-identifier">to_a</span>
</pre>
<dl class="rdoc-list note-list"><dt><code>operation_plan.reserved_token</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>operates stack if <code>true</code>, otherwise, operate <code>state</code></p>
</dd></dl>
</dd><dt><code>operation_plan.reservation_type</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>pushes stack if <code>true</code> into state, otherwise, pops.</p>
</dd></dl>
</dd><dt><code>operation_plan.token</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>state operand (element that will be pushed into the current state, when
operating <code>state</code>)</p>
</dd></dl>
</dd><dt><code>operation_plan.bulk</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if calling the object <code>nne</code> method returns a <code>true</code>
value, will operate as <code>operation_plan.token</code> is a container of
tokens instead. If the object is an <code>Array</code>, it will prepend the
first element and append to <code>pd.operand</code> after the bulk
insertion is done.</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p><code>debug.nne</code> will be used to determine whether to output or not
debug information.</p>
</dd></dl>
</dd><dt><code>pd</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd></dd></dl>
</dd></dl>

<p>@return [Array] returns the operated (or a new, when no operation)
<code>pd</code></p>
          
          

          
          <div class="method-source-code" id="pushdown_operate-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3857</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pushdown_operate</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">pd</span>,
    <span class="ruby-identifier">operation_plan</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

  <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">nne</span> []
  <span class="ruby-identifier">array_operand</span>,
    <span class="ruby-identifier">array_operands_stack</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">pd</span>

  <span class="ruby-identifier">operation_plan</span> = <span class="ruby-identifier">operation_plan</span>.<span class="ruby-identifier">nne</span>

  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;{#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;operation_plan=#{operation_plan.inspect}&quot;</span>)

  <span class="ruby-identifier">array_operands_stack</span> = <span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">nne</span> []
  <span class="ruby-identifier">array_operand</span> = <span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">nne</span> []

  <span class="ruby-identifier">reserved_token</span>,
    <span class="ruby-identifier">reservation_type</span>,
    <span class="ruby-identifier">token</span>,
    <span class="ruby-identifier">reserved_token_symbol</span>,
    <span class="ruby-identifier">bulk</span> = <span class="ruby-identifier">operation_plan</span>.<span class="ruby-identifier">to_a</span>
  <span class="ruby-identifier">bulk</span> = <span class="ruby-identifier">bulk</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reserved_token=#{reserved_token.inspect}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reservation_type=#{reservation_type.inspect}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;token=#{token.inspect}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;bulk=#{bulk.inspect}&quot;</span>)
  <span class="ruby-identifier">operation_plan</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">reserved_token</span> <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-identifier">reservation_type</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_up_token: #{token.inspect}&quot;</span>)
      <span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">array_operand</span>
      <span class="ruby-identifier">array_operand</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-keyword">true</span>
    ) <span class="ruby-operator">||</span> (
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_down_token: #{token.inspect}&quot;</span>)
      <span class="ruby-comment"># this approach:</span>
      <span class="ruby-comment">#  array_operand = array_operands_stack.pop.push array_operand</span>
      <span class="ruby-comment"># won&#39;t accept pops when the stack is empty.</span>
      <span class="ruby-comment"># this approach:</span>
      <span class="ruby-comment">#  array_operand = array_operands_stack.pop.to_a.push array_operand</span>
      <span class="ruby-comment"># will work as a &quot;push&quot; was added to the beginning</span>
      <span class="ruby-comment"># another approach (not coded here) would be stop accept</span>
      <span class="ruby-comment"># pushes to *array_operand* (at least when a new</span>
      <span class="ruby-comment"># stack push/token up is done). To keep simplicity,</span>
      <span class="ruby-comment"># the reset approach is done (past is forgotten),</span>
      <span class="ruby-comment"># but the other options are left for the case of a</span>
      <span class="ruby-comment"># future option implementation</span>
      <span class="ruby-identifier">array_operand</span> = (<span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">array_operand</span>) <span class="ruby-keyword">rescue</span> []
      <span class="ruby-keyword">true</span>
    )
  ) <span class="ruby-operator">||</span> <span class="ruby-identifier">operation_plan</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_no_token: #{token.inspect}&quot;</span>)

      <span class="ruby-identifier">bulk_token_duck_type_method</span> = <span class="ruby-value">:map</span>
      <span class="ruby-identifier">bulk_token_push</span> = <span class="ruby-identifier">bulk</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">bulk_token_duck_type_method</span>)
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;[bulk, bulk_token_duck_type_method, bulk_token_push]=#{[bulk, bulk_token_duck_type_method, bulk_token_push].inspect}&quot;</span>)
      <span class="ruby-identifier">bulk_token_push</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">token</span>)
      <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">bulk</span>.<span class="ruby-identifier">to_a</span>
      <span class="ruby-identifier">bulk_token_push</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">token</span> = [<span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">append</span>].<span class="ruby-identifier">flatten</span>(<span class="ruby-value">1</span>))
      <span class="ruby-identifier">bulk_token_push</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">token</span>.<span class="ruby-identifier">map</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:push</span>))
      <span class="ruby-keyword">true</span>
  )
  <span class="ruby-identifier">pd</span> = [<span class="ruby-identifier">array_operand</span>, <span class="ruby-identifier">array_operands_stack</span>]
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{pd.inspect}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning}&quot;</span>)
  <span class="ruby-identifier">pd</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rest_request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rest_request</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>makes a rest request. @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>url</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>payload</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>verify_ssl</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd></dd></dl>
</dd><dt><code>headers</code>
<dd><dl class="rdoc-list label-list"><dt>Hash
<dd>
<p>+“Authorization”+ key will be added to it if <code>auth_user</code> is
given.</p>
</dd></dl>
</dd><dt><code>method</code>
<dd><dl class="rdoc-list label-list"><dt>HTTP method
<dd>
<p>one of <code>:get</code>, <code>:method</code>, <code>:post</code> or
<code>:delete</code></p>
</dd></dl>
</dd><dt><code>auth_user</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>username for basic authentication method</p>
</dd></dl>
</dd><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password for basic authentication method. Will prompt without echo if
<code>nil</code> and <code>auth_user</code> is not <code>nil</code></p>
</dd></dl>
</dd><dt><code>timeout</code>
<dd><dl class="rdoc-list label-list"><dt>Fixnum
<dd></dd></dl>
</dd></dl>

<p>@return [String] the response</p>
          
          

          
          <div class="method-source-code" id="rest_request-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 955</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rest_request</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  (<span class="ruby-identifier">rest_response__request_base</span> <span class="ruby-identifier">args</span>).<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rest_request_or_open_uri_open" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rest_request_or_open_uri_open</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>calls <a href="RubymentModule.html#method-i-rest_request">rest_request</a>
(which depends on +&#39;rest-client&#39;+ gem) in the case it throws an
exception, tries to call +&#39;open-uri&#39;+&#39;s open. note that not the
arguments below refer to the <a
href="RubymentModule.html#method-i-rest_request">rest_request</a> for open,
only  <code>auth_user</code> and <code>password</code> will be forwarded,
as they come to this function. @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>url</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>payload</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>verify_ssl</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>defaults to <code>false</code></p>
</dd></dl>
</dd><dt><code>headers</code>
<dd><dl class="rdoc-list label-list"><dt>Hash
<dd>
<p>+“Authorization”+ key will be added to it if <code>auth_user</code> is
given. Defaults to +{}+</p>
</dd></dl>
</dd><dt><code>method</code>
<dd><dl class="rdoc-list label-list"><dt>HTTP method
<dd>
<p>one of <code>:get</code>, <code>:method</code>, <code>:post</code> or
<code>:delete</code>. defaults to <code>:get</code></p>
</dd></dl>
</dd><dt><code>auth_user</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>username for basic authentication method</p>
</dd></dl>
</dd><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password for basic authentication method. Will prompt without echo if
<code>nil</code> and <code>auth_user</code> is not <code>nil</code></p>
</dd></dl>
</dd><dt><code>timeout</code>
<dd><dl class="rdoc-list label-list"><dt>Fixnum, nil
<dd>
<p>defaults to <code>nil</code></p>
</dd></dl>
</dd><dt><code>skip_open_uri</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>don&#39;t bother trying with open</p>
</dd></dl>
</dd></dl>

<p>@return [Array] the response</p>
          
          

          
          <div class="method-source-code" id="rest_request_or_open_uri_open-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 977</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rest_request_or_open_uri_open</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">url</span>,
    <span class="ruby-identifier">payload</span>,
    <span class="ruby-identifier">verify_ssl</span>,
    <span class="ruby-identifier">headers</span>,
    <span class="ruby-identifier">method</span>,
    <span class="ruby-identifier">auth_user</span>,
    <span class="ruby-identifier">password</span>,
    <span class="ruby-identifier">timeout</span>,
    <span class="ruby-identifier">skip_open_uri</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">skip_open_uri</span> = <span class="ruby-identifier">skip_open_uri</span>.<span class="ruby-identifier">nne</span>

  <span class="ruby-identifier">response</span> = <span class="ruby-identifier">runea</span> [<span class="ruby-string">&quot;yes, rescue&quot;</span>,
    <span class="ruby-string">&quot;output exception&quot;</span>.<span class="ruby-identifier">negate_me</span>,
    <span class="ruby-string">&quot;nil on exception&quot;</span>
  ] {
    <span class="ruby-identifier">send</span> <span class="ruby-value">:rest_request</span>, [
      <span class="ruby-identifier">url</span>,
      <span class="ruby-identifier">payload</span>,
      <span class="ruby-identifier">verify_ssl</span>,
      <span class="ruby-identifier">headers</span>,
      <span class="ruby-identifier">method</span>,
      <span class="ruby-identifier">auth_user</span>,
      <span class="ruby-identifier">password</span>,
      <span class="ruby-identifier">timeout</span>,
    ]
  }
  <span class="ruby-identifier">response</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">runea</span> [<span class="ruby-string">&quot;yes, rescue&quot;</span>.<span class="ruby-identifier">negate_me</span>,
    <span class="ruby-string">&quot;output exception&quot;</span>.<span class="ruby-identifier">negate_me</span>,
    <span class="ruby-string">&quot;nil on exception&quot;</span>
  ] {
    <span class="ruby-operator">!</span><span class="ruby-identifier">skip_open_uri</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">send</span>(
      <span class="ruby-value">:open</span>,
      <span class="ruby-identifier">url</span>,
      <span class="ruby-value">:http_basic_authentication</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">auth_user</span>, <span class="ruby-identifier">password</span>],
    ).<span class="ruby-identifier">read</span>
  }
  [<span class="ruby-identifier">response</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rest_response__request_base" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rest_response__request_base</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>makes a rest request @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>url</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>payload</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>verify_ssl</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd></dd></dl>
</dd><dt><code>headers</code>
<dd><dl class="rdoc-list label-list"><dt>Hash
<dd>
<p>+“Authorization”+ key will be added to it if <code>auth_user</code> is
given.</p>
</dd></dl>
</dd><dt><code>method</code>
<dd><dl class="rdoc-list label-list"><dt>HTTP method
<dd>
<p>one of <code>:get</code>, <code>:method</code>, <code>:post</code> or
<code>:delete</code></p>
</dd></dl>
</dd><dt><code>auth_user</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>username for basic authentication method</p>
</dd></dl>
</dd><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password for basic authentication method. Will prompt without echo if
<code>nil</code> and <code>auth_user</code> is not <code>nil</code></p>
</dd></dl>
</dd><dt><code>timeout</code>
<dd><dl class="rdoc-list label-list"><dt>Fixnum
<dd></dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>if calling the object <code>nne</code> method returns a <code>false</code>
value, won&#39;t print debug information</p>
</dd></dl>
</dd></dl>

<p>@return [Array] returns an <code>Array</code> whose elements are :</p>
<dl class="rdoc-list note-list"><dt><code>response</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>response</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>as returned by <code>RestClient::Request.execute</code>. Note that this is
a dangerous object for printing, be aware.</p>
</dd></dl>
</dd><dt><code>http_response_object</code>
<dd><dl class="rdoc-list label-list"><dt>Net::HTTPResponse
<dd></dd></dl>
</dd><dt><code>http_response_object.code</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="rest_response__request_base-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 892</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rest_response__request_base</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rest-client&#39;</span>

  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">time</span>   = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:time</span>]
  <span class="ruby-identifier">url</span>,
    <span class="ruby-identifier">payload</span>,
    <span class="ruby-identifier">verify_ssl</span>,
    <span class="ruby-identifier">headers</span>,
    <span class="ruby-identifier">method</span>,
    <span class="ruby-identifier">auth_user</span>,
    <span class="ruby-identifier">password</span>,
    <span class="ruby-identifier">timeout</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;{#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)

  <span class="ruby-identifier">auth_user</span> = <span class="ruby-identifier">auth_user</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">password</span>  = <span class="ruby-identifier">password</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">method</span>    = <span class="ruby-identifier">method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:get</span>
  <span class="ruby-identifier">headers</span>   = <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">nne</span>({})
  <span class="ruby-identifier">base64_auth</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> [
    <span class="ruby-identifier">auth_user</span>,
    <span class="ruby-identifier">auth_user</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>])
  ].<span class="ruby-identifier">join</span> <span class="ruby-string">&quot;:&quot;</span>
  <span class="ruby-identifier">auth_user</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;Authorization&quot;</span>] = <span class="ruby-node">&quot;Basic #{base64_auth}&quot;</span>)
  <span class="ruby-identifier">response</span>,
    <span class="ruby-identifier">request</span>,
    <span class="ruby-identifier">http_response_object</span> = <span class="ruby-constant">RestClient</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">execute</span>(
    <span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">method</span>,
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">url</span>,
    <span class="ruby-value">:payload</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">payload</span>,
    <span class="ruby-value">:headers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">headers</span>,
    <span class="ruby-value">:verify_ssl</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">verify_ssl</span>,
    <span class="ruby-value">:timeout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">timeout</span>
  ) {<span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">args</span>}
  <span class="ruby-identifier">rv</span> = [
    <span class="ruby-identifier">response</span>.<span class="ruby-identifier">to_s</span>,
    <span class="ruby-identifier">request</span>,
    <span class="ruby-identifier">http_response_object</span>,
    <span class="ruby-identifier">http_response_object</span>.<span class="ruby-identifier">code</span>,
  ]
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{rv.map(&amp;:to_s)}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning}&quot;</span>)
  <span class="ruby-identifier">rv</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rubyment_gem_defaults" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rubyment_gem_defaults</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>defaults for the rubyment gem args:</p>
<dl class="rdoc-list label-list"><dt>gem_name, gem_version, gem_dir, gem_ext, gem_hifen
<dd>
<p>all Strings. defaults: [“rubyment”, version [], <a
href=":running_dir">memory</a>, “.gem”, “-”] returns:</p>
<dl class="rdoc-list label-list"><dt>gem_name, gem_version, gem_dir, gem_ext, gem_hifen
<dd></dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="rubyment_gem_defaults-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1916</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">running_dir</span>   = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
    <span class="ruby-identifier">basic_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:basic_version</span>]
    <span class="ruby-identifier">major_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:major_version</span>]

    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">gem_name</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;rubyment&quot;</span>
    <span class="ruby-identifier">gem_version</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">version</span> [])
    <span class="ruby-identifier">gem_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">running_dir</span>
    <span class="ruby-identifier">gem_ext</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;.gem&quot;</span>
    <span class="ruby-identifier">gem_hifen</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;-&quot;</span>
    <span class="ruby-identifier">gem_ext</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;date&quot;</span>
    <span class="ruby-identifier">gem_date</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;2018-04-23&quot;</span>
    <span class="ruby-identifier">gem_summary</span>     <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;a set of ruby helpers&quot;</span>
    <span class="ruby-identifier">gem_description</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;a gem for keeping Rubyment, a set of ruby helpers&quot;</span>
    <span class="ruby-identifier">gem_authors</span>     <span class="ruby-operator">||=</span> [<span class="ruby-string">&quot;Ribamar Santarosa&quot;</span>]
    <span class="ruby-identifier">gem_email</span>       <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;ribamar@gmail.com&#39;</span>
    <span class="ruby-identifier">gem_files</span>       <span class="ruby-operator">||=</span> [<span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>]
    <span class="ruby-identifier">gem_homepage</span>    <span class="ruby-operator">||=</span>
      <span class="ruby-node">&quot;http://rubygems.org/gems/#{gem_name}&quot;</span>
    <span class="ruby-identifier">gem_license</span>     <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;GPL-3.0&#39;</span>
    <span class="ruby-identifier">gem_validate_class</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">gem_validate_class_args</span> <span class="ruby-operator">||=</span> {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-string">&quot;installed and validated&quot;</span>] }
    <span class="ruby-identifier">gem_validate_class_method</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;new&quot;</span>
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-keyword">__FILE__</span> <span class="ruby-comment"># this enables the possibility of building</span>
    <span class="ruby-comment">#  a gem for the calling file itself, but be aware that lib/gem_file.rb</span>
    <span class="ruby-comment"># is supposed to be overriden later.</span>
    <span class="ruby-identifier">gem_bin_generate</span> = <span class="ruby-node">&quot;bin/#{gem_name}&quot;</span> <span class="ruby-comment"># generate a bin file</span>
    <span class="ruby-identifier">gem_bin_contents</span> =<span class="ruby-value">&lt;&lt;-ENDHEREDOC
#!/usr/bin/env ruby
require &#39;#{gem_name}&#39;
#{gem_validate_class}.new({:invoke =&gt; ARGV})
    ENDHEREDOC</span>
    <span class="ruby-identifier">gem_executables</span> = [ <span class="ruby-identifier">gem_bin_generate</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-node">&quot;#{gem_name}&quot;</span> ]

    [
       <span class="ruby-identifier">gem_name</span>,
       <span class="ruby-identifier">gem_version</span>,
       <span class="ruby-identifier">gem_dir</span>,
       <span class="ruby-identifier">gem_ext</span>,
       <span class="ruby-identifier">gem_hifen</span>,
       <span class="ruby-identifier">gem_date</span>,
       <span class="ruby-identifier">gem_summary</span>,
       <span class="ruby-identifier">gem_description</span>,
       <span class="ruby-identifier">gem_authors</span>,
       <span class="ruby-identifier">gem_email</span>,
       <span class="ruby-identifier">gem_files</span>,
       <span class="ruby-identifier">gem_homepage</span>,
       <span class="ruby-identifier">gem_license</span>,
       <span class="ruby-identifier">gem_validate_class</span>,
       <span class="ruby-identifier">gem_validate_class_args</span>,
       <span class="ruby-identifier">gem_validate_class_method</span>,
       <span class="ruby-identifier">gem_is_current_file</span>,
       <span class="ruby-identifier">gem_bin_generate</span>,
       <span class="ruby-identifier">gem_bin_contents</span>,
       <span class="ruby-identifier">gem_executables</span>,
   ]
  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rubyment_gem_spec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rubyment_gem_spec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="RubymentModule.html#method-i-rubyment_gem_spec">#rubyment_gem_spec</a>
args (Array, forwarded and transfomed by <a
href="RubymentModule.html#method-i-rubyment_gem_defaults">#rubyment_gem_defaults</a>)
returns: a gem spec string for <a
href="RubymentModule/Rubyment.html">Rubyment</a></p>
          
          

          
          <div class="method-source-code" id="rubyment_gem_spec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1890</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rubyment_gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">gem_spec</span> <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-runea" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">runea</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>creates and runs a <code>Proc</code> out of a block, where exceptions may
be admissible or not, and to be printed or not. it is an interface for the
run* methods above in this right moment it is not yet possible to return
the exception without printing (planned improvement) another desirable case
is to output the exception, but don&#39;t return it; not yet possible.
@param [splat] <code>args</code>, an splat whose elements are expected to
be <code>blea_args</code> and <code>blocks_args</code>:</p>
<dl class="rdoc-list note-list"><dt><code>blea_args</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>args to be used internally, which are expected to be:</p>
</dd></dl>
</dd><dt><code>exception_admitted</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd></dd></dl>
</dd><dt><code>output_exception</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd></dd></dl>
</dd><dt><code>blocks_args</code>
<dd><dl class="rdoc-list label-list"><dt>splat
<dd>
<p>args to be forwarded to the block call</p>
</dd></dl>
</dd></dl>

<p>@return the value returned by the block</p>
          
          

          
          <div class="method-source-code" id="runea-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">runea</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  (<span class="ruby-identifier">blea</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">call</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-runef" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">runef</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <pre class="ruby"><span class="ruby-identifier">runs</span> <span class="ruby-identifier">a</span> <span class="ruby-identifier">block</span> <span class="ruby-identifier">error</span> <span class="ruby-identifier">free</span>
</pre>

<p>(returns nil if exception happens)</p>
          
          

          
          <div class="method-source-code" id="runef-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">runef</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  (<span class="ruby-identifier">blef</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">call</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-runef_threaded" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">runef_threaded</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <pre>runs a block error free, in</pre>

<p>a different Thread. the Thread object</p>

<pre>is returned (call .join on it to</pre>

<p>wait for its completion) (the Thread itself returns nil if exception
happens)</p>
          
          

          
          <div class="method-source-code" id="runef_threaded-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 208</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">runef_threaded</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) {<span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">runef</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-runoe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">runoe</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>runs a block error free (if exception happens, will return an array having
the backtrace (as String) as the first member and the the Exception object
as the second).</p>
          
          

          
          <div class="method-source-code" id="runoe-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">runoe</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  (<span class="ruby-identifier">bloe</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">call</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-runoe_threaded" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">runoe_threaded</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>runs a block error free, in a different Thread. the Thread object is
returned (call .join on it to wait for its completion) (if exception
happens, the thread itself will return an array having the backtrace (as
String) as the first member and the the Exception object as the second).</p>
          
          

          
          <div class="method-source-code" id="runoe_threaded-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 235</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">runoe_threaded</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) {<span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">runoe</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_file</span><span
            class="method-args">(url, location, wtime=0, more = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>save url contents to a local file location url can be a uri to a local file
args: url (String), location (String), wtime (Integer) more (Hash) details:
<a href=":username">more</a>, <a href=":password">more</a> for
http_basic_authentication returns</p>

<pre class="ruby"><span class="ruby-identifier">contents</span> <span class="ruby-identifier">of</span> <span class="ruby-identifier">url</span> (<span class="ruby-constant">String</span>)
</pre>
          
          

          
          <div class="method-source-code" id="save_file-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 641</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_file</span> <span class="ruby-identifier">url</span>, <span class="ruby-identifier">location</span>, <span class="ruby-identifier">wtime</span>=<span class="ruby-value">0</span>, <span class="ruby-identifier">more</span> = {}
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;open-uri&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">location</span> <span class="ruby-comment"># note &quot;~&quot; doesn&#39;t work</span>
  <span class="ruby-identifier">user</span> = <span class="ruby-identifier">more</span>[<span class="ruby-value">:username</span>]
  <span class="ruby-identifier">pw</span> = <span class="ruby-identifier">more</span>[<span class="ruby-value">:password</span>]
  <span class="ruby-identifier">contents</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">url</span>, <span class="ruby-value">:http_basic_authentication</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>]).<span class="ruby-identifier">read</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">location</span>, <span class="ruby-identifier">contents</span>
  <span class="ruby-identifier">sleep</span> <span class="ruby-identifier">wtime</span>
  <span class="ruby-identifier">contents</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-serialize_json_metadata" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">serialize_json_metadata</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="RubymentModule.html#method-i-serialize_json_metadata">#serialize_json_metadata</a>
args:</p>
<dl class="rdoc-list label-list"><dt>payload (String), metadata (Hash), separator (String)
<dd>
<p>prepends a JSON dump of metadata followed by separator to a copy of
payload, and returns it.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="serialize_json_metadata-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1342</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">serialize_json_metadata</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">static_separator</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_separator_key</span>]
  <span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">separator</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">metadata</span> <span class="ruby-operator">||=</span> { }
  <span class="ruby-identifier">separator</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_separator</span>
  <span class="ruby-identifier">serialized_string</span> = (<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">separator</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">payload</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_dec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_dec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>prompts for arguments to dec, calls dec, and output the decrypted data to
stdout. args: (forwarded to <a
href="RubymentModule.html#method-i-shell_dec_input">#shell_dec_input</a>,
as of now: returns: nil</p>

<p>planned changes: stop argument shifting. call separate functions.</p>
          
          

          
          <div class="method-source-code" id="shell_dec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1181</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_json_serialized_data</span>, <span class="ruby-identifier">iv_deprecated</span> = <span class="ruby-identifier">shell_dec_input</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_json_serialized_data</span>
  <span class="ruby-identifier">base64_iv</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iv&quot;</span>]
  <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_encrypted&quot;</span>]
  <span class="ruby-identifier">base64_salt</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_salt&quot;</span>]
  <span class="ruby-identifier">base64_iter</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iter&quot;</span>]
  <span class="ruby-identifier">base64_key</span>  = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_key&quot;</span> ]
  <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">pw_plain</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
  <span class="ruby-identifier">shell_dec_output</span> [<span class="ruby-identifier">pw_plain</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_dec_input" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_dec_input</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>prompts for arguments to dec function args:</p>
<dl class="rdoc-list label-list"><dt> iv, encrypted, password 
<dd>
<p>(all Strings)</p>
</dd></dl>

<p>returns:</p>

<pre>[password, encrypted, iv] (all Strings)</pre>

<p>planned changes: call separate functions.</p>
          
          

          
          <div class="method-source-code" id="shell_dec_input-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1128</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_dec_input</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stringio&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;io/console&quot;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">debug</span>  = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:debug</span>]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">stdout</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stdout</span>]
    <span class="ruby-identifier">stdin</span>  = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stdin</span>]

    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;iv:&quot;</span>
    <span class="ruby-comment"># basically =&gt; any string other than &quot;&quot; or the default one:</span>
    <span class="ruby-identifier">iv</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">iv</span> = (<span class="ruby-identifier">url_to_str</span> <span class="ruby-identifier">iv</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">iv</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">url_to_str</span> <span class="ruby-string">&#39;out.enc.iv.base64&#39;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">iv</span>)
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;encrypted:&quot;</span>
    <span class="ruby-comment"># basically =&gt; any string other than &quot;&quot; or the default one:</span>
    <span class="ruby-identifier">encrypted</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">encrypted</span> = (<span class="ruby-identifier">url_to_str</span> <span class="ruby-identifier">encrypted</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">encrypted</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span>  <span class="ruby-operator">||</span> (<span class="ruby-identifier">url_to_str</span> <span class="ruby-string">&#39;out.enc.encrypted.base64&#39;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{encrypted}&quot;</span>)
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;password:&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">begin</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>}.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-identifier">iv</span>]
 <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># and output the decrypted data to stdout.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># planned changes:</span>
  <span class="ruby-comment"># stop argument shifting.</span>
  <span class="ruby-comment"># call separate functions.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_dec_output</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">stdout</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stdout</span>]
    <span class="ruby-identifier">pw_plain</span>, <span class="ruby-identifier">reserved_for_future</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">pw_plain</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># prompts for arguments to dec, calls dec,</span>
  <span class="ruby-comment"># and output the decrypted data to stdout.</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># (forwarded to shell_dec_input, as of now:</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># nil</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># planned changes:</span>
  <span class="ruby-comment"># stop argument shifting.</span>
  <span class="ruby-comment"># call separate functions.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_json_serialized_data</span>, <span class="ruby-identifier">iv_deprecated</span> = <span class="ruby-identifier">shell_dec_input</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_json_serialized_data</span>
    <span class="ruby-identifier">base64_iv</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iv&quot;</span>]
    <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_encrypted&quot;</span>]
    <span class="ruby-identifier">base64_salt</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_salt&quot;</span>]
    <span class="ruby-identifier">base64_iter</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iter&quot;</span>]
    <span class="ruby-identifier">base64_key</span>  = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_key&quot;</span> ]
    <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">pw_plain</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">shell_dec_output</span> [<span class="ruby-identifier">pw_plain</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># encode data into aes-128-cbc cipher protected by a key generated</span>
  <span class="ruby-comment"># by #generate_pbkdf2_key, using given +password+, +salt+, +iter+</span>
  <span class="ruby-comment"># By default, may not work with binary data. Set +data_not_base64+ to</span>
  <span class="ruby-comment"># true (or give data already as base64) to make it work.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># +data+:: [String, nil] data to be encoded data</span>
  <span class="ruby-comment"># +ending+:: [nil] deprecated</span>
  <span class="ruby-comment"># +salt+:: [String, nil] #generate_pbkdf2_key salt argument</span>
  <span class="ruby-comment"># +iter+:: [String, nil] #generate_pbkdf2_key iterations argument</span>
  <span class="ruby-comment"># +data_not_base64+:: [true, false, nil] data not yet in base64</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return @param [Array] an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +base64_encrypted+:: [String, nil] ciphered data (without metadata) encoded with Base64</span>
  <span class="ruby-comment"># +base64_iv+:: [String] initialization vectors encoded with Base64</span>
  <span class="ruby-comment"># +base64_salt+:: [String] #generate_pbkdf2_key salt encoded with Base64</span>
  <span class="ruby-comment"># +base64_iter+:: [String] #generate_pbkdf2_key iterations encoded with Base64</span>
  <span class="ruby-comment"># +base64_key+::  [String] #generate_pbkdf2_key return value</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">enc</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>]
    <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">ending</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_end_key</span>
    <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> = (
      <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
    )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

    <span class="ruby-identifier">cipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
    <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">encrypt</span>

    <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
    <span class="ruby-identifier">iv</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">random_iv</span>
    <span class="ruby-identifier">base64_data</span> = <span class="ruby-identifier">data_not_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">data</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>
    <span class="ruby-identifier">encrypted</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">base64_data</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ending</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">final</span>

    <span class="ruby-identifier">base64_iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iv</span>
    <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>  <span class="ruby-identifier">encrypted</span>
    <span class="ruby-identifier">base64_salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">base64_iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">base64_key</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>

    [<span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>,  <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># prompts for arguments to dec</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [ multiline_data, data_file, single_line_data, password, encrypted_base64_filename, enc_iv_base64_filename_deprecated] (all Strings)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment">#   [password, data, encrypted_base64_filename, enc_iv_base64_filename_deprecated]</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># planned changes:</span>
  <span class="ruby-comment"># call separate functions.</span>
  <span class="ruby-comment"># stop argument shifting.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_enc_input</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">stdout</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdout</span>]
    <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:debug</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stringio&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;io/console&quot;</span>

    <span class="ruby-identifier">data</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;multi_line_data[ data 1/3, echoing, enter + control-D to stop]:&quot;</span>
    <span class="ruby-identifier">data</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span>  (<span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">join</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">join</span>)
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;data_file [data 2/3]:&quot;</span>
    <span class="ruby-identifier">data_file</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span>  (<span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span>)
    <span class="ruby-identifier">data</span>  <span class="ruby-operator">+=</span> <span class="ruby-identifier">url_to_str</span> <span class="ruby-identifier">data_file</span>, <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;single_line_data[data 3/3, no echo part]:&quot;</span>
    <span class="ruby-identifier">data</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">begin</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>}.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;password:&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">begin</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>}.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;encrypted_base64_filename[default=out.enc.encrypted.base64]:&quot;</span>
    <span class="ruby-comment"># basically =&gt; any string other than &quot;&quot; or the default one:</span>
    <span class="ruby-identifier">encrypted_base64_filename</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;out.enc.encrypted.base64&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">encrypted_base64_filename</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;enc_iv_base64_filename[DEPRECATED]:&quot;</span>
    <span class="ruby-comment"># basically =&gt; any string other than &quot;&quot; or the default one:</span>
    <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;out.enc.iv.base64&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span>

    [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># outputs the results from enc</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_enc_output</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">base64_iv</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">base64_encrypted</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span>  <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">base64_encrypted</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># shell_enc</span>
  <span class="ruby-comment"># args</span>
  <span class="ruby-comment"># [password, data, encrypted_base64_filename, enc_iv_base64_filename_deprecated] (all Strings)</span>
  <span class="ruby-comment"># encrypts data using password and stores to encrypted_base64_filename</span>
  <span class="ruby-comment"># returns</span>
  <span class="ruby-comment"># nil</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># planned changes:</span>
  <span class="ruby-comment"># encrypted_base64_filename</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_enc</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
    <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span>  = <span class="ruby-identifier">shell_enc_input</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">salt</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">iter</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
    <span class="ruby-identifier">metadata</span> = {
      <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span>,
      <span class="ruby-string">&quot;base64_iv&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iv</span>,
      <span class="ruby-string">&quot;base64_encrypted&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_encrypted</span>,
      <span class="ruby-string">&quot;base64_salt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_salt</span>,
      <span class="ruby-string">&quot;base64_iter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iter</span>,
    }
    <span class="ruby-identifier">base64_json_serialized_data</span> =  <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>
    <span class="ruby-identifier">shell_enc_output</span> [<span class="ruby-identifier">base64_json_serialized_data</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">encrypted_base64_filename</span> ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># serialize_json_metadata</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [payload (String), metadata (Hash), separator (String)]</span>
  <span class="ruby-comment"># prepends a JSON dump of metadata followed by separator</span>
  <span class="ruby-comment"># to a copy of payload, and returns it.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">serialize_json_metadata</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_separator</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_separator_key</span>]
    <span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">separator</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">metadata</span> <span class="ruby-operator">||=</span> { }
    <span class="ruby-identifier">separator</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_separator</span>
    <span class="ruby-identifier">serialized_string</span> = (<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">separator</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">payload</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># deserialize_json_metadata</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [serialized_string (String), separator (String)]</span>
  <span class="ruby-comment"># undo what serialize_json_metadata</span>
  <span class="ruby-comment"># returns array:</span>
  <span class="ruby-comment"># [payload (String), metadata (Hash or String), separator (String)]</span>
  <span class="ruby-comment"># metadata is returned as Hash after a  JSON.parse, but in case</span>
  <span class="ruby-comment"># of any failure, it returns the String itself.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">deserialize_json_metadata</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_separator</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_separator_key</span>]
    <span class="ruby-identifier">serialized_string</span>, <span class="ruby-identifier">separator</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">separator</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_separator</span>
    <span class="ruby-identifier">metadata_json</span>, <span class="ruby-identifier">payload</span>  = <span class="ruby-identifier">serialized_string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span> <span class="ruby-identifier">separator</span>
    <span class="ruby-identifier">metadata</span> = (<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">metadata_json</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">metadata_json</span>
    [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">separator</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test__json_metadata_serialization</span>
  <span class="ruby-comment"># sanity test for serialize_json_metadata and deserialize_json_metadata</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__json_metadata_serialization</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">judgement</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">payload</span> = <span class="ruby-string">&quot;Payload&quot;</span>
    <span class="ruby-comment"># note: keys with : instead can&#39;t be recovered, because</span>
    <span class="ruby-comment"># they aren&#39;t described in JSON files</span>
    <span class="ruby-identifier">metadata</span> = { <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span> }
    <span class="ruby-identifier">serialized</span> = (<span class="ruby-identifier">serialize_json_metadata</span> [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span> ])
    <span class="ruby-identifier">new_payload</span>, <span class="ruby-identifier">new_metadata</span> = <span class="ruby-identifier">deserialize_json_metadata</span> [<span class="ruby-identifier">serialized</span>]
    <span class="ruby-identifier">judgement</span> =
      [ [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">new_payload</span>, <span class="ruby-string">&quot;payload&quot;</span>], [<span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">new_metadata</span>, <span class="ruby-string">&quot;metadata&quot;</span>]]
        .<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># format strings for  expect_format_string</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">expect_format_string</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:debug</span>]
    <span class="ruby-identifier">prepend_text</span>, <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span>, <span class="ruby-identifier">comparison_text</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-node">&quot;#{prepend_text} #{value_label}: #{value_before} #{comparison_text} #{value_after}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># expect_equal</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [ value_before (Object), value_after (Object), value_label (String) ]</span>
  <span class="ruby-comment"># returns the value of testing value_before == value_after, printing to</span>
  <span class="ruby-comment"># stderr upon failure</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">expect_equal</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">judgement</span> = (<span class="ruby-identifier">value_before</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">value_after</span>)
    (<span class="ruby-operator">!</span><span class="ruby-identifier">judgement</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>  <span class="ruby-identifier">expect_format_string</span> [<span class="ruby-string">&quot;unexpected&quot;</span>, <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span>, <span class="ruby-string">&quot;!=&quot;</span>])
    <span class="ruby-identifier">judgement</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test__shell_enc_dec</span>
  <span class="ruby-comment"># sanity test for shell_enc and shell_dec</span>
  <span class="ruby-comment"># planned changes:</span>
  <span class="ruby-comment"># don&#39;t output to stdout</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__shell_enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">shell_enc</span> [<span class="ruby-string">&quot;my secret&quot;</span>,  <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>,  <span class="ruby-string">&quot;tijolo22&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>]
    <span class="ruby-identifier">judgement</span> = ( <span class="ruby-identifier">shell_dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;tijolo22&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">true</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># an alternative interface to dec -- reads password if</span>
  <span class="ruby-comment"># nil or empty.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args Defaults to +ARGV+. Elements:</span>
  <span class="ruby-comment"># * +data+ [String, nil] data to be encrypted, If empty or nil, read (without</span>
  <span class="ruby-comment"># echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># * +password+ [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># +data_not_base64+:: [true, false, nil] don&#39;t return base64 data -- the same +data_not_base64+ given for enc should be used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [TrueClass, FalseClass] depending on whether test succeeds.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span>  = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = (<span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>])
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_not_base64</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for enc and dec.</span>
  <span class="ruby-comment"># &quot;&quot; and nil are expected to be treated</span>
  <span class="ruby-comment"># as the same.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_nil</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">nil_case</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
    <span class="ruby-identifier">empty</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">nil_case</span>, <span class="ruby-identifier">empty</span>, <span class="ruby-string">&quot;empty_nil_equality&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for enc and dec and output_array_to_shell.</span>
  <span class="ruby-comment"># output_array_to_shell should create proper arguments</span>
  <span class="ruby-comment">#  to dec</span>
  <span class="ruby-comment"># TODO: invalid test -- that can&#39;t yet be ensured</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_shell_programatically</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;test invalid; skip&quot;</span>
    <span class="ruby-identifier">shell</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">programatically</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">shell</span>, <span class="ruby-identifier">programatically</span>, <span class="ruby-string">&quot;shell_programatically_equality&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for enc and dec.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +data+:: [String, nil] data to be encrypted.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [TrueClass, FalseClass] depending on whether test succeeds.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">dec_args</span> = [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# WARNING: secrets, including password are printed here. Storing them may be a major security incident.&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_args</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double p dec &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_args</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># output encrypted data (and data required to</span>
  <span class="ruby-comment"># decrypt) into encrypted_base64_filename</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">output_enc_file</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">encrypted_base64_filename</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">metadata</span> = {
      <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span>,
      <span class="ruby-string">&quot;base64_iv&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iv</span>,
      <span class="ruby-string">&quot;base64_encrypted&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_encrypted</span>,
      <span class="ruby-string">&quot;base64_salt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_salt</span>,
      <span class="ruby-string">&quot;base64_iter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iter</span>,
    }
    <span class="ruby-identifier">base64_json_serialized_data</span> =  <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">base64_json_serialized_data</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# File written: \n# #{encrypted_base64_filename}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># output encrypted data (and data required to</span>
  <span class="ruby-comment"># decrypt) into encrypted_base64_filename</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">output_dec_file</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">base64_json_serialized_data</span> = <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">enc_filename_or_url</span>

    <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_json_serialized_data</span>
    <span class="ruby-identifier">base64_iv</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iv&quot;</span>]
    <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_encrypted&quot;</span>]
    <span class="ruby-identifier">base64_salt</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_salt&quot;</span>]
    <span class="ruby-identifier">base64_iter</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iter&quot;</span>]
    <span class="ruby-identifier">base64_key</span>  = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_key&quot;</span> ]
    <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">pw_plain</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span>]
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">pw_plain</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# File written: \n# #{out_filename}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for enc and dec_interactive.</span>
  <span class="ruby-comment"># good idea is to use this function once with the desired</span>
  <span class="ruby-comment"># data, password, and use the stderr output</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">data_not_base64</span> ]
    <span class="ruby-comment"># the output is supposed to be safe to store,</span>
    <span class="ruby-comment"># so password is not placed in from dec_interactive_args:</span>
    <span class="ruby-identifier">dec_interactive_args</span> = [<span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec_interactive &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_interactive_args</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double puts dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#or shell var:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;my_secret=$(#{$0} invoke_double puts dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)\necho $my_secret\nunset mysecret&quot;</span>
    <span class="ruby-identifier">encrypted_base64_filename</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">output_enc_file</span>(<span class="ruby-identifier">dec_interactive_args</span>  <span class="ruby-operator">+</span> [<span class="ruby-identifier">encrypted_base64_filename</span>])
    <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">dec_interactive</span>(<span class="ruby-identifier">dec_interactive_args</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span>])
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># similar to</span>
  <span class="ruby-comment"># test__enc_dec_interactive,</span>
  <span class="ruby-comment"># just that the data is ready from a file instead</span>
  <span class="ruby-comment"># note that there is an extra argument between</span>
  <span class="ruby-comment"># the args, the enc_out_filename.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">filename_or_url</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[filename_or_url]&quot;</span>
    <span class="ruby-identifier">filename_or_url</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">filename_or_url</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_encrypted_data]&quot;</span>
    <span class="ruby-identifier">enc_out_filename</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_out_filename</span> ]
    <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">filename_or_url</span>
    <span class="ruby-identifier">test__enc_dec_interactive</span> [ <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">data_not_base64</span> ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># basically the reverse of test__enc_dec_file_interactive</span>
  <span class="ruby-comment"># planned improvements: still outputs to stdout</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[enc_filename_or_url]&quot;</span>
    <span class="ruby-identifier">enc_filename_or_url</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_filename_or_url</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_plain_data]&quot;</span>
    <span class="ruby-identifier">out_filename</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">out_filename</span> ]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">enc_filename_or_url</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">base64_json_serialized_data</span> = <span class="ruby-identifier">data</span>
    <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_json_serialized_data</span>
    <span class="ruby-identifier">base64_iv</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iv&quot;</span>]
    <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_encrypted&quot;</span>]
    <span class="ruby-identifier">base64_salt</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_salt&quot;</span>]
    <span class="ruby-identifier">base64_iter</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iter&quot;</span>]
    <span class="ruby-identifier">base64_key</span>  = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_key&quot;</span> ]
    <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">pw_plain</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_not_base64</span>]
    <span class="ruby-identifier">shell_dec_output</span> [<span class="ruby-identifier">pw_plain</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># encode data into aes-128-cbc cipher protected by a key generated</span>
  <span class="ruby-comment"># by #generate_pbkdf2_key, using given +password+, +salt+, +iter+</span>
  <span class="ruby-comment"># By default, must work with binary data. Set +data_is_base64+ to</span>
  <span class="ruby-comment"># true (or give data already as base64) to achieve the original</span>
  <span class="ruby-comment"># behavior of enc(), and avoid one encoding operation on data.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># +data+:: [String, nil] data to be encoded data</span>
  <span class="ruby-comment"># +ending+:: [nil] deprecated</span>
  <span class="ruby-comment"># +salt+:: [String, nil] #generate_pbkdf2_key salt argument</span>
  <span class="ruby-comment"># +iter+:: [String, nil] #generate_pbkdf2_key iterations argument</span>
  <span class="ruby-comment"># +data_is_base64+:: [true, false, nil] data already in base64 </span>
  <span class="ruby-comment"># </span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return @param [Array] an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +base64_encrypted+:: [String, nil] ciphered data (without metadata) encoded with Base64</span>
  <span class="ruby-comment"># +base64_iv+:: [String] initialization vectors encoded with Base64</span>
  <span class="ruby-comment"># +base64_salt+:: [String] #generate_pbkdf2_key salt encoded with Base64</span>
  <span class="ruby-comment"># +base64_iter+:: [String] #generate_pbkdf2_key iterations encoded with Base64</span>
  <span class="ruby-comment"># +base64_key+::  [String] #generate_pbkdf2_key return value</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_enc</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;_binary&quot;</span>
    <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">ending</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_end_key</span>
    <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> = (
      <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
    )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

    <span class="ruby-identifier">cipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
    <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">encrypt</span>

    <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
    <span class="ruby-identifier">iv</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">random_iv</span>
    <span class="ruby-identifier">base64_data</span> = <span class="ruby-identifier">data_is_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">data</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>
    <span class="ruby-identifier">encrypted</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">base64_data</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ending</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">final</span>

    <span class="ruby-identifier">base64_iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iv</span>
    <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>  <span class="ruby-identifier">encrypted</span>
    <span class="ruby-identifier">base64_salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">base64_iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">base64_key</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>

    [<span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>,  <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># decipher the data encoded by binary_enc</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># +base64_iv+:: [String, nil] initialization vectors encoded with Base64</span>
  <span class="ruby-comment"># +base64_encrypted+:: [String, nil] ciphered data (without metadata) encoded with Base64</span>
  <span class="ruby-comment"># +ending+:: [nil] deprecated</span>
  <span class="ruby-comment"># +base64_salt+:: [String, nil] #generate_pbkdf2_key salt encoded with Base64</span>
  <span class="ruby-comment"># +base64_iter+:: [String, nil] #generate_pbkdf2_key iterations encoded with Base64</span>
  <span class="ruby-comment"># +data_is_base64+:: [true, false, nil] return base64 data -- the same +data_is_base64+ given for enc should be used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [String] decoded data</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;_binary&quot;</span>
    <span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_salt</span>
    <span class="ruby-identifier">iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_iter</span>
    <span class="ruby-comment"># FIXME: don&#39;t split on \0</span>
    <span class="ruby-identifier">ending</span> = <span class="ruby-identifier">ending</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">static_end_key</span>
    <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> =  (
      <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
    )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

    <span class="ruby-identifier">decipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
    <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">decrypt</span>
    <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">padding</span> = <span class="ruby-value">0</span>

    <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
    <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_iv</span>
    <span class="ruby-identifier">base64_plain</span> = <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_encrypted</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">final</span>
    <span class="ruby-identifier">plain</span> = <span class="ruby-identifier">data_is_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_plain</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">base64_plain</span>
    <span class="ruby-comment"># split is not the ideal, if ever ending is duplicated it won&#39;t</span>
    <span class="ruby-comment"># work. also may be innefficient.</span>
    (<span class="ruby-identifier">plain</span>.<span class="ruby-identifier">split</span> <span class="ruby-identifier">ending</span>).<span class="ruby-identifier">first</span>

  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># an alternative interface to binary_dec -- reads password if</span>
  <span class="ruby-comment"># nil or empty.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args Defaults to +ARGV+. Elements:</span>
  <span class="ruby-comment"># * +data+ [String, nil] data to be encrypted, If empty or nil, read (without</span>
  <span class="ruby-comment"># echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># * +password+ [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># +data_is_base64+:: [true, false, nil] return base64 data -- the same +data_is_base64+ given for enc should be used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [TrueClass, FalseClass] depending on whether test succeeds.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>  = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = (<span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>])
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for binary_enc and binary_dec.</span>
  <span class="ruby-comment"># &quot;&quot; and nil are expected to be treated</span>
  <span class="ruby-comment"># as the same.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_nil</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">nil_case</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
    <span class="ruby-identifier">empty</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">nil_case</span>, <span class="ruby-identifier">empty</span>, <span class="ruby-string">&quot;empty_nil_equality&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for binary_enc and binary_dec.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +data+:: [String, nil] data to be encrypted.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [TrueClass, FalseClass] depending on whether test succeeds.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">binary_enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">dec_args</span> = [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# WARNING: secrets, including password are printed here. Storing them may be a major security incident.&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;binary_dec &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_args</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double p binary_dec &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_args</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for binary_enc and binary_dec_interactive.</span>
  <span class="ruby-comment"># good idea is to use this function once with the desired</span>
  <span class="ruby-comment"># data, password, and use the stderr output</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
    <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">binary_enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">data_is_base64</span> ]
    <span class="ruby-comment"># the output is supposed to be safe to store,</span>
    <span class="ruby-comment"># so password is not placed in from binary_dec_interactive_args:</span>
    <span class="ruby-identifier">dec_interactive_args</span> = [<span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec_interactive &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_interactive_args</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double puts binary_dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#or shell var:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;my_secret=$(#{$0} invoke_double puts binary_dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)\necho $my_secret\nunset mysecret&quot;</span>
    <span class="ruby-identifier">encrypted_base64_filename</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">output_enc_file</span>(<span class="ruby-identifier">dec_interactive_args</span>  <span class="ruby-operator">+</span> [<span class="ruby-identifier">encrypted_base64_filename</span>])
    <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">binary_dec_interactive</span>(<span class="ruby-identifier">dec_interactive_args</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>])
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">data_plain</span>.<span class="ruby-identifier">size</span>, <span class="ruby-string">&quot;data.size&quot;</span>],
        [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># similar to</span>
  <span class="ruby-comment"># test__binary_enc_dec_interactive,</span>
  <span class="ruby-comment"># just that the data is ready from a file instead</span>
  <span class="ruby-comment"># note that there is an extra argument between</span>
  <span class="ruby-comment"># the args, the enc_out_filename.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">filename_or_url</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[filename_or_url]&quot;</span>
    <span class="ruby-identifier">filename_or_url</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">filename_or_url</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_encrypted_data]&quot;</span>
    <span class="ruby-identifier">enc_out_filename</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_out_filename</span> ]
    <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">filename_or_url</span>
    <span class="ruby-identifier">test__binary_enc_dec_interactive</span> [ <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">data_is_base64</span> ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># basically the reverse of test__binary_enc_dec_file_interactive</span>
  <span class="ruby-comment"># planned improvements: still outputs to stdout</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">stdout</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdout</span>]
    <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[enc_filename_or_url]&quot;</span>
    <span class="ruby-identifier">enc_filename_or_url</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_filename_or_url</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_plain_data]&quot;</span>
    <span class="ruby-identifier">out_filename</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">out_filename</span> ]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]

    <span class="ruby-identifier">output_dec_file</span> [<span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gem_spec</span>
  <span class="ruby-comment"># args (Array like the one returned by rubyment_gem_defaults)</span>
  <span class="ruby-comment"># returns: a gem spec string accordingly to args</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span>,
    <span class="ruby-identifier">gem_bin_generate</span>,
    <span class="ruby-identifier">gem_bin_contents</span>,
    <span class="ruby-identifier">gem_bin_executables</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">contents</span> =<span class="ruby-value">&lt;&lt;-ENDHEREDOC
Gem::Specification.new do |s|
  s.name        = &#39;#{gem_name}&#39;
  s.version     = &#39;#{gem_version}&#39;
  s.date        = &#39;#{gem_date}&#39;
  s.summary     = &#39;#{gem_summary}&#39;
  s.description = &#39;#{gem_description}&#39;
  s.authors     = #{gem_authors.inspect}
  s.email       = &#39;#{gem_email}&#39;
  s.files       = #{gem_files.inspect}
  s.homepage    = &#39;#{gem_homepage}&#39;
  s.license     = &#39;#{gem_license}&#39;
  s.executables += [#{gem_bin_executables}].flatten
end
    ENDHEREDOC</span>
    <span class="ruby-identifier">contents</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># rubyment_gem_spec</span>
  <span class="ruby-comment"># args (Array, forwarded and transfomed by rubyment_gem_defaults)</span>
  <span class="ruby-comment"># returns: a gem spec string for Rubyment</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">rubyment_gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_spec</span> <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for rubyment_gem_spec. outputs the contents</span>
  <span class="ruby-comment"># returned by that function.</span>
  <span class="ruby-comment"># args: none</span>
  <span class="ruby-comment"># returns: none</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__rubyment_gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">rubyment_gem_spec</span>
  <span class="ruby-keyword">end</span>



  <span class="ruby-comment"># defaults for the rubyment gem</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_name, gem_version, gem_dir, gem_ext, gem_hifen]</span>
  <span class="ruby-comment"># all Strings.</span>
  <span class="ruby-comment"># defaults:</span>
  <span class="ruby-comment"># [&quot;rubyment&quot;, version [], memory[:running_dir],</span>
  <span class="ruby-comment"># &quot;.gem&quot;, &quot;-&quot;]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># [gem_name, gem_version, gem_dir, gem_ext, gem_hifen]</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">running_dir</span>   = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
    <span class="ruby-identifier">basic_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:basic_version</span>]
    <span class="ruby-identifier">major_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:major_version</span>]

    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">gem_name</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;rubyment&quot;</span>
    <span class="ruby-identifier">gem_version</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">version</span> [])
    <span class="ruby-identifier">gem_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">running_dir</span>
    <span class="ruby-identifier">gem_ext</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;.gem&quot;</span>
    <span class="ruby-identifier">gem_hifen</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;-&quot;</span>
    <span class="ruby-identifier">gem_ext</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;date&quot;</span>
    <span class="ruby-identifier">gem_date</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;2018-04-23&quot;</span>
    <span class="ruby-identifier">gem_summary</span>     <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;a set of ruby helpers&quot;</span>
    <span class="ruby-identifier">gem_description</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;a gem for keeping Rubyment, a set of ruby helpers&quot;</span>
    <span class="ruby-identifier">gem_authors</span>     <span class="ruby-operator">||=</span> [<span class="ruby-string">&quot;Ribamar Santarosa&quot;</span>]
    <span class="ruby-identifier">gem_email</span>       <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;ribamar@gmail.com&#39;</span>
    <span class="ruby-identifier">gem_files</span>       <span class="ruby-operator">||=</span> [<span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>]
    <span class="ruby-identifier">gem_homepage</span>    <span class="ruby-operator">||=</span>
      <span class="ruby-node">&quot;http://rubygems.org/gems/#{gem_name}&quot;</span>
    <span class="ruby-identifier">gem_license</span>     <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;GPL-3.0&#39;</span>
    <span class="ruby-identifier">gem_validate_class</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">gem_validate_class_args</span> <span class="ruby-operator">||=</span> {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-string">&quot;installed and validated&quot;</span>] }
    <span class="ruby-identifier">gem_validate_class_method</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;new&quot;</span>
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-keyword">__FILE__</span> <span class="ruby-comment"># this enables the possibility of building</span>
    <span class="ruby-comment">#  a gem for the calling file itself, but be aware that lib/gem_file.rb</span>
    <span class="ruby-comment"># is supposed to be overriden later.</span>
    <span class="ruby-identifier">gem_bin_generate</span> = <span class="ruby-node">&quot;bin/#{gem_name}&quot;</span> <span class="ruby-comment"># generate a bin file</span>
    <span class="ruby-identifier">gem_bin_contents</span> =<span class="ruby-value">&lt;&lt;-ENDHEREDOC
#!/usr/bin/env ruby
require &#39;#{gem_name}&#39;
#{gem_validate_class}.new({:invoke =&gt; ARGV})
    ENDHEREDOC</span>
    <span class="ruby-identifier">gem_executables</span> = [ <span class="ruby-identifier">gem_bin_generate</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-node">&quot;#{gem_name}&quot;</span> ]

    [
       <span class="ruby-identifier">gem_name</span>,
       <span class="ruby-identifier">gem_version</span>,
       <span class="ruby-identifier">gem_dir</span>,
       <span class="ruby-identifier">gem_ext</span>,
       <span class="ruby-identifier">gem_hifen</span>,
       <span class="ruby-identifier">gem_date</span>,
       <span class="ruby-identifier">gem_summary</span>,
       <span class="ruby-identifier">gem_description</span>,
       <span class="ruby-identifier">gem_authors</span>,
       <span class="ruby-identifier">gem_email</span>,
       <span class="ruby-identifier">gem_files</span>,
       <span class="ruby-identifier">gem_homepage</span>,
       <span class="ruby-identifier">gem_license</span>,
       <span class="ruby-identifier">gem_validate_class</span>,
       <span class="ruby-identifier">gem_validate_class_args</span>,
       <span class="ruby-identifier">gem_validate_class_method</span>,
       <span class="ruby-identifier">gem_is_current_file</span>,
       <span class="ruby-identifier">gem_bin_generate</span>,
       <span class="ruby-identifier">gem_bin_contents</span>,
       <span class="ruby-identifier">gem_executables</span>,
   ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns the gem path given the params.</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_name, gem_version, gem_dir, gem_ext, gem_hifen]</span>
  <span class="ruby-comment"># all Strings.</span>
  <span class="ruby-comment"># defaults:</span>
  <span class="ruby-comment"># [&quot;rubyment&quot;, version [], memory[:running_dir],</span>
  <span class="ruby-comment"># &quot;.gem&quot;, &quot;-&quot;]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_path</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>, <span class="ruby-identifier">gem_dir</span>, <span class="ruby-identifier">gem_ext</span>, <span class="ruby-identifier">gem_hifen</span> = <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
    <span class="ruby-node">&quot;#{gem_dir}/#{gem_name}#{gem_hifen}#{gem_version}#{gem_ext}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># forces the uninstallation of a gem in all the ways we can</span>
  <span class="ruby-comment"># mostly for internal tests that needs to ensure a gem wasn&#39;t</span>
  <span class="ruby-comment"># installed before a test.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_uninstall_extreme_force</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -a -x  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -a -x --user-install  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -a -x  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -a -x --user-install  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>

    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -x  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -x --user-install  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -x  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -x --user-install  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    []
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># gem_build</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec_path (String), gem_spec_contents (String), gem_is_current_file, gem_name]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem build (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_build</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec_path</span>,
    <span class="ruby-identifier">gem_spec_contents</span>,
    <span class="ruby-identifier">gem_is_current_file</span>,
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_bin_generate</span>,
    <span class="ruby-identifier">gem_bin_contents</span>,
      <span class="ruby-identifier">quiet</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>

    <span class="ruby-comment"># this supposes that  the current file is listed by the</span>
    <span class="ruby-comment"># s.files</span>
    <span class="ruby-comment"># field of the specification. it is not currently checked.</span>
    <span class="ruby-identifier">gem_is_current_file</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-string">&#39;lib&#39;</span>
      <span class="ruby-identifier">file_backup</span> <span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>, <span class="ruby-string">&quot;lib/&quot;</span>
      <span class="ruby-comment"># quick hack for backwards compatibility</span>
      <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">gem_is_current_file</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">TrueClass</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">__FILE__</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">gem_is_current_file</span>
      <span class="ruby-identifier">save_file</span> <span class="ruby-identifier">gem_is_current_file</span>, <span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>
    )

    <span class="ruby-comment"># this supposes that  the current file is listed by the</span>
    <span class="ruby-comment"># s.files</span>
    <span class="ruby-comment"># field of the specification. it is not currently checked.</span>
    <span class="ruby-identifier">gem_bin_generate</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_bin_generate</span>
      <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">gem_bin_generate</span>, (<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_bin_generate</span>)
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_bin_generate</span>, <span class="ruby-identifier">gem_bin_contents</span>
      (<span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-value">0755</span>, <span class="ruby-identifier">gem_bin_generate</span>)
    )

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_spec_path</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_spec_path</span>, <span class="ruby-identifier">gem_spec_contents</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">gem_spec_path</span>)
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem build #{gem_spec_path}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for gem_build: builds gem for this rubyment file</span>
  <span class="ruby-comment"># after it, these commands will install/uninstall it:</span>
  <span class="ruby-comment"># sudo gem install $PWD/rubyment-0.0.#{@memory[:basic_version]} ; gem list  | grep -i rubyment ; sudo gem uninstall  rubyment</span>
  <span class="ruby-comment"># dependee:</span>
  <span class="ruby-comment">#  test__gem_install_validate_uninstall</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec_path (String), gem_spec_contents (String)]</span>
  <span class="ruby-comment"># returns: none</span>
  <span class="ruby-comment"># outputs of gem build (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_build</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-string">&#39;lib&#39;</span>
    <span class="ruby-identifier">save_file</span> <span class="ruby-keyword">__FILE__</span>, <span class="ruby-string">&#39;lib/rubyment.rb&#39;</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_build</span> [<span class="ruby-string">&quot;rubyment.spec&quot;</span>, <span class="ruby-identifier">rubyment_gem_spec</span>(<span class="ruby-identifier">args</span>) ]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># gem_install</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec (String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem install (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_install</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">system_user_is_super</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:system_user_is_super</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">user_install</span> <span class="ruby-operator">||=</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">system_user_is_super</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;--user-install&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem install #{user_install}  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># gem_push</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec (String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem push (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_push</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">future_arg</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem push #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># uninstall all versions of a specific gem</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +gem_spect+:: [String] </span>
  <span class="ruby-comment"># +user_install+:: [Object]</span>
  <span class="ruby-comment"># +quiet+:: [Object] if calling the object +nne+ method returns a +false+ value, will print debug information</span>
  <span class="ruby-comment"># @return [String] console output of gem uninstall</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_uninstall_all</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">all</span> = <span class="ruby-string">&quot;-a&quot;</span>
    <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gem_uninstall</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec (String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem uninstall (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_uninstall</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">system_user_is_super</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:system_user_is_super</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">all</span> = <span class="ruby-identifier">all</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">user_install</span> <span class="ruby-operator">||=</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">system_user_is_super</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;--user-install&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall #{all} -x #{user_install}  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-comment">#stdin, stdout, stderr, wait_thr = Open3.popen3(&quot;:;&quot; + command)</span>
    <span class="ruby-comment">#stdout</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># gem_list</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec (String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem install (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_list</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec</span>,
      <span class="ruby-identifier">quiet</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem list | grep #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># validate_require</span>
  <span class="ruby-comment"># requires a file/gem in the system</span>
  <span class="ruby-comment"># returns nil if not found</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [requirement (String), validator_class (Class or String or nil),</span>
  <span class="ruby-comment">#  validator_args (Array), validator_method (Method or String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># Rubyment, true or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">requirement</span>, <span class="ruby-identifier">validator_class</span>, <span class="ruby-identifier">validator_args</span>, <span class="ruby-identifier">validator_method</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">validate_call</span> = <span class="ruby-identifier">validator_class</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">validator_class</span> = <span class="ruby-identifier">to_class</span> <span class="ruby-identifier">validator_class</span>
    <span class="ruby-identifier">validator_method</span> <span class="ruby-operator">||=</span>  <span class="ruby-string">&quot;new&quot;</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">require</span> <span class="ruby-identifier">requirement</span>
      <span class="ruby-identifier">validate_call</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">object_method_args_call</span> [<span class="ruby-identifier">validator_method</span>, <span class="ruby-identifier">validator_class</span>, <span class="ruby-identifier">validator_args</span>]) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">validate_call</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">LoadError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">e</span>
      <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># system_rubyment</span>
  <span class="ruby-comment"># requires a system&#39;s Rubyment and invoke it using args</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># Rubyment or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">system_rubyment</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">validate_require</span> [<span class="ruby-string">&#39;rubyment&#39;</span>, <span class="ruby-string">&#39;Rubyment&#39;</span>, {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">args</span> }]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># extract only the arguments referring to the</span>
  <span class="ruby-comment"># bin file generation from args</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_bin_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span>,
    <span class="ruby-identifier">gem_bin_generate</span>,
    <span class="ruby-identifier">gem_bin_contents</span>,
    <span class="ruby-identifier">gem_bin_executables</span> = <span class="ruby-identifier">args</span>
    [
        <span class="ruby-identifier">gem_bin_generate</span>,
        <span class="ruby-identifier">gem_bin_contents</span>,
        <span class="ruby-identifier">gem_bin_executables</span>,
    ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment">#  extract only the arguments referring to files</span>
  <span class="ruby-comment"># from args</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_files_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>
    [
        <span class="ruby-identifier">gem_files</span>,
        <span class="ruby-identifier">gem_is_current_file</span>,
    ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment">#  extract only the arguments for validation</span>
  <span class="ruby-comment"># from args</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>
    [
        <span class="ruby-identifier">gem_name</span>,
        <span class="ruby-identifier">gem_validate_class</span>,
        <span class="ruby-identifier">gem_validate_class_args</span>,
        <span class="ruby-identifier">gem_validate_class_method</span>,
    ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for system_rubyment</span>
  <span class="ruby-comment"># dependee:</span>
  <span class="ruby-comment">#  test__gem_install_validate_uninstall</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array or nil)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># Rubyment or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__system_rubyment</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">rubyment_args</span> = (<span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>) <span class="ruby-operator">||</span> [<span class="ruby-string">&quot;main&quot;</span>, <span class="ruby-string">&quot;tested system_rubyment&quot;</span>]
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">validate_require</span> [<span class="ruby-string">&#39;rubyment&#39;</span>, <span class="ruby-string">&#39;Rubyment&#39;</span>, {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rubyment_args</span> }]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># validate the installation of a gem</span>
  <span class="ruby-comment"># args rubyment_gem_defaults</span>
  <span class="ruby-comment"># but planned to change.</span>
  <span class="ruby-comment"># bug detected: require x won&#39;t reload the gem.</span>
  <span class="ruby-comment"># args (Array just like the one</span>
  <span class="ruby-comment"># returned by rubyment_gem_defaults)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># true or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_validate</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_defaults</span> = <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span> = <span class="ruby-identifier">gem_defaults</span>
    <span class="ruby-identifier">gem_files</span>, <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">gem_files_args</span> <span class="ruby-identifier">gem_defaults</span>
    <span class="ruby-identifier">gem_bin_generate</span>, <span class="ruby-identifier">gem_bin_contents</span> = <span class="ruby-identifier">gem_bin_args</span> <span class="ruby-identifier">gem_defaults</span>

    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_build</span> [
      <span class="ruby-node">&quot;#{gem_name}.spec&quot;</span>,
      <span class="ruby-identifier">gem_spec</span>(<span class="ruby-identifier">gem_defaults</span>),
      <span class="ruby-identifier">gem_is_current_file</span>,
      <span class="ruby-identifier">gem_name</span>,
      <span class="ruby-identifier">gem_bin_generate</span>,
      <span class="ruby-identifier">gem_bin_contents</span>,
    ]
    <span class="ruby-identifier">already_installed</span> = (
      <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">gem_defaults</span>
    )
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_uninstall_all</span> [<span class="ruby-identifier">gem_name</span>])
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-identifier">gem_name</span>]
    <span class="ruby-identifier">p</span> (<span class="ruby-identifier">gem_path</span> [<span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>])
    <span class="ruby-identifier">gem_install</span> [(<span class="ruby-identifier">gem_path</span> [<span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>])]
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-identifier">gem_name</span>]
    <span class="ruby-identifier">v</span> = (
      <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">gem_defaults</span>
    )
    <span class="ruby-identifier">gem_uninstall_all</span> [<span class="ruby-identifier">gem_name</span>]
    <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_install</span> [<span class="ruby-identifier">gem_name</span>])
    <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for gem_build, gem_install, gem_list</span>
  <span class="ruby-comment"># system_rubyment, gem_uninstall</span>
  <span class="ruby-comment"># note that, if there is a &quot;rubyment&quot; gem</span>
  <span class="ruby-comment"># already installed, it will be temporarily</span>
  <span class="ruby-comment"># unavailable.</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array or nil)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># Rubyment or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_build_install_validate_uninstall</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">basic_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:basic_version</span>]
    <span class="ruby-identifier">major_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:major_version</span>]
    <span class="ruby-identifier">running_dir</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
    <span class="ruby-identifier">test__gem_build</span> []
    <span class="ruby-identifier">already_installed</span> = (<span class="ruby-identifier">system_rubyment</span> [<span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-string">&quot;already installed&quot;</span>])
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
    <span class="ruby-identifier">gem_install</span> [<span class="ruby-node">&quot;#{running_dir}/rubyment-#{major_version}.#{basic_version}.gem&quot;</span>]
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
    <span class="ruby-identifier">v</span> = <span class="ruby-identifier">test__system_rubyment</span> []
    <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
    <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_install</span> [<span class="ruby-string">&quot;rubyment&quot;</span>])
    <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gets the api key needed to push gems to rubygems.</span>
  <span class="ruby-comment"># prompts for arguments when username or password</span>
  <span class="ruby-comment"># not provided.</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [username (String or nil), password (String or nil),</span>
  <span class="ruby-comment"># file_destination (String, &quot;/dev/null&quot; if empty/nil given)]</span>
  <span class="ruby-comment"># returns</span>
  <span class="ruby-comment"># key_contents (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_get_api_key</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
    <span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">file_destination</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;username - &quot;</span>
    <span class="ruby-identifier">username</span> = <span class="ruby-identifier">input_single_line</span> [<span class="ruby-identifier">username</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;password - &quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">file_destination</span> = <span class="ruby-identifier">file_destination</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;/dev/null&quot;</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">file_destination</span>
    <span class="ruby-identifier">key_contents</span> = <span class="ruby-identifier">save_file</span> <span class="ruby-string">&quot;https://rubygems.org/api/v1/api_key.yaml&quot;</span>,
      <span class="ruby-identifier">file_destination</span>, <span class="ruby-value">0</span>, {<span class="ruby-value">:username</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">username</span>, <span class="ruby-value">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">password</span> }
    (<span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-value">0600</span>, <span class="ruby-identifier">file_destination</span>)
    <span class="ruby-identifier">key_contents</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for test__gem_get_api_key</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># (Array - forwarded to gem_get_api_key)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># nil</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_get_api_key</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_get_api_key</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># builds, validates and push a gem accordingly</span>
  <span class="ruby-comment"># to the arguments. if arguments not given,</span>
  <span class="ruby-comment"># will do for the defaults (see rubyment_gem_defaults)</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array or nil)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># ignore (will change)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_build_push</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">running_dir</span>      = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
    <span class="ruby-identifier">home_dir</span>         = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:home_dir</span>]
    <span class="ruby-identifier">gem_username</span>, <span class="ruby-identifier">gem_password</span>, <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-identifier">gem_defaults</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">gem_password</span> = <span class="ruby-identifier">gem_password</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">gem_defaults</span> <span class="ruby-operator">||=</span>  <span class="ruby-identifier">rubyment_gem_defaults</span> []
    <span class="ruby-identifier">gem_api_key_file</span> <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{home_dir}/.gem/credentials&quot;</span>
    <span class="ruby-identifier">permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">gem_api_key_file</span>
    <span class="ruby-identifier">credentials_contents</span> = <span class="ruby-identifier">url_to_str</span> <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-string">&quot;&quot;</span>
    (<span class="ruby-identifier">gem_get_api_key</span> [<span class="ruby-identifier">gem_username</span>, <span class="ruby-identifier">gem_password</span>, <span class="ruby-identifier">gem_api_key_file</span>]) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">validated</span> = (
      <span class="ruby-identifier">gem_validate</span> <span class="ruby-identifier">gem_defaults</span>
    )
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">validated</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_push</span> <span class="ruby-identifier">gem_path</span> <span class="ruby-identifier">gem_defaults</span> )
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-identifier">credentials_contents</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-identifier">permissions</span>, <span class="ruby-identifier">gem_api_key_file</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for gem_build, gem_install, gem_list</span>
  <span class="ruby-comment"># system_rubyment, gem_uninstall</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array or nil)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># ignore</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_complete_flow</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_build_push</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test file_backup when file is a dir</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__when_file_is_dir</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
    <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">keep_new</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">filename</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;testing-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;/tmp/&quot;</span>
    <span class="ruby-identifier">append</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">prepend</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">filename</span>  <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;/&quot;</span>
    <span class="ruby-identifier">expected_new_dir</span> = <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">existing_dir</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>])
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>
    <span class="ruby-identifier">filename_test</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">expected_new_dir_test</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">expected_new_dir</span>
    <span class="ruby-identifier">original_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">new_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">expected_new_dir</span>
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">filename_test</span>, <span class="ruby-identifier">expected_new_dir_test</span>, <span class="ruby-string">&quot;File.directory?&quot;</span>],
        [<span class="ruby-identifier">original_permissions</span>, <span class="ruby-identifier">new_permissions</span>, <span class="ruby-string">&quot;file_permissions&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
    (<span class="ruby-operator">!</span><span class="ruby-identifier">existing_dir</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rmdir</span> <span class="ruby-identifier">filename</span>)
    (<span class="ruby-operator">!</span><span class="ruby-identifier">keep_new</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rmdir</span> <span class="ruby-identifier">expected_new_dir</span>)
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test file_backup (just like a copy)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-identifier">keep_new</span>  = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">filename</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;testing-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;/tmp/&quot;</span>
    <span class="ruby-identifier">append</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">prepend</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">expected_new_filename</span> = <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">existing_file</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>])
    <span class="ruby-identifier">file_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">filename</span>, <span class="ruby-node">&quot;contents_of:#{filename}&quot;</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>
    <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>
    <span class="ruby-identifier">new_file_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">expected_new_filename</span>
    <span class="ruby-identifier">original_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">new_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">expected_new_filename</span>
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">new_file_contents</span>, <span class="ruby-string">&quot;file_contents&quot;</span>],
        [<span class="ruby-identifier">original_permissions</span>, <span class="ruby-identifier">new_permissions</span>, <span class="ruby-string">&quot;file_permissions&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
    (<span class="ruby-operator">!</span><span class="ruby-identifier">existing_file</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">filename</span>)
    (<span class="ruby-operator">!</span><span class="ruby-identifier">keep_new</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">expected_new_filename</span>)
    <span class="ruby-identifier">judgement</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># same as test__file_backup__when_file_is_dir, but backup is not removed.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__when_file_is_dir__but_keep</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">dont_keep_new</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">test__file_backup__when_file_is_dir</span> [<span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">dont_keep_new</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># same as test__file_backup, but backup is not removed.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__but_keep</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-identifier">dont_keep_new</span>  = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">test__file_backup</span> [<span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">dont_keep_new</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns a method object out of a string or a method object,</span>
  <span class="ruby-comment"># in a polymorphic style.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +method_name_or_method+:: [String, Method] method name or method object</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Method] a method</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">to_method</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">method_name_or_method</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    (
      <span class="ruby-identifier">to_object_method</span> [<span class="ruby-identifier">object</span>, <span class="ruby-identifier">method_name_or_method</span>]
    ) <span class="ruby-operator">||</span> (
      <span class="ruby-identifier">method_name_or_method</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:call</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">method_name_or_method</span>
    ) <span class="ruby-operator">||</span>
      <span class="ruby-identifier">method</span>(<span class="ruby-identifier">method_name_or_method</span>)
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># echoes the processing arg</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +processing_arg+:: [String]</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [String] +processing_arg+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">echo</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># calls a function with the processing arg</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +processing_arg+:: [Object]</span>
  <span class="ruby-comment"># +method+:: [Method, String]</span>
  <span class="ruby-comment"># +method_args+:: [Array] args to be given to the +transform_method_name+</span>
  <span class="ruby-comment"># +on_object+:: [String, Boolean]</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [String] +processing_arg+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__transform_call</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">processing_arg</span>, <span class="ruby-identifier">method</span>, <span class="ruby-identifier">method_args</span>, <span class="ruby-identifier">on_object</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">object_arg</span> = <span class="ruby-identifier">on_object</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">processing_arg</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">to_method</span>(
      [<span class="ruby-identifier">method</span>, <span class="ruby-identifier">object_arg</span>]).<span class="ruby-identifier">call</span>(
        [<span class="ruby-identifier">processing_arg</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">method_args</span>
    )
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns an HTTP response</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +response+:: [String, nil] response payload</span>
  <span class="ruby-comment"># +content_type+:: [String, nil] mime type of payload</span>
  <span class="ruby-comment"># +version+:: [String, nil] http protocol version</span>
  <span class="ruby-comment"># +code+:: [String, nil] response code</span>
  <span class="ruby-comment"># +keep_alive+:: [Boolean] right not unsupported, always close the connection</span>
  <span class="ruby-comment"># +debug+:: [Object] if calling the object +nne+ method returns a +false+ value, won&#39;t print debug information</span>
  <span class="ruby-comment"># +eol+:: [String, nil] string to attach to the end of each line in the response</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [String] response with headers</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">http_response_base</span> <span class="ruby-identifier">args</span> = []
    <span class="ruby-identifier">payload</span>,
      <span class="ruby-identifier">content_type</span>,
      <span class="ruby-identifier">code</span>,
      <span class="ruby-identifier">version</span>,
      <span class="ruby-identifier">keep_alive</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">eol</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">rv</span> = [
      <span class="ruby-node">&quot;HTTP/#{version} #{code}&quot;</span>,
      <span class="ruby-node">&quot;Content-Type: #{content_type};&quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-node">&quot; charset=#{payload.encoding.name.downcase}&quot;</span>,
      <span class="ruby-node">&quot;Content-Length: #{payload.bytesize}&quot;</span>,
      <span class="ruby-identifier">keep_alive</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;Connection: close&quot;</span>,
      <span class="ruby-string">&quot;&quot;</span>,
      <span class="ruby-node">&quot;#{payload}&quot;</span>
    ]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} will return #{rv}&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">rv</span>.<span class="ruby-identifier">join</span> <span class="ruby-identifier">eol</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns an HTTP response (1.1 200 OK by default)</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +response+:: [String, nil] response payload (default empty)</span>
  <span class="ruby-comment"># +content_type+:: [String, nil] mime type of payload (default +text/plain+)</span>
  <span class="ruby-comment"># +version+:: [String, nil] http protocol version (+1.1+ by default)</span>
  <span class="ruby-comment"># +code+:: [String, nil] response code (+&quot;200 OK&quot;+ by default)</span>
  <span class="ruby-comment"># +keep_alive+:: [Boolean] right not unsupported, always close the connection</span>
  <span class="ruby-comment"># +debug+:: [Object] if calling the object +nne+ method returns a +false+ value, won&#39;t print debug information</span>
  <span class="ruby-comment"># +eol+:: [String, nil] response code (+&quot;\r\n&quot;+ by default/on +nil+)</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Array] response with proper headers in an array where each element is a response line</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">payload</span>, <span class="ruby-identifier">content_type</span>, <span class="ruby-identifier">code</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">keep_alive</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">eol</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">payload</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">payload</span>  = <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">content_type</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;text/plain&quot;</span>
    <span class="ruby-identifier">version</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;1.1&quot;</span>
    <span class="ruby-identifier">code</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;200 OK&quot;</span>
    <span class="ruby-identifier">eol</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;\r\n&quot;</span>
    <span class="ruby-identifier">rv</span> = <span class="ruby-identifier">http_response_base</span> [
      <span class="ruby-identifier">payload</span>,
      <span class="ruby-identifier">content_type</span>,
      <span class="ruby-identifier">code</span>,
      <span class="ruby-identifier">version</span>,
      <span class="ruby-identifier">keep_alive</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">eol</span>,
    ]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">rv</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># will call #gets on  +io+ until line starts with +happy_with_request+</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +io+:: [IO] any +IO+, like a +Socket+, returned by #TCPServer::accept</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +happy_with_request+:: [String, nil] if nil, +eol+ is used.</span>
  <span class="ruby-comment"># +eol+:: [String] end of line</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Array] array of strings having the lines read from the IO.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_gets</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">happy_with_request</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;\r\n&quot;</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">lines</span> = []
    (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-constant">Float</span><span class="ruby-operator">::</span><span class="ruby-constant">INFINITY</span>).
      <span class="ruby-identifier">lazy</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">io</span>.<span class="ruby-identifier">gets</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">r</span>)
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">happy_with_request</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">r</span>
      }.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">x</span> }
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">lines</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gets an input from +io+ and writes it back to the same +io+</span>
  <span class="ruby-comment"># supports an optional +replace+ and +replacement+ parameter</span>
  <span class="ruby-comment"># that can be used to make simple changes to the echoing output</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +io+:: [IO] any +IO+, like a +Socket+, returned by #TCPServer::accept</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +transform_method_name+:: [String]</span>
  <span class="ruby-comment"># +transform_method_args+:: [Array] args to be given to the ++transform_method_name+</span>
  <span class="ruby-comment"># +happy_with_request+:: [String, nil] if nil, +eol+ is used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [nil]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">io</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">transform_method_name</span>,
      <span class="ruby-identifier">transform_method_args</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;transform_method_name: #{transform_method_name}&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;transform_method_args: #{transform_method_args.inspect}&quot;</span>)
    <span class="ruby-identifier">io_forward</span> [[<span class="ruby-identifier">io</span>], <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>, <span class="ruby-identifier">reserved</span>,
      <span class="ruby-value">:test__transform_call</span>, [
        <span class="ruby-identifier">transform_method_name</span>,
        <span class="ruby-identifier">transform_method_args</span>,
        <span class="ruby-string">&quot;on_object:true&quot;</span>,
      ]
    ]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gets and forwards the input from one IO to a list of IOs</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +ios_out+:: [Array] array of +IO+, where data will be written to.</span>
  <span class="ruby-comment"># +io_in+:: [IO] any +IO+, like a +Socket+, returned by #TCPServer::accept, where data will be read from.</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +happy_with_request+:: [String, nil] if nil, +eol+ is used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [nil]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_forward</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>

    <span class="ruby-identifier">ios_out</span>,
      <span class="ruby-identifier">io_in</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">reserved</span>,
      <span class="ruby-identifier">processing_method</span>,
      <span class="ruby-identifier">processing_method_args</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">io_gets_args</span> = [<span class="ruby-identifier">io_in</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">input</span> = <span class="ruby-identifier">io_gets</span> <span class="ruby-identifier">io_gets_args</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">ios_out</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">processing_method</span> <span class="ruby-operator">||=</span> <span class="ruby-value">:echo</span>
    <span class="ruby-identifier">processing_method_args</span> <span class="ruby-operator">||=</span> []
    <span class="ruby-identifier">processed_input</span> = <span class="ruby-identifier">to_method</span>(
      [<span class="ruby-identifier">processing_method</span>]).<span class="ruby-identifier">call</span>(
        [<span class="ruby-identifier">input</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">processing_method_args</span>
    )
    <span class="ruby-identifier">ios_out</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">shared_io_out</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">runoe_threaded</span>(<span class="ruby-identifier">shared_io_out</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">io_out</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">io_out</span> = <span class="ruby-identifier">shared_io_out</span>
        <span class="ruby-identifier">io_out</span>.<span class="ruby-identifier">print</span> <span class="ruby-identifier">processed_input</span>
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
          <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{io_out}: #{processed_input.size} bytes: response writen.&quot;</span>
        )
        <span class="ruby-identifier">io_out</span>.<span class="ruby-identifier">close</span>
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
          <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{io_out}: IO closed.&quot;</span>
        )

      }
    }
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gets an input from +io+ and writes it back to the same +io+</span>
  <span class="ruby-comment"># supports an optional +replace+ and +replacement+ parameter</span>
  <span class="ruby-comment"># that can be used to make simple changes to the echoing output</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +io+:: [IO] any +IO+, like a +Socket+, returned by #TCPServer::accept</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +replace+:: [String]</span>
  <span class="ruby-comment"># +replacement+:: [String]</span>
  <span class="ruby-comment"># +happy_with_request+:: [String, nil] if nil, +eol+ is used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [nil]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_echo</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>, <span class="ruby-identifier">replace</span>, <span class="ruby-identifier">replacement</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-comment"># this is an inefficient replacement:</span>
    <span class="ruby-identifier">replace</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot; &quot;</span>
    <span class="ruby-identifier">replacement</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot; &quot;</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">io_transform</span> [
      <span class="ruby-identifier">io</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-value">:array_maps</span>,
      [
        <span class="ruby-value">:gsub!</span>, [<span class="ruby-identifier">replace</span>, <span class="ruby-identifier">replacement</span>]
      ],
    ]

    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># writes a response to an IO (e.g.: socket)</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +reserved+:: [Object] for future use</span>
  <span class="ruby-comment"># +args_for_http_OK_response+:: [splat] args to be forwarded to #http_OK_response (check it for specification)</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [nil]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">reserved</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args_for_http_OK_response</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">response</span> = <span class="ruby-identifier">http_OK_response</span> <span class="ruby-identifier">args_for_http_OK_response</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">inspect</span>
    )
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;response writen.&quot;</span>)
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;IO closed.&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># opens a TCP server accepting connections.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +reserved+:: [Object] for future use</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +callback_method+:: [String, Method] method to call when a client connects. The method must accept a socket as parameter.</span>
  <span class="ruby-comment"># +callback_method_args+:: [splat] args to be given to the call_back_method</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Thread] returns a Thread object looping for accepting</span>
  <span class="ruby-comment"># incoming connections (call join on that object for waiting for its</span>
  <span class="ruby-comment"># completion).</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_server_plain</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">reserved</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">callback_method</span>,
      <span class="ruby-operator">*</span><span class="ruby-identifier">callback_method_args</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">tcp_ssl_server</span> [
      <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-string">&quot;admit non ssl server&quot;</span>,
      <span class="ruby-identifier">callback_method</span>,
      <span class="ruby-identifier">callback_method_args</span>
      ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># makes one or more OpenSSL server</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +admit_plain+:: [Boolean] if +true+, tries to create a normal +TCPServer+, if not possible to create +SSLServer+ (default: +false+, for preventing unadvertnt non-SSL server creation)</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +priv_pemfile+:: [String] argument to be given to +OpenSSL::SSL::SSLContext.key+ method, after calling +OpenSSL::PKey::RSA.new+ with it. It&#39;s the private key file. letsencrypt example: +&quot;/etc/letsencrypt/live/#{domain}/privkey.pem&quot;+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +cert_pem_file+:: [String] argument to be given to +OpenSSL::SSL::SSLContext.cert+ method, after calling +OpenSSL::X509::Certificate+.  It&#39;s the &quot;Context certificate&quot; accordingly to its ruby-doc page. letsencrypt example: +&quot;/etc/letsencrypt/live/#{domain}/fullchain.pem&quot;+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +extra_cert_pem_files+:: [Array] array of strings. Each string will be mapped with +OpenSSL::SSL::SSLContext.new+, and the resulting array is given to +OpenSSL::SSL::SSLContext.extra_chain_cert+. &quot;An Array of extra X509 certificates to be added to the certificate chain&quot; accordingly to its ruby-doc. letsencryptexample: +[&quot;/etc/letsencrypt/live/#{domain}/chain.pem&quot;]+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +output_exception+:: [Bool] output exceptions even if they are admitted?</span>
  <span class="ruby-comment"># +plain_servers+:: [TCPServer, Array of TCPServer] if given, ignores +listening_port+ and +ip_addr+, does not create a +TCPServer+ and just creates an +SSLServer+ out of this one. If an +Array+ of +TCPServer+ is provided instead, it will create one +SSLServer+ to each of those +TCPServer+.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Array] returns an  #Array whose elements are:</span>
  <span class="ruby-comment"># +servers+:: [Array of OpenSSL::SSL::SSLServer or of TCPServer] depending on +admit_plain+ and in the success of the creation of +SSLServers+.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_make_servers</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">plain_servers</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">extra_cert_pem_files</span> = <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> []
    <span class="ruby-identifier">admit_plain</span> = <span class="ruby-identifier">admit_plain</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">output_exception</span> = (
      <span class="ruby-identifier">output_exception</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">admit_plain</span>.<span class="ruby-identifier">negate_me</span>
    )
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-comment"># openssl functions want contents, not filenames:</span>
    <span class="ruby-identifier">extra_cert_pem_files</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>
      .<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">extra_cert_pem_file</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">file_read</span> [
          <span class="ruby-identifier">extra_cert_pem_file</span>,
          <span class="ruby-keyword">nil</span>,
          <span class="ruby-keyword">nil</span>,
          <span class="ruby-identifier">extra_cert_pem_file</span>
        ]
      }
    <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_pem_file</span>]
    <span class="ruby-identifier">priv_pemfile</span>  = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">priv_pemfile</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">priv_pemfile</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;socket&#39;</span>
    <span class="ruby-identifier">plain_servers</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">ip_addr</span>, <span class="ruby-identifier">listening_port</span>
    <span class="ruby-identifier">plain_servers</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">plain_servers</span>

    <span class="ruby-identifier">servers</span> = <span class="ruby-identifier">plain_servers</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">plain_server</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">ssl_server</span> = <span class="ruby-identifier">runea</span> [
        <span class="ruby-identifier">admit_plain</span>,
        <span class="ruby-identifier">output_exception</span>,
        <span class="ruby-string">&quot;nil on exception&quot;</span>] {
          <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
          <span class="ruby-identifier">ssl_context</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLContext</span>.<span class="ruby-identifier">new</span>
          <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">extra_chain_cert</span> =
            <span class="ruby-identifier">extra_cert_pem_files</span>
              .<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:new</span>))
          <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">cert</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>
            .<span class="ruby-identifier">new</span> <span class="ruby-identifier">cert_pem_file</span>
          <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">key</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>
            .<span class="ruby-identifier">new</span> <span class="ruby-identifier">priv_pemfile</span>
          <span class="ruby-identifier">ssl_server</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLServer</span>
            .<span class="ruby-identifier">new</span> <span class="ruby-identifier">plain_server</span>, <span class="ruby-identifier">ssl_context</span>
          <span class="ruby-identifier">ssl_server</span>
      }
      <span class="ruby-identifier">server</span> = <span class="ruby-identifier">ssl_server</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">admit_plain</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">plain_server</span>
    }
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{[servers]}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    [<span class="ruby-identifier">servers</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># makes an OpenSSL server </span>
  <span class="ruby-comment"># just an interface to the more powerful</span>
  <span class="ruby-comment"># recommended #ssl_make_servers</span>
  <span class="ruby-comment"># (kept for respecting open-closed principle)</span>
  <span class="ruby-comment"># @param [splat] +args+, an splat whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +admit_plain+:: [Boolean] if +true+, tries to create a normal +TCPServer+, if not possible to create +SSLServer+ (default: +false+, for preventing unadvertnt non-SSL server creation)</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +priv_pemfile+:: [String] argument to be given to +OpenSSL::SSL::SSLContext.key+ method, after calling +OpenSSL::PKey::RSA.new+ with it. It&#39;s the private key file. letsencrypt example: +&quot;/etc/letsencrypt/live/#{domain}/privkey.pem&quot;+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +cert_pem_file+:: [String] argument to be given to +OpenSSL::SSL::SSLContext.cert+ method, after calling +OpenSSL::X509::Certificate+.  It&#39;s the &quot;Context certificate&quot; accordingly to its ruby-doc page. letsencrypt example: +&quot;/etc/letsencrypt/live/#{domain}/fullchain.pem&quot;+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +extra_cert_pem_files+:: [Array] array of strings. Each string will be mapped with +OpenSSL::SSL::SSLContext.new+, and the resulting array is given to +OpenSSL::SSL::SSLContext.extra_chain_cert+. &quot;An Array of extra X509 certificates to be added to the certificate chain&quot; accordingly to its ruby-doc. letsencryptexample: +[&quot;/etc/letsencrypt/live/#{domain}/chain.pem&quot;]+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +output_exception+:: [Bool] output exceptions even if they are admitted?</span>
  <span class="ruby-comment"># +plain_server+:: [TCPServer] if given, ignores +listening_port+ and +ip_addr+, does not create a +TCPServer+ and just creates an +SSLServer+ out of this one.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [OpenSSL::SSL::SSLServer] returns an ssl server, which can be used to accept connections.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_make_server</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">plain_server</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">rv</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
      <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">plain_server</span>,
    ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{rv}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">rv</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># opens one or more TCP and/or SSL server accepting connections.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +admit_plain+:: [Boolean] if +true+, tries to create a normal +TCPServer+, if not possible to create +SSLServer+ (default: +false+, for preventing unadvertnt non-SSL server creation)</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +callback_method+:: [String, Method] method to call when a client connects. The method must accept a socket as parameter.</span>
  <span class="ruby-comment"># +callback_method_args+:: [Array] args to be given to the call_back_method. Note that the type differs from #tcp_server_plain (which takes splat)</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Array] returns a , an +Array+ whose elements are:</span>
  <span class="ruby-comment"># +threads+:: [Array of Thread] returns an Array of Thread object looping for accepting  incoming connections (call join on those object for waiting for its completion).</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_ssl_servers</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">callback_method</span>,
      <span class="ruby-identifier">callback_method_args</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">server</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
      <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
    ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">server</span>)
    <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> {
      <span class="ruby-identifier">loop</span> {
        <span class="ruby-identifier">client</span> = <span class="ruby-identifier">runea</span> [<span class="ruby-string">&quot;yes, rescue&quot;</span>,
          <span class="ruby-string">&quot;yes, output exception&quot;</span>,
          <span class="ruby-string">&quot;nil on exception&quot;</span>
        ] {
          <span class="ruby-identifier">server</span>.<span class="ruby-identifier">accept</span>
        }
        <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">client</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
          <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">client</span>)
          <span class="ruby-identifier">runoe</span> {
            <span class="ruby-identifier">to_method</span>([<span class="ruby-identifier">callback_method</span>])
              .<span class="ruby-identifier">call</span>([<span class="ruby-identifier">client</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">callback_method_args</span>)
          }
        }
      }
    }
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># opens an SSL server accepting connections.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +admit_plain+:: [Boolean] if +true+, tries to create a normal +TCPServer+, if not possible to create +SSLServer+ (default: +false+, for preventing unadvertnt non-SSL server creation)</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +callback_method+:: [String, Method] method to call when a client connects. The method must accept a socket as parameter.</span>
  <span class="ruby-comment"># +callback_method_args+:: [Array] args to be given to the call_back_method. Note that the type differs from #tcp_server_plain (which takes splat)</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Thread] returns a Thread object looping for accepting</span>
  <span class="ruby-comment"># incoming connections (call join on that object for waiting for its</span>
  <span class="ruby-comment"># completion).</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_ssl_server</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">callback_method</span>,
      <span class="ruby-identifier">callback_method_args</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">server</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
      <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
    ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">server</span>)
    <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> {
      <span class="ruby-identifier">loop</span> {
        <span class="ruby-identifier">client</span> = <span class="ruby-identifier">runea</span> [<span class="ruby-string">&quot;yes, rescue&quot;</span>,
          <span class="ruby-string">&quot;yes, output exception&quot;</span>,
          <span class="ruby-string">&quot;nil on exception&quot;</span>
        ] {
          <span class="ruby-identifier">server</span>.<span class="ruby-identifier">accept</span>
        }
        <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">client</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
          <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">client</span>)
          <span class="ruby-identifier">runoe</span> {
            <span class="ruby-identifier">to_method</span>([<span class="ruby-identifier">callback_method</span>])
              .<span class="ruby-identifier">call</span>([<span class="ruby-identifier">client</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">callback_method_args</span>)
          }
        }
      }
    }
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_server_plain</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [<span class="ruby-value">8003</span>,
     <span class="ruby-string">&quot;0&quot;</span>,
     <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;io_echo&quot;</span>,
     <span class="ruby-string">&quot;debug_io_echo&quot;</span>,
     <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot; &quot;</span>, <span class="ruby-comment">#replace</span>
     <span class="ruby-string">&quot;__&quot;</span>, <span class="ruby-comment">#replacement -- will replace empty spaces</span>
     ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># test for tcp_server_plain (call io_transform)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
     <span class="ruby-value">8003</span>,
     <span class="ruby-string">&quot;0&quot;</span>,
     <span class="ruby-string">&quot;&quot;</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;io_transform&quot;</span>,
     <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
     <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-value">:array_maps</span>,
     [
        <span class="ruby-value">:gsub!</span>, [<span class="ruby-string">&quot; &quot;</span>, <span class="ruby-string">&quot;_____&quot;</span>]
     ]
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># test for tcp_server_plain</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_io_http_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
     <span class="ruby-value">8003</span>, <span class="ruby-comment"># listening_port</span>
     <span class="ruby-string">&quot;0&quot;</span>,  <span class="ruby-comment"># ip_addr: all possible</span>
     <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot;debug_tcp_server_plain_arg&quot;</span>,
     <span class="ruby-string">&quot;io_http_OK_response&quot;</span>,
     <span class="ruby-string">&quot;debug_io_http_OK_response_arg&quot;</span>,
     <span class="ruby-string">&quot;reserved_io_http_OK_response_arg&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot;This is the response payload&quot;</span>,
     <span class="ruby-string">&quot;dont_keep_alive&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_server_plain (call #io_transform with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
   <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
   <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
   <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
   <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
   <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;io_transform&quot;</span>,
     <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
     <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_ssl_server (call #io_transform with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-comment"># just like #test__tcp_server_plain__with_http_OK_response</span>
  <span class="ruby-comment"># but calling directly #tcp_ssl_server</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__non_ssl</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
   <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
   <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
   <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
   <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
   <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> [
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;admit non ssl server&quot;</span>,
     <span class="ruby-string">&quot;io_transform&quot;</span>,
     [
       <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
       <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
       <span class="ruby-identifier">http_processing_method</span>,
       <span class="ruby-identifier">http_processing_method_args</span>
     ],
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># generates a hash string based on current time</span>
  <span class="ruby-comment"># @return [String] +Time.now.hash.abs.to_s+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">time_now_hash</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns a sample self signed certificate-private key pair</span>
  <span class="ruby-comment"># that once was created with the command (no password, no</span>
  <span class="ruby-comment"># expire date):</span>
  <span class="ruby-comment"># + openssl req -x509 -nodes -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</span>
  <span class="ruby-comment"># @param [splat] +args+::, an splat whose elements are expected to be:</span>
  <span class="ruby-comment"># +reserved+:: [splat] reserved for future use</span>
  <span class="ruby-comment"># @return [Array] where the first element is a certificate (suitable to be the contents of +cert_pem_file+  in #ssl_make_server) and the second a private key (suitable to be the contents of +priv_pemfile+ in #ssl_make_server)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">self_signed_certificate</span> = <span class="ruby-value">&lt;&lt;-ENDHEREDOC
-----BEGIN CERTIFICATE-----
MIICWDCCAcGgAwIBAgIJAPa0EXsH2MwsMA0GCSqGSIb3DQEBCwUAMEUxCzAJBgNV
BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX
aWRnaXRzIFB0eSBMdGQwHhcNMTgwNjI3MDkzMTEyWhcNMTgwNzI3MDkzMTEyWjBF
MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50
ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKB
gQCplOo6dvbM1650qMYLQ8tRycYlHEZH95kUR5E5EEA8yqgimBtx6InpGQi/PejK
tk+IXbDrxinXMXqjZxAhCjd7+frSUFwUTZ669PuRaptlkjV1KojXBW5kRERAgYId
H7z7QRuK/gWHqTt9zl3WpW2spfWjHY+cnkYdZIWqDBOggwIDAQABo1AwTjAdBgNV
HQ4EFgQUAIq0u116/WmTFQ8HC7/XrKl6wB8wHwYDVR0jBBgwFoAUAIq0u116/WmT
FQ8HC7/XrKl6wB8wDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOBgQBgA9ID
JcreAgjYLxiaAd7fCfLQ1/RYM8YdP9R4Lzg2cu0dCjXoLZqzAEwUg424rPOvf0Pj
wnZ3DFJkg1CoN2fH3yLXQ75mhfM7PJXeWoWLTS2wIG/+VIVI+nKJU0RPOM87Mdlq
+b6TI5LsGxlJhaxTmzPtkHZLIRdW6iCJTwP+5Q==
-----END CERTIFICATE-----
   ENDHEREDOC</span>
   <span class="ruby-identifier">private_key</span> = <span class="ruby-value">&lt;&lt;-ENDHEREDOC
-----BEGIN PRIVATE KEY-----
MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAKmU6jp29szXrnSo
xgtDy1HJxiUcRkf3mRRHkTkQQDzKqCKYG3HoiekZCL896Mq2T4hdsOvGKdcxeqNn
ECEKN3v5+tJQXBRNnrr0+5Fqm2WSNXUqiNcFbmRERECBgh0fvPtBG4r+BYepO33O
Xdalbayl9aMdj5yeRh1khaoME6CDAgMBAAECgYB+Z80spU6UJFUbCk8NSIx+u6ui
L/BHZs1Ja4tZgL6RUfKATuduQgrCoPF/NBOZPsoL+OKO7Nh1WqFyubkxF5+A6BlI
BRe/E4K3cChBWyR5ZQyldYUNVV1HBrAhpurW/OX7FInPGo0I5TkR/CJt6xZPgK1n
4lNXFV29gz/LPTJN4QJBANxnUn2xbtBH0xaTX4iIGEH2keLaUftg0b29Ou/MIPn3
+z7Ln9K6eknf/OGXAvBP2cnWkTGXAOBmB95s9XDrORMCQQDE+FcWTlSKFywFaxhp
nVkDOL+k7Vpn/rKvqKB3JQOrPkovPSo/CHsUVe/r2NEsdJt1SKOs0/xzNe7wSXBa
1tjRAkAHVbTsE+yRJ+LBfJQQUh8kitUeDI/v4q/4NYTxmAR87SDCXTprY+NP9BFR
XJovbyjbS7W3RcQ0s5CNeWjNojZbAkA5u3SDJDhhNUOA3xALvMPfTt3VMICkJKIp
HGrUITQ/GAXUbMAaM5knr7yfyzAcMJ10NfNLb+L5veAn686TwY9RAkArqoX6cWrd
GflH+FhUggqgVrr9XaXkpPUxcpNqAQH/3Yl5pt9jV2VE7eD3chijMGzGJrMUsqFG
n8mFEtUKobsK
-----END PRIVATE KEY-----
   ENDHEREDOC</span>
   [<span class="ruby-identifier">self_signed_certificate</span>, <span class="ruby-identifier">private_key</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># has the same functionality as</span>
  <span class="ruby-comment"># #ssl_sample_self_signed_cert.</span>
  <span class="ruby-comment"># this one is left as an example on how</span>
  <span class="ruby-comment"># safely place a certificate/private key</span>
  <span class="ruby-comment"># pair inside this code, instead of leaving</span>
  <span class="ruby-comment"># it in plain or somewhere in your filesystem.</span>
  <span class="ruby-comment"># @param [splat] +args+::, an splat whose elements are expected to be:</span>
  <span class="ruby-comment"># +reserved+:: [splat] reserved for future use</span>
  <span class="ruby-comment"># @return [Array] where the first element is a certificate (suitable to be the contents of +cert_pem_file+  in #ssl_make_server) and the second a private key (suitable to be the contents of +priv_pemfile+ in #ssl_make_server)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-string">&quot;onlyNSAknows&quot;</span>
    <span class="ruby-comment"># generated with:</span>
    <span class="ruby-comment"># test__enc_dec_interactive [</span>
    <span class="ruby-comment">#   ssl_sample_self_signed_cert[0],</span>
    <span class="ruby-comment">#   password,</span>
    <span class="ruby-comment"># ]:</span>
     <span class="ruby-identifier">self_signed_certificate</span> = <span class="ruby-identifier">dec_interactive</span> [
      <span class="ruby-string">&quot;owdfr76MvIhPb05PLsPiTw==\n&quot;</span>,
      <span class="ruby-string">&quot;R1QSJSUmfXVB4ET2r5C2MN3MZC75V9Pi7nWl8+lTZ363IJOYK4/DJkKL0Y58\nMo8fp1mvoq0fjhCSdHqld6IMWxFXW3kzXGyuVScfbRbvYV83AAhmq+HTscUE\nYJLsfnUqTzGKN/AB/Kr1x3kIsZsb9oNSQMk3dFHV89AM9Z1d30ZMgtW8mn/c\nTHmxsLaFgKvg8bT9t+ERBr85bmJuphkDBlAc4hP2KS/xTFeKB1QL/lJ/oF9j\ncUmb5uWdmZ0REzLyYu9F1MfHv0lwENi+oJYW50lo7DUTYHnyKxYRo+rlUsDF\n0nyS4wcPQVxvY1vDrC34pFdMtcXLQTzzbAiyJx73fT7WfY40MNNKRZfz/zlG\nl/d4ILNlW43/fVnOwg4yZ1tGT1PovrDs1c8Mxu7zm0QCT7+Dp+nN0zes5K8A\n2aYIsR7Nvm+3OeKrRf2JXHv8J/10NEcPfuYocmitlzrr6yM3+4xMXM94Zt/7\n4+vONht+xOhOxUmJufC4HNOmqszX1480dL96qfhc9zXlvxpbD4DGkgU0AR17\nt1C6XNqI0jQxxDMQa0jn0HsX5C9dmtqunLIz8ZkgfSNJbsOtVYVS11YuXk+k\nbEdVimP6DT1x0KZ+UxpxOFJcuvtM6eBe3aMWRjlIf/xjobJ2GP9OlDq1hPJe\n+zz1lhUxobFZiqSIrVbYz8u6ZuvVSEa8NfQJ+GpE1poExzBAsM5RjSMWK0Yr\nLnasLNQwJkYoDlmZBNOX30pCaZPmLl9xLaJphIeHOcmNL0e209hST4H5s1oZ\np/k+sk/jgqtc6jVBeMVwSEDHLl4F4hiNHqeqW72bim7XlkbVjaZ8Q66hUCK/\nKBlJ9YH4QCm3zN4ZQtoTOwu7G8+GeO46ahShzE9+6uoj8DCN31zcbDA5sKgJ\nc6SkA1KG83cDq2rP9zKAMn8V1O/NMnV/09gqPiowl/60CVuepkpNmVehhBVi\noamQ5r1g2l/PaUr7hmwygLBjnMHYD2eu5M0gMLYtZxCQSiXTxryp8Xd7vBzs\n0oWO2km/RjVedhxIBMGxcL2O17lWvumcr8AQYOuuiciPqNj0p/KxDYUHvIqx\nW3vPHknUzug5gSwfYZF7t5HCAc8dyRyC/b5M7Mvl9OsWdRPpcv25Dr+x/i/r\nrRMyvBLd8cujRh532fuyDZVL8NwPqwkKoBSU/+hkSOfW6WEdwYWp8xHDFmrQ\nD/YTNSSVPhGNSxR4I/niEksgH43zp5MdowcVuVsIxQBI/ExGcloRJ3hVa1I=\n&quot;</span>,
      <span class="ruby-string">&quot;IxDTD59cryQjCnFpYQTudw==\n&quot;</span>,
      <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>,
      <span class="ruby-identifier">password</span>,
    ]
    <span class="ruby-comment"># generated with:</span>
    <span class="ruby-comment"># test__enc_dec_interactive [</span>
    <span class="ruby-comment">#   ssl_sample_self_signed_cert[1],</span>
    <span class="ruby-comment">#   &quot;onlyNSAknows&quot;,</span>
    <span class="ruby-comment"># ]</span>
    <span class="ruby-identifier">private_key</span> = <span class="ruby-identifier">dec_interactive</span> [
      <span class="ruby-string">&quot;mxoZrTsIelpVmTAdSMQJaw==\n&quot;</span>,
      <span class="ruby-string">&quot;ebsMBtAoESJAOrmffbRsNdjv3FUqyTetrKlw6WGCNLre8uChpt38ZRmi1XAr\nab2PxiNyz7OJ8PWwCnd/TjIOhvid3Zt7LbqUpR2ixRmVf/mEFoWrdwdXnOMz\nzQErlSok1dY2cAvGqBihP26yC9N4IGJU5Jrt4wivahnnvWZoC1gvsEZVPC+Q\nxLF69gu8fn4gUgFvzpjuhgcCXk6QyhW916pZxJrtwBRMEQWu9dGEcRqSPqNt\nLfw6cXyGHDNV1320Je2BRjzMrhIfiwkv88oWEjnHcbOzboxhGdvYG8oYNMgQ\nf9qouABXlQyOEnBIFfl2lKoJaizERs1ShsdNCAcyZZPgNdxWNawdcF3AawYh\nqlX+uOlxCsWQLV3AaSDPy9mDthF3IuMLLe/BlY3gkGLCvD4szZIsQhk6047+\n9euOuJxxu8X3r8TZDHQK9esm5O6YeNFIlGko6PXA2OwcdUWO9Umwr7Lu8Mgk\n/yldW0G/6dMZ6qKSSSLTvEnzZChz91GabcntxT2TrOR2b1zHJhfOUUxcHxWe\nkuqZZ6GmGFIPju22cCsstXDZ0Q1J19VnGBsrySR0AHDxS3sLgeihf8SjP1bn\n3B1nRR+1gHyKPthKiuzibJj+j6xcIgYBynyaNIeT0Wfcf7WXyBTZ+Idd7Z+R\nkiy9jnZPqCIEE5aebuVvAUXksPE2OvEgsCIiLSEylXXrHEdcEnfra7wvo0qb\n1G/vRNlOIYJiOsKLOqcg6KZVJ+QHHYPrir33g4N02Q64WEw4/eIzR5o4MV9c\n7tho/VLQBE1T3z8HPlhe8XOXvVIDJ/cDVJhTre6KbKBsA+Ow47Z1uNXAchAO\n2bwl1sN1iH+SNBsEjRiXpjbrk95I/H66+LZoz85kRBcoQIhfXU97qbskBUwX\nK//3HdYluo/xx5QSVNqQUzybQnRdNV7gy6xNIgpot9ZtPB2K00HulWW1dnRQ\nBMCWb5h3eUob826icleZ/bEFfcfY8FjNTh9zhyWra3wJOTGS4zhmnlfhBRFZ\njRUcKGX/zgfIrCKXum+2m7Cku3bez+mKpEMRWIBPweGzjq3DSdtY+qlKOgeV\nBxOOh0QoMw1kzRfqF0D0Nqn785lvcXjH28v1efHf6SgFrOXjFNl0ihXXxhMG\nivsoIGIblspGIddR6wbarq1L8xMBTCAorNo0OrWPYACz4ek2CmQUuLhwiNx/\nWsFmaElfdtNL/WM06D5zehAYnCfg02zVr4bIgrHkFaq+jsI+u7/3GhtAmnAC\nkUT9CQvGNXwki3jIHOJQL1X8vLA2T25lg9I7wU4EXA==\n&quot;</span>,
      <span class="ruby-string">&quot;IBBcvvM2/h7bW+tBcBbXeQ==\n&quot;</span>,
      <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>,
      <span class="ruby-identifier">password</span>,
      ]
    [<span class="ruby-identifier">self_signed_certificate</span>, <span class="ruby-identifier">private_key</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for ssl_sample_self_signed_cert_encrypted</span>
  <span class="ruby-comment"># note: function name out of standard. kept for</span>
  <span class="ruby-comment"># open-closed commitment.</span>
  <span class="ruby-comment"># call #test__enc_dec_interactive__ssl_sample_self_signed_cert</span>
  <span class="ruby-comment"># instead</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">expectation</span> = {
      <span class="ruby-value">:self_signed_certificate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span>[<span class="ruby-value">0</span>],
      <span class="ruby-value">:private_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span>[<span class="ruby-value">1</span>],
    }
    <span class="ruby-identifier">actual</span> = {
      <span class="ruby-value">:self_signed_certificate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span>[<span class="ruby-value">0</span>],
      <span class="ruby-value">:private_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span>[<span class="ruby-value">1</span>],
    }
    <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
    }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># #test_enc_dec_interactive__ssl_sample_self_signed_cert</span>
  <span class="ruby-comment"># function name out of standard.</span>
  <span class="ruby-comment"># this one should be called instead instead</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">test_enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_ssl_server (call #io_transform with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-comment"># just like #test__tcp_ssl_server__non_ssl,</span>
  <span class="ruby-comment"># calling directly #tcp_ssl_server, but making</span>
  <span class="ruby-comment"># mandatory the server to be ssl one.</span>
  <span class="ruby-comment"># requires, by default that the certificate and its</span>
  <span class="ruby-comment">#  private key are found in the current dir, which</span>
  <span class="ruby-comment">#  can be achieved with:</span>
  <span class="ruby-comment">#  +openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</span>
  <span class="ruby-comment"># but if the files don&#39;t exist, they will be created</span>
  <span class="ruby-comment"># with a sample self signed certificate.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">priv_pemfile</span>,
     <span class="ruby-identifier">cert_pem_file</span>,
     <span class="ruby-identifier">extra_cert_pem_files</span>,
     <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
     <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
   <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
   <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
   <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
   <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
   <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> =
     <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
   <span class="ruby-identifier">ssl_cert_pkey_chain</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>
   <span class="ruby-identifier">priv_pemfile</span>  =   <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">1</span>]
   <span class="ruby-identifier">cert_pem_file</span> =  <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">0</span>]
   <span class="ruby-identifier">extra_cert_pem_files</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">2</span>]
   <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> [
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;admit non ssl server&quot;</span>.<span class="ruby-identifier">negate_me</span>,
     <span class="ruby-string">&quot;io_transform&quot;</span>,
     [
       <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
       <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
       <span class="ruby-identifier">http_processing_method</span>,
       <span class="ruby-identifier">http_processing_method_args</span>
     ],
     <span class="ruby-identifier">priv_pemfile</span>,
     <span class="ruby-identifier">cert_pem_file</span>,
     <span class="ruby-identifier">extra_cert_pem_files</span>,
     <span class="ruby-string">&quot;yes, output exceptions&quot;</span>,
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests #file_read_or_write and #file_read</span>
  <span class="ruby-comment"># specially its +return_on_rescue+ parameter.</span>
  <span class="ruby-comment"># attention that files given by parameter</span>
  <span class="ruby-comment"># will be mercilessly overwritten.</span>
  <span class="ruby-comment"># writes the contents returned by </span>
  <span class="ruby-comment"># #ssl_sample_self_signed_cert</span>
  <span class="ruby-comment"># to 2 files. then reads then.</span>
  <span class="ruby-comment"># after it tries to give the contents of</span>
  <span class="ruby-comment"># those files instead of the filenames.</span>
  <span class="ruby-comment"># the idea behind is that, no matter if</span>
  <span class="ruby-comment"># contents or filename were given, it</span>
  <span class="ruby-comment"># should always return the contents of</span>
  <span class="ruby-comment"># the file.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_read__return_on_rescue</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">priv_pemfile</span>, <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">priv_pemfile</span>  =  <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;/tmp/pkey.pem&quot;</span>
    <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;/tmp/cert.crt&quot;</span>
    <span class="ruby-identifier">runef</span> { 
     <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">priv_pemfile</span>
     <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">cert_pem_file</span>
    }
    <span class="ruby-identifier">cert_contents</span>, <span class="ruby-identifier">pkey_contents</span> = <span class="ruby-identifier">ssl_sample_self_signed_cert</span>
    <span class="ruby-comment"># asserting that file_read_or_write is correct</span>
    <span class="ruby-identifier">read_or_write_cert_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-identifier">cert_contents</span>
    <span class="ruby-identifier">read_or_write_pkey_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">priv_pemfile</span>,  <span class="ruby-identifier">pkey_contents</span>
    <span class="ruby-identifier">file_dot_read_cert_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">cert_pem_file</span>
    <span class="ruby-identifier">file_dot_read_pkey_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">priv_pemfile</span>
    <span class="ruby-comment"># files exist case (will return the contents of 1st parameter filename):</span>
    <span class="ruby-identifier">existing_cert_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_pem_file</span>]
    <span class="ruby-identifier">existing_pkey_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">priv_pemfile</span>,  <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">priv_pemfile</span> ]
    <span class="ruby-comment"># files don&#39;t exist case (will return the 4th parameter):</span>
    <span class="ruby-identifier">rescue_cert_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_contents</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_contents</span>]
    <span class="ruby-identifier">rescue_pkey_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">pkey_contents</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">pkey_contents</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">read_or_write_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;read_or_write_cert_contents&quot;</span>],
        [<span class="ruby-identifier">read_or_write_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;read_or_write_pkey_contents&quot;</span>],
        [<span class="ruby-identifier">file_dot_read_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;file_dot_read_cert_contents&quot;</span>],
        [<span class="ruby-identifier">file_dot_read_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;file_dot_read_pkey_contents&quot;</span>],
        [<span class="ruby-identifier">existing_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;existing_cert_contents&quot;</span>],
        [<span class="ruby-identifier">existing_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;existing_pkey_contents&quot;</span>],
        [<span class="ruby-identifier">rescue_cert_contents</span>,   <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;rescue_cert_contents&quot;</span>],
        [<span class="ruby-identifier">rescue_pkey_contents</span>,   <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;rescue_pkey_contents&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_ssl_server (call #io_transform with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-comment"># just like #test__tcp_ssl_server__non_ssl,</span>
  <span class="ruby-comment"># calling directly #tcp_ssl_server, but making</span>
  <span class="ruby-comment"># mandatory the server to be ssl one.</span>
  <span class="ruby-comment"># requires, by default that the certificate and its</span>
  <span class="ruby-comment">#  private key are found in the current dir, which</span>
  <span class="ruby-comment">#  can be achieved with:</span>
  <span class="ruby-comment">#  +openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</span>
  <span class="ruby-comment"># but if the files don&#39;t exist, they will be created</span>
  <span class="ruby-comment"># with a sample self signed certificate.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__ssl_self_signed</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">priv_pemfile</span>,
     <span class="ruby-identifier">cert_pem_file</span>,
     <span class="ruby-identifier">extra_cert_pem_files</span>,
     <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
   <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> = <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
   <span class="ruby-identifier">test__tcp_ssl_server__io_transform</span> [
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">priv_pemfile</span>,
     <span class="ruby-identifier">cert_pem_file</span>,
     <span class="ruby-identifier">extra_cert_pem_files</span>,
     <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
   ]
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_ssl_server (calling an +io_method+,</span>
  <span class="ruby-comment"># by default #io_transform, with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-comment"># just like #test__tcp_ssl_server__non_ssl,</span>
  <span class="ruby-comment"># calling directly #tcp_ssl_server, but making</span>
  <span class="ruby-comment"># mandatory the server to be ssl one.</span>
  <span class="ruby-comment"># requires, by default that the certificate and its</span>
  <span class="ruby-comment">#  private key are found in the current dir, which</span>
  <span class="ruby-comment">#  can be achieved with:</span>
  <span class="ruby-comment">#  +openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</span>
  <span class="ruby-comment"># but if the files don&#39;t exist, they will be created</span>
  <span class="ruby-comment"># with a sample self signed certificate.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__io_method</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">io_method</span>,
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
    <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
    <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
    <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
    <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> =
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
    <span class="ruby-identifier">ssl_cert_pkey_chain</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>
    <span class="ruby-identifier">priv_pemfile</span>  =   <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">cert_pem_file</span> =  <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">0</span>]
    <span class="ruby-identifier">extra_cert_pemiles</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">2</span>]
    <span class="ruby-identifier">debug</span> =  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;yes, debug&quot;</span>
    <span class="ruby-identifier">io_method</span> =  <span class="ruby-identifier">io_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;io_transform&quot;</span>
    <span class="ruby-identifier">io_method_debug</span> =  <span class="ruby-identifier">io_method_debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">debug</span>
    <span class="ruby-identifier">happy_with_request</span> = <span class="ruby-identifier">happy_with_request</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">admit_non_ssl</span> = <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">tcp_ssl_server_args</span> = [
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">io_method</span>,
      [
        <span class="ruby-identifier">io_method_debug</span>,
        <span class="ruby-identifier">happy_with_request</span>,
        <span class="ruby-identifier">http_processing_method</span>,
        <span class="ruby-identifier">http_processing_method_args</span>
      ],
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-string">&quot;yes, output exceptions&quot;</span>,
    ]
    <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> <span class="ruby-identifier">tcp_ssl_server_args</span>
    [ <span class="ruby-identifier">thread</span> ] <span class="ruby-operator">+</span> <span class="ruby-identifier">tcp_ssl_server_args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests file_read against a uri.</span>
  <span class="ruby-comment"># created to test a client for servers</span>
  <span class="ruby-comment"># created with</span>
  <span class="ruby-comment"># #test__tcp_ssl_server__io_method</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_read__uri_root</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">domain</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
    <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
    <span class="ruby-identifier">admit_non_ssl</span> = <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">nne</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">inspect</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> (<span class="ruby-identifier">admit_non_ssl</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;http://#{domain}:#{http_server_port}/&quot;</span>])).<span class="ruby-identifier">inspect</span>
    <span class="ruby-identifier">response</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;https://#{domain}:#{http_server_port}/&quot;</span>]) <span class="ruby-operator">||</span>
      <span class="ruby-identifier">admit_non_ssl</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;http://#{domain}:#{http_server_port}/&quot;</span>])
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>  <span class="ruby-node">&quot;response{#{response}}response&quot;</span>)
    <span class="ruby-identifier">response</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests test__tcp_ssl_server__io_method, creating two</span>
  <span class="ruby-comment"># servers, one ssl and another plain, redirecting to</span>
  <span class="ruby-comment"># the ssl one. then, opens a client thread with a client</span>
  <span class="ruby-comment"># connecting to the root document of the plain server</span>
  <span class="ruby-comment"># (and in the end being served by the root document of</span>
  <span class="ruby-comment"># the ssl server).</span>
  <span class="ruby-comment"># another thread for the client</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__get_root__plain_redirect</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">tcp_ssl_server_method</span>,
      <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
      <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">io_method</span>,
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">domain</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">no_debug_client</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">tcp_ssl_server_method</span> = <span class="ruby-identifier">tcp_ssl_server_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:test__tcp_ssl_server__io_method</span>
    <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
    <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
    <span class="ruby-identifier">no_debug_client</span> = <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">server_thread</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">tcp_ssl_server_method</span>,
      [
        <span class="ruby-identifier">http_processing_method</span>,
        <span class="ruby-identifier">http_processing_method_args</span>,
        <span class="ruby-identifier">http_server_port</span>,
        <span class="ruby-identifier">http_ip_addr</span>,
        <span class="ruby-identifier">priv_pemfile</span>,
        <span class="ruby-identifier">cert_pem_file</span>,
        <span class="ruby-identifier">extra_cert_pem_files</span>,
        <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
        <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
        <span class="ruby-identifier">happy_with_request</span>,
        <span class="ruby-identifier">io_method</span>,
        <span class="ruby-identifier">io_method_debug</span>,
        <span class="ruby-identifier">admit_non_ssl</span>,
      ]

    <span class="ruby-identifier">thread_2</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> {
      <span class="ruby-identifier">loop</span> {
        <span class="ruby-identifier">response</span> = <span class="ruby-identifier">test__file_read__uri_root</span> [
          <span class="ruby-identifier">domain</span>,
          <span class="ruby-identifier">http_server_port</span>,
          <span class="ruby-identifier">admit_non_ssl</span>,
          <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">negate_me</span>,
        ]
        <span class="ruby-identifier">sleep</span> <span class="ruby-value">2</span>
      }
    }
    <span class="ruby-identifier">server_thread</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">join</span>

    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests test__tcp_ssl_server__io_method and opens</span>
  <span class="ruby-comment"># another thread for the client</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__get_root</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">tcp_ssl_server_method</span>,
      <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
      <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">io_method</span>,
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">domain</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">no_debug_client</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">tcp_ssl_server_method</span> = <span class="ruby-identifier">tcp_ssl_server_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:test__tcp_ssl_server__io_method</span>
    <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
    <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
    <span class="ruby-identifier">no_debug_client</span> = <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">server_thread</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">tcp_ssl_server_method</span>,
      [
        <span class="ruby-identifier">http_processing_method</span>,
        <span class="ruby-identifier">http_processing_method_args</span>,
        <span class="ruby-identifier">http_server_port</span>,
        <span class="ruby-identifier">http_ip_addr</span>,
        <span class="ruby-identifier">priv_pemfile</span>,
        <span class="ruby-identifier">cert_pem_file</span>,
        <span class="ruby-identifier">extra_cert_pem_files</span>,
        <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
        <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
        <span class="ruby-identifier">happy_with_request</span>,
        <span class="ruby-identifier">io_method</span>,
        <span class="ruby-identifier">io_method_debug</span>,
        <span class="ruby-identifier">admit_non_ssl</span>,
      ]

    <span class="ruby-identifier">thread_2</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> {
      <span class="ruby-identifier">loop</span> {
        <span class="ruby-identifier">response</span> = <span class="ruby-identifier">test__file_read__uri_root</span> [
          <span class="ruby-identifier">domain</span>,
          <span class="ruby-identifier">http_server_port</span>,
          <span class="ruby-identifier">admit_non_ssl</span>,
          <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">negate_me</span>,
        ]
        <span class="ruby-identifier">sleep</span> <span class="ruby-value">2</span>
      }
    }
    <span class="ruby-identifier">server_thread</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">join</span>

    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># experimental stuff coming. usage example:</span>
  <span class="ruby-comment"># ./rubyment.rb  invoke_double p test__shell_send_array__main  &quot;tinga&quot; &quot;&quot; sub in EN </span>
  <span class="ruby-comment"># [&quot;tENga&quot;]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__shell_send_array__main</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">object_to_send</span>,
      <span class="ruby-identifier">reserved</span>,
      <span class="ruby-identifier">method_to_send</span>,
      <span class="ruby-operator">*</span><span class="ruby-identifier">args_to_send</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">object_to_send</span> = <span class="ruby-identifier">object_to_send</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">method_to_send</span> = <span class="ruby-identifier">method_to_send</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:main</span>
    <span class="ruby-identifier">object_to_send</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">object_to_send</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">method_to_send</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args_to_send</span>
    ) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">object_to_send</span>) <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">send</span> <span class="ruby-identifier">method_to_send</span>, <span class="ruby-identifier">args_to_send</span>
    )
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for Object::nne</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__object_nne</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">string_neutral</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">string_non_neutral</span> = <span class="ruby-string">&quot;xxx&quot;</span>
    <span class="ruby-identifier">fixnum_neutral</span> = <span class="ruby-value">0</span>
    <span class="ruby-identifier">fixnum_non_neutral</span> = <span class="ruby-value">1</span>
    <span class="ruby-identifier">array_neutral</span> = []
    <span class="ruby-identifier">array_non_neutral</span> = [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>]
    <span class="ruby-identifier">hash_neutral</span> = {}
    <span class="ruby-identifier">hash_non_neutral</span> = { <span class="ruby-value">1</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> }
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">string_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;string_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">string_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">string_non_neutral</span>, <span class="ruby-string">&quot;string_non_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">fixnum_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;fixnum_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">fixnum_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">fixnum_non_neutral</span>, <span class="ruby-string">&quot;fixnum_non_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">array_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;array_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">array_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">array_non_neutral</span>, <span class="ruby-string">&quot;array_non_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">hash_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;hash_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">hash_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">hash_non_neutral</span>, <span class="ruby-string">&quot;hash_non_neutral.nne&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># runs a command in a shell (requires &#39;open3&#39;)</span>
  <span class="ruby-comment"># returns stdout and stderr output mixed</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +command+:: [String] command to be executed</span>
  <span class="ruby-comment"># @return [Array] returns an  #Array whose elements are:</span>
  <span class="ruby-comment"># +stdoutanderr+:: [Array of Strings] mix of stdout and stderr output</span>
  <span class="ruby-comment"># +stdin+:: [IO]</span>
  <span class="ruby-comment"># +wait_thr+:: [Thread]</span>
  <span class="ruby-comment"># +success?+:: [TrueClass, FalseClass]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_popen2e_command</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">command</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;open3&quot;</span>
      <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">stdoutanderr</span>, <span class="ruby-identifier">wait_thr</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">popen2e</span>(<span class="ruby-string">&quot;:;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">command</span>)
      [ <span class="ruby-identifier">stdoutanderr</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">wait_thr</span>, <span class="ruby-identifier">wait_thr</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">success?</span> ]
    <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># runs a command in a shell (requires &#39;open3&#39;)</span>
  <span class="ruby-comment"># returns stdout and stderr output separated</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +command+:: [String] command to be executed</span>
  <span class="ruby-comment"># @return [Array] returns an  #Array whose elements are:</span>
  <span class="ruby-comment"># +stdout+:: [Array of Strings] stdout output</span>
  <span class="ruby-comment"># +stderr+:: [Array of Strings] stderr output</span>
  <span class="ruby-comment"># +stdin+:: [IO]</span>
  <span class="ruby-comment"># +wait_thr+:: [Thread]</span>
  <span class="ruby-comment"># +success?+:: [TrueClass, FalseClass]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_popen3_command</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">command</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;open3&quot;</span>
      <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">stdout</span>, <span class="ruby-identifier">stderr</span>, <span class="ruby-identifier">wait_thr</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">popen3</span>(<span class="ruby-string">&quot;:;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">command</span>)
      [ <span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">wait_thr</span>, <span class="ruby-identifier">wait_thr</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">success?</span> ]
    <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for functions that adds syntatic sugar to</span>
  <span class="ruby-comment"># exceptions.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__rune_functions</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">do_rescue</span> = <span class="ruby-string">&quot;rescue&quot;</span>
    <span class="ruby-identifier">do_output</span> = <span class="ruby-string">&quot;output&quot;</span>
    <span class="ruby-identifier">no_rescue</span> = <span class="ruby-string">&quot;no rescue&quot;</span>
    <span class="ruby-identifier">no_output</span> = <span class="ruby-string">&quot;no output&quot;</span>
    <span class="ruby-identifier">actual</span> = {}
    <span class="ruby-identifier">expectation</span> = {}

    <span class="ruby-comment">#working case</span>
    <span class="ruby-identifier">expected_return</span> = [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>]
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_and_output_work</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">do_output</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_but_no_output_work</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:effectless_output_but_no_rescue_work</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">do_output</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:no_output_and_no_rescue_work</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>

    <span class="ruby-comment"># failure cases</span>
    <span class="ruby-identifier">expected_return</span> = <span class="ruby-string">&quot;no_such_method&quot;</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_and_output_fail</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">do_output</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>;  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }[<span class="ruby-value">1</span>].<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_but_no_output_fail</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:effectless_output_but_no_rescue_fail</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">do_output</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NoMethodError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">noMethodError</span>
      <span class="ruby-identifier">noMethodError</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:no_output_and_no_rescue_fail</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NoMethodError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">noMethodError</span>
      <span class="ruby-identifier">noMethodError</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>

    <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
    }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests if  +operand_1+ is only</span>
  <span class="ruby-comment"># composed by a repetition of +operand_2+</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +operand_1+:: [String]</span>
  <span class="ruby-comment"># +operand_2+:: [String] </span>
  <span class="ruby-comment"># +min_repetitions+:: [FixNum] minimum of times +operand_2+ is required to appear in +operand_1+ (default: +0+). Note that in +args=[&quot;&quot;, &quot;X&quot;, 0]+, +operand_1=&quot;&quot;+ will be returned, because &quot;&quot; is a composition of +0+ times &quot;X&quot;. </span>
  <span class="ruby-comment"># @return [String, FalseClass] returns +operand_1+ if it is only</span>
  <span class="ruby-comment"># composed by a repetition of +operand_2+, otherwise +false+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">string_repetition</span>  <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">operand_1</span>,
    <span class="ruby-identifier">operand_2</span>,
    <span class="ruby-identifier">min_repetitions</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
    <span class="ruby-identifier">matches</span>  = (<span class="ruby-identifier">operand_1</span>.<span class="ruby-identifier">scan</span> <span class="ruby-identifier">operand_2</span>) <span class="ruby-keyword">rescue</span> []
    <span class="ruby-identifier">amout_of_matches</span> = <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">size</span>
    <span class="ruby-identifier">min_repetitions</span> = <span class="ruby-identifier">min_repetitions</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">is_string_repetition</span> = (
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;(#{amout_of_matches} &gt;= #{min_repetitions}) &amp;&amp; (#{operand_2.size} * #{amout_of_matches} == #{operand_1.size})&#39;</span>)
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;(#{amout_of_matches} &gt;= #{min_repetitions}) &amp;&amp; (#{operand_2.size} * #{amout_of_matches} == #{operand_1.size})&quot;</span>)
      <span class="ruby-comment"># if operand_2 was matched N times, and the sum</span>
      <span class="ruby-comment"># of those N matched sizes is the same</span>
      (<span class="ruby-identifier">amout_of_matches</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">min_repetitions</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">operand_2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">amout_of_matches</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">operand_1</span>.<span class="ruby-identifier">size</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
    ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">operand_1</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{is_string_repetition}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">is_string_repetition</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># operates and/or returns a structure similar to an pushdown automaton.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +pd+:: [Array] an +Array+ whose elements are :</span>
  <span class="ruby-comment"># +pd.operand+:: [Array] current state</span>
  <span class="ruby-comment"># +pd.stack+:: [Array] state stack</span>
  <span class="ruby-comment"># +operation_plan+:: [Array, Object] +false+ object is interpreted as no operation (only creates a pd). Otherwise, it is an +Array+ whose elements are :</span>
  <span class="ruby-comment">#     reserved_token, reservation_type, token = operation_plan.to_a</span>
  <span class="ruby-comment"># +operation_plan.reserved_token+:: [Object] operates stack if +true+, otherwise, operate +state+</span>
  <span class="ruby-comment"># +operation_plan.reservation_type+:: [Object] pushes stack if +true+ into state, otherwise, pops.</span>
  <span class="ruby-comment"># +operation_plan.token+:: [Object] state operand (element that will be pushed into the current state, when operating +state+)</span>
  <span class="ruby-comment"># +operation_plan.bulk+:: [Object] if calling the object +nne+ method returns a +true+ value, will operate as +operation_plan.token+ is a container of tokens instead. If the object is an +Array+, it will prepend the first element and append to +pd.operand+ after the bulk insertion is done.</span>
  <span class="ruby-comment"># +debug+:: [Object] +debug.nne+ will be used to determine whether to output or not debug information.</span>
  <span class="ruby-comment"># +pd+:: [Array] </span>
  <span class="ruby-comment"># @return [Array] returns the operated (or a new, when no operation) +pd+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">pushdown_operate</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">pd</span>,
      <span class="ruby-identifier">operation_plan</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">nne</span> []
    <span class="ruby-identifier">array_operand</span>,
      <span class="ruby-identifier">array_operands_stack</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">pd</span>

    <span class="ruby-identifier">operation_plan</span> = <span class="ruby-identifier">operation_plan</span>.<span class="ruby-identifier">nne</span>

    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;{#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;operation_plan=#{operation_plan.inspect}&quot;</span>)

    <span class="ruby-identifier">array_operands_stack</span> = <span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">nne</span> []
    <span class="ruby-identifier">array_operand</span> = <span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">nne</span> []

    <span class="ruby-identifier">reserved_token</span>,
      <span class="ruby-identifier">reservation_type</span>,
      <span class="ruby-identifier">token</span>,
      <span class="ruby-identifier">reserved_token_symbol</span>,
      <span class="ruby-identifier">bulk</span> = <span class="ruby-identifier">operation_plan</span>.<span class="ruby-identifier">to_a</span>
    <span class="ruby-identifier">bulk</span> = <span class="ruby-identifier">bulk</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reserved_token=#{reserved_token.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reservation_type=#{reservation_type.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;token=#{token.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;bulk=#{bulk.inspect}&quot;</span>)
    <span class="ruby-identifier">operation_plan</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">reserved_token</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">reservation_type</span> <span class="ruby-operator">&amp;&amp;</span> (
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_up_token: #{token.inspect}&quot;</span>)
        <span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">array_operand</span>
        <span class="ruby-identifier">array_operand</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-keyword">true</span>
      ) <span class="ruby-operator">||</span> (
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_down_token: #{token.inspect}&quot;</span>)
        <span class="ruby-comment"># this approach:</span>
        <span class="ruby-comment">#  array_operand = array_operands_stack.pop.push array_operand</span>
        <span class="ruby-comment"># won&#39;t accept pops when the stack is empty.</span>
        <span class="ruby-comment"># this approach:</span>
        <span class="ruby-comment">#  array_operand = array_operands_stack.pop.to_a.push array_operand</span>
        <span class="ruby-comment"># will work as a &quot;push&quot; was added to the beginning</span>
        <span class="ruby-comment"># another approach (not coded here) would be stop accept</span>
        <span class="ruby-comment"># pushes to *array_operand* (at least when a new</span>
        <span class="ruby-comment"># stack push/token up is done). To keep simplicity,</span>
        <span class="ruby-comment"># the reset approach is done (past is forgotten),</span>
        <span class="ruby-comment"># but the other options are left for the case of a</span>
        <span class="ruby-comment"># future option implementation</span>
        <span class="ruby-identifier">array_operand</span> = (<span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">array_operand</span>) <span class="ruby-keyword">rescue</span> []
        <span class="ruby-keyword">true</span>
      )
    ) <span class="ruby-operator">||</span> <span class="ruby-identifier">operation_plan</span> <span class="ruby-operator">&amp;&amp;</span> (
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_no_token: #{token.inspect}&quot;</span>)

        <span class="ruby-identifier">bulk_token_duck_type_method</span> = <span class="ruby-value">:map</span>
        <span class="ruby-identifier">bulk_token_push</span> = <span class="ruby-identifier">bulk</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">bulk_token_duck_type_method</span>)
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;[bulk, bulk_token_duck_type_method, bulk_token_push]=#{[bulk, bulk_token_duck_type_method, bulk_token_push].inspect}&quot;</span>)
        <span class="ruby-identifier">bulk_token_push</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">token</span>)
        <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">bulk</span>.<span class="ruby-identifier">to_a</span>
        <span class="ruby-identifier">bulk_token_push</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">token</span> = [<span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">append</span>].<span class="ruby-identifier">flatten</span>(<span class="ruby-value">1</span>))
        <span class="ruby-identifier">bulk_token_push</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">token</span>.<span class="ruby-identifier">map</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:push</span>))
        <span class="ruby-keyword">true</span>
    )
    <span class="ruby-identifier">pd</span> = [<span class="ruby-identifier">array_operand</span>, <span class="ruby-identifier">array_operands_stack</span>]
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{pd.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning}&quot;</span>)
    <span class="ruby-identifier">pd</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># will take a flatten array and makes it deeper, starting a new array</span>
  <span class="ruby-comment"># everytime it finds the string +&quot;[&quot;+. +&quot;]&quot;+ stops the array (and</span>
  <span class="ruby-comment"># return to the upper one). To reserve the possibility of</span>
  <span class="ruby-comment"># representing &quot;[&quot; or &quot;]&quot;, everytime a string contains only those</span>
  <span class="ruby-comment"># chars, repeteaded any number of times, starting from 2, one of</span>
  <span class="ruby-comment"># them will be removed. So +&quot;[[&quot;+ will be left as +&quot;[&quot;+ and</span>
  <span class="ruby-comment"># +&quot;]]]&quot;+ will be left as +&quot;]]&quot;+.</span>
  <span class="ruby-comment"># if the provided array is not flatten, it has an undefined</span>
  <span class="ruby-comment"># behaviour (it will either a - transverse the sub-arrays</span>
  <span class="ruby-comment"># or b - don&#39;t transverse it, leaving it untouched. while</span>
  <span class="ruby-comment"># the a is the planned effect, initially only a may will</span>
  <span class="ruby-comment"># be implemented) (currently this behaviour is easily configurable</span>
  <span class="ruby-comment"># by the value +deep+, hardcoded in the function. soon, new</span>
  <span class="ruby-comment"># functions will come to clarify and specify the proper behaviours)</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +flatten_array+:: [Array] the array to be operated.</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +shallow+:: [Object] if evals to false (or empty string), will traverse recursively +flatten_array+ and apply the rules, in the case it is not flatten.</span>
  <span class="ruby-comment"># +reserved_tokens+:: [Array of Arrays]</span>
  <span class="ruby-comment"># +inverse+:: [Object] if calling the object +nne+ method returns a +false+ value, will operate this function inversely: will take a unflatten array and flatten it, applying the inverse escaping rules (note that any object responding to +:map+ will be considered an array in +flatten_array+).</span>
  <span class="ruby-comment"># +debug_pushdown+:: [Object] if evals to false (or empty string), won&#39;t print debug information about the call #pushdown_operated</span>
<span class="ruby-comment"># +inversion_envelope+::  [Array, nil], if +nil+, the first colum of +reserved_tokens+ will be used. if an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +inversion_envelope.prepend+::  [Object] when an inversion occurrs, this element will be prepended when a new object responding to +:map+, like +Array+ is found.</span>
  <span class="ruby-comment"># +inversion_envelope.append+::  [Object] when an inversion occurrs, this element will be prepended when a new object responding to +:map+, like +Array+ is found.</span>
  <span class="ruby-comment"># @return [Array] returns the modified, deep, #Array</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">array_unflatten_base</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">flatten_array</span>,
      <span class="ruby-identifier">shallow</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">reserved_tokens</span>,
      <span class="ruby-identifier">inverse</span>,
      <span class="ruby-identifier">debug_pushdown</span>,
      <span class="ruby-identifier">inversion_envelope</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">reserved_tokens</span> = <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">nne</span> [
      [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:up</span>],
      [ <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>],
    ]
    <span class="ruby-identifier">inversion_envelope</span> = <span class="ruby-identifier">inversion_envelope</span>.<span class="ruby-identifier">nne</span>(
      <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">transpose</span>.<span class="ruby-identifier">first</span>
    )
    <span class="ruby-identifier">inverse</span> = <span class="ruby-identifier">inverse</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">shallow</span> = <span class="ruby-identifier">shallow</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug_pushdown</span> = <span class="ruby-identifier">debug_pushdown</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;{#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
    <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pushdown_operate</span>
    <span class="ruby-identifier">flatten_array</span>.<span class="ruby-identifier">each_with_index</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">e</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;-------------------&quot;</span>)
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;[e, index]=#{[e, index].inspect}&quot;</span>)
      <span class="ruby-identifier">shallow</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> (
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;e.hash=#{e.hash}&quot;</span>)
        <span class="ruby-identifier">args_recursion</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">clone</span>
        <span class="ruby-identifier">args_recursion</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">e</span>
        <span class="ruby-identifier">e</span> = (<span class="ruby-identifier">send</span> <span class="ruby-identifier">__method__</span>, <span class="ruby-identifier">args_recursion</span>) <span class="ruby-keyword">rescue</span> ( <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} finished with exception }&quot;</span> ) ; <span class="ruby-identifier">e</span>)
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;e.hash=#{e.hash}&quot;</span>)
      )
      <span class="ruby-identifier">operations</span> = <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">reserved_token</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reserved_token=#{reserved_token.inspect}&quot;</span>)
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;array_operands_stack=#{pd[1].inspect}&quot;</span>)
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;array_operand=#{pd.first.inspect}&quot;</span>)
        <span class="ruby-identifier">rtoken</span>, <span class="ruby-identifier">is_up_token</span> = <span class="ruby-identifier">reserved_token</span>

        <span class="ruby-identifier">repetition_test</span> = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-value">1</span>]
        (
          <span class="ruby-comment"># case A: e is exactly the reserved token.</span>
          <span class="ruby-comment"># start or finish an array</span>
          <span class="ruby-comment"># note: if rtoken is false, it will succeed this</span>
          <span class="ruby-comment"># test.</span>
          (<span class="ruby-identifier">repetition_test</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rtoken</span>) <span class="ruby-operator">&amp;&amp;</span> (
            <span class="ruby-identifier">inverse</span>  <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">e</span> = (<span class="ruby-identifier">e</span>.<span class="ruby-identifier">sub!</span> <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">rtoken</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">e</span>)
            <span class="ruby-identifier">is_up_token</span> <span class="ruby-operator">&amp;&amp;</span> (
              <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case is_up_token&quot;</span>)
              [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>(<span class="ruby-identifier">inverse</span>), <span class="ruby-value">:up</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
            ) <span class="ruby-operator">||</span> (
              <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case is_down_token&quot;</span>)
              [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>(<span class="ruby-identifier">inverse</span>), <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
            )
          )
        ) <span class="ruby-operator">||</span> (
          <span class="ruby-comment"># case B: is a a repetition with at least 2</span>
          <span class="ruby-comment"># occurrences of the reserved token. remove one.</span>
          <span class="ruby-comment"># (and add it to the current array)</span>
          <span class="ruby-identifier">repetition_test</span> <span class="ruby-operator">&amp;&amp;</span> (
            <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case escape&quot;</span>)
            <span class="ruby-comment"># room for improvement: and if array had sub! ?</span>
            <span class="ruby-operator">!</span><span class="ruby-identifier">inverse</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">escaped_e</span> = (<span class="ruby-identifier">e</span>.<span class="ruby-identifier">sub!</span> <span class="ruby-identifier">rtoken</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">e</span>)
            [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">escaped_e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
          )
        ) <span class="ruby-operator">||</span> (
          <span class="ruby-comment"># case C: no repetition. (just add e to</span>
          <span class="ruby-comment"># the current array.)</span>
            <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case just add&quot;</span>)
            [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-identifier">inverse</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">inversion_envelope</span> ]
        )
      }
      <span class="ruby-comment"># now operations has |reserved_tokens| operations.</span>
      <span class="ruby-comment"># but only one will be applied: either the first</span>
      <span class="ruby-comment"># one which is a reserved token (:first), or the</span>
      <span class="ruby-comment"># last operation, in case of no reserved tokens.</span>
      <span class="ruby-identifier">operation</span> = <span class="ruby-identifier">operations</span>.<span class="ruby-identifier">lazy</span>.<span class="ruby-identifier">find</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:first</span>) <span class="ruby-operator">||</span> (
        <span class="ruby-identifier">operations</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">to_a</span>
      )
      <span class="ruby-identifier">reserved_token</span>, <span class="ruby-identifier">reservation_type</span>, <span class="ruby-identifier">token</span> = <span class="ruby-identifier">operation</span>
      <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pushdown_operate</span> [<span class="ruby-identifier">pd</span>, <span class="ruby-identifier">operation</span>, <span class="ruby-identifier">debug_pushdown</span>]
    }
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{pd.first}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning}&quot;</span>)
    <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># takes a flatten array and makes it deeper, starting a new array</span>
  <span class="ruby-comment"># everytime it finds the string +&quot;[&quot;+. +&quot;]&quot;+ stops the array (and</span>
  <span class="ruby-comment"># return to the upper one). To reserve the possibility of</span>
  <span class="ruby-comment"># representing &quot;[&quot; or &quot;]&quot;, everytime a string contains only those</span>
  <span class="ruby-comment"># chars, repeteaded any number of times, starting from 2, one of</span>
  <span class="ruby-comment"># them will be removed. So +&quot;[[&quot;+ will be left as +&quot;[&quot;+ and</span>
  <span class="ruby-comment"># +&quot;]]]&quot;+ will be left as +&quot;]]&quot;+.</span>
  <span class="ruby-comment"># if the provided array is not flatten, it won&#39;t be transversed.</span>
  <span class="ruby-comment"># @param [Array] +args+, the array to be operadated</span>
  <span class="ruby-comment"># @return [Array] returns the modified, deep, #Array</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">array_unflatten_base_shallow</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">deep</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">reserved_tokens</span> = [
      [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:up</span>],
      [ <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>],
    ]
    <span class="ruby-comment"># debug = 1</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)

    <span class="ruby-identifier">rv</span> = <span class="ruby-identifier">array_unflatten_base</span> [
      <span class="ruby-identifier">args</span>,
      <span class="ruby-identifier">deep</span>.<span class="ruby-identifier">negate_me</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">reserved_tokens</span>,
    ]

    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{rv}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">rv</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># generic function for test__ functions</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">expectation</span> = {}
    <span class="ruby-identifier">actual</span> = {}
    <span class="ruby-identifier">test_cases</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
     <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
    ]
    <span class="ruby-identifier">test_cases</span>.<span class="ruby-identifier">each_with_index</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">test_case_id</span>, <span class="ruby-identifier">test_expectation</span>, <span class="ruby-identifier">actual_params</span> = <span class="ruby-identifier">test_case</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">actual_params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">actual_params</span>[<span class="ruby-value">1</span>]
      <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case_id</span>] = <span class="ruby-identifier">test_expectation</span>
      <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case_id</span>] = <span class="ruby-identifier">result</span>
    }
    <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
    }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for #array_unflatten_base_shallow</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__array_unflatten_base_shallow</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
      <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
      [
        <span class="ruby-string">&quot;base_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_escape_case&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_open_right_case&quot;</span>, [ <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_open_left_case&quot;</span>, [ <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_double&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_inverted&quot;</span>, [ <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_mixed_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>,  ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],


    ]
    <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">test_cases</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for #array_unflatten_base</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__array_unflatten_base</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
      <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
      [
        <span class="ruby-string">&quot;base_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_escape_case&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_open_right_case&quot;</span>, [ <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_open_left_case&quot;</span>, [ <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_double&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_inverted&quot;</span>, [ <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_mixed_nested_case_deep&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ [ <span class="ruby-value">:b</span>, ] ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_mixed_nested_case_shallow&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>,  ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span> ],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span>, ], <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_double_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, [[ <span class="ruby-value">:b</span>, ]], <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_escape_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_mixed_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;open_left_base_mixed_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],


    ]
    <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">test_cases</span>
  <span class="ruby-keyword">end</span>


<span class="ruby-comment">
  # short_desc = &quot;tests the function #string_repetion&quot;
  @memory[:documentation].push = {
    :function   =&gt; :test__string_repetition,
    :short_desc =&gt; short_desc,
    :params     =&gt; [
      {
        :name             =&gt; :args,
        :description      =&gt; &quot;list of parameters&quot;,
        :duck_type        =&gt; Array,
        :default_behavior =&gt; &quot;interpreted as empty array&quot;,
        :params           =&gt; [
          {              
            :name             =&gt; :reserved,
            :duck_type        =&gt; Object,
            :default_behavior =&gt; &quot;interpreted as nil&quot;,
            :description      =&gt; &quot;for future use&quot;,
          },
        ],
      },
    ],
  }


</span>  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__string_repetition</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">expectation</span> = {}
    <span class="ruby-identifier">actual</span> = {}
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">1</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XXX&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-comment"># expectation and actual inverted.</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">2</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">3</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">4</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XXyy&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">6</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">0</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">7</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">1</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">7</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">0</span>]
    <span class="ruby-comment"># &quot;X&quot;*0 = &quot;&quot;</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">8</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">1</span>]
    <span class="ruby-comment"># &quot;X&quot;*0 = &quot;&quot;, but minimum is set to 1</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">9</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;Xy&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">10</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-comment"># clearly &quot;&quot; appears in &quot;XyXy&quot; infinity times, but &quot;XyXy&quot; is no</span>
    <span class="ruby-comment"># repetition of &quot;&quot;</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">11</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;Xy&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">12</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XXX&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">13</span>
    <span class="ruby-identifier">operand_1</span> = [<span class="ruby-value">:b</span>]
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;]&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">14</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;[:b]&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;]&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
    }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>



<span class="ruby-keyword">end</span>


<span class="ruby-keyword">class</span> <span class="ruby-constant">Rubyment</span>
   <span class="ruby-identifier">include</span> <span class="ruby-constant">RubymentModule</span>
<span class="ruby-keyword">end</span>

(<span class="ruby-keyword">__FILE__</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">$0</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Rubyment</span>.<span class="ruby-identifier">new</span>({<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ARGV</span>})
</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_dec_output" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_dec_output</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>and output the decrypted data to stdout.</p>

<p>planned changes: stop argument shifting. call separate functions.</p>
          
          

          
          <div class="method-source-code" id="shell_dec_output-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_dec_output</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">stdout</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stdout</span>]
  <span class="ruby-identifier">pw_plain</span>, <span class="ruby-identifier">reserved_for_future</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">pw_plain</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_enc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_enc</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-shell_enc">#shell_enc</a> args</p>
<dl class="rdoc-list label-list"><dt>password, data, encrypted_base64_filename, enc_iv_base64_filename_deprecated
<dd>
<p>(all Strings)</p>
</dd></dl>

<p>encrypts data using password and stores to encrypted_base64_filename
returns nil</p>

<p>planned changes: encrypted_base64_filename</p>
          
          

          
          <div class="method-source-code" id="shell_enc-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1316</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_enc</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
  <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span>  = <span class="ruby-identifier">shell_enc_input</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">salt</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">iter</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
  <span class="ruby-identifier">metadata</span> = {
    <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span>,
    <span class="ruby-string">&quot;base64_iv&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iv</span>,
    <span class="ruby-string">&quot;base64_encrypted&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_encrypted</span>,
    <span class="ruby-string">&quot;base64_salt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_salt</span>,
    <span class="ruby-string">&quot;base64_iter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iter</span>,
  }
  <span class="ruby-identifier">base64_json_serialized_data</span> =  <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>
  <span class="ruby-identifier">shell_enc_output</span> [<span class="ruby-identifier">base64_json_serialized_data</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">encrypted_base64_filename</span> ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_enc_input" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_enc_input</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>prompts for arguments to dec args:</p>
<dl class="rdoc-list label-list"><dt> multiline_data, data_file, single_line_data, password, encrypted_base64_filename, enc_iv_base64_filename_deprecated
<dd>
<p>(all Strings)</p>
</dd></dl>

<p>returns:</p>

<pre class="ruby">[<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span>]
</pre>

<p>planned changes: call separate functions. stop argument shifting.</p>
          
          

          
          <div class="method-source-code" id="shell_enc_input-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1258</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_enc_input</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">stdout</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdout</span>]
    <span class="ruby-identifier">stdin</span>  = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdin</span>]
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:debug</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stringio&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;io/console&quot;</span>

    <span class="ruby-identifier">data</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;multi_line_data[ data 1/3, echoing, enter + control-D to stop]:&quot;</span>
    <span class="ruby-identifier">data</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span>  (<span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">join</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">join</span>)
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;data_file [data 2/3]:&quot;</span>
    <span class="ruby-identifier">data_file</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span>  (<span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span>)
    <span class="ruby-identifier">data</span>  <span class="ruby-operator">+=</span> <span class="ruby-identifier">url_to_str</span> <span class="ruby-identifier">data_file</span>, <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;single_line_data[data 3/3, no echo part]:&quot;</span>
    <span class="ruby-identifier">data</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">begin</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>}.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;password:&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">begin</span> <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">noecho</span>{ <span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">gets</span>}.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;encrypted_base64_filename[default=out.enc.encrypted.base64]:&quot;</span>
    <span class="ruby-comment"># basically =&gt; any string other than &quot;&quot; or the default one:</span>
    <span class="ruby-identifier">encrypted_base64_filename</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;out.enc.encrypted.base64&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">encrypted_base64_filename</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;enc_iv_base64_filename[DEPRECATED]:&quot;</span>
    <span class="ruby-comment"># basically =&gt; any string other than &quot;&quot; or the default one:</span>
    <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;out.enc.iv.base64&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span>

    [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># outputs the results from enc</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_enc_output</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">base64_iv</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">base64_encrypted</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span>  <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">base64_encrypted</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># shell_enc</span>
  <span class="ruby-comment"># args</span>
  <span class="ruby-comment"># [password, data, encrypted_base64_filename, enc_iv_base64_filename_deprecated] (all Strings)</span>
  <span class="ruby-comment"># encrypts data using password and stores to encrypted_base64_filename</span>
  <span class="ruby-comment"># returns</span>
  <span class="ruby-comment"># nil</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># planned changes:</span>
  <span class="ruby-comment"># encrypted_base64_filename</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_enc</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
    <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span>  = <span class="ruby-identifier">shell_enc_input</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">salt</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">iter</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
    <span class="ruby-identifier">metadata</span> = {
      <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span>,
      <span class="ruby-string">&quot;base64_iv&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iv</span>,
      <span class="ruby-string">&quot;base64_encrypted&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_encrypted</span>,
      <span class="ruby-string">&quot;base64_salt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_salt</span>,
      <span class="ruby-string">&quot;base64_iter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iter</span>,
    }
    <span class="ruby-identifier">base64_json_serialized_data</span> =  <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>
    <span class="ruby-identifier">shell_enc_output</span> [<span class="ruby-identifier">base64_json_serialized_data</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">encrypted_base64_filename</span> ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># serialize_json_metadata</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [payload (String), metadata (Hash), separator (String)]</span>
  <span class="ruby-comment"># prepends a JSON dump of metadata followed by separator</span>
  <span class="ruby-comment"># to a copy of payload, and returns it.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">serialize_json_metadata</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_separator</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_separator_key</span>]
    <span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">separator</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">metadata</span> <span class="ruby-operator">||=</span> { }
    <span class="ruby-identifier">separator</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_separator</span>
    <span class="ruby-identifier">serialized_string</span> = (<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">separator</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">payload</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># deserialize_json_metadata</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [serialized_string (String), separator (String)]</span>
  <span class="ruby-comment"># undo what serialize_json_metadata</span>
  <span class="ruby-comment"># returns array:</span>
  <span class="ruby-comment"># [payload (String), metadata (Hash or String), separator (String)]</span>
  <span class="ruby-comment"># metadata is returned as Hash after a  JSON.parse, but in case</span>
  <span class="ruby-comment"># of any failure, it returns the String itself.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">deserialize_json_metadata</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_separator</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_separator_key</span>]
    <span class="ruby-identifier">serialized_string</span>, <span class="ruby-identifier">separator</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">separator</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_separator</span>
    <span class="ruby-identifier">metadata_json</span>, <span class="ruby-identifier">payload</span>  = <span class="ruby-identifier">serialized_string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span> <span class="ruby-identifier">separator</span>
    <span class="ruby-identifier">metadata</span> = (<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">metadata_json</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">metadata_json</span>
    [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">separator</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test__json_metadata_serialization</span>
  <span class="ruby-comment"># sanity test for serialize_json_metadata and deserialize_json_metadata</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__json_metadata_serialization</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">judgement</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">payload</span> = <span class="ruby-string">&quot;Payload&quot;</span>
    <span class="ruby-comment"># note: keys with : instead can&#39;t be recovered, because</span>
    <span class="ruby-comment"># they aren&#39;t described in JSON files</span>
    <span class="ruby-identifier">metadata</span> = { <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span> }
    <span class="ruby-identifier">serialized</span> = (<span class="ruby-identifier">serialize_json_metadata</span> [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span> ])
    <span class="ruby-identifier">new_payload</span>, <span class="ruby-identifier">new_metadata</span> = <span class="ruby-identifier">deserialize_json_metadata</span> [<span class="ruby-identifier">serialized</span>]
    <span class="ruby-identifier">judgement</span> =
      [ [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">new_payload</span>, <span class="ruby-string">&quot;payload&quot;</span>], [<span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">new_metadata</span>, <span class="ruby-string">&quot;metadata&quot;</span>]]
        .<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># format strings for  expect_format_string</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">expect_format_string</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:debug</span>]
    <span class="ruby-identifier">prepend_text</span>, <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span>, <span class="ruby-identifier">comparison_text</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-node">&quot;#{prepend_text} #{value_label}: #{value_before} #{comparison_text} #{value_after}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># expect_equal</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [ value_before (Object), value_after (Object), value_label (String) ]</span>
  <span class="ruby-comment"># returns the value of testing value_before == value_after, printing to</span>
  <span class="ruby-comment"># stderr upon failure</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">expect_equal</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">judgement</span> = (<span class="ruby-identifier">value_before</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">value_after</span>)
    (<span class="ruby-operator">!</span><span class="ruby-identifier">judgement</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>  <span class="ruby-identifier">expect_format_string</span> [<span class="ruby-string">&quot;unexpected&quot;</span>, <span class="ruby-identifier">value_before</span>, <span class="ruby-identifier">value_after</span>, <span class="ruby-identifier">value_label</span>, <span class="ruby-string">&quot;!=&quot;</span>])
    <span class="ruby-identifier">judgement</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test__shell_enc_dec</span>
  <span class="ruby-comment"># sanity test for shell_enc and shell_dec</span>
  <span class="ruby-comment"># planned changes:</span>
  <span class="ruby-comment"># don&#39;t output to stdout</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__shell_enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">shell_enc</span> [<span class="ruby-string">&quot;my secret&quot;</span>,  <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>,  <span class="ruby-string">&quot;tijolo22&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>]
    <span class="ruby-identifier">judgement</span> = ( <span class="ruby-identifier">shell_dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;tijolo22&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">true</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># an alternative interface to dec -- reads password if</span>
  <span class="ruby-comment"># nil or empty.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args Defaults to +ARGV+. Elements:</span>
  <span class="ruby-comment"># * +data+ [String, nil] data to be encrypted, If empty or nil, read (without</span>
  <span class="ruby-comment"># echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># * +password+ [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># +data_not_base64+:: [true, false, nil] don&#39;t return base64 data -- the same +data_not_base64+ given for enc should be used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [TrueClass, FalseClass] depending on whether test succeeds.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span>  = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = (<span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>])
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_not_base64</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for enc and dec.</span>
  <span class="ruby-comment"># &quot;&quot; and nil are expected to be treated</span>
  <span class="ruby-comment"># as the same.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_nil</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">nil_case</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
    <span class="ruby-identifier">empty</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">nil_case</span>, <span class="ruby-identifier">empty</span>, <span class="ruby-string">&quot;empty_nil_equality&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for enc and dec and output_array_to_shell.</span>
  <span class="ruby-comment"># output_array_to_shell should create proper arguments</span>
  <span class="ruby-comment">#  to dec</span>
  <span class="ruby-comment"># TODO: invalid test -- that can&#39;t yet be ensured</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_shell_programatically</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;test invalid; skip&quot;</span>
    <span class="ruby-identifier">shell</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">programatically</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">shell</span>, <span class="ruby-identifier">programatically</span>, <span class="ruby-string">&quot;shell_programatically_equality&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for enc and dec.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +data+:: [String, nil] data to be encrypted.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [TrueClass, FalseClass] depending on whether test succeeds.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">dec_args</span> = [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# WARNING: secrets, including password are printed here. Storing them may be a major security incident.&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_args</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double p dec &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_args</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># output encrypted data (and data required to</span>
  <span class="ruby-comment"># decrypt) into encrypted_base64_filename</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">output_enc_file</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">encrypted_base64_filename</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">metadata</span> = {
      <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span>,
      <span class="ruby-string">&quot;base64_iv&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iv</span>,
      <span class="ruby-string">&quot;base64_encrypted&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_encrypted</span>,
      <span class="ruby-string">&quot;base64_salt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_salt</span>,
      <span class="ruby-string">&quot;base64_iter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">base64_iter</span>,
    }
    <span class="ruby-identifier">base64_json_serialized_data</span> =  <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span> <span class="ruby-identifier">metadata</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">base64_json_serialized_data</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# File written: \n# #{encrypted_base64_filename}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># output encrypted data (and data required to</span>
  <span class="ruby-comment"># decrypt) into encrypted_base64_filename</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">output_dec_file</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">base64_json_serialized_data</span> = <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">enc_filename_or_url</span>

    <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_json_serialized_data</span>
    <span class="ruby-identifier">base64_iv</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iv&quot;</span>]
    <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_encrypted&quot;</span>]
    <span class="ruby-identifier">base64_salt</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_salt&quot;</span>]
    <span class="ruby-identifier">base64_iter</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iter&quot;</span>]
    <span class="ruby-identifier">base64_key</span>  = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_key&quot;</span> ]
    <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">pw_plain</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span>]
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">pw_plain</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# File written: \n# #{out_filename}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for enc and dec_interactive.</span>
  <span class="ruby-comment"># good idea is to use this function once with the desired</span>
  <span class="ruby-comment"># data, password, and use the stderr output</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">data_not_base64</span> ]
    <span class="ruby-comment"># the output is supposed to be safe to store,</span>
    <span class="ruby-comment"># so password is not placed in from dec_interactive_args:</span>
    <span class="ruby-identifier">dec_interactive_args</span> = [<span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec_interactive &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_interactive_args</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double puts dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#or shell var:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;my_secret=$(#{$0} invoke_double puts dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)\necho $my_secret\nunset mysecret&quot;</span>
    <span class="ruby-identifier">encrypted_base64_filename</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">output_enc_file</span>(<span class="ruby-identifier">dec_interactive_args</span>  <span class="ruby-operator">+</span> [<span class="ruby-identifier">encrypted_base64_filename</span>])
    <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">dec_interactive</span>(<span class="ruby-identifier">dec_interactive_args</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span>])
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># similar to</span>
  <span class="ruby-comment"># test__enc_dec_interactive,</span>
  <span class="ruby-comment"># just that the data is ready from a file instead</span>
  <span class="ruby-comment"># note that there is an extra argument between</span>
  <span class="ruby-comment"># the args, the enc_out_filename.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">filename_or_url</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[filename_or_url]&quot;</span>
    <span class="ruby-identifier">filename_or_url</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">filename_or_url</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_encrypted_data]&quot;</span>
    <span class="ruby-identifier">enc_out_filename</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_out_filename</span> ]
    <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">filename_or_url</span>
    <span class="ruby-identifier">test__enc_dec_interactive</span> [ <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">data_not_base64</span> ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># basically the reverse of test__enc_dec_file_interactive</span>
  <span class="ruby-comment"># planned improvements: still outputs to stdout</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[enc_filename_or_url]&quot;</span>
    <span class="ruby-identifier">enc_filename_or_url</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_filename_or_url</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_plain_data]&quot;</span>
    <span class="ruby-identifier">out_filename</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">out_filename</span> ]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">enc_filename_or_url</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">base64_json_serialized_data</span> = <span class="ruby-identifier">data</span>
    <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_json_serialized_data</span>
    <span class="ruby-identifier">base64_iv</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iv&quot;</span>]
    <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_encrypted&quot;</span>]
    <span class="ruby-identifier">base64_salt</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_salt&quot;</span>]
    <span class="ruby-identifier">base64_iter</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iter&quot;</span>]
    <span class="ruby-identifier">base64_key</span>  = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_key&quot;</span> ]
    <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">pw_plain</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_not_base64</span>]
    <span class="ruby-identifier">shell_dec_output</span> [<span class="ruby-identifier">pw_plain</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># encode data into aes-128-cbc cipher protected by a key generated</span>
  <span class="ruby-comment"># by #generate_pbkdf2_key, using given +password+, +salt+, +iter+</span>
  <span class="ruby-comment"># By default, must work with binary data. Set +data_is_base64+ to</span>
  <span class="ruby-comment"># true (or give data already as base64) to achieve the original</span>
  <span class="ruby-comment"># behavior of enc(), and avoid one encoding operation on data.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># +data+:: [String, nil] data to be encoded data</span>
  <span class="ruby-comment"># +ending+:: [nil] deprecated</span>
  <span class="ruby-comment"># +salt+:: [String, nil] #generate_pbkdf2_key salt argument</span>
  <span class="ruby-comment"># +iter+:: [String, nil] #generate_pbkdf2_key iterations argument</span>
  <span class="ruby-comment"># +data_is_base64+:: [true, false, nil] data already in base64 </span>
  <span class="ruby-comment"># </span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return @param [Array] an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +base64_encrypted+:: [String, nil] ciphered data (without metadata) encoded with Base64</span>
  <span class="ruby-comment"># +base64_iv+:: [String] initialization vectors encoded with Base64</span>
  <span class="ruby-comment"># +base64_salt+:: [String] #generate_pbkdf2_key salt encoded with Base64</span>
  <span class="ruby-comment"># +base64_iter+:: [String] #generate_pbkdf2_key iterations encoded with Base64</span>
  <span class="ruby-comment"># +base64_key+::  [String] #generate_pbkdf2_key return value</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_enc</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;_binary&quot;</span>
    <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">ending</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">static_end_key</span>
    <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> = (
      <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
    )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

    <span class="ruby-identifier">cipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
    <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">encrypt</span>

    <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
    <span class="ruby-identifier">iv</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">random_iv</span>
    <span class="ruby-identifier">base64_data</span> = <span class="ruby-identifier">data_is_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">data</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>
    <span class="ruby-identifier">encrypted</span> = <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">base64_data</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ending</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">cipher</span>.<span class="ruby-identifier">final</span>

    <span class="ruby-identifier">base64_iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iv</span>
    <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>  <span class="ruby-identifier">encrypted</span>
    <span class="ruby-identifier">base64_salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">salt</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">base64_iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">base64_key</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>

    [<span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>,  <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># decipher the data encoded by binary_enc</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># +base64_iv+:: [String, nil] initialization vectors encoded with Base64</span>
  <span class="ruby-comment"># +base64_encrypted+:: [String, nil] ciphered data (without metadata) encoded with Base64</span>
  <span class="ruby-comment"># +ending+:: [nil] deprecated</span>
  <span class="ruby-comment"># +base64_salt+:: [String, nil] #generate_pbkdf2_key salt encoded with Base64</span>
  <span class="ruby-comment"># +base64_iter+:: [String, nil] #generate_pbkdf2_key iterations encoded with Base64</span>
  <span class="ruby-comment"># +data_is_base64+:: [true, false, nil] return base64 data -- the same +data_is_base64+ given for enc should be used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [String] decoded data</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">static_end_key</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:static_end_key</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;_binary&quot;</span>
    <span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">salt</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_salt</span>
    <span class="ruby-identifier">iter</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_iter</span>
    <span class="ruby-comment"># FIXME: don&#39;t split on \0</span>
    <span class="ruby-identifier">ending</span> = <span class="ruby-identifier">ending</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">static_end_key</span>
    <span class="ruby-identifier">key</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span> =  (
      <span class="ruby-identifier">generate_pbkdf2_key</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]
    )<span class="ruby-operator">||</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">salt</span>, <span class="ruby-identifier">iter</span>]

    <span class="ruby-identifier">decipher</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Cipher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;aes-128-cbc&#39;</span>)
    <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">decrypt</span>
    <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">padding</span> = <span class="ruby-value">0</span>

    <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">hexdigest</span> <span class="ruby-identifier">password</span>)
    <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">iv</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_iv</span>
    <span class="ruby-identifier">base64_plain</span> = <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">update</span>(<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_encrypted</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">decipher</span>.<span class="ruby-identifier">final</span>
    <span class="ruby-identifier">plain</span> = <span class="ruby-identifier">data_is_base64</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_plain</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">base64_plain</span>
    <span class="ruby-comment"># split is not the ideal, if ever ending is duplicated it won&#39;t</span>
    <span class="ruby-comment"># work. also may be innefficient.</span>
    (<span class="ruby-identifier">plain</span>.<span class="ruby-identifier">split</span> <span class="ruby-identifier">ending</span>).<span class="ruby-identifier">first</span>

  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># an alternative interface to binary_dec -- reads password if</span>
  <span class="ruby-comment"># nil or empty.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args Defaults to +ARGV+. Elements:</span>
  <span class="ruby-comment"># * +data+ [String, nil] data to be encrypted, If empty or nil, read (without</span>
  <span class="ruby-comment"># echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># * +password+ [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># +data_is_base64+:: [true, false, nil] return base64 data -- the same +data_is_base64+ given for enc should be used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [TrueClass, FalseClass] depending on whether test succeeds.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">binary_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>  = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = (<span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>])
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">iv</span>, <span class="ruby-identifier">encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_is_base64</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for binary_enc and binary_dec.</span>
  <span class="ruby-comment"># &quot;&quot; and nil are expected to be treated</span>
  <span class="ruby-comment"># as the same.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_nil</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">nil_case</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
    <span class="ruby-identifier">empty</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">nil_case</span>, <span class="ruby-identifier">empty</span>, <span class="ruby-string">&quot;empty_nil_equality&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for binary_enc and binary_dec.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @param [Array] args, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +data+:: [String, nil] data to be encrypted.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment"># +password+:: [String, nil] password to be used to encryption.</span>
  <span class="ruby-comment"># If empty or nil, read (without echo) from @memory[:stdin], which defaults to STDIN</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [TrueClass, FalseClass] depending on whether test succeeds.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">binary_enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">dec_args</span> = [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# WARNING: secrets, including password are printed here. Storing them may be a major security incident.&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;binary_dec &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_args</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double p binary_dec &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_args</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for binary_enc and binary_dec_interactive.</span>
  <span class="ruby-comment"># good idea is to use this function once with the desired</span>
  <span class="ruby-comment"># data, password, and use the stderr output</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
    <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
    <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">binary_enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">data_is_base64</span> ]
    <span class="ruby-comment"># the output is supposed to be safe to store,</span>
    <span class="ruby-comment"># so password is not placed in from binary_dec_interactive_args:</span>
    <span class="ruby-identifier">dec_interactive_args</span> = [<span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec_interactive &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_interactive_args</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double puts binary_dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#or shell var:&quot;</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;my_secret=$(#{$0} invoke_double puts binary_dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)\necho $my_secret\nunset mysecret&quot;</span>
    <span class="ruby-identifier">encrypted_base64_filename</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">output_enc_file</span>(<span class="ruby-identifier">dec_interactive_args</span>  <span class="ruby-operator">+</span> [<span class="ruby-identifier">encrypted_base64_filename</span>])
    <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">binary_dec_interactive</span>(<span class="ruby-identifier">dec_interactive_args</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>])
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">data_plain</span>.<span class="ruby-identifier">size</span>, <span class="ruby-string">&quot;data.size&quot;</span>],
        [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># similar to</span>
  <span class="ruby-comment"># test__binary_enc_dec_interactive,</span>
  <span class="ruby-comment"># just that the data is ready from a file instead</span>
  <span class="ruby-comment"># note that there is an extra argument between</span>
  <span class="ruby-comment"># the args, the enc_out_filename.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">filename_or_url</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[filename_or_url]&quot;</span>
    <span class="ruby-identifier">filename_or_url</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">filename_or_url</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_encrypted_data]&quot;</span>
    <span class="ruby-identifier">enc_out_filename</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_out_filename</span> ]
    <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">filename_or_url</span>
    <span class="ruby-identifier">test__binary_enc_dec_interactive</span> [ <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">data_is_base64</span> ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># basically the reverse of test__binary_enc_dec_file_interactive</span>
  <span class="ruby-comment"># planned improvements: still outputs to stdout</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">stdout</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdout</span>]
    <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[enc_filename_or_url]&quot;</span>
    <span class="ruby-identifier">enc_filename_or_url</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_filename_or_url</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_plain_data]&quot;</span>
    <span class="ruby-identifier">out_filename</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">out_filename</span> ]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]

    <span class="ruby-identifier">output_dec_file</span> [<span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gem_spec</span>
  <span class="ruby-comment"># args (Array like the one returned by rubyment_gem_defaults)</span>
  <span class="ruby-comment"># returns: a gem spec string accordingly to args</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span>,
    <span class="ruby-identifier">gem_bin_generate</span>,
    <span class="ruby-identifier">gem_bin_contents</span>,
    <span class="ruby-identifier">gem_bin_executables</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">contents</span> =<span class="ruby-value">&lt;&lt;-ENDHEREDOC
Gem::Specification.new do |s|
  s.name        = &#39;#{gem_name}&#39;
  s.version     = &#39;#{gem_version}&#39;
  s.date        = &#39;#{gem_date}&#39;
  s.summary     = &#39;#{gem_summary}&#39;
  s.description = &#39;#{gem_description}&#39;
  s.authors     = #{gem_authors.inspect}
  s.email       = &#39;#{gem_email}&#39;
  s.files       = #{gem_files.inspect}
  s.homepage    = &#39;#{gem_homepage}&#39;
  s.license     = &#39;#{gem_license}&#39;
  s.executables += [#{gem_bin_executables}].flatten
end
    ENDHEREDOC</span>
    <span class="ruby-identifier">contents</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># rubyment_gem_spec</span>
  <span class="ruby-comment"># args (Array, forwarded and transfomed by rubyment_gem_defaults)</span>
  <span class="ruby-comment"># returns: a gem spec string for Rubyment</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">rubyment_gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_spec</span> <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for rubyment_gem_spec. outputs the contents</span>
  <span class="ruby-comment"># returned by that function.</span>
  <span class="ruby-comment"># args: none</span>
  <span class="ruby-comment"># returns: none</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__rubyment_gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">rubyment_gem_spec</span>
  <span class="ruby-keyword">end</span>



  <span class="ruby-comment"># defaults for the rubyment gem</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_name, gem_version, gem_dir, gem_ext, gem_hifen]</span>
  <span class="ruby-comment"># all Strings.</span>
  <span class="ruby-comment"># defaults:</span>
  <span class="ruby-comment"># [&quot;rubyment&quot;, version [], memory[:running_dir],</span>
  <span class="ruby-comment"># &quot;.gem&quot;, &quot;-&quot;]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># [gem_name, gem_version, gem_dir, gem_ext, gem_hifen]</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">running_dir</span>   = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
    <span class="ruby-identifier">basic_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:basic_version</span>]
    <span class="ruby-identifier">major_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:major_version</span>]

    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">gem_name</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;rubyment&quot;</span>
    <span class="ruby-identifier">gem_version</span> <span class="ruby-operator">||=</span> (<span class="ruby-identifier">version</span> [])
    <span class="ruby-identifier">gem_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">running_dir</span>
    <span class="ruby-identifier">gem_ext</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;.gem&quot;</span>
    <span class="ruby-identifier">gem_hifen</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;-&quot;</span>
    <span class="ruby-identifier">gem_ext</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;date&quot;</span>
    <span class="ruby-identifier">gem_date</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;2018-04-23&quot;</span>
    <span class="ruby-identifier">gem_summary</span>     <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;a set of ruby helpers&quot;</span>
    <span class="ruby-identifier">gem_description</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;a gem for keeping Rubyment, a set of ruby helpers&quot;</span>
    <span class="ruby-identifier">gem_authors</span>     <span class="ruby-operator">||=</span> [<span class="ruby-string">&quot;Ribamar Santarosa&quot;</span>]
    <span class="ruby-identifier">gem_email</span>       <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;ribamar@gmail.com&#39;</span>
    <span class="ruby-identifier">gem_files</span>       <span class="ruby-operator">||=</span> [<span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>]
    <span class="ruby-identifier">gem_homepage</span>    <span class="ruby-operator">||=</span>
      <span class="ruby-node">&quot;http://rubygems.org/gems/#{gem_name}&quot;</span>
    <span class="ruby-identifier">gem_license</span>     <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;GPL-3.0&#39;</span>
    <span class="ruby-identifier">gem_validate_class</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">gem_validate_class_args</span> <span class="ruby-operator">||=</span> {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-string">&quot;installed and validated&quot;</span>] }
    <span class="ruby-identifier">gem_validate_class_method</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;new&quot;</span>
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-keyword">__FILE__</span> <span class="ruby-comment"># this enables the possibility of building</span>
    <span class="ruby-comment">#  a gem for the calling file itself, but be aware that lib/gem_file.rb</span>
    <span class="ruby-comment"># is supposed to be overriden later.</span>
    <span class="ruby-identifier">gem_bin_generate</span> = <span class="ruby-node">&quot;bin/#{gem_name}&quot;</span> <span class="ruby-comment"># generate a bin file</span>
    <span class="ruby-identifier">gem_bin_contents</span> =<span class="ruby-value">&lt;&lt;-ENDHEREDOC
#!/usr/bin/env ruby
require &#39;#{gem_name}&#39;
#{gem_validate_class}.new({:invoke =&gt; ARGV})
    ENDHEREDOC</span>
    <span class="ruby-identifier">gem_executables</span> = [ <span class="ruby-identifier">gem_bin_generate</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-node">&quot;#{gem_name}&quot;</span> ]

    [
       <span class="ruby-identifier">gem_name</span>,
       <span class="ruby-identifier">gem_version</span>,
       <span class="ruby-identifier">gem_dir</span>,
       <span class="ruby-identifier">gem_ext</span>,
       <span class="ruby-identifier">gem_hifen</span>,
       <span class="ruby-identifier">gem_date</span>,
       <span class="ruby-identifier">gem_summary</span>,
       <span class="ruby-identifier">gem_description</span>,
       <span class="ruby-identifier">gem_authors</span>,
       <span class="ruby-identifier">gem_email</span>,
       <span class="ruby-identifier">gem_files</span>,
       <span class="ruby-identifier">gem_homepage</span>,
       <span class="ruby-identifier">gem_license</span>,
       <span class="ruby-identifier">gem_validate_class</span>,
       <span class="ruby-identifier">gem_validate_class_args</span>,
       <span class="ruby-identifier">gem_validate_class_method</span>,
       <span class="ruby-identifier">gem_is_current_file</span>,
       <span class="ruby-identifier">gem_bin_generate</span>,
       <span class="ruby-identifier">gem_bin_contents</span>,
       <span class="ruby-identifier">gem_executables</span>,
   ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns the gem path given the params.</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_name, gem_version, gem_dir, gem_ext, gem_hifen]</span>
  <span class="ruby-comment"># all Strings.</span>
  <span class="ruby-comment"># defaults:</span>
  <span class="ruby-comment"># [&quot;rubyment&quot;, version [], memory[:running_dir],</span>
  <span class="ruby-comment"># &quot;.gem&quot;, &quot;-&quot;]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_path</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>, <span class="ruby-identifier">gem_dir</span>, <span class="ruby-identifier">gem_ext</span>, <span class="ruby-identifier">gem_hifen</span> = <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
    <span class="ruby-node">&quot;#{gem_dir}/#{gem_name}#{gem_hifen}#{gem_version}#{gem_ext}&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># forces the uninstallation of a gem in all the ways we can</span>
  <span class="ruby-comment"># mostly for internal tests that needs to ensure a gem wasn&#39;t</span>
  <span class="ruby-comment"># installed before a test.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_uninstall_extreme_force</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -a -x  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -a -x --user-install  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -a -x  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -a -x --user-install  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>

    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -x  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -x --user-install  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -x  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -x --user-install  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    []
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># gem_build</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec_path (String), gem_spec_contents (String), gem_is_current_file, gem_name]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem build (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_build</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec_path</span>,
    <span class="ruby-identifier">gem_spec_contents</span>,
    <span class="ruby-identifier">gem_is_current_file</span>,
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_bin_generate</span>,
    <span class="ruby-identifier">gem_bin_contents</span>,
      <span class="ruby-identifier">quiet</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>

    <span class="ruby-comment"># this supposes that  the current file is listed by the</span>
    <span class="ruby-comment"># s.files</span>
    <span class="ruby-comment"># field of the specification. it is not currently checked.</span>
    <span class="ruby-identifier">gem_is_current_file</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-string">&#39;lib&#39;</span>
      <span class="ruby-identifier">file_backup</span> <span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>, <span class="ruby-string">&quot;lib/&quot;</span>
      <span class="ruby-comment"># quick hack for backwards compatibility</span>
      <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">gem_is_current_file</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">TrueClass</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">__FILE__</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">gem_is_current_file</span>
      <span class="ruby-identifier">save_file</span> <span class="ruby-identifier">gem_is_current_file</span>, <span class="ruby-node">&quot;lib/#{gem_name}.rb&quot;</span>
    )

    <span class="ruby-comment"># this supposes that  the current file is listed by the</span>
    <span class="ruby-comment"># s.files</span>
    <span class="ruby-comment"># field of the specification. it is not currently checked.</span>
    <span class="ruby-identifier">gem_bin_generate</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_bin_generate</span>
      <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">gem_bin_generate</span>, (<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_bin_generate</span>)
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_bin_generate</span>, <span class="ruby-identifier">gem_bin_contents</span>
      (<span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-value">0755</span>, <span class="ruby-identifier">gem_bin_generate</span>)
    )

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">gem_spec_path</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_spec_path</span>, <span class="ruby-identifier">gem_spec_contents</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">gem_spec_path</span>)
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem build #{gem_spec_path}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for gem_build: builds gem for this rubyment file</span>
  <span class="ruby-comment"># after it, these commands will install/uninstall it:</span>
  <span class="ruby-comment"># sudo gem install $PWD/rubyment-0.0.#{@memory[:basic_version]} ; gem list  | grep -i rubyment ; sudo gem uninstall  rubyment</span>
  <span class="ruby-comment"># dependee:</span>
  <span class="ruby-comment">#  test__gem_install_validate_uninstall</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec_path (String), gem_spec_contents (String)]</span>
  <span class="ruby-comment"># returns: none</span>
  <span class="ruby-comment"># outputs of gem build (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_build</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-string">&#39;lib&#39;</span>
    <span class="ruby-identifier">save_file</span> <span class="ruby-keyword">__FILE__</span>, <span class="ruby-string">&#39;lib/rubyment.rb&#39;</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_build</span> [<span class="ruby-string">&quot;rubyment.spec&quot;</span>, <span class="ruby-identifier">rubyment_gem_spec</span>(<span class="ruby-identifier">args</span>) ]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># gem_install</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec (String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem install (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_install</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">system_user_is_super</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:system_user_is_super</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">user_install</span> <span class="ruby-operator">||=</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">system_user_is_super</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;--user-install&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem install #{user_install}  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># gem_push</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec (String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem push (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_push</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">future_arg</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem push #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># uninstall all versions of a specific gem</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +gem_spect+:: [String] </span>
  <span class="ruby-comment"># +user_install+:: [Object]</span>
  <span class="ruby-comment"># +quiet+:: [Object] if calling the object +nne+ method returns a +false+ value, will print debug information</span>
  <span class="ruby-comment"># @return [String] console output of gem uninstall</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_uninstall_all</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">all</span> = <span class="ruby-string">&quot;-a&quot;</span>
    <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gem_uninstall</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec (String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem uninstall (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_uninstall</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">system_user_is_super</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:system_user_is_super</span>]
    <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span>, <span class="ruby-identifier">all</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">all</span> = <span class="ruby-identifier">all</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">user_install</span> <span class="ruby-operator">||=</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">system_user_is_super</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;--user-install&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall #{all} -x #{user_install}  #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
    <span class="ruby-comment">#stdin, stdout, stderr, wait_thr = Open3.popen3(&quot;:;&quot; + command)</span>
    <span class="ruby-comment">#stdout</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># gem_list</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [gem_spec (String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># console output of gem install (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_list</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">gem_spec</span>,
      <span class="ruby-identifier">quiet</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
    <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem list | grep #{gem_spec}&quot;</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
    <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># validate_require</span>
  <span class="ruby-comment"># requires a file/gem in the system</span>
  <span class="ruby-comment"># returns nil if not found</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [requirement (String), validator_class (Class or String or nil),</span>
  <span class="ruby-comment">#  validator_args (Array), validator_method (Method or String)]</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># Rubyment, true or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">requirement</span>, <span class="ruby-identifier">validator_class</span>, <span class="ruby-identifier">validator_args</span>, <span class="ruby-identifier">validator_method</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">validate_call</span> = <span class="ruby-identifier">validator_class</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">validator_class</span> = <span class="ruby-identifier">to_class</span> <span class="ruby-identifier">validator_class</span>
    <span class="ruby-identifier">validator_method</span> <span class="ruby-operator">||=</span>  <span class="ruby-string">&quot;new&quot;</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">require</span> <span class="ruby-identifier">requirement</span>
      <span class="ruby-identifier">validate_call</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">object_method_args_call</span> [<span class="ruby-identifier">validator_method</span>, <span class="ruby-identifier">validator_class</span>, <span class="ruby-identifier">validator_args</span>]) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">validate_call</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">LoadError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">e</span>
      <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># system_rubyment</span>
  <span class="ruby-comment"># requires a system&#39;s Rubyment and invoke it using args</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># Rubyment or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">system_rubyment</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">validate_require</span> [<span class="ruby-string">&#39;rubyment&#39;</span>, <span class="ruby-string">&#39;Rubyment&#39;</span>, {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">args</span> }]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># extract only the arguments referring to the</span>
  <span class="ruby-comment"># bin file generation from args</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_bin_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span>,
    <span class="ruby-identifier">gem_bin_generate</span>,
    <span class="ruby-identifier">gem_bin_contents</span>,
    <span class="ruby-identifier">gem_bin_executables</span> = <span class="ruby-identifier">args</span>
    [
        <span class="ruby-identifier">gem_bin_generate</span>,
        <span class="ruby-identifier">gem_bin_contents</span>,
        <span class="ruby-identifier">gem_bin_executables</span>,
    ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment">#  extract only the arguments referring to files</span>
  <span class="ruby-comment"># from args</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_files_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>
    [
        <span class="ruby-identifier">gem_files</span>,
        <span class="ruby-identifier">gem_is_current_file</span>,
    ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment">#  extract only the arguments for validation</span>
  <span class="ruby-comment"># from args</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">gem_name</span>,
    <span class="ruby-identifier">gem_version</span>,
    <span class="ruby-identifier">gem_dir</span>,
    <span class="ruby-identifier">gem_ext</span>,
    <span class="ruby-identifier">gem_hifen</span>,
    <span class="ruby-identifier">gem_date</span>,
    <span class="ruby-identifier">gem_summary</span>,
    <span class="ruby-identifier">gem_description</span>,
    <span class="ruby-identifier">gem_authors</span>,
    <span class="ruby-identifier">gem_email</span>,
    <span class="ruby-identifier">gem_files</span>,
    <span class="ruby-identifier">gem_homepage</span>,
    <span class="ruby-identifier">gem_license</span>,
    <span class="ruby-identifier">gem_validate_class</span>,
    <span class="ruby-identifier">gem_validate_class_args</span>,
    <span class="ruby-identifier">gem_validate_class_method</span>,
    <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">args</span>
    [
        <span class="ruby-identifier">gem_name</span>,
        <span class="ruby-identifier">gem_validate_class</span>,
        <span class="ruby-identifier">gem_validate_class_args</span>,
        <span class="ruby-identifier">gem_validate_class_method</span>,
    ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for system_rubyment</span>
  <span class="ruby-comment"># dependee:</span>
  <span class="ruby-comment">#  test__gem_install_validate_uninstall</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array or nil)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># Rubyment or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__system_rubyment</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">rubyment_args</span> = (<span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>) <span class="ruby-operator">||</span> [<span class="ruby-string">&quot;main&quot;</span>, <span class="ruby-string">&quot;tested system_rubyment&quot;</span>]
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">validate_require</span> [<span class="ruby-string">&#39;rubyment&#39;</span>, <span class="ruby-string">&#39;Rubyment&#39;</span>, {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rubyment_args</span> }]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># validate the installation of a gem</span>
  <span class="ruby-comment"># args rubyment_gem_defaults</span>
  <span class="ruby-comment"># but planned to change.</span>
  <span class="ruby-comment"># bug detected: require x won&#39;t reload the gem.</span>
  <span class="ruby-comment"># args (Array just like the one</span>
  <span class="ruby-comment"># returned by rubyment_gem_defaults)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># true or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_validate</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_defaults</span> = <span class="ruby-identifier">rubyment_gem_defaults</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span> = <span class="ruby-identifier">gem_defaults</span>
    <span class="ruby-identifier">gem_files</span>, <span class="ruby-identifier">gem_is_current_file</span> = <span class="ruby-identifier">gem_files_args</span> <span class="ruby-identifier">gem_defaults</span>
    <span class="ruby-identifier">gem_bin_generate</span>, <span class="ruby-identifier">gem_bin_contents</span> = <span class="ruby-identifier">gem_bin_args</span> <span class="ruby-identifier">gem_defaults</span>

    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_build</span> [
      <span class="ruby-node">&quot;#{gem_name}.spec&quot;</span>,
      <span class="ruby-identifier">gem_spec</span>(<span class="ruby-identifier">gem_defaults</span>),
      <span class="ruby-identifier">gem_is_current_file</span>,
      <span class="ruby-identifier">gem_name</span>,
      <span class="ruby-identifier">gem_bin_generate</span>,
      <span class="ruby-identifier">gem_bin_contents</span>,
    ]
    <span class="ruby-identifier">already_installed</span> = (
      <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">gem_defaults</span>
    )
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_uninstall_all</span> [<span class="ruby-identifier">gem_name</span>])
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-identifier">gem_name</span>]
    <span class="ruby-identifier">p</span> (<span class="ruby-identifier">gem_path</span> [<span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>])
    <span class="ruby-identifier">gem_install</span> [(<span class="ruby-identifier">gem_path</span> [<span class="ruby-identifier">gem_name</span>, <span class="ruby-identifier">gem_version</span>])]
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-identifier">gem_name</span>]
    <span class="ruby-identifier">v</span> = (
      <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">gem_validate_args</span> <span class="ruby-identifier">gem_defaults</span>
    )
    <span class="ruby-identifier">gem_uninstall_all</span> [<span class="ruby-identifier">gem_name</span>]
    <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_install</span> [<span class="ruby-identifier">gem_name</span>])
    <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for gem_build, gem_install, gem_list</span>
  <span class="ruby-comment"># system_rubyment, gem_uninstall</span>
  <span class="ruby-comment"># note that, if there is a &quot;rubyment&quot; gem</span>
  <span class="ruby-comment"># already installed, it will be temporarily</span>
  <span class="ruby-comment"># unavailable.</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array or nil)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># Rubyment or false</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_build_install_validate_uninstall</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">basic_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:basic_version</span>]
    <span class="ruby-identifier">major_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:major_version</span>]
    <span class="ruby-identifier">running_dir</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
    <span class="ruby-identifier">test__gem_build</span> []
    <span class="ruby-identifier">already_installed</span> = (<span class="ruby-identifier">system_rubyment</span> [<span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-string">&quot;already installed&quot;</span>])
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
    <span class="ruby-identifier">gem_install</span> [<span class="ruby-node">&quot;#{running_dir}/rubyment-#{major_version}.#{basic_version}.gem&quot;</span>]
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
    <span class="ruby-identifier">v</span> = <span class="ruby-identifier">test__system_rubyment</span> []
    <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
    <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_install</span> [<span class="ruby-string">&quot;rubyment&quot;</span>])
    <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gets the api key needed to push gems to rubygems.</span>
  <span class="ruby-comment"># prompts for arguments when username or password</span>
  <span class="ruby-comment"># not provided.</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># [username (String or nil), password (String or nil),</span>
  <span class="ruby-comment"># file_destination (String, &quot;/dev/null&quot; if empty/nil given)]</span>
  <span class="ruby-comment"># returns</span>
  <span class="ruby-comment"># key_contents (String)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_get_api_key</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
    <span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">file_destination</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;username - &quot;</span>
    <span class="ruby-identifier">username</span> = <span class="ruby-identifier">input_single_line</span> [<span class="ruby-identifier">username</span>]
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;password - &quot;</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">file_destination</span> = <span class="ruby-identifier">file_destination</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;/dev/null&quot;</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">file_destination</span>
    <span class="ruby-identifier">key_contents</span> = <span class="ruby-identifier">save_file</span> <span class="ruby-string">&quot;https://rubygems.org/api/v1/api_key.yaml&quot;</span>,
      <span class="ruby-identifier">file_destination</span>, <span class="ruby-value">0</span>, {<span class="ruby-value">:username</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">username</span>, <span class="ruby-value">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">password</span> }
    (<span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-value">0600</span>, <span class="ruby-identifier">file_destination</span>)
    <span class="ruby-identifier">key_contents</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for test__gem_get_api_key</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># (Array - forwarded to gem_get_api_key)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># nil</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_get_api_key</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_get_api_key</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># builds, validates and push a gem accordingly</span>
  <span class="ruby-comment"># to the arguments. if arguments not given,</span>
  <span class="ruby-comment"># will do for the defaults (see rubyment_gem_defaults)</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array or nil)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># ignore (will change)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">gem_build_push</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">running_dir</span>      = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
    <span class="ruby-identifier">home_dir</span>         = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:home_dir</span>]
    <span class="ruby-identifier">gem_username</span>, <span class="ruby-identifier">gem_password</span>, <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-identifier">gem_defaults</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">gem_password</span> = <span class="ruby-identifier">gem_password</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\0&quot;</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">gem_defaults</span> <span class="ruby-operator">||=</span>  <span class="ruby-identifier">rubyment_gem_defaults</span> []
    <span class="ruby-identifier">gem_api_key_file</span> <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{home_dir}/.gem/credentials&quot;</span>
    <span class="ruby-identifier">permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">gem_api_key_file</span>
    <span class="ruby-identifier">credentials_contents</span> = <span class="ruby-identifier">url_to_str</span> <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-string">&quot;&quot;</span>
    (<span class="ruby-identifier">gem_get_api_key</span> [<span class="ruby-identifier">gem_username</span>, <span class="ruby-identifier">gem_password</span>, <span class="ruby-identifier">gem_api_key_file</span>]) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">validated</span> = (
      <span class="ruby-identifier">gem_validate</span> <span class="ruby-identifier">gem_defaults</span>
    )
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">validated</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_push</span> <span class="ruby-identifier">gem_path</span> <span class="ruby-identifier">gem_defaults</span> )
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gem_api_key_file</span>, <span class="ruby-identifier">credentials_contents</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-identifier">permissions</span>, <span class="ruby-identifier">gem_api_key_file</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for gem_build, gem_install, gem_list</span>
  <span class="ruby-comment"># system_rubyment, gem_uninstall</span>
  <span class="ruby-comment"># args:</span>
  <span class="ruby-comment"># args (Array or nil)</span>
  <span class="ruby-comment"># returns:</span>
  <span class="ruby-comment"># ignore</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_complete_flow</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
    <span class="ruby-identifier">gem_build_push</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test file_backup when file is a dir</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__when_file_is_dir</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
    <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">keep_new</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">filename</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;testing-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;/tmp/&quot;</span>
    <span class="ruby-identifier">append</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">prepend</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">filename</span>  <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;/&quot;</span>
    <span class="ruby-identifier">expected_new_dir</span> = <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">existing_dir</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>])
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>
    <span class="ruby-identifier">filename_test</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">expected_new_dir_test</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">expected_new_dir</span>
    <span class="ruby-identifier">original_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">new_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">expected_new_dir</span>
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">filename_test</span>, <span class="ruby-identifier">expected_new_dir_test</span>, <span class="ruby-string">&quot;File.directory?&quot;</span>],
        [<span class="ruby-identifier">original_permissions</span>, <span class="ruby-identifier">new_permissions</span>, <span class="ruby-string">&quot;file_permissions&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
    (<span class="ruby-operator">!</span><span class="ruby-identifier">existing_dir</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rmdir</span> <span class="ruby-identifier">filename</span>)
    (<span class="ruby-operator">!</span><span class="ruby-identifier">keep_new</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rmdir</span> <span class="ruby-identifier">expected_new_dir</span>)
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test file_backup (just like a copy)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-identifier">keep_new</span>  = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">filename</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;testing-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;/tmp/&quot;</span>
    <span class="ruby-identifier">append</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">prepend</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">expected_new_filename</span> = <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">existing_file</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>])
    <span class="ruby-identifier">file_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">filename</span>, <span class="ruby-node">&quot;contents_of:#{filename}&quot;</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>
    <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>
    <span class="ruby-identifier">new_file_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">expected_new_filename</span>
    <span class="ruby-identifier">original_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">new_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">expected_new_filename</span>
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">new_file_contents</span>, <span class="ruby-string">&quot;file_contents&quot;</span>],
        [<span class="ruby-identifier">original_permissions</span>, <span class="ruby-identifier">new_permissions</span>, <span class="ruby-string">&quot;file_permissions&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
    (<span class="ruby-operator">!</span><span class="ruby-identifier">existing_file</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">filename</span>)
    (<span class="ruby-operator">!</span><span class="ruby-identifier">keep_new</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">expected_new_filename</span>)
    <span class="ruby-identifier">judgement</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># same as test__file_backup__when_file_is_dir, but backup is not removed.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__when_file_is_dir__but_keep</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">dont_keep_new</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">test__file_backup__when_file_is_dir</span> [<span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">dont_keep_new</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># same as test__file_backup, but backup is not removed.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__but_keep</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-identifier">dont_keep_new</span>  = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">test__file_backup</span> [<span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">dont_keep_new</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns a method object out of a string or a method object,</span>
  <span class="ruby-comment"># in a polymorphic style.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +method_name_or_method+:: [String, Method] method name or method object</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Method] a method</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">to_method</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">method_name_or_method</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    (
      <span class="ruby-identifier">to_object_method</span> [<span class="ruby-identifier">object</span>, <span class="ruby-identifier">method_name_or_method</span>]
    ) <span class="ruby-operator">||</span> (
      <span class="ruby-identifier">method_name_or_method</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:call</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">method_name_or_method</span>
    ) <span class="ruby-operator">||</span>
      <span class="ruby-identifier">method</span>(<span class="ruby-identifier">method_name_or_method</span>)
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># echoes the processing arg</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +processing_arg+:: [String]</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [String] +processing_arg+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">echo</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># calls a function with the processing arg</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +processing_arg+:: [Object]</span>
  <span class="ruby-comment"># +method+:: [Method, String]</span>
  <span class="ruby-comment"># +method_args+:: [Array] args to be given to the +transform_method_name+</span>
  <span class="ruby-comment"># +on_object+:: [String, Boolean]</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [String] +processing_arg+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__transform_call</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">processing_arg</span>, <span class="ruby-identifier">method</span>, <span class="ruby-identifier">method_args</span>, <span class="ruby-identifier">on_object</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">object_arg</span> = <span class="ruby-identifier">on_object</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">processing_arg</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">to_method</span>(
      [<span class="ruby-identifier">method</span>, <span class="ruby-identifier">object_arg</span>]).<span class="ruby-identifier">call</span>(
        [<span class="ruby-identifier">processing_arg</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">method_args</span>
    )
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns an HTTP response</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +response+:: [String, nil] response payload</span>
  <span class="ruby-comment"># +content_type+:: [String, nil] mime type of payload</span>
  <span class="ruby-comment"># +version+:: [String, nil] http protocol version</span>
  <span class="ruby-comment"># +code+:: [String, nil] response code</span>
  <span class="ruby-comment"># +keep_alive+:: [Boolean] right not unsupported, always close the connection</span>
  <span class="ruby-comment"># +debug+:: [Object] if calling the object +nne+ method returns a +false+ value, won&#39;t print debug information</span>
  <span class="ruby-comment"># +eol+:: [String, nil] string to attach to the end of each line in the response</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [String] response with headers</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">http_response_base</span> <span class="ruby-identifier">args</span> = []
    <span class="ruby-identifier">payload</span>,
      <span class="ruby-identifier">content_type</span>,
      <span class="ruby-identifier">code</span>,
      <span class="ruby-identifier">version</span>,
      <span class="ruby-identifier">keep_alive</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">eol</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">rv</span> = [
      <span class="ruby-node">&quot;HTTP/#{version} #{code}&quot;</span>,
      <span class="ruby-node">&quot;Content-Type: #{content_type};&quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-node">&quot; charset=#{payload.encoding.name.downcase}&quot;</span>,
      <span class="ruby-node">&quot;Content-Length: #{payload.bytesize}&quot;</span>,
      <span class="ruby-identifier">keep_alive</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&quot;Connection: close&quot;</span>,
      <span class="ruby-string">&quot;&quot;</span>,
      <span class="ruby-node">&quot;#{payload}&quot;</span>
    ]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} will return #{rv}&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">rv</span>.<span class="ruby-identifier">join</span> <span class="ruby-identifier">eol</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns an HTTP response (1.1 200 OK by default)</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +response+:: [String, nil] response payload (default empty)</span>
  <span class="ruby-comment"># +content_type+:: [String, nil] mime type of payload (default +text/plain+)</span>
  <span class="ruby-comment"># +version+:: [String, nil] http protocol version (+1.1+ by default)</span>
  <span class="ruby-comment"># +code+:: [String, nil] response code (+&quot;200 OK&quot;+ by default)</span>
  <span class="ruby-comment"># +keep_alive+:: [Boolean] right not unsupported, always close the connection</span>
  <span class="ruby-comment"># +debug+:: [Object] if calling the object +nne+ method returns a +false+ value, won&#39;t print debug information</span>
  <span class="ruby-comment"># +eol+:: [String, nil] response code (+&quot;\r\n&quot;+ by default/on +nil+)</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Array] response with proper headers in an array where each element is a response line</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">payload</span>, <span class="ruby-identifier">content_type</span>, <span class="ruby-identifier">code</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">keep_alive</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">eol</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">payload</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">payload</span>  = <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">content_type</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;text/plain&quot;</span>
    <span class="ruby-identifier">version</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;1.1&quot;</span>
    <span class="ruby-identifier">code</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;200 OK&quot;</span>
    <span class="ruby-identifier">eol</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;\r\n&quot;</span>
    <span class="ruby-identifier">rv</span> = <span class="ruby-identifier">http_response_base</span> [
      <span class="ruby-identifier">payload</span>,
      <span class="ruby-identifier">content_type</span>,
      <span class="ruby-identifier">code</span>,
      <span class="ruby-identifier">version</span>,
      <span class="ruby-identifier">keep_alive</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">eol</span>,
    ]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">rv</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># will call #gets on  +io+ until line starts with +happy_with_request+</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +io+:: [IO] any +IO+, like a +Socket+, returned by #TCPServer::accept</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +happy_with_request+:: [String, nil] if nil, +eol+ is used.</span>
  <span class="ruby-comment"># +eol+:: [String] end of line</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Array] array of strings having the lines read from the IO.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_gets</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">happy_with_request</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;\r\n&quot;</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">lines</span> = []
    (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-constant">Float</span><span class="ruby-operator">::</span><span class="ruby-constant">INFINITY</span>).
      <span class="ruby-identifier">lazy</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">io</span>.<span class="ruby-identifier">gets</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">r</span>)
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">happy_with_request</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">r</span>
      }.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">x</span> }
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">lines</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gets an input from +io+ and writes it back to the same +io+</span>
  <span class="ruby-comment"># supports an optional +replace+ and +replacement+ parameter</span>
  <span class="ruby-comment"># that can be used to make simple changes to the echoing output</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +io+:: [IO] any +IO+, like a +Socket+, returned by #TCPServer::accept</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +transform_method_name+:: [String]</span>
  <span class="ruby-comment"># +transform_method_args+:: [Array] args to be given to the ++transform_method_name+</span>
  <span class="ruby-comment"># +happy_with_request+:: [String, nil] if nil, +eol+ is used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [nil]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">io</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">transform_method_name</span>,
      <span class="ruby-identifier">transform_method_args</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;transform_method_name: #{transform_method_name}&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;transform_method_args: #{transform_method_args.inspect}&quot;</span>)
    <span class="ruby-identifier">io_forward</span> [[<span class="ruby-identifier">io</span>], <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>, <span class="ruby-identifier">reserved</span>,
      <span class="ruby-value">:test__transform_call</span>, [
        <span class="ruby-identifier">transform_method_name</span>,
        <span class="ruby-identifier">transform_method_args</span>,
        <span class="ruby-string">&quot;on_object:true&quot;</span>,
      ]
    ]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gets and forwards the input from one IO to a list of IOs</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +ios_out+:: [Array] array of +IO+, where data will be written to.</span>
  <span class="ruby-comment"># +io_in+:: [IO] any +IO+, like a +Socket+, returned by #TCPServer::accept, where data will be read from.</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +happy_with_request+:: [String, nil] if nil, +eol+ is used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [nil]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_forward</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>

    <span class="ruby-identifier">ios_out</span>,
      <span class="ruby-identifier">io_in</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">reserved</span>,
      <span class="ruby-identifier">processing_method</span>,
      <span class="ruby-identifier">processing_method_args</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">io_gets_args</span> = [<span class="ruby-identifier">io_in</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">input</span> = <span class="ruby-identifier">io_gets</span> <span class="ruby-identifier">io_gets_args</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">ios_out</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">processing_method</span> <span class="ruby-operator">||=</span> <span class="ruby-value">:echo</span>
    <span class="ruby-identifier">processing_method_args</span> <span class="ruby-operator">||=</span> []
    <span class="ruby-identifier">processed_input</span> = <span class="ruby-identifier">to_method</span>(
      [<span class="ruby-identifier">processing_method</span>]).<span class="ruby-identifier">call</span>(
        [<span class="ruby-identifier">input</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">processing_method_args</span>
    )
    <span class="ruby-identifier">ios_out</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">shared_io_out</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">runoe_threaded</span>(<span class="ruby-identifier">shared_io_out</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">io_out</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">io_out</span> = <span class="ruby-identifier">shared_io_out</span>
        <span class="ruby-identifier">io_out</span>.<span class="ruby-identifier">print</span> <span class="ruby-identifier">processed_input</span>
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
          <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{io_out}: #{processed_input.size} bytes: response writen.&quot;</span>
        )
        <span class="ruby-identifier">io_out</span>.<span class="ruby-identifier">close</span>
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
          <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{io_out}: IO closed.&quot;</span>
        )

      }
    }
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># gets an input from +io+ and writes it back to the same +io+</span>
  <span class="ruby-comment"># supports an optional +replace+ and +replacement+ parameter</span>
  <span class="ruby-comment"># that can be used to make simple changes to the echoing output</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +io+:: [IO] any +IO+, like a +Socket+, returned by #TCPServer::accept</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +replace+:: [String]</span>
  <span class="ruby-comment"># +replacement+:: [String]</span>
  <span class="ruby-comment"># +happy_with_request+:: [String, nil] if nil, +eol+ is used.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [nil]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_echo</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">happy_with_request</span>, <span class="ruby-identifier">replace</span>, <span class="ruby-identifier">replacement</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-comment"># this is an inefficient replacement:</span>
    <span class="ruby-identifier">replace</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot; &quot;</span>
    <span class="ruby-identifier">replacement</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot; &quot;</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">io_transform</span> [
      <span class="ruby-identifier">io</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-value">:array_maps</span>,
      [
        <span class="ruby-value">:gsub!</span>, [<span class="ruby-identifier">replace</span>, <span class="ruby-identifier">replacement</span>]
      ],
    ]

    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># writes a response to an IO (e.g.: socket)</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +reserved+:: [Object] for future use</span>
  <span class="ruby-comment"># +args_for_http_OK_response+:: [splat] args to be forwarded to #http_OK_response (check it for specification)</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [nil]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">io_http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">io</span>, <span class="ruby-identifier">debug</span>, <span class="ruby-identifier">reserved</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args_for_http_OK_response</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">inspect</span>)
    <span class="ruby-identifier">response</span> = <span class="ruby-identifier">http_OK_response</span> <span class="ruby-identifier">args_for_http_OK_response</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">inspect</span>
    )
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;response writen.&quot;</span>)
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;IO closed.&quot;</span>)
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># opens a TCP server accepting connections.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +reserved+:: [Object] for future use</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +callback_method+:: [String, Method] method to call when a client connects. The method must accept a socket as parameter.</span>
  <span class="ruby-comment"># +callback_method_args+:: [splat] args to be given to the call_back_method</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Thread] returns a Thread object looping for accepting</span>
  <span class="ruby-comment"># incoming connections (call join on that object for waiting for its</span>
  <span class="ruby-comment"># completion).</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_server_plain</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">reserved</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">callback_method</span>,
      <span class="ruby-operator">*</span><span class="ruby-identifier">callback_method_args</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">tcp_ssl_server</span> [
      <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-string">&quot;admit non ssl server&quot;</span>,
      <span class="ruby-identifier">callback_method</span>,
      <span class="ruby-identifier">callback_method_args</span>
      ]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># makes one or more OpenSSL server</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +admit_plain+:: [Boolean] if +true+, tries to create a normal +TCPServer+, if not possible to create +SSLServer+ (default: +false+, for preventing unadvertnt non-SSL server creation)</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +priv_pemfile+:: [String] argument to be given to +OpenSSL::SSL::SSLContext.key+ method, after calling +OpenSSL::PKey::RSA.new+ with it. It&#39;s the private key file. letsencrypt example: +&quot;/etc/letsencrypt/live/#{domain}/privkey.pem&quot;+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +cert_pem_file+:: [String] argument to be given to +OpenSSL::SSL::SSLContext.cert+ method, after calling +OpenSSL::X509::Certificate+.  It&#39;s the &quot;Context certificate&quot; accordingly to its ruby-doc page. letsencrypt example: +&quot;/etc/letsencrypt/live/#{domain}/fullchain.pem&quot;+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +extra_cert_pem_files+:: [Array] array of strings. Each string will be mapped with +OpenSSL::SSL::SSLContext.new+, and the resulting array is given to +OpenSSL::SSL::SSLContext.extra_chain_cert+. &quot;An Array of extra X509 certificates to be added to the certificate chain&quot; accordingly to its ruby-doc. letsencryptexample: +[&quot;/etc/letsencrypt/live/#{domain}/chain.pem&quot;]+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +output_exception+:: [Bool] output exceptions even if they are admitted?</span>
  <span class="ruby-comment"># +plain_servers+:: [TCPServer, Array of TCPServer] if given, ignores +listening_port+ and +ip_addr+, does not create a +TCPServer+ and just creates an +SSLServer+ out of this one. If an +Array+ of +TCPServer+ is provided instead, it will create one +SSLServer+ to each of those +TCPServer+.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Array] returns an  #Array whose elements are:</span>
  <span class="ruby-comment"># +servers+:: [Array of OpenSSL::SSL::SSLServer or of TCPServer] depending on +admit_plain+ and in the success of the creation of +SSLServers+.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_make_servers</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">plain_servers</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">extra_cert_pem_files</span> = <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> []
    <span class="ruby-identifier">admit_plain</span> = <span class="ruby-identifier">admit_plain</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">output_exception</span> = (
      <span class="ruby-identifier">output_exception</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">admit_plain</span>.<span class="ruby-identifier">negate_me</span>
    )
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-comment"># openssl functions want contents, not filenames:</span>
    <span class="ruby-identifier">extra_cert_pem_files</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>
      .<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">extra_cert_pem_file</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">file_read</span> [
          <span class="ruby-identifier">extra_cert_pem_file</span>,
          <span class="ruby-keyword">nil</span>,
          <span class="ruby-keyword">nil</span>,
          <span class="ruby-identifier">extra_cert_pem_file</span>
        ]
      }
    <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_pem_file</span>]
    <span class="ruby-identifier">priv_pemfile</span>  = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">priv_pemfile</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">priv_pemfile</span>]
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;socket&#39;</span>
    <span class="ruby-identifier">plain_servers</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">ip_addr</span>, <span class="ruby-identifier">listening_port</span>
    <span class="ruby-identifier">plain_servers</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">plain_servers</span>

    <span class="ruby-identifier">servers</span> = <span class="ruby-identifier">plain_servers</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">plain_server</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">ssl_server</span> = <span class="ruby-identifier">runea</span> [
        <span class="ruby-identifier">admit_plain</span>,
        <span class="ruby-identifier">output_exception</span>,
        <span class="ruby-string">&quot;nil on exception&quot;</span>] {
          <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
          <span class="ruby-identifier">ssl_context</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLContext</span>.<span class="ruby-identifier">new</span>
          <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">extra_chain_cert</span> =
            <span class="ruby-identifier">extra_cert_pem_files</span>
              .<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:new</span>))
          <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">cert</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>
            .<span class="ruby-identifier">new</span> <span class="ruby-identifier">cert_pem_file</span>
          <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">key</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>
            .<span class="ruby-identifier">new</span> <span class="ruby-identifier">priv_pemfile</span>
          <span class="ruby-identifier">ssl_server</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLServer</span>
            .<span class="ruby-identifier">new</span> <span class="ruby-identifier">plain_server</span>, <span class="ruby-identifier">ssl_context</span>
          <span class="ruby-identifier">ssl_server</span>
      }
      <span class="ruby-identifier">server</span> = <span class="ruby-identifier">ssl_server</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">admit_plain</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">plain_server</span>
    }
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{[servers]}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    [<span class="ruby-identifier">servers</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># makes an OpenSSL server </span>
  <span class="ruby-comment"># just an interface to the more powerful</span>
  <span class="ruby-comment"># recommended #ssl_make_servers</span>
  <span class="ruby-comment"># (kept for respecting open-closed principle)</span>
  <span class="ruby-comment"># @param [splat] +args+, an splat whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +admit_plain+:: [Boolean] if +true+, tries to create a normal +TCPServer+, if not possible to create +SSLServer+ (default: +false+, for preventing unadvertnt non-SSL server creation)</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +priv_pemfile+:: [String] argument to be given to +OpenSSL::SSL::SSLContext.key+ method, after calling +OpenSSL::PKey::RSA.new+ with it. It&#39;s the private key file. letsencrypt example: +&quot;/etc/letsencrypt/live/#{domain}/privkey.pem&quot;+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +cert_pem_file+:: [String] argument to be given to +OpenSSL::SSL::SSLContext.cert+ method, after calling +OpenSSL::X509::Certificate+.  It&#39;s the &quot;Context certificate&quot; accordingly to its ruby-doc page. letsencrypt example: +&quot;/etc/letsencrypt/live/#{domain}/fullchain.pem&quot;+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +extra_cert_pem_files+:: [Array] array of strings. Each string will be mapped with +OpenSSL::SSL::SSLContext.new+, and the resulting array is given to +OpenSSL::SSL::SSLContext.extra_chain_cert+. &quot;An Array of extra X509 certificates to be added to the certificate chain&quot; accordingly to its ruby-doc. letsencryptexample: +[&quot;/etc/letsencrypt/live/#{domain}/chain.pem&quot;]+ (now it&#39;s accepted to pass the file contents instead, both must work).</span>
  <span class="ruby-comment"># +output_exception+:: [Bool] output exceptions even if they are admitted?</span>
  <span class="ruby-comment"># +plain_server+:: [TCPServer] if given, ignores +listening_port+ and +ip_addr+, does not create a +TCPServer+ and just creates an +SSLServer+ out of this one.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [OpenSSL::SSL::SSLServer] returns an ssl server, which can be used to accept connections.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_make_server</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">plain_server</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">rv</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
      <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">plain_server</span>,
    ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{rv}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">rv</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># opens one or more TCP and/or SSL server accepting connections.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +admit_plain+:: [Boolean] if +true+, tries to create a normal +TCPServer+, if not possible to create +SSLServer+ (default: +false+, for preventing unadvertnt non-SSL server creation)</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +callback_method+:: [String, Method] method to call when a client connects. The method must accept a socket as parameter.</span>
  <span class="ruby-comment"># +callback_method_args+:: [Array] args to be given to the call_back_method. Note that the type differs from #tcp_server_plain (which takes splat)</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Array] returns a , an +Array+ whose elements are:</span>
  <span class="ruby-comment"># +threads+:: [Array of Thread] returns an Array of Thread object looping for accepting  incoming connections (call join on those object for waiting for its completion).</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_ssl_servers</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">callback_method</span>,
      <span class="ruby-identifier">callback_method_args</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">server</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
      <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
    ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">server</span>)
    <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> {
      <span class="ruby-identifier">loop</span> {
        <span class="ruby-identifier">client</span> = <span class="ruby-identifier">runea</span> [<span class="ruby-string">&quot;yes, rescue&quot;</span>,
          <span class="ruby-string">&quot;yes, output exception&quot;</span>,
          <span class="ruby-string">&quot;nil on exception&quot;</span>
        ] {
          <span class="ruby-identifier">server</span>.<span class="ruby-identifier">accept</span>
        }
        <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">client</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
          <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">client</span>)
          <span class="ruby-identifier">runoe</span> {
            <span class="ruby-identifier">to_method</span>([<span class="ruby-identifier">callback_method</span>])
              .<span class="ruby-identifier">call</span>([<span class="ruby-identifier">client</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">callback_method_args</span>)
          }
        }
      }
    }
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># opens an SSL server accepting connections.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +listening_port+:: [String, Integer] port to listen</span>
  <span class="ruby-comment"># +ip_addr+:: [String, nil] ip (no hostname) to bind the server. 0, nil, false, empty string will bind to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all ipv4 and ipv6</span>
  <span class="ruby-comment"># +admit_plain+:: [Boolean] if +true+, tries to create a normal +TCPServer+, if not possible to create +SSLServer+ (default: +false+, for preventing unadvertnt non-SSL server creation)</span>
  <span class="ruby-comment"># +debug+:: [Object] for future use</span>
  <span class="ruby-comment"># +callback_method+:: [String, Method] method to call when a client connects. The method must accept a socket as parameter.</span>
  <span class="ruby-comment"># +callback_method_args+:: [Array] args to be given to the call_back_method. Note that the type differs from #tcp_server_plain (which takes splat)</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># @return [Thread] returns a Thread object looping for accepting</span>
  <span class="ruby-comment"># incoming connections (call join on that object for waiting for its</span>
  <span class="ruby-comment"># completion).</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_ssl_server</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">callback_method</span>,
      <span class="ruby-identifier">callback_method_args</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">server</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
      <span class="ruby-identifier">listening_port</span>,
      <span class="ruby-identifier">ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">output_exception</span>,
    ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">server</span>)
    <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> {
      <span class="ruby-identifier">loop</span> {
        <span class="ruby-identifier">client</span> = <span class="ruby-identifier">runea</span> [<span class="ruby-string">&quot;yes, rescue&quot;</span>,
          <span class="ruby-string">&quot;yes, output exception&quot;</span>,
          <span class="ruby-string">&quot;nil on exception&quot;</span>
        ] {
          <span class="ruby-identifier">server</span>.<span class="ruby-identifier">accept</span>
        }
        <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">client</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
          <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">client</span>)
          <span class="ruby-identifier">runoe</span> {
            <span class="ruby-identifier">to_method</span>([<span class="ruby-identifier">callback_method</span>])
              .<span class="ruby-identifier">call</span>([<span class="ruby-identifier">client</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">callback_method_args</span>)
          }
        }
      }
    }
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_server_plain</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [<span class="ruby-value">8003</span>,
     <span class="ruby-string">&quot;0&quot;</span>,
     <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;io_echo&quot;</span>,
     <span class="ruby-string">&quot;debug_io_echo&quot;</span>,
     <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot; &quot;</span>, <span class="ruby-comment">#replace</span>
     <span class="ruby-string">&quot;__&quot;</span>, <span class="ruby-comment">#replacement -- will replace empty spaces</span>
     ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># test for tcp_server_plain (call io_transform)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
     <span class="ruby-value">8003</span>,
     <span class="ruby-string">&quot;0&quot;</span>,
     <span class="ruby-string">&quot;&quot;</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;io_transform&quot;</span>,
     <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
     <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-value">:array_maps</span>,
     [
        <span class="ruby-value">:gsub!</span>, [<span class="ruby-string">&quot; &quot;</span>, <span class="ruby-string">&quot;_____&quot;</span>]
     ]
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># test for tcp_server_plain</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_io_http_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
     <span class="ruby-value">8003</span>, <span class="ruby-comment"># listening_port</span>
     <span class="ruby-string">&quot;0&quot;</span>,  <span class="ruby-comment"># ip_addr: all possible</span>
     <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot;debug_tcp_server_plain_arg&quot;</span>,
     <span class="ruby-string">&quot;io_http_OK_response&quot;</span>,
     <span class="ruby-string">&quot;debug_io_http_OK_response_arg&quot;</span>,
     <span class="ruby-string">&quot;reserved_io_http_OK_response_arg&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot;This is the response payload&quot;</span>,
     <span class="ruby-string">&quot;dont_keep_alive&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_server_plain (call #io_transform with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
   <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
   <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
   <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
   <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
   <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;io_transform&quot;</span>,
     <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
     <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_ssl_server (call #io_transform with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-comment"># just like #test__tcp_server_plain__with_http_OK_response</span>
  <span class="ruby-comment"># but calling directly #tcp_ssl_server</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__non_ssl</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
   <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
   <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
   <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
   <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
   <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> [
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;admit non ssl server&quot;</span>,
     <span class="ruby-string">&quot;io_transform&quot;</span>,
     [
       <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
       <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
       <span class="ruby-identifier">http_processing_method</span>,
       <span class="ruby-identifier">http_processing_method_args</span>
     ],
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># generates a hash string based on current time</span>
  <span class="ruby-comment"># @return [String] +Time.now.hash.abs.to_s+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">time_now_hash</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># returns a sample self signed certificate-private key pair</span>
  <span class="ruby-comment"># that once was created with the command (no password, no</span>
  <span class="ruby-comment"># expire date):</span>
  <span class="ruby-comment"># + openssl req -x509 -nodes -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</span>
  <span class="ruby-comment"># @param [splat] +args+::, an splat whose elements are expected to be:</span>
  <span class="ruby-comment"># +reserved+:: [splat] reserved for future use</span>
  <span class="ruby-comment"># @return [Array] where the first element is a certificate (suitable to be the contents of +cert_pem_file+  in #ssl_make_server) and the second a private key (suitable to be the contents of +priv_pemfile+ in #ssl_make_server)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">self_signed_certificate</span> = <span class="ruby-value">&lt;&lt;-ENDHEREDOC
-----BEGIN CERTIFICATE-----
MIICWDCCAcGgAwIBAgIJAPa0EXsH2MwsMA0GCSqGSIb3DQEBCwUAMEUxCzAJBgNV
BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX
aWRnaXRzIFB0eSBMdGQwHhcNMTgwNjI3MDkzMTEyWhcNMTgwNzI3MDkzMTEyWjBF
MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50
ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKB
gQCplOo6dvbM1650qMYLQ8tRycYlHEZH95kUR5E5EEA8yqgimBtx6InpGQi/PejK
tk+IXbDrxinXMXqjZxAhCjd7+frSUFwUTZ669PuRaptlkjV1KojXBW5kRERAgYId
H7z7QRuK/gWHqTt9zl3WpW2spfWjHY+cnkYdZIWqDBOggwIDAQABo1AwTjAdBgNV
HQ4EFgQUAIq0u116/WmTFQ8HC7/XrKl6wB8wHwYDVR0jBBgwFoAUAIq0u116/WmT
FQ8HC7/XrKl6wB8wDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOBgQBgA9ID
JcreAgjYLxiaAd7fCfLQ1/RYM8YdP9R4Lzg2cu0dCjXoLZqzAEwUg424rPOvf0Pj
wnZ3DFJkg1CoN2fH3yLXQ75mhfM7PJXeWoWLTS2wIG/+VIVI+nKJU0RPOM87Mdlq
+b6TI5LsGxlJhaxTmzPtkHZLIRdW6iCJTwP+5Q==
-----END CERTIFICATE-----
   ENDHEREDOC</span>
   <span class="ruby-identifier">private_key</span> = <span class="ruby-value">&lt;&lt;-ENDHEREDOC
-----BEGIN PRIVATE KEY-----
MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAKmU6jp29szXrnSo
xgtDy1HJxiUcRkf3mRRHkTkQQDzKqCKYG3HoiekZCL896Mq2T4hdsOvGKdcxeqNn
ECEKN3v5+tJQXBRNnrr0+5Fqm2WSNXUqiNcFbmRERECBgh0fvPtBG4r+BYepO33O
Xdalbayl9aMdj5yeRh1khaoME6CDAgMBAAECgYB+Z80spU6UJFUbCk8NSIx+u6ui
L/BHZs1Ja4tZgL6RUfKATuduQgrCoPF/NBOZPsoL+OKO7Nh1WqFyubkxF5+A6BlI
BRe/E4K3cChBWyR5ZQyldYUNVV1HBrAhpurW/OX7FInPGo0I5TkR/CJt6xZPgK1n
4lNXFV29gz/LPTJN4QJBANxnUn2xbtBH0xaTX4iIGEH2keLaUftg0b29Ou/MIPn3
+z7Ln9K6eknf/OGXAvBP2cnWkTGXAOBmB95s9XDrORMCQQDE+FcWTlSKFywFaxhp
nVkDOL+k7Vpn/rKvqKB3JQOrPkovPSo/CHsUVe/r2NEsdJt1SKOs0/xzNe7wSXBa
1tjRAkAHVbTsE+yRJ+LBfJQQUh8kitUeDI/v4q/4NYTxmAR87SDCXTprY+NP9BFR
XJovbyjbS7W3RcQ0s5CNeWjNojZbAkA5u3SDJDhhNUOA3xALvMPfTt3VMICkJKIp
HGrUITQ/GAXUbMAaM5knr7yfyzAcMJ10NfNLb+L5veAn686TwY9RAkArqoX6cWrd
GflH+FhUggqgVrr9XaXkpPUxcpNqAQH/3Yl5pt9jV2VE7eD3chijMGzGJrMUsqFG
n8mFEtUKobsK
-----END PRIVATE KEY-----
   ENDHEREDOC</span>
   [<span class="ruby-identifier">self_signed_certificate</span>, <span class="ruby-identifier">private_key</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># has the same functionality as</span>
  <span class="ruby-comment"># #ssl_sample_self_signed_cert.</span>
  <span class="ruby-comment"># this one is left as an example on how</span>
  <span class="ruby-comment"># safely place a certificate/private key</span>
  <span class="ruby-comment"># pair inside this code, instead of leaving</span>
  <span class="ruby-comment"># it in plain or somewhere in your filesystem.</span>
  <span class="ruby-comment"># @param [splat] +args+::, an splat whose elements are expected to be:</span>
  <span class="ruby-comment"># +reserved+:: [splat] reserved for future use</span>
  <span class="ruby-comment"># @return [Array] where the first element is a certificate (suitable to be the contents of +cert_pem_file+  in #ssl_make_server) and the second a private key (suitable to be the contents of +priv_pemfile+ in #ssl_make_server)</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">password</span> = <span class="ruby-string">&quot;onlyNSAknows&quot;</span>
    <span class="ruby-comment"># generated with:</span>
    <span class="ruby-comment"># test__enc_dec_interactive [</span>
    <span class="ruby-comment">#   ssl_sample_self_signed_cert[0],</span>
    <span class="ruby-comment">#   password,</span>
    <span class="ruby-comment"># ]:</span>
     <span class="ruby-identifier">self_signed_certificate</span> = <span class="ruby-identifier">dec_interactive</span> [
      <span class="ruby-string">&quot;owdfr76MvIhPb05PLsPiTw==\n&quot;</span>,
      <span class="ruby-string">&quot;R1QSJSUmfXVB4ET2r5C2MN3MZC75V9Pi7nWl8+lTZ363IJOYK4/DJkKL0Y58\nMo8fp1mvoq0fjhCSdHqld6IMWxFXW3kzXGyuVScfbRbvYV83AAhmq+HTscUE\nYJLsfnUqTzGKN/AB/Kr1x3kIsZsb9oNSQMk3dFHV89AM9Z1d30ZMgtW8mn/c\nTHmxsLaFgKvg8bT9t+ERBr85bmJuphkDBlAc4hP2KS/xTFeKB1QL/lJ/oF9j\ncUmb5uWdmZ0REzLyYu9F1MfHv0lwENi+oJYW50lo7DUTYHnyKxYRo+rlUsDF\n0nyS4wcPQVxvY1vDrC34pFdMtcXLQTzzbAiyJx73fT7WfY40MNNKRZfz/zlG\nl/d4ILNlW43/fVnOwg4yZ1tGT1PovrDs1c8Mxu7zm0QCT7+Dp+nN0zes5K8A\n2aYIsR7Nvm+3OeKrRf2JXHv8J/10NEcPfuYocmitlzrr6yM3+4xMXM94Zt/7\n4+vONht+xOhOxUmJufC4HNOmqszX1480dL96qfhc9zXlvxpbD4DGkgU0AR17\nt1C6XNqI0jQxxDMQa0jn0HsX5C9dmtqunLIz8ZkgfSNJbsOtVYVS11YuXk+k\nbEdVimP6DT1x0KZ+UxpxOFJcuvtM6eBe3aMWRjlIf/xjobJ2GP9OlDq1hPJe\n+zz1lhUxobFZiqSIrVbYz8u6ZuvVSEa8NfQJ+GpE1poExzBAsM5RjSMWK0Yr\nLnasLNQwJkYoDlmZBNOX30pCaZPmLl9xLaJphIeHOcmNL0e209hST4H5s1oZ\np/k+sk/jgqtc6jVBeMVwSEDHLl4F4hiNHqeqW72bim7XlkbVjaZ8Q66hUCK/\nKBlJ9YH4QCm3zN4ZQtoTOwu7G8+GeO46ahShzE9+6uoj8DCN31zcbDA5sKgJ\nc6SkA1KG83cDq2rP9zKAMn8V1O/NMnV/09gqPiowl/60CVuepkpNmVehhBVi\noamQ5r1g2l/PaUr7hmwygLBjnMHYD2eu5M0gMLYtZxCQSiXTxryp8Xd7vBzs\n0oWO2km/RjVedhxIBMGxcL2O17lWvumcr8AQYOuuiciPqNj0p/KxDYUHvIqx\nW3vPHknUzug5gSwfYZF7t5HCAc8dyRyC/b5M7Mvl9OsWdRPpcv25Dr+x/i/r\nrRMyvBLd8cujRh532fuyDZVL8NwPqwkKoBSU/+hkSOfW6WEdwYWp8xHDFmrQ\nD/YTNSSVPhGNSxR4I/niEksgH43zp5MdowcVuVsIxQBI/ExGcloRJ3hVa1I=\n&quot;</span>,
      <span class="ruby-string">&quot;IxDTD59cryQjCnFpYQTudw==\n&quot;</span>,
      <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>,
      <span class="ruby-identifier">password</span>,
    ]
    <span class="ruby-comment"># generated with:</span>
    <span class="ruby-comment"># test__enc_dec_interactive [</span>
    <span class="ruby-comment">#   ssl_sample_self_signed_cert[1],</span>
    <span class="ruby-comment">#   &quot;onlyNSAknows&quot;,</span>
    <span class="ruby-comment"># ]</span>
    <span class="ruby-identifier">private_key</span> = <span class="ruby-identifier">dec_interactive</span> [
      <span class="ruby-string">&quot;mxoZrTsIelpVmTAdSMQJaw==\n&quot;</span>,
      <span class="ruby-string">&quot;ebsMBtAoESJAOrmffbRsNdjv3FUqyTetrKlw6WGCNLre8uChpt38ZRmi1XAr\nab2PxiNyz7OJ8PWwCnd/TjIOhvid3Zt7LbqUpR2ixRmVf/mEFoWrdwdXnOMz\nzQErlSok1dY2cAvGqBihP26yC9N4IGJU5Jrt4wivahnnvWZoC1gvsEZVPC+Q\nxLF69gu8fn4gUgFvzpjuhgcCXk6QyhW916pZxJrtwBRMEQWu9dGEcRqSPqNt\nLfw6cXyGHDNV1320Je2BRjzMrhIfiwkv88oWEjnHcbOzboxhGdvYG8oYNMgQ\nf9qouABXlQyOEnBIFfl2lKoJaizERs1ShsdNCAcyZZPgNdxWNawdcF3AawYh\nqlX+uOlxCsWQLV3AaSDPy9mDthF3IuMLLe/BlY3gkGLCvD4szZIsQhk6047+\n9euOuJxxu8X3r8TZDHQK9esm5O6YeNFIlGko6PXA2OwcdUWO9Umwr7Lu8Mgk\n/yldW0G/6dMZ6qKSSSLTvEnzZChz91GabcntxT2TrOR2b1zHJhfOUUxcHxWe\nkuqZZ6GmGFIPju22cCsstXDZ0Q1J19VnGBsrySR0AHDxS3sLgeihf8SjP1bn\n3B1nRR+1gHyKPthKiuzibJj+j6xcIgYBynyaNIeT0Wfcf7WXyBTZ+Idd7Z+R\nkiy9jnZPqCIEE5aebuVvAUXksPE2OvEgsCIiLSEylXXrHEdcEnfra7wvo0qb\n1G/vRNlOIYJiOsKLOqcg6KZVJ+QHHYPrir33g4N02Q64WEw4/eIzR5o4MV9c\n7tho/VLQBE1T3z8HPlhe8XOXvVIDJ/cDVJhTre6KbKBsA+Ow47Z1uNXAchAO\n2bwl1sN1iH+SNBsEjRiXpjbrk95I/H66+LZoz85kRBcoQIhfXU97qbskBUwX\nK//3HdYluo/xx5QSVNqQUzybQnRdNV7gy6xNIgpot9ZtPB2K00HulWW1dnRQ\nBMCWb5h3eUob826icleZ/bEFfcfY8FjNTh9zhyWra3wJOTGS4zhmnlfhBRFZ\njRUcKGX/zgfIrCKXum+2m7Cku3bez+mKpEMRWIBPweGzjq3DSdtY+qlKOgeV\nBxOOh0QoMw1kzRfqF0D0Nqn785lvcXjH28v1efHf6SgFrOXjFNl0ihXXxhMG\nivsoIGIblspGIddR6wbarq1L8xMBTCAorNo0OrWPYACz4ek2CmQUuLhwiNx/\nWsFmaElfdtNL/WM06D5zehAYnCfg02zVr4bIgrHkFaq+jsI+u7/3GhtAmnAC\nkUT9CQvGNXwki3jIHOJQL1X8vLA2T25lg9I7wU4EXA==\n&quot;</span>,
      <span class="ruby-string">&quot;IBBcvvM2/h7bW+tBcBbXeQ==\n&quot;</span>,
      <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>,
      <span class="ruby-identifier">password</span>,
      ]
    [<span class="ruby-identifier">self_signed_certificate</span>, <span class="ruby-identifier">private_key</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for ssl_sample_self_signed_cert_encrypted</span>
  <span class="ruby-comment"># note: function name out of standard. kept for</span>
  <span class="ruby-comment"># open-closed commitment.</span>
  <span class="ruby-comment"># call #test__enc_dec_interactive__ssl_sample_self_signed_cert</span>
  <span class="ruby-comment"># instead</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">expectation</span> = {
      <span class="ruby-value">:self_signed_certificate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span>[<span class="ruby-value">0</span>],
      <span class="ruby-value">:private_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span>[<span class="ruby-value">1</span>],
    }
    <span class="ruby-identifier">actual</span> = {
      <span class="ruby-value">:self_signed_certificate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span>[<span class="ruby-value">0</span>],
      <span class="ruby-value">:private_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span>[<span class="ruby-value">1</span>],
    }
    <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
    }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># #test_enc_dec_interactive__ssl_sample_self_signed_cert</span>
  <span class="ruby-comment"># function name out of standard.</span>
  <span class="ruby-comment"># this one should be called instead instead</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">test_enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_ssl_server (call #io_transform with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-comment"># just like #test__tcp_ssl_server__non_ssl,</span>
  <span class="ruby-comment"># calling directly #tcp_ssl_server, but making</span>
  <span class="ruby-comment"># mandatory the server to be ssl one.</span>
  <span class="ruby-comment"># requires, by default that the certificate and its</span>
  <span class="ruby-comment">#  private key are found in the current dir, which</span>
  <span class="ruby-comment">#  can be achieved with:</span>
  <span class="ruby-comment">#  +openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</span>
  <span class="ruby-comment"># but if the files don&#39;t exist, they will be created</span>
  <span class="ruby-comment"># with a sample self signed certificate.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">priv_pemfile</span>,
     <span class="ruby-identifier">cert_pem_file</span>,
     <span class="ruby-identifier">extra_cert_pem_files</span>,
     <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
     <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
   <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
   <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
   <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
   <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
   <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> =
     <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
   <span class="ruby-identifier">ssl_cert_pkey_chain</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>
   <span class="ruby-identifier">priv_pemfile</span>  =   <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">1</span>]
   <span class="ruby-identifier">cert_pem_file</span> =  <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">0</span>]
   <span class="ruby-identifier">extra_cert_pem_files</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">2</span>]
   <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> [
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-string">&quot;debug&quot;</span>,
     <span class="ruby-string">&quot;admit non ssl server&quot;</span>.<span class="ruby-identifier">negate_me</span>,
     <span class="ruby-string">&quot;io_transform&quot;</span>,
     [
       <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
       <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
       <span class="ruby-identifier">http_processing_method</span>,
       <span class="ruby-identifier">http_processing_method_args</span>
     ],
     <span class="ruby-identifier">priv_pemfile</span>,
     <span class="ruby-identifier">cert_pem_file</span>,
     <span class="ruby-identifier">extra_cert_pem_files</span>,
     <span class="ruby-string">&quot;yes, output exceptions&quot;</span>,
   ]
   <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests #file_read_or_write and #file_read</span>
  <span class="ruby-comment"># specially its +return_on_rescue+ parameter.</span>
  <span class="ruby-comment"># attention that files given by parameter</span>
  <span class="ruby-comment"># will be mercilessly overwritten.</span>
  <span class="ruby-comment"># writes the contents returned by </span>
  <span class="ruby-comment"># #ssl_sample_self_signed_cert</span>
  <span class="ruby-comment"># to 2 files. then reads then.</span>
  <span class="ruby-comment"># after it tries to give the contents of</span>
  <span class="ruby-comment"># those files instead of the filenames.</span>
  <span class="ruby-comment"># the idea behind is that, no matter if</span>
  <span class="ruby-comment"># contents or filename were given, it</span>
  <span class="ruby-comment"># should always return the contents of</span>
  <span class="ruby-comment"># the file.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_read__return_on_rescue</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">priv_pemfile</span>, <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">priv_pemfile</span>  =  <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;/tmp/pkey.pem&quot;</span>
    <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;/tmp/cert.crt&quot;</span>
    <span class="ruby-identifier">runef</span> { 
     <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">priv_pemfile</span>
     <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">cert_pem_file</span>
    }
    <span class="ruby-identifier">cert_contents</span>, <span class="ruby-identifier">pkey_contents</span> = <span class="ruby-identifier">ssl_sample_self_signed_cert</span>
    <span class="ruby-comment"># asserting that file_read_or_write is correct</span>
    <span class="ruby-identifier">read_or_write_cert_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-identifier">cert_contents</span>
    <span class="ruby-identifier">read_or_write_pkey_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">priv_pemfile</span>,  <span class="ruby-identifier">pkey_contents</span>
    <span class="ruby-identifier">file_dot_read_cert_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">cert_pem_file</span>
    <span class="ruby-identifier">file_dot_read_pkey_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">priv_pemfile</span>
    <span class="ruby-comment"># files exist case (will return the contents of 1st parameter filename):</span>
    <span class="ruby-identifier">existing_cert_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_pem_file</span>]
    <span class="ruby-identifier">existing_pkey_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">priv_pemfile</span>,  <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">priv_pemfile</span> ]
    <span class="ruby-comment"># files don&#39;t exist case (will return the 4th parameter):</span>
    <span class="ruby-identifier">rescue_cert_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_contents</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_contents</span>]
    <span class="ruby-identifier">rescue_pkey_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">pkey_contents</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">pkey_contents</span>]
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">read_or_write_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;read_or_write_cert_contents&quot;</span>],
        [<span class="ruby-identifier">read_or_write_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;read_or_write_pkey_contents&quot;</span>],
        [<span class="ruby-identifier">file_dot_read_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;file_dot_read_cert_contents&quot;</span>],
        [<span class="ruby-identifier">file_dot_read_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;file_dot_read_pkey_contents&quot;</span>],
        [<span class="ruby-identifier">existing_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;existing_cert_contents&quot;</span>],
        [<span class="ruby-identifier">existing_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;existing_pkey_contents&quot;</span>],
        [<span class="ruby-identifier">rescue_cert_contents</span>,   <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;rescue_cert_contents&quot;</span>],
        [<span class="ruby-identifier">rescue_pkey_contents</span>,   <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;rescue_pkey_contents&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_ssl_server (call #io_transform with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-comment"># just like #test__tcp_ssl_server__non_ssl,</span>
  <span class="ruby-comment"># calling directly #tcp_ssl_server, but making</span>
  <span class="ruby-comment"># mandatory the server to be ssl one.</span>
  <span class="ruby-comment"># requires, by default that the certificate and its</span>
  <span class="ruby-comment">#  private key are found in the current dir, which</span>
  <span class="ruby-comment">#  can be achieved with:</span>
  <span class="ruby-comment">#  +openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</span>
  <span class="ruby-comment"># but if the files don&#39;t exist, they will be created</span>
  <span class="ruby-comment"># with a sample self signed certificate.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__ssl_self_signed</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">priv_pemfile</span>,
     <span class="ruby-identifier">cert_pem_file</span>,
     <span class="ruby-identifier">extra_cert_pem_files</span>,
     <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
   <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> = <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
   <span class="ruby-identifier">test__tcp_ssl_server__io_transform</span> [
   <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>,
     <span class="ruby-identifier">http_server_port</span>,
     <span class="ruby-identifier">http_ip_addr</span>,
     <span class="ruby-identifier">priv_pemfile</span>,
     <span class="ruby-identifier">cert_pem_file</span>,
     <span class="ruby-identifier">extra_cert_pem_files</span>,
     <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
   ]
   <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for tcp_ssl_server (calling an +io_method+,</span>
  <span class="ruby-comment"># by default #io_transform, with</span>
  <span class="ruby-comment"># a function that processes an http request and returns</span>
  <span class="ruby-comment"># an http_response, by default #http_OK_response)</span>
  <span class="ruby-comment"># just like #test__tcp_ssl_server__non_ssl,</span>
  <span class="ruby-comment"># calling directly #tcp_ssl_server, but making</span>
  <span class="ruby-comment"># mandatory the server to be ssl one.</span>
  <span class="ruby-comment"># requires, by default that the certificate and its</span>
  <span class="ruby-comment">#  private key are found in the current dir, which</span>
  <span class="ruby-comment">#  can be achieved with:</span>
  <span class="ruby-comment">#  +openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</span>
  <span class="ruby-comment"># but if the files don&#39;t exist, they will be created</span>
  <span class="ruby-comment"># with a sample self signed certificate.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__io_method</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">io_method</span>,
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
    <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
    <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
    <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
    <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> =
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
    <span class="ruby-identifier">ssl_cert_pkey_chain</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>
    <span class="ruby-identifier">priv_pemfile</span>  =   <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">cert_pem_file</span> =  <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">0</span>]
    <span class="ruby-identifier">extra_cert_pemiles</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">2</span>]
    <span class="ruby-identifier">debug</span> =  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;yes, debug&quot;</span>
    <span class="ruby-identifier">io_method</span> =  <span class="ruby-identifier">io_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;io_transform&quot;</span>
    <span class="ruby-identifier">io_method_debug</span> =  <span class="ruby-identifier">io_method_debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">debug</span>
    <span class="ruby-identifier">happy_with_request</span> = <span class="ruby-identifier">happy_with_request</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">admit_non_ssl</span> = <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">tcp_ssl_server_args</span> = [
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">io_method</span>,
      [
        <span class="ruby-identifier">io_method_debug</span>,
        <span class="ruby-identifier">happy_with_request</span>,
        <span class="ruby-identifier">http_processing_method</span>,
        <span class="ruby-identifier">http_processing_method_args</span>
      ],
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-string">&quot;yes, output exceptions&quot;</span>,
    ]
    <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> <span class="ruby-identifier">tcp_ssl_server_args</span>
    [ <span class="ruby-identifier">thread</span> ] <span class="ruby-operator">+</span> <span class="ruby-identifier">tcp_ssl_server_args</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests file_read against a uri.</span>
  <span class="ruby-comment"># created to test a client for servers</span>
  <span class="ruby-comment"># created with</span>
  <span class="ruby-comment"># #test__tcp_ssl_server__io_method</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_read__uri_root</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">domain</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
    <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
    <span class="ruby-identifier">admit_non_ssl</span> = <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">nne</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">inspect</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> (<span class="ruby-identifier">admit_non_ssl</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;http://#{domain}:#{http_server_port}/&quot;</span>])).<span class="ruby-identifier">inspect</span>
    <span class="ruby-identifier">response</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;https://#{domain}:#{http_server_port}/&quot;</span>]) <span class="ruby-operator">||</span>
      <span class="ruby-identifier">admit_non_ssl</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;http://#{domain}:#{http_server_port}/&quot;</span>])
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>  <span class="ruby-node">&quot;response{#{response}}response&quot;</span>)
    <span class="ruby-identifier">response</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests test__tcp_ssl_server__io_method, creating two</span>
  <span class="ruby-comment"># servers, one ssl and another plain, redirecting to</span>
  <span class="ruby-comment"># the ssl one. then, opens a client thread with a client</span>
  <span class="ruby-comment"># connecting to the root document of the plain server</span>
  <span class="ruby-comment"># (and in the end being served by the root document of</span>
  <span class="ruby-comment"># the ssl server).</span>
  <span class="ruby-comment"># another thread for the client</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__get_root__plain_redirect</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">tcp_ssl_server_method</span>,
      <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
      <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">io_method</span>,
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">domain</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">no_debug_client</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">tcp_ssl_server_method</span> = <span class="ruby-identifier">tcp_ssl_server_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:test__tcp_ssl_server__io_method</span>
    <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
    <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
    <span class="ruby-identifier">no_debug_client</span> = <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">server_thread</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">tcp_ssl_server_method</span>,
      [
        <span class="ruby-identifier">http_processing_method</span>,
        <span class="ruby-identifier">http_processing_method_args</span>,
        <span class="ruby-identifier">http_server_port</span>,
        <span class="ruby-identifier">http_ip_addr</span>,
        <span class="ruby-identifier">priv_pemfile</span>,
        <span class="ruby-identifier">cert_pem_file</span>,
        <span class="ruby-identifier">extra_cert_pem_files</span>,
        <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
        <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
        <span class="ruby-identifier">happy_with_request</span>,
        <span class="ruby-identifier">io_method</span>,
        <span class="ruby-identifier">io_method_debug</span>,
        <span class="ruby-identifier">admit_non_ssl</span>,
      ]

    <span class="ruby-identifier">thread_2</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> {
      <span class="ruby-identifier">loop</span> {
        <span class="ruby-identifier">response</span> = <span class="ruby-identifier">test__file_read__uri_root</span> [
          <span class="ruby-identifier">domain</span>,
          <span class="ruby-identifier">http_server_port</span>,
          <span class="ruby-identifier">admit_non_ssl</span>,
          <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">negate_me</span>,
        ]
        <span class="ruby-identifier">sleep</span> <span class="ruby-value">2</span>
      }
    }
    <span class="ruby-identifier">server_thread</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">join</span>

    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests test__tcp_ssl_server__io_method and opens</span>
  <span class="ruby-comment"># another thread for the client</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__get_root</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">tcp_ssl_server_method</span>,
      <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
      <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">io_method</span>,
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">domain</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
      <span class="ruby-identifier">no_debug_client</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">tcp_ssl_server_method</span> = <span class="ruby-identifier">tcp_ssl_server_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:test__tcp_ssl_server__io_method</span>
    <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
    <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
    <span class="ruby-identifier">no_debug_client</span> = <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">server_thread</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">tcp_ssl_server_method</span>,
      [
        <span class="ruby-identifier">http_processing_method</span>,
        <span class="ruby-identifier">http_processing_method_args</span>,
        <span class="ruby-identifier">http_server_port</span>,
        <span class="ruby-identifier">http_ip_addr</span>,
        <span class="ruby-identifier">priv_pemfile</span>,
        <span class="ruby-identifier">cert_pem_file</span>,
        <span class="ruby-identifier">extra_cert_pem_files</span>,
        <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
        <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
        <span class="ruby-identifier">happy_with_request</span>,
        <span class="ruby-identifier">io_method</span>,
        <span class="ruby-identifier">io_method_debug</span>,
        <span class="ruby-identifier">admit_non_ssl</span>,
      ]

    <span class="ruby-identifier">thread_2</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> {
      <span class="ruby-identifier">loop</span> {
        <span class="ruby-identifier">response</span> = <span class="ruby-identifier">test__file_read__uri_root</span> [
          <span class="ruby-identifier">domain</span>,
          <span class="ruby-identifier">http_server_port</span>,
          <span class="ruby-identifier">admit_non_ssl</span>,
          <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">negate_me</span>,
        ]
        <span class="ruby-identifier">sleep</span> <span class="ruby-value">2</span>
      }
    }
    <span class="ruby-identifier">server_thread</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">join</span>

    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># experimental stuff coming. usage example:</span>
  <span class="ruby-comment"># ./rubyment.rb  invoke_double p test__shell_send_array__main  &quot;tinga&quot; &quot;&quot; sub in EN </span>
  <span class="ruby-comment"># [&quot;tENga&quot;]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__shell_send_array__main</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">object_to_send</span>,
      <span class="ruby-identifier">reserved</span>,
      <span class="ruby-identifier">method_to_send</span>,
      <span class="ruby-operator">*</span><span class="ruby-identifier">args_to_send</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">object_to_send</span> = <span class="ruby-identifier">object_to_send</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">method_to_send</span> = <span class="ruby-identifier">method_to_send</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:main</span>
    <span class="ruby-identifier">object_to_send</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">object_to_send</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">method_to_send</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args_to_send</span>
    ) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">object_to_send</span>) <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">send</span> <span class="ruby-identifier">method_to_send</span>, <span class="ruby-identifier">args_to_send</span>
    )
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for Object::nne</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__object_nne</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">string_neutral</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">string_non_neutral</span> = <span class="ruby-string">&quot;xxx&quot;</span>
    <span class="ruby-identifier">fixnum_neutral</span> = <span class="ruby-value">0</span>
    <span class="ruby-identifier">fixnum_non_neutral</span> = <span class="ruby-value">1</span>
    <span class="ruby-identifier">array_neutral</span> = []
    <span class="ruby-identifier">array_non_neutral</span> = [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>]
    <span class="ruby-identifier">hash_neutral</span> = {}
    <span class="ruby-identifier">hash_non_neutral</span> = { <span class="ruby-value">1</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> }
    <span class="ruby-identifier">judgement</span> =
      [
        [<span class="ruby-identifier">string_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;string_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">string_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">string_non_neutral</span>, <span class="ruby-string">&quot;string_non_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">fixnum_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;fixnum_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">fixnum_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">fixnum_non_neutral</span>, <span class="ruby-string">&quot;fixnum_non_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">array_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;array_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">array_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">array_non_neutral</span>, <span class="ruby-string">&quot;array_non_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">hash_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;hash_neutral.nne&quot;</span>],
        [<span class="ruby-identifier">hash_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">hash_non_neutral</span>, <span class="ruby-string">&quot;hash_non_neutral.nne&quot;</span>],
      ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># runs a command in a shell (requires &#39;open3&#39;)</span>
  <span class="ruby-comment"># returns stdout and stderr output mixed</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +command+:: [String] command to be executed</span>
  <span class="ruby-comment"># @return [Array] returns an  #Array whose elements are:</span>
  <span class="ruby-comment"># +stdoutanderr+:: [Array of Strings] mix of stdout and stderr output</span>
  <span class="ruby-comment"># +stdin+:: [IO]</span>
  <span class="ruby-comment"># +wait_thr+:: [Thread]</span>
  <span class="ruby-comment"># +success?+:: [TrueClass, FalseClass]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_popen2e_command</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">command</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;open3&quot;</span>
      <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">stdoutanderr</span>, <span class="ruby-identifier">wait_thr</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">popen2e</span>(<span class="ruby-string">&quot;:;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">command</span>)
      [ <span class="ruby-identifier">stdoutanderr</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">wait_thr</span>, <span class="ruby-identifier">wait_thr</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">success?</span> ]
    <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># runs a command in a shell (requires &#39;open3&#39;)</span>
  <span class="ruby-comment"># returns stdout and stderr output separated</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +command+:: [String] command to be executed</span>
  <span class="ruby-comment"># @return [Array] returns an  #Array whose elements are:</span>
  <span class="ruby-comment"># +stdout+:: [Array of Strings] stdout output</span>
  <span class="ruby-comment"># +stderr+:: [Array of Strings] stderr output</span>
  <span class="ruby-comment"># +stdin+:: [IO]</span>
  <span class="ruby-comment"># +wait_thr+:: [Thread]</span>
  <span class="ruby-comment"># +success?+:: [TrueClass, FalseClass]</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_popen3_command</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">command</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;open3&quot;</span>
      <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">stdout</span>, <span class="ruby-identifier">stderr</span>, <span class="ruby-identifier">wait_thr</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">popen3</span>(<span class="ruby-string">&quot;:;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">command</span>)
      [ <span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">wait_thr</span>, <span class="ruby-identifier">wait_thr</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">success?</span> ]
    <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for functions that adds syntatic sugar to</span>
  <span class="ruby-comment"># exceptions.</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__rune_functions</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
    <span class="ruby-identifier">do_rescue</span> = <span class="ruby-string">&quot;rescue&quot;</span>
    <span class="ruby-identifier">do_output</span> = <span class="ruby-string">&quot;output&quot;</span>
    <span class="ruby-identifier">no_rescue</span> = <span class="ruby-string">&quot;no rescue&quot;</span>
    <span class="ruby-identifier">no_output</span> = <span class="ruby-string">&quot;no output&quot;</span>
    <span class="ruby-identifier">actual</span> = {}
    <span class="ruby-identifier">expectation</span> = {}

    <span class="ruby-comment">#working case</span>
    <span class="ruby-identifier">expected_return</span> = [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>]
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_and_output_work</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">do_output</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_but_no_output_work</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:effectless_output_but_no_rescue_work</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">do_output</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:no_output_and_no_rescue_work</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>

    <span class="ruby-comment"># failure cases</span>
    <span class="ruby-identifier">expected_return</span> = <span class="ruby-string">&quot;no_such_method&quot;</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_and_output_fail</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">do_output</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>;  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }[<span class="ruby-value">1</span>].<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_but_no_output_fail</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:effectless_output_but_no_rescue_fail</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">do_output</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NoMethodError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">noMethodError</span>
      <span class="ruby-identifier">noMethodError</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:no_output_and_no_rescue_fail</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NoMethodError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">noMethodError</span>
      <span class="ruby-identifier">noMethodError</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>

    <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
    }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># tests if  +operand_1+ is only</span>
  <span class="ruby-comment"># composed by a repetition of +operand_2+</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +operand_1+:: [String]</span>
  <span class="ruby-comment"># +operand_2+:: [String] </span>
  <span class="ruby-comment"># +min_repetitions+:: [FixNum] minimum of times +operand_2+ is required to appear in +operand_1+ (default: +0+). Note that in +args=[&quot;&quot;, &quot;X&quot;, 0]+, +operand_1=&quot;&quot;+ will be returned, because &quot;&quot; is a composition of +0+ times &quot;X&quot;. </span>
  <span class="ruby-comment"># @return [String, FalseClass] returns +operand_1+ if it is only</span>
  <span class="ruby-comment"># composed by a repetition of +operand_2+, otherwise +false+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">string_repetition</span>  <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">operand_1</span>,
    <span class="ruby-identifier">operand_2</span>,
    <span class="ruby-identifier">min_repetitions</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
    <span class="ruby-identifier">matches</span>  = (<span class="ruby-identifier">operand_1</span>.<span class="ruby-identifier">scan</span> <span class="ruby-identifier">operand_2</span>) <span class="ruby-keyword">rescue</span> []
    <span class="ruby-identifier">amout_of_matches</span> = <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">size</span>
    <span class="ruby-identifier">min_repetitions</span> = <span class="ruby-identifier">min_repetitions</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">is_string_repetition</span> = (
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;(#{amout_of_matches} &gt;= #{min_repetitions}) &amp;&amp; (#{operand_2.size} * #{amout_of_matches} == #{operand_1.size})&#39;</span>)
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;(#{amout_of_matches} &gt;= #{min_repetitions}) &amp;&amp; (#{operand_2.size} * #{amout_of_matches} == #{operand_1.size})&quot;</span>)
      <span class="ruby-comment"># if operand_2 was matched N times, and the sum</span>
      <span class="ruby-comment"># of those N matched sizes is the same</span>
      (<span class="ruby-identifier">amout_of_matches</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">min_repetitions</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">operand_2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">amout_of_matches</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">operand_1</span>.<span class="ruby-identifier">size</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
    ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">operand_1</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{is_string_repetition}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">is_string_repetition</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># operates and/or returns a structure similar to an pushdown automaton.</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +pd+:: [Array] an +Array+ whose elements are :</span>
  <span class="ruby-comment"># +pd.operand+:: [Array] current state</span>
  <span class="ruby-comment"># +pd.stack+:: [Array] state stack</span>
  <span class="ruby-comment"># +operation_plan+:: [Array, Object] +false+ object is interpreted as no operation (only creates a pd). Otherwise, it is an +Array+ whose elements are :</span>
  <span class="ruby-comment">#     reserved_token, reservation_type, token = operation_plan.to_a</span>
  <span class="ruby-comment"># +operation_plan.reserved_token+:: [Object] operates stack if +true+, otherwise, operate +state+</span>
  <span class="ruby-comment"># +operation_plan.reservation_type+:: [Object] pushes stack if +true+ into state, otherwise, pops.</span>
  <span class="ruby-comment"># +operation_plan.token+:: [Object] state operand (element that will be pushed into the current state, when operating +state+)</span>
  <span class="ruby-comment"># +operation_plan.bulk+:: [Object] if calling the object +nne+ method returns a +true+ value, will operate as +operation_plan.token+ is a container of tokens instead. If the object is an +Array+, it will prepend the first element and append to +pd.operand+ after the bulk insertion is done.</span>
  <span class="ruby-comment"># +debug+:: [Object] +debug.nne+ will be used to determine whether to output or not debug information.</span>
  <span class="ruby-comment"># +pd+:: [Array] </span>
  <span class="ruby-comment"># @return [Array] returns the operated (or a new, when no operation) +pd+</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">pushdown_operate</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">pd</span>,
      <span class="ruby-identifier">operation_plan</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

    <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">nne</span> []
    <span class="ruby-identifier">array_operand</span>,
      <span class="ruby-identifier">array_operands_stack</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">pd</span>

    <span class="ruby-identifier">operation_plan</span> = <span class="ruby-identifier">operation_plan</span>.<span class="ruby-identifier">nne</span>

    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;{#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;operation_plan=#{operation_plan.inspect}&quot;</span>)

    <span class="ruby-identifier">array_operands_stack</span> = <span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">nne</span> []
    <span class="ruby-identifier">array_operand</span> = <span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">nne</span> []

    <span class="ruby-identifier">reserved_token</span>,
      <span class="ruby-identifier">reservation_type</span>,
      <span class="ruby-identifier">token</span>,
      <span class="ruby-identifier">reserved_token_symbol</span>,
      <span class="ruby-identifier">bulk</span> = <span class="ruby-identifier">operation_plan</span>.<span class="ruby-identifier">to_a</span>
    <span class="ruby-identifier">bulk</span> = <span class="ruby-identifier">bulk</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reserved_token=#{reserved_token.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reservation_type=#{reservation_type.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;token=#{token.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;bulk=#{bulk.inspect}&quot;</span>)
    <span class="ruby-identifier">operation_plan</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">reserved_token</span> <span class="ruby-operator">&amp;&amp;</span> (
      <span class="ruby-identifier">reservation_type</span> <span class="ruby-operator">&amp;&amp;</span> (
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_up_token: #{token.inspect}&quot;</span>)
        <span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">array_operand</span>
        <span class="ruby-identifier">array_operand</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-keyword">true</span>
      ) <span class="ruby-operator">||</span> (
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_down_token: #{token.inspect}&quot;</span>)
        <span class="ruby-comment"># this approach:</span>
        <span class="ruby-comment">#  array_operand = array_operands_stack.pop.push array_operand</span>
        <span class="ruby-comment"># won&#39;t accept pops when the stack is empty.</span>
        <span class="ruby-comment"># this approach:</span>
        <span class="ruby-comment">#  array_operand = array_operands_stack.pop.to_a.push array_operand</span>
        <span class="ruby-comment"># will work as a &quot;push&quot; was added to the beginning</span>
        <span class="ruby-comment"># another approach (not coded here) would be stop accept</span>
        <span class="ruby-comment"># pushes to *array_operand* (at least when a new</span>
        <span class="ruby-comment"># stack push/token up is done). To keep simplicity,</span>
        <span class="ruby-comment"># the reset approach is done (past is forgotten),</span>
        <span class="ruby-comment"># but the other options are left for the case of a</span>
        <span class="ruby-comment"># future option implementation</span>
        <span class="ruby-identifier">array_operand</span> = (<span class="ruby-identifier">array_operands_stack</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">array_operand</span>) <span class="ruby-keyword">rescue</span> []
        <span class="ruby-keyword">true</span>
      )
    ) <span class="ruby-operator">||</span> <span class="ruby-identifier">operation_plan</span> <span class="ruby-operator">&amp;&amp;</span> (
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;case is_no_token: #{token.inspect}&quot;</span>)

        <span class="ruby-identifier">bulk_token_duck_type_method</span> = <span class="ruby-value">:map</span>
        <span class="ruby-identifier">bulk_token_push</span> = <span class="ruby-identifier">bulk</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">bulk_token_duck_type_method</span>)
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;[bulk, bulk_token_duck_type_method, bulk_token_push]=#{[bulk, bulk_token_duck_type_method, bulk_token_push].inspect}&quot;</span>)
        <span class="ruby-identifier">bulk_token_push</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">token</span>)
        <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">bulk</span>.<span class="ruby-identifier">to_a</span>
        <span class="ruby-identifier">bulk_token_push</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">token</span> = [<span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">append</span>].<span class="ruby-identifier">flatten</span>(<span class="ruby-value">1</span>))
        <span class="ruby-identifier">bulk_token_push</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">token</span>.<span class="ruby-identifier">map</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">array_operand</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:push</span>))
        <span class="ruby-keyword">true</span>
    )
    <span class="ruby-identifier">pd</span> = [<span class="ruby-identifier">array_operand</span>, <span class="ruby-identifier">array_operands_stack</span>]
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{pd.inspect}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning}&quot;</span>)
    <span class="ruby-identifier">pd</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># will take a flatten array and makes it deeper, starting a new array</span>
  <span class="ruby-comment"># everytime it finds the string +&quot;[&quot;+. +&quot;]&quot;+ stops the array (and</span>
  <span class="ruby-comment"># return to the upper one). To reserve the possibility of</span>
  <span class="ruby-comment"># representing &quot;[&quot; or &quot;]&quot;, everytime a string contains only those</span>
  <span class="ruby-comment"># chars, repeteaded any number of times, starting from 2, one of</span>
  <span class="ruby-comment"># them will be removed. So +&quot;[[&quot;+ will be left as +&quot;[&quot;+ and</span>
  <span class="ruby-comment"># +&quot;]]]&quot;+ will be left as +&quot;]]&quot;+.</span>
  <span class="ruby-comment"># if the provided array is not flatten, it has an undefined</span>
  <span class="ruby-comment"># behaviour (it will either a - transverse the sub-arrays</span>
  <span class="ruby-comment"># or b - don&#39;t transverse it, leaving it untouched. while</span>
  <span class="ruby-comment"># the a is the planned effect, initially only a may will</span>
  <span class="ruby-comment"># be implemented) (currently this behaviour is easily configurable</span>
  <span class="ruby-comment"># by the value +deep+, hardcoded in the function. soon, new</span>
  <span class="ruby-comment"># functions will come to clarify and specify the proper behaviours)</span>
  <span class="ruby-comment"># @param [Array] +args+, an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +flatten_array+:: [Array] the array to be operated.</span>
  <span class="ruby-comment"># +debug+:: [Object] if evals to false (or empty string), won&#39;t print debug information</span>
  <span class="ruby-comment"># +shallow+:: [Object] if evals to false (or empty string), will traverse recursively +flatten_array+ and apply the rules, in the case it is not flatten.</span>
  <span class="ruby-comment"># +reserved_tokens+:: [Array of Arrays]</span>
  <span class="ruby-comment"># +inverse+:: [Object] if calling the object +nne+ method returns a +false+ value, will operate this function inversely: will take a unflatten array and flatten it, applying the inverse escaping rules (note that any object responding to +:map+ will be considered an array in +flatten_array+).</span>
  <span class="ruby-comment"># +debug_pushdown+:: [Object] if evals to false (or empty string), won&#39;t print debug information about the call #pushdown_operated</span>
<span class="ruby-comment"># +inversion_envelope+::  [Array, nil], if +nil+, the first colum of +reserved_tokens+ will be used. if an +Array+ whose elements are expected to be:</span>
  <span class="ruby-comment"># +inversion_envelope.prepend+::  [Object] when an inversion occurrs, this element will be prepended when a new object responding to +:map+, like +Array+ is found.</span>
  <span class="ruby-comment"># +inversion_envelope.append+::  [Object] when an inversion occurrs, this element will be prepended when a new object responding to +:map+, like +Array+ is found.</span>
  <span class="ruby-comment"># @return [Array] returns the modified, deep, #Array</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">array_unflatten_base</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">flatten_array</span>,
      <span class="ruby-identifier">shallow</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">reserved_tokens</span>,
      <span class="ruby-identifier">inverse</span>,
      <span class="ruby-identifier">debug_pushdown</span>,
      <span class="ruby-identifier">inversion_envelope</span>,
      <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">reserved_tokens</span> = <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">nne</span> [
      [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:up</span>],
      [ <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>],
    ]
    <span class="ruby-identifier">inversion_envelope</span> = <span class="ruby-identifier">inversion_envelope</span>.<span class="ruby-identifier">nne</span>(
      <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">transpose</span>.<span class="ruby-identifier">first</span>
    )
    <span class="ruby-identifier">inverse</span> = <span class="ruby-identifier">inverse</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">shallow</span> = <span class="ruby-identifier">shallow</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug_pushdown</span> = <span class="ruby-identifier">debug_pushdown</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;{#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
    <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pushdown_operate</span>
    <span class="ruby-identifier">flatten_array</span>.<span class="ruby-identifier">each_with_index</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">e</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;-------------------&quot;</span>)
      <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;[e, index]=#{[e, index].inspect}&quot;</span>)
      <span class="ruby-identifier">shallow</span>.<span class="ruby-identifier">negate_me</span> <span class="ruby-operator">&amp;&amp;</span> (
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;e.hash=#{e.hash}&quot;</span>)
        <span class="ruby-identifier">args_recursion</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">clone</span>
        <span class="ruby-identifier">args_recursion</span>[<span class="ruby-value">0</span>] = <span class="ruby-identifier">e</span>
        <span class="ruby-identifier">e</span> = (<span class="ruby-identifier">send</span> <span class="ruby-identifier">__method__</span>, <span class="ruby-identifier">args_recursion</span>) <span class="ruby-keyword">rescue</span> ( <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} finished with exception }&quot;</span> ) ; <span class="ruby-identifier">e</span>)
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;e.hash=#{e.hash}&quot;</span>)
      )
      <span class="ruby-identifier">operations</span> = <span class="ruby-identifier">reserved_tokens</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">reserved_token</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;reserved_token=#{reserved_token.inspect}&quot;</span>)
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;array_operands_stack=#{pd[1].inspect}&quot;</span>)
        <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;array_operand=#{pd.first.inspect}&quot;</span>)
        <span class="ruby-identifier">rtoken</span>, <span class="ruby-identifier">is_up_token</span> = <span class="ruby-identifier">reserved_token</span>

        <span class="ruby-identifier">repetition_test</span> = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-value">1</span>]
        (
          <span class="ruby-comment"># case A: e is exactly the reserved token.</span>
          <span class="ruby-comment"># start or finish an array</span>
          <span class="ruby-comment"># note: if rtoken is false, it will succeed this</span>
          <span class="ruby-comment"># test.</span>
          (<span class="ruby-identifier">repetition_test</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rtoken</span>) <span class="ruby-operator">&amp;&amp;</span> (
            <span class="ruby-identifier">inverse</span>  <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">e</span> = (<span class="ruby-identifier">e</span>.<span class="ruby-identifier">sub!</span> <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">rtoken</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">e</span>)
            <span class="ruby-identifier">is_up_token</span> <span class="ruby-operator">&amp;&amp;</span> (
              <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case is_up_token&quot;</span>)
              [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>(<span class="ruby-identifier">inverse</span>), <span class="ruby-value">:up</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
            ) <span class="ruby-operator">||</span> (
              <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case is_down_token&quot;</span>)
              [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>(<span class="ruby-identifier">inverse</span>), <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
            )
          )
        ) <span class="ruby-operator">||</span> (
          <span class="ruby-comment"># case B: is a a repetition with at least 2</span>
          <span class="ruby-comment"># occurrences of the reserved token. remove one.</span>
          <span class="ruby-comment"># (and add it to the current array)</span>
          <span class="ruby-identifier">repetition_test</span> <span class="ruby-operator">&amp;&amp;</span> (
            <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case escape&quot;</span>)
            <span class="ruby-comment"># room for improvement: and if array had sub! ?</span>
            <span class="ruby-operator">!</span><span class="ruby-identifier">inverse</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">escaped_e</span> = (<span class="ruby-identifier">e</span>.<span class="ruby-identifier">sub!</span> <span class="ruby-identifier">rtoken</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">e</span>)
            [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">escaped_e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-keyword">false</span> ]
          )
        ) <span class="ruby-operator">||</span> (
          <span class="ruby-comment"># case C: no repetition. (just add e to</span>
          <span class="ruby-comment"># the current array.)</span>
            <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;case just add&quot;</span>)
            [<span class="ruby-value">:reserved_token</span>.<span class="ruby-identifier">negate_me</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">rtoken</span>, <span class="ruby-identifier">inverse</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">inversion_envelope</span> ]
        )
      }
      <span class="ruby-comment"># now operations has |reserved_tokens| operations.</span>
      <span class="ruby-comment"># but only one will be applied: either the first</span>
      <span class="ruby-comment"># one which is a reserved token (:first), or the</span>
      <span class="ruby-comment"># last operation, in case of no reserved tokens.</span>
      <span class="ruby-identifier">operation</span> = <span class="ruby-identifier">operations</span>.<span class="ruby-identifier">lazy</span>.<span class="ruby-identifier">find</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:first</span>) <span class="ruby-operator">||</span> (
        <span class="ruby-identifier">operations</span>[<span class="ruby-value">-1</span>].<span class="ruby-identifier">to_a</span>
      )
      <span class="ruby-identifier">reserved_token</span>, <span class="ruby-identifier">reservation_type</span>, <span class="ruby-identifier">token</span> = <span class="ruby-identifier">operation</span>
      <span class="ruby-identifier">pd</span> = <span class="ruby-identifier">pushdown_operate</span> [<span class="ruby-identifier">pd</span>, <span class="ruby-identifier">operation</span>, <span class="ruby-identifier">debug_pushdown</span>]
    }
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{pd.first}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning}&quot;</span>)
    <span class="ruby-identifier">pd</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># takes a flatten array and makes it deeper, starting a new array</span>
  <span class="ruby-comment"># everytime it finds the string +&quot;[&quot;+. +&quot;]&quot;+ stops the array (and</span>
  <span class="ruby-comment"># return to the upper one). To reserve the possibility of</span>
  <span class="ruby-comment"># representing &quot;[&quot; or &quot;]&quot;, everytime a string contains only those</span>
  <span class="ruby-comment"># chars, repeteaded any number of times, starting from 2, one of</span>
  <span class="ruby-comment"># them will be removed. So +&quot;[[&quot;+ will be left as +&quot;[&quot;+ and</span>
  <span class="ruby-comment"># +&quot;]]]&quot;+ will be left as +&quot;]]&quot;+.</span>
  <span class="ruby-comment"># if the provided array is not flatten, it won&#39;t be transversed.</span>
  <span class="ruby-comment"># @param [Array] +args+, the array to be operadated</span>
  <span class="ruby-comment"># @return [Array] returns the modified, deep, #Array</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">array_unflatten_base_shallow</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
    <span class="ruby-identifier">deep</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">reserved_tokens</span> = [
      [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:up</span>],
      [ <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:up</span>.<span class="ruby-identifier">negate_me</span>],
    ]
    <span class="ruby-comment"># debug = 1</span>
    <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
    <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)

    <span class="ruby-identifier">rv</span> = <span class="ruby-identifier">array_unflatten_base</span> [
      <span class="ruby-identifier">args</span>,
      <span class="ruby-identifier">deep</span>.<span class="ruby-identifier">negate_me</span>,
      <span class="ruby-identifier">debug</span>,
      <span class="ruby-identifier">reserved_tokens</span>,
    ]

    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{rv}&quot;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
    <span class="ruby-identifier">rv</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># generic function for test__ functions</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">expectation</span> = {}
    <span class="ruby-identifier">actual</span> = {}
    <span class="ruby-identifier">test_cases</span> = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
     <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
    ]
    <span class="ruby-identifier">test_cases</span>.<span class="ruby-identifier">each_with_index</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">test_case_id</span>, <span class="ruby-identifier">test_expectation</span>, <span class="ruby-identifier">actual_params</span> = <span class="ruby-identifier">test_case</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">actual_params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">actual_params</span>[<span class="ruby-value">1</span>]
      <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case_id</span>] = <span class="ruby-identifier">test_expectation</span>
      <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case_id</span>] = <span class="ruby-identifier">result</span>
    }
    <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
    }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for #array_unflatten_base_shallow</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__array_unflatten_base_shallow</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
      <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
      [
        <span class="ruby-string">&quot;base_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_escape_case&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_open_right_case&quot;</span>, [ <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_open_left_case&quot;</span>, [ <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_double&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_inverted&quot;</span>, [ <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_mixed_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>,  ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base_shallow</span>, [
             <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
           ]
        ],
      ],


    ]
    <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">test_cases</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-comment"># test for #array_unflatten_base</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__array_unflatten_base</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
      <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
      [
        <span class="ruby-string">&quot;base_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_escape_case&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_open_right_case&quot;</span>, [ <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_open_left_case&quot;</span>, [ <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_double&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_inverted&quot;</span>, [ <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_mixed_nested_case_deep&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ [ <span class="ruby-value">:b</span>, ] ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;base_mixed_nested_case_shallow&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>,  ] ], <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span> ],
             <span class="ruby-value">:shallow</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span>, ], <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_case_double_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, [[ <span class="ruby-value">:b</span>, ]], <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_escape_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],

      [
        <span class="ruby-string">&quot;base_mixed_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],


      [
        <span class="ruby-string">&quot;open_left_base_mixed_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
           <span class="ruby-value">:array_unflatten_base</span>, [
             [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
             <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
             <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
             <span class="ruby-value">:inverse</span>,
           ]
        ],
      ],


    ]
    <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">test_cases</span>
  <span class="ruby-keyword">end</span>


<span class="ruby-comment">
  # short_desc = &quot;tests the function #string_repetion&quot;
  @memory[:documentation].push = {
    :function   =&gt; :test__string_repetition,
    :short_desc =&gt; short_desc,
    :params     =&gt; [
      {
        :name             =&gt; :args,
        :description      =&gt; &quot;list of parameters&quot;,
        :duck_type        =&gt; Array,
        :default_behavior =&gt; &quot;interpreted as empty array&quot;,
        :params           =&gt; [
          {              
            :name             =&gt; :reserved,
            :duck_type        =&gt; Object,
            :default_behavior =&gt; &quot;interpreted as nil&quot;,
            :description      =&gt; &quot;for future use&quot;,
          },
        ],
      },
    ],
  }


</span>  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test__string_repetition</span> <span class="ruby-identifier">args</span>=[]
    <span class="ruby-identifier">expectation</span> = {}
    <span class="ruby-identifier">actual</span> = {}
    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">1</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XXX&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-comment"># expectation and actual inverted.</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">2</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">3</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">4</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XXyy&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">6</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">0</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">7</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">1</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">7</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">0</span>]
    <span class="ruby-comment"># &quot;X&quot;*0 = &quot;&quot;</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">8</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">1</span>]
    <span class="ruby-comment"># &quot;X&quot;*0 = &quot;&quot;, but minimum is set to 1</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">9</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;Xy&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">10</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-comment"># clearly &quot;&quot; appears in &quot;XyXy&quot; infinity times, but &quot;XyXy&quot; is no</span>
    <span class="ruby-comment"># repetition of &quot;&quot;</span>
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">11</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;Xy&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">12</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;X&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XXX&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">13</span>
    <span class="ruby-identifier">operand_1</span> = [<span class="ruby-value">:b</span>]
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;]&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">test_case</span> = <span class="ruby-value">14</span>
    <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;[:b]&quot;</span>
    <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;]&quot;</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

    <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
      [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
    }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  <span class="ruby-keyword">end</span>



<span class="ruby-keyword">end</span>


<span class="ruby-keyword">class</span> <span class="ruby-constant">Rubyment</span>
   <span class="ruby-identifier">include</span> <span class="ruby-constant">RubymentModule</span>
<span class="ruby-keyword">end</span>

(<span class="ruby-keyword">__FILE__</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">$0</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Rubyment</span>.<span class="ruby-identifier">new</span>({<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ARGV</span>})
</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_enc_output" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_enc_output</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>outputs the results from enc</p>
          
          

          
          <div class="method-source-code" id="shell_enc_output-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1296</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_enc_output</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">enc_iv_base64_filename_deprecated</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">base64_iv</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">base64_encrypted</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span>  <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">base64_encrypted</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_popen2e_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_popen2e_command</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>runs a command in a shell (requires &#39;open3&#39;) returns stdout and
stderr output mixed @param [Array] <code>args</code>, an <code>Array</code>
whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>command</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>command to be executed</p>
</dd></dl>
</dd></dl>

<p>@return [Array] returns an  #Array whose elements are:</p>
<dl class="rdoc-list note-list"><dt><code>stdoutanderr</code>
<dd><dl class="rdoc-list label-list"><dt>Array of Strings
<dd>
<p>mix of stdout and stderr output</p>
</dd></dl>
</dd><dt><code>stdin</code>
<dd><dl class="rdoc-list label-list"><dt>IO
<dd></dd></dl>
</dd><dt><code>wait_thr</code>
<dd><dl class="rdoc-list label-list"><dt>Thread
<dd></dd></dl>
</dd><dt><code>success?</code>
<dd><dl class="rdoc-list label-list"><dt><a href="TrueClass.html">TrueClass</a>, FalseClass
<dd></dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="shell_popen2e_command-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3728</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_popen2e_command</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">command</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;open3&quot;</span>
    <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">stdoutanderr</span>, <span class="ruby-identifier">wait_thr</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">popen2e</span>(<span class="ruby-string">&quot;:;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">command</span>)
    [ <span class="ruby-identifier">stdoutanderr</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">wait_thr</span>, <span class="ruby-identifier">wait_thr</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">success?</span> ]
  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_popen3_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_popen3_command</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>runs a command in a shell (requires &#39;open3&#39;) returns stdout and
stderr output separated @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>command</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>command to be executed</p>
</dd></dl>
</dd></dl>

<p>@return [Array] returns an  #Array whose elements are:</p>
<dl class="rdoc-list note-list"><dt><code>stdout</code>
<dd><dl class="rdoc-list label-list"><dt>Array of Strings
<dd>
<p>stdout output</p>
</dd></dl>
</dd><dt><code>stderr</code>
<dd><dl class="rdoc-list label-list"><dt>Array of Strings
<dd>
<p>stderr output</p>
</dd></dl>
</dd><dt><code>stdin</code>
<dd><dl class="rdoc-list label-list"><dt>IO
<dd></dd></dl>
</dd><dt><code>wait_thr</code>
<dd><dl class="rdoc-list label-list"><dt>Thread
<dd></dd></dl>
</dd><dt><code>success?</code>
<dd><dl class="rdoc-list label-list"><dt><a href="TrueClass.html">TrueClass</a>, FalseClass
<dd></dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="shell_popen3_command-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3747</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_popen3_command</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">command</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;open3&quot;</span>
    <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">stdout</span>, <span class="ruby-identifier">stderr</span>, <span class="ruby-identifier">wait_thr</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">popen3</span>(<span class="ruby-string">&quot;:;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">command</span>)
    [ <span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">entries</span>, <span class="ruby-identifier">stdin</span>, <span class="ruby-identifier">wait_thr</span>, <span class="ruby-identifier">wait_thr</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">success?</span> ]
  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shell_string_in_columns" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell_string_in_columns</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>planned changes: use stdin from memory instead</p>
          
          

          
          <div class="method-source-code" id="shell_string_in_columns-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 859</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shell_string_in_columns</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">time</span>   = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:time</span>]
  <span class="ruby-identifier">number_of_columns</span> = <span class="ruby-identifier">input_shift</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">text</span> = <span class="ruby-identifier">input_non_empty_filepath_or_contents_or_multiline_prompt</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">puts</span> (<span class="ruby-identifier">string_in_columns</span> <span class="ruby-identifier">text</span>, <span class="ruby-identifier">number_of_columns</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ssl_make_server" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssl_make_server</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>makes an OpenSSL server  just an interface to the more powerful recommended
<a
href="RubymentModule.html#method-i-ssl_make_servers">ssl_make_servers</a>
(kept for respecting open-closed principle) @param [splat]
<code>args</code>, an splat whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>listening_port</code>
<dd><dl class="rdoc-list label-list"><dt>String, Integer
<dd>
<p>port to listen</p>
</dd></dl>
</dd><dt><code>ip_addr</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ip (no hostname) to bind the server. 0, nil, false, empty string will bind
to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all
ipv4 and ipv6</p>
</dd></dl>
</dd><dt><code>admit_plain</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>if <code>true</code>, tries to create a normal <code>TCPServer</code>, if
not possible to create <code>SSLServer</code> (default: <code>false</code>,
for preventing unadvertnt non-SSL server creation)</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>for future use</p>
</dd></dl>
</dd><dt><code>priv_pemfile</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>argument to be given to <code>OpenSSL::SSL::SSLContext.key</code> method,
after calling <code>OpenSSL::PKey::RSA.new</code> with it. It&#39;s the
private key file. letsencrypt example:
+“/etc/letsencrypt/live/#{domain}/privkey.pem”+ (now it&#39;s accepted to
pass the file contents instead, both must work).</p>
</dd></dl>
</dd><dt><code>cert_pem_file</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>argument to be given to <code>OpenSSL::SSL::SSLContext.cert</code> method,
after calling <code>OpenSSL::X509::Certificate</code>.  It&#39;s the
“Context certificate” accordingly to its ruby-doc page. letsencrypt
example: +“/etc/letsencrypt/live/#{domain}/fullchain.pem”+ (now it&#39;s
accepted to pass the file contents instead, both must work).</p>
</dd></dl>
</dd><dt><code>extra_cert_pem_files</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>array of strings. Each string will be mapped with
<code>OpenSSL::SSL::SSLContext.new</code>, and the resulting array is given
to <code>OpenSSL::SSL::SSLContext.extra_chain_cert</code>. “An Array of
extra X509 certificates to be added to the certificate chain” accordingly
to its ruby-doc. letsencryptexample:
+[“/etc/letsencrypt/live/#{domain}/chain.pem”]+ (now it&#39;s accepted to
pass the file contents instead, both must work).</p>
</dd></dl>
</dd><dt><code>output_exception</code>
<dd><dl class="rdoc-list label-list"><dt>Bool
<dd>
<p>output exceptions even if they are admitted?</p>
</dd></dl>
</dd><dt><code>plain_server</code>
<dd><dl class="rdoc-list label-list"><dt>TCPServer
<dd>
<p>if given, ignores <code>listening_port</code> and <code>ip_addr</code>,
does not create a <code>TCPServer</code> and just creates an
<code>SSLServer</code> out of this one.</p>
</dd></dl>
</dd></dl>

<p>@return [OpenSSL::SSL::SSLServer] returns an ssl server, which can be used
to accept connections.</p>
          
          

          
          <div class="method-source-code" id="ssl_make_server-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2945</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_make_server</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">admit_plain</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">output_exception</span>,
    <span class="ruby-identifier">plain_server</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">rv</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
    <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">admit_plain</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">output_exception</span>,
    <span class="ruby-identifier">plain_server</span>,
  ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{rv}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-identifier">rv</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ssl_make_servers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssl_make_servers</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>makes one or more OpenSSL server @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>listening_port</code>
<dd><dl class="rdoc-list label-list"><dt>String, Integer
<dd>
<p>port to listen</p>
</dd></dl>
</dd><dt><code>ip_addr</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ip (no hostname) to bind the server. 0, nil, false, empty string will bind
to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all
ipv4 and ipv6</p>
</dd></dl>
</dd><dt><code>admit_plain</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>if <code>true</code>, tries to create a normal <code>TCPServer</code>, if
not possible to create <code>SSLServer</code> (default: <code>false</code>,
for preventing unadvertnt non-SSL server creation)</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>for future use</p>
</dd></dl>
</dd><dt><code>priv_pemfile</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>argument to be given to <code>OpenSSL::SSL::SSLContext.key</code> method,
after calling <code>OpenSSL::PKey::RSA.new</code> with it. It&#39;s the
private key file. letsencrypt example:
+“/etc/letsencrypt/live/#{domain}/privkey.pem”+ (now it&#39;s accepted to
pass the file contents instead, both must work).</p>
</dd></dl>
</dd><dt><code>cert_pem_file</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd>
<p>argument to be given to <code>OpenSSL::SSL::SSLContext.cert</code> method,
after calling <code>OpenSSL::X509::Certificate</code>.  It&#39;s the
“Context certificate” accordingly to its ruby-doc page. letsencrypt
example: +“/etc/letsencrypt/live/#{domain}/fullchain.pem”+ (now it&#39;s
accepted to pass the file contents instead, both must work).</p>
</dd></dl>
</dd><dt><code>extra_cert_pem_files</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>array of strings. Each string will be mapped with
<code>OpenSSL::SSL::SSLContext.new</code>, and the resulting array is given
to <code>OpenSSL::SSL::SSLContext.extra_chain_cert</code>. “An Array of
extra X509 certificates to be added to the certificate chain” accordingly
to its ruby-doc. letsencryptexample:
+[“/etc/letsencrypt/live/#{domain}/chain.pem”]+ (now it&#39;s accepted to
pass the file contents instead, both must work).</p>
</dd></dl>
</dd><dt><code>output_exception</code>
<dd><dl class="rdoc-list label-list"><dt>Bool
<dd>
<p>output exceptions even if they are admitted?</p>
</dd></dl>
</dd><dt><code>plain_servers</code>
<dd><dl class="rdoc-list label-list"><dt>TCPServer, Array of TCPServer
<dd>
<p>if given, ignores <code>listening_port</code> and <code>ip_addr</code>,
does not create a <code>TCPServer</code> and just creates an
<code>SSLServer</code> out of this one. If an <code>Array</code> of
<code>TCPServer</code> is provided instead, it will create one
<code>SSLServer</code> to each of those <code>TCPServer</code>.</p>
</dd></dl>
</dd></dl>

<p>@return [Array] returns an  #Array whose elements are:</p>
<dl class="rdoc-list note-list"><dt><code>servers</code>
<dd><dl class="rdoc-list label-list"><dt>Array of OpenSSL::SSL::SSLServer or of TCPServer
<dd>
<p>depending on <code>admit_plain</code> and in the success of the creation of
<code>SSLServers</code>.</p>
</dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="ssl_make_servers-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2868</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_make_servers</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">admit_plain</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">output_exception</span>,
    <span class="ruby-identifier">plain_servers</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">extra_cert_pem_files</span> = <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> []
  <span class="ruby-identifier">admit_plain</span> = <span class="ruby-identifier">admit_plain</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">output_exception</span> = (
    <span class="ruby-identifier">output_exception</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">admit_plain</span>.<span class="ruby-identifier">negate_me</span>
  )
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-comment"># openssl functions want contents, not filenames:</span>
  <span class="ruby-identifier">extra_cert_pem_files</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>
    .<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">extra_cert_pem_file</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">file_read</span> [
        <span class="ruby-identifier">extra_cert_pem_file</span>,
        <span class="ruby-keyword">nil</span>,
        <span class="ruby-keyword">nil</span>,
        <span class="ruby-identifier">extra_cert_pem_file</span>
      ]
    }
  <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_pem_file</span>]
  <span class="ruby-identifier">priv_pemfile</span>  = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">priv_pemfile</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">priv_pemfile</span>]
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;socket&#39;</span>
  <span class="ruby-identifier">plain_servers</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">ip_addr</span>, <span class="ruby-identifier">listening_port</span>
  <span class="ruby-identifier">plain_servers</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">plain_servers</span>

  <span class="ruby-identifier">servers</span> = <span class="ruby-identifier">plain_servers</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">plain_server</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ssl_server</span> = <span class="ruby-identifier">runea</span> [
      <span class="ruby-identifier">admit_plain</span>,
      <span class="ruby-identifier">output_exception</span>,
      <span class="ruby-string">&quot;nil on exception&quot;</span>] {
        <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;openssl&#39;</span>
        <span class="ruby-identifier">ssl_context</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLContext</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">extra_chain_cert</span> =
          <span class="ruby-identifier">extra_cert_pem_files</span>
            .<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:new</span>))
        <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">cert</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>
          .<span class="ruby-identifier">new</span> <span class="ruby-identifier">cert_pem_file</span>
        <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">key</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>
          .<span class="ruby-identifier">new</span> <span class="ruby-identifier">priv_pemfile</span>
        <span class="ruby-identifier">ssl_server</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLServer</span>
          .<span class="ruby-identifier">new</span> <span class="ruby-identifier">plain_server</span>, <span class="ruby-identifier">ssl_context</span>
        <span class="ruby-identifier">ssl_server</span>
    }
    <span class="ruby-identifier">server</span> = <span class="ruby-identifier">ssl_server</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">admit_plain</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">plain_server</span>
  }
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{[servers]}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  [<span class="ruby-identifier">servers</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ssl_sample_self_signed_cert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssl_sample_self_signed_cert</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a sample self signed certificate-private key pair that once was
created with the command (no password, no expire date): + openssl req -x509
-nodes -newkey rsa:1024 -keyout pkey.pem -out cert.crt+ @param [splat]
<code>args</code>::, an splat whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>reserved</code>
<dd><dl class="rdoc-list label-list"><dt>splat
<dd>
<p>reserved for future use</p>
</dd></dl>
</dd></dl>

<p>@return [Array] where the first element is a certificate (suitable to be
the contents of <code>cert_pem_file</code>  in <a
href="RubymentModule.html#method-i-ssl_make_server">ssl_make_server</a>)
and the second a private key (suitable to be the contents of
<code>priv_pemfile</code> in <a
href="RubymentModule.html#method-i-ssl_make_server">ssl_make_server</a>)</p>
          
          

          
          <div class="method-source-code" id="ssl_sample_self_signed_cert-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3220</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
    <span class="ruby-identifier">self_signed_certificate</span> = <span class="ruby-value">&lt;&lt;-ENDHEREDOC
-----BEGIN CERTIFICATE-----
MIICWDCCAcGgAwIBAgIJAPa0EXsH2MwsMA0GCSqGSIb3DQEBCwUAMEUxCzAJBgNV
BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX
aWRnaXRzIFB0eSBMdGQwHhcNMTgwNjI3MDkzMTEyWhcNMTgwNzI3MDkzMTEyWjBF
MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50
ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKB
gQCplOo6dvbM1650qMYLQ8tRycYlHEZH95kUR5E5EEA8yqgimBtx6InpGQi/PejK
tk+IXbDrxinXMXqjZxAhCjd7+frSUFwUTZ669PuRaptlkjV1KojXBW5kRERAgYId
H7z7QRuK/gWHqTt9zl3WpW2spfWjHY+cnkYdZIWqDBOggwIDAQABo1AwTjAdBgNV
HQ4EFgQUAIq0u116/WmTFQ8HC7/XrKl6wB8wHwYDVR0jBBgwFoAUAIq0u116/WmT
FQ8HC7/XrKl6wB8wDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOBgQBgA9ID
JcreAgjYLxiaAd7fCfLQ1/RYM8YdP9R4Lzg2cu0dCjXoLZqzAEwUg424rPOvf0Pj
wnZ3DFJkg1CoN2fH3yLXQ75mhfM7PJXeWoWLTS2wIG/+VIVI+nKJU0RPOM87Mdlq
+b6TI5LsGxlJhaxTmzPtkHZLIRdW6iCJTwP+5Q==
-----END CERTIFICATE-----
   ENDHEREDOC</span>
   <span class="ruby-identifier">private_key</span> = <span class="ruby-value">&lt;&lt;-ENDHEREDOC
-----BEGIN PRIVATE KEY-----
MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAKmU6jp29szXrnSo
xgtDy1HJxiUcRkf3mRRHkTkQQDzKqCKYG3HoiekZCL896Mq2T4hdsOvGKdcxeqNn
ECEKN3v5+tJQXBRNnrr0+5Fqm2WSNXUqiNcFbmRERECBgh0fvPtBG4r+BYepO33O
Xdalbayl9aMdj5yeRh1khaoME6CDAgMBAAECgYB+Z80spU6UJFUbCk8NSIx+u6ui
L/BHZs1Ja4tZgL6RUfKATuduQgrCoPF/NBOZPsoL+OKO7Nh1WqFyubkxF5+A6BlI
BRe/E4K3cChBWyR5ZQyldYUNVV1HBrAhpurW/OX7FInPGo0I5TkR/CJt6xZPgK1n
4lNXFV29gz/LPTJN4QJBANxnUn2xbtBH0xaTX4iIGEH2keLaUftg0b29Ou/MIPn3
+z7Ln9K6eknf/OGXAvBP2cnWkTGXAOBmB95s9XDrORMCQQDE+FcWTlSKFywFaxhp
nVkDOL+k7Vpn/rKvqKB3JQOrPkovPSo/CHsUVe/r2NEsdJt1SKOs0/xzNe7wSXBa
1tjRAkAHVbTsE+yRJ+LBfJQQUh8kitUeDI/v4q/4NYTxmAR87SDCXTprY+NP9BFR
XJovbyjbS7W3RcQ0s5CNeWjNojZbAkA5u3SDJDhhNUOA3xALvMPfTt3VMICkJKIp
HGrUITQ/GAXUbMAaM5knr7yfyzAcMJ10NfNLb+L5veAn686TwY9RAkArqoX6cWrd
GflH+FhUggqgVrr9XaXkpPUxcpNqAQH/3Yl5pt9jV2VE7eD3chijMGzGJrMUsqFG
n8mFEtUKobsK
-----END PRIVATE KEY-----
   ENDHEREDOC</span>
   [<span class="ruby-identifier">self_signed_certificate</span>, <span class="ruby-identifier">private_key</span>]
  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ssl_sample_self_signed_cert_encrypted" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ssl_sample_self_signed_cert_encrypted</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>has the same functionality as <a
href="RubymentModule.html#method-i-ssl_sample_self_signed_cert">ssl_sample_self_signed_cert</a>.
this one is left as an example on how safely place a certificate/private
key pair inside this code, instead of leaving it in plain or somewhere in
your filesystem. @param [splat] <code>args</code>::, an splat whose
elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>reserved</code>
<dd><dl class="rdoc-list label-list"><dt>splat
<dd>
<p>reserved for future use</p>
</dd></dl>
</dd></dl>

<p>@return [Array] where the first element is a certificate (suitable to be
the contents of <code>cert_pem_file</code>  in <a
href="RubymentModule.html#method-i-ssl_make_server">ssl_make_server</a>)
and the second a private key (suitable to be the contents of
<code>priv_pemfile</code> in <a
href="RubymentModule.html#method-i-ssl_make_server">ssl_make_server</a>)</p>
          
          

          
          <div class="method-source-code" id="ssl_sample_self_signed_cert_encrypted-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3269</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-string">&quot;onlyNSAknows&quot;</span>
  <span class="ruby-comment"># generated with:</span>
  <span class="ruby-comment"># test__enc_dec_interactive [</span>
  <span class="ruby-comment">#   ssl_sample_self_signed_cert[0],</span>
  <span class="ruby-comment">#   password,</span>
  <span class="ruby-comment"># ]:</span>
   <span class="ruby-identifier">self_signed_certificate</span> = <span class="ruby-identifier">dec_interactive</span> [
    <span class="ruby-string">&quot;owdfr76MvIhPb05PLsPiTw==\n&quot;</span>,
    <span class="ruby-string">&quot;R1QSJSUmfXVB4ET2r5C2MN3MZC75V9Pi7nWl8+lTZ363IJOYK4/DJkKL0Y58\nMo8fp1mvoq0fjhCSdHqld6IMWxFXW3kzXGyuVScfbRbvYV83AAhmq+HTscUE\nYJLsfnUqTzGKN/AB/Kr1x3kIsZsb9oNSQMk3dFHV89AM9Z1d30ZMgtW8mn/c\nTHmxsLaFgKvg8bT9t+ERBr85bmJuphkDBlAc4hP2KS/xTFeKB1QL/lJ/oF9j\ncUmb5uWdmZ0REzLyYu9F1MfHv0lwENi+oJYW50lo7DUTYHnyKxYRo+rlUsDF\n0nyS4wcPQVxvY1vDrC34pFdMtcXLQTzzbAiyJx73fT7WfY40MNNKRZfz/zlG\nl/d4ILNlW43/fVnOwg4yZ1tGT1PovrDs1c8Mxu7zm0QCT7+Dp+nN0zes5K8A\n2aYIsR7Nvm+3OeKrRf2JXHv8J/10NEcPfuYocmitlzrr6yM3+4xMXM94Zt/7\n4+vONht+xOhOxUmJufC4HNOmqszX1480dL96qfhc9zXlvxpbD4DGkgU0AR17\nt1C6XNqI0jQxxDMQa0jn0HsX5C9dmtqunLIz8ZkgfSNJbsOtVYVS11YuXk+k\nbEdVimP6DT1x0KZ+UxpxOFJcuvtM6eBe3aMWRjlIf/xjobJ2GP9OlDq1hPJe\n+zz1lhUxobFZiqSIrVbYz8u6ZuvVSEa8NfQJ+GpE1poExzBAsM5RjSMWK0Yr\nLnasLNQwJkYoDlmZBNOX30pCaZPmLl9xLaJphIeHOcmNL0e209hST4H5s1oZ\np/k+sk/jgqtc6jVBeMVwSEDHLl4F4hiNHqeqW72bim7XlkbVjaZ8Q66hUCK/\nKBlJ9YH4QCm3zN4ZQtoTOwu7G8+GeO46ahShzE9+6uoj8DCN31zcbDA5sKgJ\nc6SkA1KG83cDq2rP9zKAMn8V1O/NMnV/09gqPiowl/60CVuepkpNmVehhBVi\noamQ5r1g2l/PaUr7hmwygLBjnMHYD2eu5M0gMLYtZxCQSiXTxryp8Xd7vBzs\n0oWO2km/RjVedhxIBMGxcL2O17lWvumcr8AQYOuuiciPqNj0p/KxDYUHvIqx\nW3vPHknUzug5gSwfYZF7t5HCAc8dyRyC/b5M7Mvl9OsWdRPpcv25Dr+x/i/r\nrRMyvBLd8cujRh532fuyDZVL8NwPqwkKoBSU/+hkSOfW6WEdwYWp8xHDFmrQ\nD/YTNSSVPhGNSxR4I/niEksgH43zp5MdowcVuVsIxQBI/ExGcloRJ3hVa1I=\n&quot;</span>,
    <span class="ruby-string">&quot;IxDTD59cryQjCnFpYQTudw==\n&quot;</span>,
    <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>,
    <span class="ruby-identifier">password</span>,
  ]
  <span class="ruby-comment"># generated with:</span>
  <span class="ruby-comment"># test__enc_dec_interactive [</span>
  <span class="ruby-comment">#   ssl_sample_self_signed_cert[1],</span>
  <span class="ruby-comment">#   &quot;onlyNSAknows&quot;,</span>
  <span class="ruby-comment"># ]</span>
  <span class="ruby-identifier">private_key</span> = <span class="ruby-identifier">dec_interactive</span> [
    <span class="ruby-string">&quot;mxoZrTsIelpVmTAdSMQJaw==\n&quot;</span>,
    <span class="ruby-string">&quot;ebsMBtAoESJAOrmffbRsNdjv3FUqyTetrKlw6WGCNLre8uChpt38ZRmi1XAr\nab2PxiNyz7OJ8PWwCnd/TjIOhvid3Zt7LbqUpR2ixRmVf/mEFoWrdwdXnOMz\nzQErlSok1dY2cAvGqBihP26yC9N4IGJU5Jrt4wivahnnvWZoC1gvsEZVPC+Q\nxLF69gu8fn4gUgFvzpjuhgcCXk6QyhW916pZxJrtwBRMEQWu9dGEcRqSPqNt\nLfw6cXyGHDNV1320Je2BRjzMrhIfiwkv88oWEjnHcbOzboxhGdvYG8oYNMgQ\nf9qouABXlQyOEnBIFfl2lKoJaizERs1ShsdNCAcyZZPgNdxWNawdcF3AawYh\nqlX+uOlxCsWQLV3AaSDPy9mDthF3IuMLLe/BlY3gkGLCvD4szZIsQhk6047+\n9euOuJxxu8X3r8TZDHQK9esm5O6YeNFIlGko6PXA2OwcdUWO9Umwr7Lu8Mgk\n/yldW0G/6dMZ6qKSSSLTvEnzZChz91GabcntxT2TrOR2b1zHJhfOUUxcHxWe\nkuqZZ6GmGFIPju22cCsstXDZ0Q1J19VnGBsrySR0AHDxS3sLgeihf8SjP1bn\n3B1nRR+1gHyKPthKiuzibJj+j6xcIgYBynyaNIeT0Wfcf7WXyBTZ+Idd7Z+R\nkiy9jnZPqCIEE5aebuVvAUXksPE2OvEgsCIiLSEylXXrHEdcEnfra7wvo0qb\n1G/vRNlOIYJiOsKLOqcg6KZVJ+QHHYPrir33g4N02Q64WEw4/eIzR5o4MV9c\n7tho/VLQBE1T3z8HPlhe8XOXvVIDJ/cDVJhTre6KbKBsA+Ow47Z1uNXAchAO\n2bwl1sN1iH+SNBsEjRiXpjbrk95I/H66+LZoz85kRBcoQIhfXU97qbskBUwX\nK//3HdYluo/xx5QSVNqQUzybQnRdNV7gy6xNIgpot9ZtPB2K00HulWW1dnRQ\nBMCWb5h3eUob826icleZ/bEFfcfY8FjNTh9zhyWra3wJOTGS4zhmnlfhBRFZ\njRUcKGX/zgfIrCKXum+2m7Cku3bez+mKpEMRWIBPweGzjq3DSdtY+qlKOgeV\nBxOOh0QoMw1kzRfqF0D0Nqn785lvcXjH28v1efHf6SgFrOXjFNl0ihXXxhMG\nivsoIGIblspGIddR6wbarq1L8xMBTCAorNo0OrWPYACz4ek2CmQUuLhwiNx/\nWsFmaElfdtNL/WM06D5zehAYnCfg02zVr4bIgrHkFaq+jsI+u7/3GhtAmnAC\nkUT9CQvGNXwki3jIHOJQL1X8vLA2T25lg9I7wU4EXA==\n&quot;</span>,
    <span class="ruby-string">&quot;IBBcvvM2/h7bW+tBcBbXeQ==\n&quot;</span>,
    <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>,
    <span class="ruby-identifier">password</span>,
    ]
  [<span class="ruby-identifier">self_signed_certificate</span>, <span class="ruby-identifier">private_key</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-string_in_columns" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">string_in_columns</span><span
            class="method-args">(s, max_column=80)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>place a n at every max_column chars approximately (a word can be bigger
than max_column, and some other situations)</p>
          
          

          
          <div class="method-source-code" id="string_in_columns-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 850</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">string_in_columns</span> <span class="ruby-identifier">s</span>, <span class="ruby-identifier">max_column</span>=<span class="ruby-value">80</span>
  <span class="ruby-identifier">max_column</span> = <span class="ruby-identifier">max_column</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">as</span> = <span class="ruby-value">0</span> ; <span class="ruby-identifier">ln</span> = <span class="ruby-value">0</span> ; <span class="ruby-identifier">t</span> =  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">split</span>.<span class="ruby-identifier">chunk</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> ((<span class="ruby-identifier">l</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">as</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">max_column</span> ) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">as</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">size</span> ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ln</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">as</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">size</span>; <span class="ruby-identifier">ln</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>)  }.<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>) }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-identifier">t</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-string_repetition" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">string_repetition</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>tests if  <code>operand_1</code> is only composed by a repetition of
<code>operand_2</code> @param [Array] <code>args</code>, an
<code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>operand_1</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>operand_2</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>min_repetitions</code>
<dd><dl class="rdoc-list label-list"><dt>FixNum
<dd>
<p>minimum of times <code>operand_2</code> is required to appear in
<code>operand_1</code> (default: <code>0</code>). Note that in +args=[“”,
“X”, 0]+, +operand_1=“”+ will be returned, because “” is a composition of
<code>0</code> times “X”.</p>
</dd></dl>
</dd></dl>

<p>@return [String, FalseClass] returns <code>operand_1</code> if it is only
composed by a repetition of <code>operand_2</code>, otherwise
<code>false</code></p>
          
          

          
          <div class="method-source-code" id="string_repetition-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3818</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">string_repetition</span>  <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">operand_1</span>,
  <span class="ruby-identifier">operand_2</span>,
  <span class="ruby-identifier">min_repetitions</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} starting&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;args=#{args.inspect}&quot;</span>)
  <span class="ruby-identifier">matches</span>  = (<span class="ruby-identifier">operand_1</span>.<span class="ruby-identifier">scan</span> <span class="ruby-identifier">operand_2</span>) <span class="ruby-keyword">rescue</span> []
  <span class="ruby-identifier">amout_of_matches</span> = <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-identifier">min_repetitions</span> = <span class="ruby-identifier">min_repetitions</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">is_string_repetition</span> = (
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;(#{amout_of_matches} &gt;= #{min_repetitions}) &amp;&amp; (#{operand_2.size} * #{amout_of_matches} == #{operand_1.size})&#39;</span>)
    <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;(#{amout_of_matches} &gt;= #{min_repetitions}) &amp;&amp; (#{operand_2.size} * #{amout_of_matches} == #{operand_1.size})&quot;</span>)
    <span class="ruby-comment"># if operand_2 was matched N times, and the sum</span>
    <span class="ruby-comment"># of those N matched sizes is the same</span>
    (<span class="ruby-identifier">amout_of_matches</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">min_repetitions</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">operand_2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">amout_of_matches</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">operand_1</span>.<span class="ruby-identifier">size</span>) <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
  ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">operand_1</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;will return #{is_string_repetition}&quot;</span>)
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{__method__} returning&quot;</span>)
  <span class="ruby-identifier">is_string_repetition</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-system_rubyment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">system_rubyment</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="RubymentModule.html#method-i-system_rubyment">#system_rubyment</a>
requires a system&#39;s <a href="RubymentModule/Rubyment.html">Rubyment</a>
and invoke it using args args: args (Array) returns: <a
href="RubymentModule/Rubyment.html">Rubyment</a> or false</p>
          
          

          
          <div class="method-source-code" id="system_rubyment-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2220</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">system_rubyment</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">validate_require</span> [<span class="ruby-string">&#39;rubyment&#39;</span>, <span class="ruby-string">&#39;Rubyment&#39;</span>, {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">args</span> }]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tcp_server_plain" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tcp_server_plain</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens a TCP server accepting connections. @param [Array] <code>args</code>,
an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>listening_port</code>
<dd><dl class="rdoc-list label-list"><dt>String, Integer
<dd>
<p>port to listen</p>
</dd></dl>
</dd><dt><code>ip_addr</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ip (no hostname) to bind the server. 0, nil, false, empty string will bind
to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all
ipv4 and ipv6</p>
</dd></dl>
</dd><dt><code>reserved</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>for future use</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>for future use</p>
</dd></dl>
</dd><dt><code>callback_method</code>
<dd><dl class="rdoc-list label-list"><dt>String, Method
<dd>
<p>method to call when a client connects. The method must accept a socket as
parameter.</p>
</dd></dl>
</dd><dt><code>callback_method_args</code>
<dd><dl class="rdoc-list label-list"><dt>splat
<dd>
<p>args to be given to the call_back_method</p>
</dd></dl>
</dd></dl>

<p>@return [Thread] returns a Thread object looping for accepting incoming
connections (call join on that object for waiting for its completion).</p>
          
          

          
          <div class="method-source-code" id="tcp_server_plain-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2834</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_server_plain</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">reserved</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">callback_method</span>,
    <span class="ruby-operator">*</span><span class="ruby-identifier">callback_method_args</span> = <span class="ruby-identifier">args</span>

  <span class="ruby-identifier">tcp_ssl_server</span> [
    <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-string">&quot;admit non ssl server&quot;</span>,
    <span class="ruby-identifier">callback_method</span>,
    <span class="ruby-identifier">callback_method_args</span>
    ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tcp_ssl_server" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tcp_ssl_server</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens an SSL server accepting connections. @param [Array]
<code>args</code>, an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>listening_port</code>
<dd><dl class="rdoc-list label-list"><dt>String, Integer
<dd>
<p>port to listen</p>
</dd></dl>
</dd><dt><code>ip_addr</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ip (no hostname) to bind the server. 0, nil, false, empty string will bind
to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all
ipv4 and ipv6</p>
</dd></dl>
</dd><dt><code>admit_plain</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>if <code>true</code>, tries to create a normal <code>TCPServer</code>, if
not possible to create <code>SSLServer</code> (default: <code>false</code>,
for preventing unadvertnt non-SSL server creation)</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>for future use</p>
</dd></dl>
</dd><dt><code>callback_method</code>
<dd><dl class="rdoc-list label-list"><dt>String, Method
<dd>
<p>method to call when a client connects. The method must accept a socket as
parameter.</p>
</dd></dl>
</dd><dt><code>callback_method_args</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>args to be given to the call_back_method. Note that the type differs from
<a
href="RubymentModule.html#method-i-tcp_server_plain">tcp_server_plain</a>
(which takes splat)</p>
</dd></dl>
</dd></dl>

<p>@return [Thread] returns a Thread object looping for accepting incoming
connections (call join on that object for waiting for its completion).</p>
          
          

          
          <div class="method-source-code" id="tcp_ssl_server-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3045</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_ssl_server</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">admit_plain</span>,
    <span class="ruby-identifier">callback_method</span>,
    <span class="ruby-identifier">callback_method_args</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">output_exception</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

  <span class="ruby-identifier">server</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
    <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">admit_plain</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">output_exception</span>,
  ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">server</span>)
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> {
    <span class="ruby-identifier">loop</span> {
      <span class="ruby-identifier">client</span> = <span class="ruby-identifier">runea</span> [<span class="ruby-string">&quot;yes, rescue&quot;</span>,
        <span class="ruby-string">&quot;yes, output exception&quot;</span>,
        <span class="ruby-string">&quot;nil on exception&quot;</span>
      ] {
        <span class="ruby-identifier">server</span>.<span class="ruby-identifier">accept</span>
      }
      <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">client</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">client</span>)
        <span class="ruby-identifier">runoe</span> {
          <span class="ruby-identifier">to_method</span>([<span class="ruby-identifier">callback_method</span>])
            .<span class="ruby-identifier">call</span>([<span class="ruby-identifier">client</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">callback_method_args</span>)
        }
      }
    }
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tcp_ssl_servers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tcp_ssl_servers</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>opens one or more TCP and/or SSL server accepting connections. @param
[Array] <code>args</code>, an <code>Array</code> whose elements are
expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>listening_port</code>
<dd><dl class="rdoc-list label-list"><dt>String, Integer
<dd>
<p>port to listen</p>
</dd></dl>
</dd><dt><code>ip_addr</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>ip (no hostname) to bind the server. 0, nil, false, empty string will bind
to all addresses possible.  0.0.0.0 =&gt; binds to all ipv4 . ::0 to all
ipv4 and ipv6</p>
</dd></dl>
</dd><dt><code>admit_plain</code>
<dd><dl class="rdoc-list label-list"><dt>Boolean
<dd>
<p>if <code>true</code>, tries to create a normal <code>TCPServer</code>, if
not possible to create <code>SSLServer</code> (default: <code>false</code>,
for preventing unadvertnt non-SSL server creation)</p>
</dd></dl>
</dd><dt><code>debug</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd>
<p>for future use</p>
</dd></dl>
</dd><dt><code>callback_method</code>
<dd><dl class="rdoc-list label-list"><dt>String, Method
<dd>
<p>method to call when a client connects. The method must accept a socket as
parameter.</p>
</dd></dl>
</dd><dt><code>callback_method_args</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>args to be given to the call_back_method. Note that the type differs from
<a
href="RubymentModule.html#method-i-tcp_server_plain">tcp_server_plain</a>
(which takes splat)</p>
</dd></dl>
</dd></dl>

<p>@return [Array] returns a , an <code>Array</code> whose elements are:</p>
<dl class="rdoc-list note-list"><dt><code>threads</code>
<dd><dl class="rdoc-list label-list"><dt>Array of Thread
<dd>
<p>returns an Array of Thread object looping for accepting  incoming
connections (call join on those object for waiting for its completion).</p>
</dd></dl>
</dd></dl>
          
          

          
          <div class="method-source-code" id="tcp_ssl_servers-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2987</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tcp_ssl_servers</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">admit_plain</span>,
    <span class="ruby-identifier">callback_method</span>,
    <span class="ruby-identifier">callback_method_args</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">output_exception</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>

  <span class="ruby-identifier">server</span> = (<span class="ruby-identifier">ssl_make_servers</span> [
    <span class="ruby-identifier">listening_port</span>,
    <span class="ruby-identifier">ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">admit_plain</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">output_exception</span>,
  ]).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">server</span>)
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> {
    <span class="ruby-identifier">loop</span> {
      <span class="ruby-identifier">client</span> = <span class="ruby-identifier">runea</span> [<span class="ruby-string">&quot;yes, rescue&quot;</span>,
        <span class="ruby-string">&quot;yes, output exception&quot;</span>,
        <span class="ruby-string">&quot;nil on exception&quot;</span>
      ] {
        <span class="ruby-identifier">server</span>.<span class="ruby-identifier">accept</span>
      }
      <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">client</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
        <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">client</span>)
        <span class="ruby-identifier">runoe</span> {
          <span class="ruby-identifier">to_method</span>([<span class="ruby-identifier">callback_method</span>])
            .<span class="ruby-identifier">call</span>([<span class="ruby-identifier">client</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">callback_method_args</span>)
        }
      }
    }
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__array_unflatten_base" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__array_unflatten_base</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-array_unflatten_base">array_unflatten_base</a></p>
          
          

          
          <div class="method-source-code" id="test__array_unflatten_base-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 4177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__array_unflatten_base</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
    <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
    [
      <span class="ruby-string">&quot;base_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_escape_case&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_open_right_case&quot;</span>, [ <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_open_left_case&quot;</span>, [ <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_case_double&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_case_inverted&quot;</span>, [ <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],


    [
      <span class="ruby-string">&quot;base_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],


    [
      <span class="ruby-string">&quot;base_mixed_nested_case_deep&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ [ <span class="ruby-value">:b</span>, ] ] ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],


    [
      <span class="ruby-string">&quot;base_mixed_nested_case_shallow&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>,  ] ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span> ],
           <span class="ruby-value">:shallow</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>.<span class="ruby-identifier">negate_me</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span>, ], <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_case_double_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, [[ <span class="ruby-value">:b</span>, ]], <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_escape_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>,
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_mixed_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>,
         ]
      ],
    ],


    [
      <span class="ruby-string">&quot;open_left_base_mixed_case_inverse&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base</span>, [
           [<span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>],
           <span class="ruby-value">:shallow</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:debug</span>.<span class="ruby-identifier">negate_me</span>,
           <span class="ruby-value">:reserved_tokens</span>.<span class="ruby-identifier">to_nil</span>,
           <span class="ruby-value">:inverse</span>,
         ]
      ],
    ],


  ]
  <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">test_cases</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__array_unflatten_base_shallow" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__array_unflatten_base_shallow</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-array_unflatten_base_shallow">array_unflatten_base_shallow</a></p>
          
          

          
          <div class="method-source-code" id="test__array_unflatten_base_shallow-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 4101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__array_unflatten_base_shallow</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
    <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
    [
      <span class="ruby-string">&quot;base_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base_shallow</span>, [
           <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_escape_case&quot;</span>, [ <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base_shallow</span>, [
           <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]]&quot;</span>, <span class="ruby-value">:c</span>
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_open_right_case&quot;</span>, [ <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base_shallow</span>, [
           <span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_open_left_case&quot;</span>, [ <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base_shallow</span>, [
           <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_case_double&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base_shallow</span>, [
           <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">&quot;[&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
         ]
      ],
    ],

    [
      <span class="ruby-string">&quot;base_case_inverted&quot;</span>, [ <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base_shallow</span>, [
           <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;]&quot;</span>,  <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:c</span>
         ]
      ],
    ],


    [
      <span class="ruby-string">&quot;base_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-value">:b</span> ] ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base_shallow</span>, [
           <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-value">:b</span> ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
         ]
      ],
    ],


    [
      <span class="ruby-string">&quot;base_mixed_nested_case&quot;</span>, [ <span class="ruby-value">:a</span>, [ [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>,  ] ], <span class="ruby-value">:c</span>], [
         <span class="ruby-value">:array_unflatten_base_shallow</span>, [
           <span class="ruby-value">:a</span>, <span class="ruby-string">&quot;[&quot;</span>, [ <span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-value">:b</span>, <span class="ruby-string">&quot;]&quot;</span>, ], <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-value">:c</span>
         ]
      ],
    ],


  ]
  <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">test_cases</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__binary_dec_file_interactive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__binary_dec_file_interactive</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>basically the reverse of <a
href="RubymentModule.html#method-i-test__binary_enc_dec_file_interactive">#test__binary_enc_dec_file_interactive</a>
planned improvements: still outputs to stdout</p>
          
          

          
          <div class="method-source-code" id="test__binary_dec_file_interactive-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1827</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stdout</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stdout</span>]
  <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[enc_filename_or_url]&quot;</span>
  <span class="ruby-identifier">enc_filename_or_url</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_filename_or_url</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_plain_data]&quot;</span>
  <span class="ruby-identifier">out_filename</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">out_filename</span> ]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]

  <span class="ruby-identifier">output_dec_file</span> [<span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__binary_enc_dec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__binary_enc_dec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a href="RubymentModule.html#method-i-binary_enc">#binary_enc</a>
and binary_dec.</p>

<p>@param [Array] args, an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>data</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>data to be encrypted.</p>
</dd></dl>
</dd></dl>

<p>If empty or nil, read (without echo) from @<a href=":stdin">memory</a>,
which defaults to STDIN</p>
<dl class="rdoc-list note-list"><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password to be used to encryption.</p>
</dd></dl>
</dd></dl>

<p>If empty or nil, read (without echo) from @<a href=":stdin">memory</a>,
which defaults to STDIN</p>

<p>@return [TrueClass, FalseClass] depending on whether test succeeds.</p>
          
          

          
          <div class="method-source-code" id="test__binary_enc_dec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1755</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
  <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">binary_enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>]
  <span class="ruby-identifier">dec_args</span> = [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# WARNING: secrets, including password are printed here. Storing them may be a major security incident.&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;binary_dec &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_args</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double p binary_dec &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_args</span>).<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__binary_enc_dec_file_interactive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__binary_enc_dec_file_interactive</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>similar to <a
href="RubymentModule.html#method-i-test__binary_enc_dec_interactive">#test__binary_enc_dec_interactive</a>,
just that the data is ready from a file instead note that there is an extra
argument between the args, the enc_out_filename.</p>
          
          

          
          <div class="method-source-code" id="test__binary_enc_dec_file_interactive-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1813</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">filename_or_url</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[filename_or_url]&quot;</span>
  <span class="ruby-identifier">filename_or_url</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">filename_or_url</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_encrypted_data]&quot;</span>
  <span class="ruby-identifier">enc_out_filename</span> = <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_out_filename</span> ]
  <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">filename_or_url</span>
  <span class="ruby-identifier">test__binary_enc_dec_interactive</span> [ <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">data_is_base64</span> ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__binary_enc_dec_interactive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__binary_enc_dec_interactive</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a href="RubymentModule.html#method-i-binary_enc">#binary_enc</a>
and binary_dec_interactive. good idea is to use this function once with the
desired data, password, and use the stderr output</p>
          
          

          
          <div class="method-source-code" id="test__binary_enc_dec_interactive-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1780</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">data_is_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
  <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">binary_input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-identifier">binary_input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
  <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">binary_enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">data_is_base64</span> ]
  <span class="ruby-comment"># the output is supposed to be safe to store,</span>
  <span class="ruby-comment"># so password is not placed in from binary_dec_interactive_args:</span>
  <span class="ruby-identifier">dec_interactive_args</span> = [<span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec_interactive &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_interactive_args</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double puts binary_dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#or shell var:&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;my_secret=$(#{$0} invoke_double puts binary_dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)\necho $my_secret\nunset mysecret&quot;</span>
  <span class="ruby-identifier">encrypted_base64_filename</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">output_enc_file</span>(<span class="ruby-identifier">dec_interactive_args</span>  <span class="ruby-operator">+</span> [<span class="ruby-identifier">encrypted_base64_filename</span>])
  <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">binary_dec_interactive</span>(<span class="ruby-identifier">dec_interactive_args</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_is_base64</span>])
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">data_plain</span>.<span class="ruby-identifier">size</span>, <span class="ruby-string">&quot;data.size&quot;</span>],
      [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>],
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__binary_enc_dec_nil" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__binary_enc_dec_nil</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a href="RubymentModule.html#method-i-binary_enc">#binary_enc</a>
and binary_dec. “” and nil are expected to be treated as the same.</p>
          
          

          
          <div class="method-source-code" id="test__binary_enc_dec_nil-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1736</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__binary_enc_dec_nil</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">nil_case</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
  <span class="ruby-identifier">empty</span> = <span class="ruby-identifier">binary_dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">nil_case</span>, <span class="ruby-identifier">empty</span>, <span class="ruby-string">&quot;empty_nil_equality&quot;</span>]
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__dec_file_interactive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__dec_file_interactive</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>basically the reverse of <a
href="RubymentModule.html#method-i-test__enc_dec_file_interactive">#test__enc_dec_file_interactive</a>
planned improvements: still outputs to stdout</p>
          
          

          
          <div class="method-source-code" id="test__dec_file_interactive-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1595</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">enc_filename_or_url</span>, <span class="ruby-identifier">out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[enc_filename_or_url]&quot;</span>
  <span class="ruby-identifier">enc_filename_or_url</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_filename_or_url</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_plain_data]&quot;</span>
  <span class="ruby-identifier">out_filename</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">out_filename</span> ]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
  <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">enc_filename_or_url</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;base64&#39;</span>
  <span class="ruby-identifier">base64_json_serialized_data</span> = <span class="ruby-identifier">data</span>
  <span class="ruby-identifier">metadata</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span> <span class="ruby-identifier">base64_json_serialized_data</span>
  <span class="ruby-identifier">base64_iv</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iv&quot;</span>]
  <span class="ruby-identifier">base64_encrypted</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_encrypted&quot;</span>]
  <span class="ruby-identifier">base64_salt</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_salt&quot;</span>]
  <span class="ruby-identifier">base64_iter</span> = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_iter&quot;</span>]
  <span class="ruby-identifier">base64_key</span>  = <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;base64_key&quot;</span> ]
  <span class="ruby-identifier">ending</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">pw_plain</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">ending</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">data_not_base64</span>]
  <span class="ruby-identifier">shell_dec_output</span> [<span class="ruby-identifier">pw_plain</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__enc_dec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__enc_dec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for enc and dec.</p>

<p>@param [Array] args, an <code>Array</code> whose elements are expected to
be:</p>
<dl class="rdoc-list note-list"><dt><code>data</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>data to be encrypted.</p>
</dd></dl>
</dd></dl>

<p>If empty or nil, read (without echo) from @<a href=":stdin">memory</a>,
which defaults to STDIN</p>
<dl class="rdoc-list note-list"><dt><code>password</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd>
<p>password to be used to encryption.</p>
</dd></dl>
</dd></dl>

<p>If empty or nil, read (without echo) from @<a href=":stdin">memory</a>,
which defaults to STDIN</p>

<p>@return [TrueClass, FalseClass] depending on whether test succeeds.</p>
          
          

          
          <div class="method-source-code" id="test__enc_dec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1482</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
  <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>]
  <span class="ruby-identifier">dec_args</span> = [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# WARNING: secrets, including password are printed here. Storing them may be a major security incident.&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_args</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double p dec &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_args</span>).<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__enc_dec_file_interactive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__enc_dec_file_interactive</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>similar to <a
href="RubymentModule.html#method-i-test__enc_dec_interactive">#test__enc_dec_interactive</a>,
just that the data is ready from a file instead note that there is an extra
argument between the args, the enc_out_filename.</p>
          
          

          
          <div class="method-source-code" id="test__enc_dec_file_interactive-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1581</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_file_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">filename_or_url</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[filename_or_url]&quot;</span>
  <span class="ruby-identifier">filename_or_url</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">filename_or_url</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[output_filename_encrypted_data]&quot;</span>
  <span class="ruby-identifier">enc_out_filename</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">enc_out_filename</span> ]
  <span class="ruby-identifier">data</span> =  <span class="ruby-identifier">file_or_url_contents</span> <span class="ruby-identifier">filename_or_url</span>
  <span class="ruby-identifier">test__enc_dec_interactive</span> [ <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">enc_out_filename</span>, <span class="ruby-identifier">data_not_base64</span> ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__enc_dec_interactive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__enc_dec_interactive</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for enc and dec_interactive. good idea is to use this function once
with the desired data, password, and use the stderr output</p>
          
          

          
          <div class="method-source-code" id="test__enc_dec_interactive-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1549</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_interactive</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">data</span>, <span class="ruby-identifier">password</span>, <span class="ruby-identifier">encrypted_base64_filename</span>, <span class="ruby-identifier">data_not_base64</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[data]&quot;</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">input_multi_line_non_echo</span> [<span class="ruby-identifier">data</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-string">&quot;[password]&quot;</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-identifier">input_single_line_non_echo</span> [<span class="ruby-identifier">password</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>
  <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>, <span class="ruby-identifier">base64_key</span> = <span class="ruby-identifier">enc</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">data_not_base64</span> ]
  <span class="ruby-comment"># the output is supposed to be safe to store,</span>
  <span class="ruby-comment"># so password is not placed in from dec_interactive_args:</span>
  <span class="ruby-identifier">dec_interactive_args</span> = [<span class="ruby-identifier">base64_iv</span>, <span class="ruby-identifier">base64_encrypted</span>, <span class="ruby-identifier">base64_salt</span>, <span class="ruby-identifier">base64_iter</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# programmatically:&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;dec_interactive &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">dec_interactive_args</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# shell: &quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{$0} invoke_double puts dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#or shell var:&quot;</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;my_secret=$(#{$0} invoke_double puts dec_interactive &quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">output_array_to_shell</span> <span class="ruby-identifier">dec_interactive_args</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)\necho $my_secret\nunset mysecret&quot;</span>
  <span class="ruby-identifier">encrypted_base64_filename</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">output_enc_file</span>(<span class="ruby-identifier">dec_interactive_args</span>  <span class="ruby-operator">+</span> [<span class="ruby-identifier">encrypted_base64_filename</span>])
  <span class="ruby-identifier">data_plain</span> = <span class="ruby-identifier">dec_interactive</span>(<span class="ruby-identifier">dec_interactive_args</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">password</span>, <span class="ruby-identifier">data_not_base64</span>])
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">data</span>, <span class="ruby-identifier">data_plain</span>, <span class="ruby-string">&quot;data&quot;</span>]
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__enc_dec_interactive__ssl_sample_self_signed_cert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__enc_dec_interactive__ssl_sample_self_signed_cert</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="RubymentModule.html#method-i-test_enc_dec_interactive__ssl_sample_self_signed_cert">test_enc_dec_interactive__ssl_sample_self_signed_cert</a>
function name out of standard. this one should be called instead instead</p>
          
          

          
          <div class="method-source-code" id="test__enc_dec_interactive__ssl_sample_self_signed_cert-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3322</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-identifier">test_enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__enc_dec_nil" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__enc_dec_nil</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for enc and dec. “” and nil are expected to be treated as the same.</p>
          
          

          
          <div class="method-source-code" id="test__enc_dec_nil-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1447</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_nil</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">nil_case</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
  <span class="ruby-identifier">empty</span> = <span class="ruby-identifier">dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;ltUQIxgRAeUNXPNTTps8FQ==\n&quot;</span>, <span class="ruby-string">&quot;xyeqxw/TzkyXtOxpDqAl58SNAvXPyNZ89B5JGtwDkcbjo0vObgPsh5FrgZJs\nHPjofsyXnljnTrHpDoQeDVezo9wBZ74NU+TSi/GssX605oE=\n&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;TU4o3IKiFWki3rZ3lMchLQ==\n&quot;</span>, <span class="ruby-string">&quot;MjAwMDA=\n&quot;</span>]
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">nil_case</span>, <span class="ruby-identifier">empty</span>, <span class="ruby-string">&quot;empty_nil_equality&quot;</span>]
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__enc_dec_shell_programatically" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__enc_dec_shell_programatically</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for enc and dec and output_array_to_shell. <a
href="RubymentModule.html#method-i-output_array_to_shell">#output_array_to_shell</a>
should create proper arguments</p>

<pre class="ruby"><span class="ruby-identifier">to</span> <span class="ruby-identifier">dec</span>
</pre>

<p>TODO: invalid test – that can&#39;t yet be ensured</p>
          
          

          
          <div class="method-source-code" id="test__enc_dec_shell_programatically-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1461</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__enc_dec_shell_programatically</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;test invalid; skip&quot;</span>
  <span class="ruby-identifier">shell</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">programatically</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">shell</span>, <span class="ruby-identifier">programatically</span>, <span class="ruby-string">&quot;shell_programatically_equality&quot;</span>]
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__file_backup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__file_backup</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test <a href="RubymentModule.html#method-i-file_backup">#file_backup</a>
(just like a copy)</p>
          
          

          
          <div class="method-source-code" id="test__file_backup-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2496</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-identifier">keep_new</span>  = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">filename</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;testing-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;/tmp/&quot;</span>
  <span class="ruby-identifier">append</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">prepend</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">expected_new_filename</span> = <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-identifier">existing_file</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>])
  <span class="ruby-identifier">file_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">filename</span>, <span class="ruby-node">&quot;contents_of:#{filename}&quot;</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>
  <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>
  <span class="ruby-identifier">new_file_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">expected_new_filename</span>
  <span class="ruby-identifier">original_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-identifier">new_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">expected_new_filename</span>
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">new_file_contents</span>, <span class="ruby-string">&quot;file_contents&quot;</span>],
      [<span class="ruby-identifier">original_permissions</span>, <span class="ruby-identifier">new_permissions</span>, <span class="ruby-string">&quot;file_permissions&quot;</span>],
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  (<span class="ruby-operator">!</span><span class="ruby-identifier">existing_file</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">filename</span>)
  (<span class="ruby-operator">!</span><span class="ruby-identifier">keep_new</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">expected_new_filename</span>)
  <span class="ruby-identifier">judgement</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__file_backup__but_keep" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__file_backup__but_keep</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>same as <a
href="RubymentModule.html#method-i-test__file_backup">#test__file_backup</a>,
but backup is not removed.</p>
          
          

          
          <div class="method-source-code" id="test__file_backup__but_keep-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2528</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__but_keep</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-identifier">dont_keep_new</span>  = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">test__file_backup</span> [<span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">file_contents</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">pw</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">dont_keep_new</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__file_backup__when_file_is_dir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__file_backup__when_file_is_dir</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test <a href="RubymentModule.html#method-i-file_backup">#file_backup</a>
when file is a dir</p>
          
          

          
          <div class="method-source-code" id="test__file_backup__when_file_is_dir-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2469</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__when_file_is_dir</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
  <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">keep_new</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">filename</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;testing-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;/tmp/&quot;</span>
  <span class="ruby-identifier">append</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">prepend</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">filename</span>  <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;/&quot;</span>
  <span class="ruby-identifier">expected_new_dir</span> = <span class="ruby-identifier">dest_dir</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-identifier">existing_dir</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>])
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-identifier">file_backup</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>
  <span class="ruby-identifier">filename_test</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-identifier">expected_new_dir_test</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">expected_new_dir</span>
  <span class="ruby-identifier">original_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-identifier">new_permissions</span> = <span class="ruby-identifier">file_permissions_octal</span> <span class="ruby-identifier">expected_new_dir</span>
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">filename_test</span>, <span class="ruby-identifier">expected_new_dir_test</span>, <span class="ruby-string">&quot;File.directory?&quot;</span>],
      [<span class="ruby-identifier">original_permissions</span>, <span class="ruby-identifier">new_permissions</span>, <span class="ruby-string">&quot;file_permissions&quot;</span>],
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
  (<span class="ruby-operator">!</span><span class="ruby-identifier">existing_dir</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rmdir</span> <span class="ruby-identifier">filename</span>)
  (<span class="ruby-operator">!</span><span class="ruby-identifier">keep_new</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rmdir</span> <span class="ruby-identifier">expected_new_dir</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__file_backup__when_file_is_dir__but_keep" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__file_backup__when_file_is_dir__but_keep</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>same as <a
href="RubymentModule.html#method-i-test__file_backup__when_file_is_dir">#test__file_backup__when_file_is_dir</a>,
but backup is not removed.</p>
          
          

          
          <div class="method-source-code" id="test__file_backup__when_file_is_dir__but_keep-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2521</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_backup__when_file_is_dir__but_keep</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-identifier">dont_keep_new</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">test__file_backup__when_file_is_dir</span> [<span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">append</span>, <span class="ruby-identifier">prepend</span>, <span class="ruby-operator">!</span><span class="ruby-identifier">dont_keep_new</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__file_read__return_on_rescue" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__file_read__return_on_rescue</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>tests <a
href="RubymentModule.html#method-i-file_read_or_write">file_read_or_write</a>
and <a href="RubymentModule.html#method-i-file_read">file_read</a>
specially its <code>return_on_rescue</code> parameter. attention that files
given by parameter will be mercilessly overwritten. writes the contents
returned by  <a
href="RubymentModule.html#method-i-ssl_sample_self_signed_cert">ssl_sample_self_signed_cert</a>
to 2 files. then reads then. after it tries to give the contents of those
files instead of the filenames. the idea behind is that, no matter if
contents or filename were given, it should always return the contents of
the file.</p>
          
          

          
          <div class="method-source-code" id="test__file_read__return_on_rescue-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3394</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_read__return_on_rescue</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">priv_pemfile</span>, <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">priv_pemfile</span>  =  <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;/tmp/pkey.pem&quot;</span>
  <span class="ruby-identifier">cert_pem_file</span> = <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;/tmp/cert.crt&quot;</span>
  <span class="ruby-identifier">runef</span> { 
   <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">priv_pemfile</span>
   <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">cert_pem_file</span>
  }
  <span class="ruby-identifier">cert_contents</span>, <span class="ruby-identifier">pkey_contents</span> = <span class="ruby-identifier">ssl_sample_self_signed_cert</span>
  <span class="ruby-comment"># asserting that file_read_or_write is correct</span>
  <span class="ruby-identifier">read_or_write_cert_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-identifier">cert_contents</span>
  <span class="ruby-identifier">read_or_write_pkey_contents</span> = <span class="ruby-identifier">file_read_or_write</span> <span class="ruby-identifier">priv_pemfile</span>,  <span class="ruby-identifier">pkey_contents</span>
  <span class="ruby-identifier">file_dot_read_cert_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">cert_pem_file</span>
  <span class="ruby-identifier">file_dot_read_pkey_contents</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">priv_pemfile</span>
  <span class="ruby-comment"># files exist case (will return the contents of 1st parameter filename):</span>
  <span class="ruby-identifier">existing_cert_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_pem_file</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_pem_file</span>]
  <span class="ruby-identifier">existing_pkey_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">priv_pemfile</span>,  <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">priv_pemfile</span> ]
  <span class="ruby-comment"># files don&#39;t exist case (will return the 4th parameter):</span>
  <span class="ruby-identifier">rescue_cert_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">cert_contents</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cert_contents</span>]
  <span class="ruby-identifier">rescue_pkey_contents</span> = <span class="ruby-identifier">file_read</span> [<span class="ruby-identifier">pkey_contents</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">pkey_contents</span>]
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">read_or_write_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;read_or_write_cert_contents&quot;</span>],
      [<span class="ruby-identifier">read_or_write_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;read_or_write_pkey_contents&quot;</span>],
      [<span class="ruby-identifier">file_dot_read_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;file_dot_read_cert_contents&quot;</span>],
      [<span class="ruby-identifier">file_dot_read_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;file_dot_read_pkey_contents&quot;</span>],
      [<span class="ruby-identifier">existing_cert_contents</span>, <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;existing_cert_contents&quot;</span>],
      [<span class="ruby-identifier">existing_pkey_contents</span>, <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;existing_pkey_contents&quot;</span>],
      [<span class="ruby-identifier">rescue_cert_contents</span>,   <span class="ruby-identifier">cert_contents</span>, <span class="ruby-string">&quot;rescue_cert_contents&quot;</span>],
      [<span class="ruby-identifier">rescue_pkey_contents</span>,   <span class="ruby-identifier">pkey_contents</span>, <span class="ruby-string">&quot;rescue_pkey_contents&quot;</span>],
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__file_read__uri_root" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__file_read__uri_root</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>tests <a href="RubymentModule.html#method-i-file_read">#file_read</a>
against a uri. created to test a client for servers created with <a
href="RubymentModule.html#method-i-test__tcp_ssl_server__io_method">test__tcp_ssl_server__io_method</a></p>
          
          

          
          <div class="method-source-code" id="test__file_read__uri_root-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3533</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__file_read__uri_root</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">domain</span>,
    <span class="ruby-identifier">http_server_port</span>,
    <span class="ruby-identifier">admit_non_ssl</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
  <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
  <span class="ruby-identifier">admit_non_ssl</span> = <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">nne</span> <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">inspect</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> (<span class="ruby-identifier">admit_non_ssl</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;http://#{domain}:#{http_server_port}/&quot;</span>])).<span class="ruby-identifier">inspect</span>
  <span class="ruby-identifier">response</span> = (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;https://#{domain}:#{http_server_port}/&quot;</span>]) <span class="ruby-operator">||</span>
    <span class="ruby-identifier">admit_non_ssl</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">file_read</span> [<span class="ruby-node">&quot;http://#{domain}:#{http_server_port}/&quot;</span>])
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span>  <span class="ruby-node">&quot;response{#{response}}response&quot;</span>)
  <span class="ruby-identifier">response</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__gem_build" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__gem_build</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a href="RubymentModule.html#method-i-gem_build">#gem_build</a>:
builds gem for this rubyment file after it, these commands will
install/uninstall it: sudo gem install $PWD/rubyment-0.0.#{@<a
href=":basic_version">memory</a>} ; gem list  | grep -i rubyment ; sudo gem
uninstall  rubyment dependee:</p>

<pre class="ruby"><span class="ruby-identifier">test__gem_install_validate_uninstall</span>
</pre>

<p>args:</p>
<dl class="rdoc-list label-list"><dt>gem_spec_path (String), gem_spec_contents (String)
<dd>
<p>returns: none outputs of gem build (String)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="test__gem_build-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2100</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_build</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;fileutils&#39;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-string">&#39;lib&#39;</span>
  <span class="ruby-identifier">save_file</span> <span class="ruby-keyword">__FILE__</span>, <span class="ruby-string">&#39;lib/rubyment.rb&#39;</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_build</span> [<span class="ruby-string">&quot;rubyment.spec&quot;</span>, <span class="ruby-identifier">rubyment_gem_spec</span>(<span class="ruby-identifier">args</span>) ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__gem_build_install_validate_uninstall" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__gem_build_install_validate_uninstall</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a href="RubymentModule.html#method-i-gem_build">#gem_build</a>,
<a href="RubymentModule.html#method-i-gem_install">#gem_install</a>, <a
href="RubymentModule.html#method-i-gem_list">#gem_list</a> <a
href="RubymentModule.html#method-i-system_rubyment">#system_rubyment</a>,
<a href="RubymentModule.html#method-i-gem_uninstall">#gem_uninstall</a>
note that, if there is a “rubyment” gem already installed, it will be
temporarily unavailable. args: args (Array or nil) returns: <a
href="RubymentModule/Rubyment.html">Rubyment</a> or false</p>
          
          

          
          <div class="method-source-code" id="test__gem_build_install_validate_uninstall-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2375</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_build_install_validate_uninstall</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">basic_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:basic_version</span>]
  <span class="ruby-identifier">major_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:major_version</span>]
  <span class="ruby-identifier">running_dir</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:running_dir</span>]
  <span class="ruby-identifier">test__gem_build</span> []
  <span class="ruby-identifier">already_installed</span> = (<span class="ruby-identifier">system_rubyment</span> [<span class="ruby-string">&quot;p&quot;</span>, <span class="ruby-string">&quot;already installed&quot;</span>])
  <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
  <span class="ruby-identifier">gem_install</span> [<span class="ruby-node">&quot;#{running_dir}/rubyment-#{major_version}.#{basic_version}.gem&quot;</span>]
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_list</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
  <span class="ruby-identifier">v</span> = <span class="ruby-identifier">test__system_rubyment</span> []
  <span class="ruby-identifier">gem_uninstall</span> [<span class="ruby-string">&quot;rubyment&quot;</span>]
  <span class="ruby-identifier">already_installed</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">gem_install</span> [<span class="ruby-string">&quot;rubyment&quot;</span>])
  <span class="ruby-identifier">v</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__gem_complete_flow" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__gem_complete_flow</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a href="RubymentModule.html#method-i-gem_build">#gem_build</a>,
<a href="RubymentModule.html#method-i-gem_install">#gem_install</a>, <a
href="RubymentModule.html#method-i-gem_list">#gem_list</a> <a
href="RubymentModule.html#method-i-system_rubyment">#system_rubyment</a>,
<a href="RubymentModule.html#method-i-gem_uninstall">#gem_uninstall</a>
args: args (Array or nil) returns: ignore</p>
          
          

          
          <div class="method-source-code" id="test__gem_complete_flow-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2462</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_complete_flow</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">gem_build_push</span> <span class="ruby-identifier">args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__gem_get_api_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__gem_get_api_key</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-test__gem_get_api_key">#test__gem_get_api_key</a>
args: (Array - forwarded to <a
href="RubymentModule.html#method-i-gem_get_api_key">#gem_get_api_key</a>)
returns: nil</p>
          
          

          
          <div class="method-source-code" id="test__gem_get_api_key-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2424</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_get_api_key</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">gem_get_api_key</span> <span class="ruby-identifier">args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__gem_uninstall_extreme_force" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__gem_uninstall_extreme_force</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>forces the uninstallation of a gem in all the ways we can mostly for
internal tests that needs to ensure a gem wasn&#39;t installed before a
test.</p>
          
          

          
          <div class="method-source-code" id="test__gem_uninstall_extreme_force-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2010</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__gem_uninstall_extreme_force</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">gem_spec</span>, <span class="ruby-identifier">user_install</span>, <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">quiet</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">quiet</span>.<span class="ruby-identifier">negate_me</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -a -x  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -a -x --user-install  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -a -x  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -a -x --user-install  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>

  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -x  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;gem uninstall -x --user-install  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -x  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
  <span class="ruby-identifier">command</span>=<span class="ruby-node">&quot;sudo gem uninstall -x --user-install  #{gem_spec}&quot;</span>
  <span class="ruby-identifier">debug</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;command=#{command}&quot;</span>)
  <span class="ruby-node">%x`#{command}`</span>
  []
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__json_metadata_serialization" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__json_metadata_serialization</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="RubymentModule.html#method-i-test__json_metadata_serialization">#test__json_metadata_serialization</a>
sanity test for <a
href="RubymentModule.html#method-i-serialize_json_metadata">#serialize_json_metadata</a>
and <a
href="RubymentModule.html#method-i-deserialize_json_metadata">#deserialize_json_metadata</a></p>
          
          

          
          <div class="method-source-code" id="test__json_metadata_serialization-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1375</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__json_metadata_serialization</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">judgement</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">payload</span> = <span class="ruby-string">&quot;Payload&quot;</span>
  <span class="ruby-comment"># note: keys with : instead can&#39;t be recovered, because</span>
  <span class="ruby-comment"># they aren&#39;t described in JSON files</span>
  <span class="ruby-identifier">metadata</span> = { <span class="ruby-string">&quot;metadata&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Metadata&quot;</span> }
  <span class="ruby-identifier">serialized</span> = (<span class="ruby-identifier">serialize_json_metadata</span> [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">metadata</span> ])
  <span class="ruby-identifier">new_payload</span>, <span class="ruby-identifier">new_metadata</span> = <span class="ruby-identifier">deserialize_json_metadata</span> [<span class="ruby-identifier">serialized</span>]
  <span class="ruby-identifier">judgement</span> =
    [ [<span class="ruby-identifier">payload</span>, <span class="ruby-identifier">new_payload</span>, <span class="ruby-string">&quot;payload&quot;</span>], [<span class="ruby-identifier">metadata</span>, <span class="ruby-identifier">new_metadata</span>, <span class="ruby-string">&quot;metadata&quot;</span>]]
      .<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__object_nne" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__object_nne</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for Object::nne</p>
          
          

          
          <div class="method-source-code" id="test__object_nne-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3696</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__object_nne</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">string_neutral</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">string_non_neutral</span> = <span class="ruby-string">&quot;xxx&quot;</span>
  <span class="ruby-identifier">fixnum_neutral</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">fixnum_non_neutral</span> = <span class="ruby-value">1</span>
  <span class="ruby-identifier">array_neutral</span> = []
  <span class="ruby-identifier">array_non_neutral</span> = [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>]
  <span class="ruby-identifier">hash_neutral</span> = {}
  <span class="ruby-identifier">hash_non_neutral</span> = { <span class="ruby-value">1</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> }
  <span class="ruby-identifier">judgement</span> =
    [
      [<span class="ruby-identifier">string_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;string_neutral.nne&quot;</span>],
      [<span class="ruby-identifier">string_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">string_non_neutral</span>, <span class="ruby-string">&quot;string_non_neutral.nne&quot;</span>],
      [<span class="ruby-identifier">fixnum_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;fixnum_neutral.nne&quot;</span>],
      [<span class="ruby-identifier">fixnum_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">fixnum_non_neutral</span>, <span class="ruby-string">&quot;fixnum_non_neutral.nne&quot;</span>],
      [<span class="ruby-identifier">array_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;array_neutral.nne&quot;</span>],
      [<span class="ruby-identifier">array_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">array_non_neutral</span>, <span class="ruby-string">&quot;array_non_neutral.nne&quot;</span>],
      [<span class="ruby-identifier">hash_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;hash_neutral.nne&quot;</span>],
      [<span class="ruby-identifier">hash_non_neutral</span>.<span class="ruby-identifier">nne</span>, <span class="ruby-identifier">hash_non_neutral</span>, <span class="ruby-string">&quot;hash_non_neutral.nne&quot;</span>],
    ].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__rest_request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__rest_request</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test <a href="RubymentModule.html#method-i-rest_request">rest_request</a>
for now, the parameters must still be hardcoded.</p>
          
          

          
          <div class="method-source-code" id="test__rest_request-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1021</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__rest_request</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]

  <span class="ruby-identifier">atlasian_account</span>=<span class="ruby-string">&quot;my_atlasian_account&quot;</span>
  <span class="ruby-identifier">jira_host</span> = <span class="ruby-string">&quot;https://mydomain.atlassian.net/&quot;</span>
  <span class="ruby-identifier">issue</span> = <span class="ruby-string">&quot;JIRAISSUE-6517&quot;</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;#{jira_host}/rest/api/2/issue/#{issue}/comment&quot;</span>

  <span class="ruby-identifier">json</span> =<span class="ruby-value">&lt;&lt;-ENDHEREDOC
  {
      &quot;body&quot; : &quot;my comment&quot;
  }
  ENDHEREDOC</span>
  <span class="ruby-identifier">payload</span> = <span class="ruby-node">&quot;#{json}&quot;</span>

  <span class="ruby-identifier">auth_user</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">password</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">method</span> = <span class="ruby-value">:get</span>
  <span class="ruby-identifier">method</span> = <span class="ruby-value">:post</span>
  <span class="ruby-identifier">timeout</span> = <span class="ruby-value">2000</span>
  <span class="ruby-identifier">verify_ssl</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">payload</span> = <span class="ruby-node">&quot;#{json}&quot;</span>
  <span class="ruby-identifier">headers</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">request_execution</span> = <span class="ruby-identifier">send</span> <span class="ruby-value">:rest_request</span>, [
    <span class="ruby-identifier">url</span>,
    <span class="ruby-identifier">payload</span>,
    <span class="ruby-identifier">verify_ssl</span>,
    <span class="ruby-identifier">headers</span>,
    <span class="ruby-identifier">method</span>,
    <span class="ruby-identifier">auth_user</span>,
    <span class="ruby-identifier">password</span>,
    <span class="ruby-identifier">timeout</span>,
  ]
  <span class="ruby-identifier">parsed_json</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">request_execution</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">parsed_json</span>
  [<span class="ruby-identifier">parsed_json</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__rubyment_gem_spec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__rubyment_gem_spec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for rubyment_gem_spec. outputs the contents returned by that function.
args: none returns: none</p>
          
          

          
          <div class="method-source-code" id="test__rubyment_gem_spec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1900</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__rubyment_gem_spec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">rubyment_gem_spec</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__rune_functions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__rune_functions</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for functions that adds syntatic sugar to exceptions.</p>
          
          

          
          <div class="method-source-code" id="test__rune_functions-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3758</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__rune_functions</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">do_rescue</span> = <span class="ruby-string">&quot;rescue&quot;</span>
  <span class="ruby-identifier">do_output</span> = <span class="ruby-string">&quot;output&quot;</span>
  <span class="ruby-identifier">no_rescue</span> = <span class="ruby-string">&quot;no rescue&quot;</span>
  <span class="ruby-identifier">no_output</span> = <span class="ruby-string">&quot;no output&quot;</span>
  <span class="ruby-identifier">actual</span> = {}
  <span class="ruby-identifier">expectation</span> = {}

  <span class="ruby-comment">#working case</span>
  <span class="ruby-identifier">expected_return</span> = [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>]
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_and_output_work</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">do_output</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_but_no_output_work</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:effectless_output_but_no_rescue_work</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">do_output</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:no_output_and_no_rescue_work</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], <span class="ruby-identifier">expected_return</span> ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>  }
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>

  <span class="ruby-comment"># failure cases</span>
  <span class="ruby-identifier">expected_return</span> = <span class="ruby-string">&quot;no_such_method&quot;</span>
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_and_output_fail</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">do_output</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>;  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>;  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }[<span class="ruby-value">1</span>].<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:rescue_but_no_output_fail</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">do_rescue</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">expected_return</span>
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:effectless_output_but_no_rescue_fail</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">do_output</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NoMethodError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">noMethodError</span>
    <span class="ruby-identifier">noMethodError</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">:no_output_and_no_rescue_fail</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">runea</span>([<span class="ruby-identifier">no_rescue</span>.<span class="ruby-identifier">to_nil</span>, <span class="ruby-identifier">no_output</span>.<span class="ruby-identifier">to_nil</span>], [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>] ) {<span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;test_case=#{test_case}&quot;</span>; <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span> ; <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_nil</span>.<span class="ruby-identifier">no_such_method</span>  }
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NoMethodError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">noMethodError</span>
    <span class="ruby-identifier">noMethodError</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">expected_return</span>

  <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
    [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
  }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__shell_enc_dec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__shell_enc_dec</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="RubymentModule.html#method-i-test__shell_enc_dec">#test__shell_enc_dec</a>
sanity test for <a
href="RubymentModule.html#method-i-shell_enc">#shell_enc</a> and <a
href="RubymentModule.html#method-i-shell_dec">#shell_dec</a> planned
changes: don&#39;t output to stdout</p>
          
          

          
          <div class="method-source-code" id="test__shell_enc_dec-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 1417</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__shell_enc_dec</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">shell_enc</span> [<span class="ruby-string">&quot;my secret&quot;</span>,  <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>,  <span class="ruby-string">&quot;tijolo22&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>]
  <span class="ruby-identifier">judgement</span> = ( <span class="ruby-identifier">shell_dec</span> [<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;tijolo22&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">true</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__shell_send_array__main" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__shell_send_array__main</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>experimental stuff coming. usage example: ./rubyment.rb  <a
href="RubymentModule.html#method-i-invoke_double">#invoke_double</a> p <a
href="RubymentModule.html#method-i-test__shell_send_array__main">#test__shell_send_array__main</a>
“tinga” “” sub in EN</p>
<dl class="rdoc-list label-list"><dt>“tENga”
<dd></dd></dl>
          
          

          
          <div class="method-source-code" id="test__shell_send_array__main-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3679</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__shell_send_array__main</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">object_to_send</span>,
    <span class="ruby-identifier">reserved</span>,
    <span class="ruby-identifier">method_to_send</span>,
    <span class="ruby-operator">*</span><span class="ruby-identifier">args_to_send</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">object_to_send</span> = <span class="ruby-identifier">object_to_send</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">method_to_send</span> = <span class="ruby-identifier">method_to_send</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:main</span>
  <span class="ruby-identifier">object_to_send</span> <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-identifier">object_to_send</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">method_to_send</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args_to_send</span>
  ) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">object_to_send</span>) <span class="ruby-operator">&amp;&amp;</span> (
    <span class="ruby-identifier">send</span> <span class="ruby-identifier">method_to_send</span>, <span class="ruby-identifier">args_to_send</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__string_repetition" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__string_repetition</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p># short_desc = “tests the function string_repetion” @<a
href=":documentation">memory</a>.push = {</p>

<pre>:function   =&gt; :test__string_repetition,
:short_desc =&gt; short_desc,
:params     =&gt; [
  {
    :name             =&gt; :args,
    :description      =&gt; &quot;list of parameters&quot;,
    :duck_type        =&gt; Array,
    :default_behavior =&gt; &quot;interpreted as empty array&quot;,
    :params           =&gt; [
      {              
        :name             =&gt; :reserved,
        :duck_type        =&gt; Object,
        :default_behavior =&gt; &quot;interpreted as nil&quot;,
        :description      =&gt; &quot;for future use&quot;,
      },
    ],
  },
],</pre>

<p>}</p>
          
          

          
          <div class="method-source-code" id="test__string_repetition-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 4384</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__string_repetition</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">expectation</span> = {}
  <span class="ruby-identifier">actual</span> = {}
  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">1</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XXX&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
  <span class="ruby-comment"># expectation and actual inverted.</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">2</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;X&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">3</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">4</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XXyy&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">6</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">0</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">7</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">1</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">7</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">0</span>]
  <span class="ruby-comment"># &quot;X&quot;*0 = &quot;&quot;</span>
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">8</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;X&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>, <span class="ruby-value">1</span>]
  <span class="ruby-comment"># &quot;X&quot;*0 = &quot;&quot;, but minimum is set to 1</span>
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">9</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;Xy&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">10</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-comment"># clearly &quot;&quot; appears in &quot;XyXy&quot; infinity times, but &quot;XyXy&quot; is no</span>
  <span class="ruby-comment"># repetition of &quot;&quot;</span>
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">11</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;XyXy&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;Xy&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">operand_1</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">12</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;X&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;XXX&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">13</span>
  <span class="ruby-identifier">operand_1</span> = [<span class="ruby-value">:b</span>]
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;]&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">test_case</span> = <span class="ruby-value">14</span>
  <span class="ruby-identifier">operand_1</span> = <span class="ruby-string">&quot;[:b]&quot;</span>
  <span class="ruby-identifier">operand_2</span> = <span class="ruby-string">&quot;]&quot;</span>
  <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-identifier">string_repetition</span> [<span class="ruby-identifier">operand_1</span>, <span class="ruby-identifier">operand_2</span>]
  <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>] = <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
    [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
  }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__system_rubyment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__system_rubyment</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-system_rubyment">#system_rubyment</a>
dependee:</p>

<pre class="ruby"><span class="ruby-identifier">test__gem_install_validate_uninstall</span>
</pre>

<p>args: args (Array or nil) returns: <a
href="RubymentModule/Rubyment.html">Rubyment</a> or false</p>
          
          

          
          <div class="method-source-code" id="test__system_rubyment-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2319</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__system_rubyment</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">rubyment_args</span> = (<span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>) <span class="ruby-operator">||</span> [<span class="ruby-string">&quot;main&quot;</span>, <span class="ruby-string">&quot;tested system_rubyment&quot;</span>]
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">validate_require</span> [<span class="ruby-string">&#39;rubyment&#39;</span>, <span class="ruby-string">&#39;Rubyment&#39;</span>, {<span class="ruby-value">:invoke</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rubyment_args</span> }]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_server_plain" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_server_plain</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-tcp_server_plain">#tcp_server_plain</a></p>
          
          

          
          <div class="method-source-code" id="test__tcp_server_plain-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3092</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
 <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [<span class="ruby-value">8003</span>,
   <span class="ruby-string">&quot;0&quot;</span>,
   <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   <span class="ruby-string">&quot;debug&quot;</span>,
   <span class="ruby-string">&quot;io_echo&quot;</span>,
   <span class="ruby-string">&quot;debug_io_echo&quot;</span>,
   <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   <span class="ruby-string">&quot; &quot;</span>, <span class="ruby-comment">#replace</span>
   <span class="ruby-string">&quot;__&quot;</span>, <span class="ruby-comment">#replacement -- will replace empty spaces</span>
   ]
 <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
 <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_server_plain__with_http_OK_response" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_server_plain__with_http_OK_response</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-tcp_server_plain">#tcp_server_plain</a>
(call <a href="RubymentModule.html#method-i-io_transform">io_transform</a>
with a function that processes an http request and returns an
http_response, by default <a
href="RubymentModule.html#method-i-http_OK_response">http_OK_response</a>)</p>
          
          

          
          <div class="method-source-code" id="test__tcp_server_plain__with_http_OK_response-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3147</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_http_OK_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
 <span class="ruby-identifier">http_processing_method</span>,
   <span class="ruby-identifier">http_processing_method_args</span>,
   <span class="ruby-identifier">http_server_port</span>,
   <span class="ruby-identifier">http_ip_addr</span>,
   <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
 <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
 <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
 <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
 <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
 <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
   <span class="ruby-identifier">http_server_port</span>,
   <span class="ruby-identifier">http_ip_addr</span>,
   <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   <span class="ruby-string">&quot;debug&quot;</span>,
   <span class="ruby-string">&quot;io_transform&quot;</span>,
   <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
   <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   <span class="ruby-identifier">http_processing_method</span>,
   <span class="ruby-identifier">http_processing_method_args</span>
 ]
 <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
 <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_server_plain__with_io_http_response" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_server_plain__with_io_http_response</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-tcp_server_plain">#tcp_server_plain</a></p>
          
          

          
          <div class="method-source-code" id="test__tcp_server_plain__with_io_http_response-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_io_http_response</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
 <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
   <span class="ruby-value">8003</span>, <span class="ruby-comment"># listening_port</span>
   <span class="ruby-string">&quot;0&quot;</span>,  <span class="ruby-comment"># ip_addr: all possible</span>
   <span class="ruby-string">&quot;reserved&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   <span class="ruby-string">&quot;debug_tcp_server_plain_arg&quot;</span>,
   <span class="ruby-string">&quot;io_http_OK_response&quot;</span>,
   <span class="ruby-string">&quot;debug_io_http_OK_response_arg&quot;</span>,
   <span class="ruby-string">&quot;reserved_io_http_OK_response_arg&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   <span class="ruby-string">&quot;This is the response payload&quot;</span>,
   <span class="ruby-string">&quot;dont_keep_alive&quot;</span>.<span class="ruby-identifier">to_nil</span>,
 ]
 <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
 <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_server_plain__with_io_transform" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_server_plain__with_io_transform</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-tcp_server_plain">#tcp_server_plain</a>
(call <a
href="RubymentModule.html#method-i-io_transform">#io_transform</a>)</p>
          
          

          
          <div class="method-source-code" id="test__tcp_server_plain__with_io_transform-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3108</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_server_plain__with_io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
 <span class="ruby-identifier">thread</span> = <span class="ruby-identifier">tcp_server_plain</span> [
   <span class="ruby-value">8003</span>,
   <span class="ruby-string">&quot;0&quot;</span>,
   <span class="ruby-string">&quot;&quot;</span>,
   <span class="ruby-string">&quot;debug&quot;</span>,
   <span class="ruby-string">&quot;io_transform&quot;</span>,
   <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
   <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
   <span class="ruby-value">:array_maps</span>,
   [
      <span class="ruby-value">:gsub!</span>, [<span class="ruby-string">&quot; &quot;</span>, <span class="ruby-string">&quot;_____&quot;</span>]
   ]
 ]
 <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
 <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_ssl_server__get_root" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_ssl_server__get_root</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>tests <a
href="RubymentModule.html#method-i-test__tcp_ssl_server__io_method">#test__tcp_ssl_server__io_method</a>
and opens another thread for the client</p>
          
          

          
          <div class="method-source-code" id="test__tcp_ssl_server__get_root-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3619</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__get_root</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">tcp_ssl_server_method</span>,
    <span class="ruby-identifier">http_processing_method</span>,
    <span class="ruby-identifier">http_processing_method_args</span>,
    <span class="ruby-identifier">http_server_port</span>,
    <span class="ruby-identifier">http_ip_addr</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
    <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
    <span class="ruby-identifier">happy_with_request</span>,
    <span class="ruby-identifier">io_method</span>,
    <span class="ruby-identifier">io_method_debug</span>,
    <span class="ruby-identifier">domain</span>,
    <span class="ruby-identifier">admit_non_ssl</span>,
    <span class="ruby-identifier">no_debug_client</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">tcp_ssl_server_method</span> = <span class="ruby-identifier">tcp_ssl_server_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:test__tcp_ssl_server__io_method</span>
  <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
  <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
  <span class="ruby-identifier">no_debug_client</span> = <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">server_thread</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">tcp_ssl_server_method</span>,
    [
      <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
      <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">io_method</span>,
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
    ]

  <span class="ruby-identifier">thread_2</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> {
    <span class="ruby-identifier">loop</span> {
      <span class="ruby-identifier">response</span> = <span class="ruby-identifier">test__file_read__uri_root</span> [
        <span class="ruby-identifier">domain</span>,
        <span class="ruby-identifier">http_server_port</span>,
        <span class="ruby-identifier">admit_non_ssl</span>,
        <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">negate_me</span>,
      ]
      <span class="ruby-identifier">sleep</span> <span class="ruby-value">2</span>
    }
  }
  <span class="ruby-identifier">server_thread</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">join</span>

  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_ssl_server__get_root__plain_redirect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_ssl_server__get_root__plain_redirect</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>tests <a
href="RubymentModule.html#method-i-test__tcp_ssl_server__io_method">#test__tcp_ssl_server__io_method</a>,
creating two servers, one ssl and another plain, redirecting to the ssl
one. then, opens a client thread with a client connecting to the root
document of the plain server (and in the end being served by the root
document of the ssl server). another thread for the client</p>
          
          

          
          <div class="method-source-code" id="test__tcp_ssl_server__get_root__plain_redirect-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3560</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__get_root__plain_redirect</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">tcp_ssl_server_method</span>,
    <span class="ruby-identifier">http_processing_method</span>,
    <span class="ruby-identifier">http_processing_method_args</span>,
    <span class="ruby-identifier">http_server_port</span>,
    <span class="ruby-identifier">http_ip_addr</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
    <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
    <span class="ruby-identifier">happy_with_request</span>,
    <span class="ruby-identifier">io_method</span>,
    <span class="ruby-identifier">io_method_debug</span>,
    <span class="ruby-identifier">domain</span>,
    <span class="ruby-identifier">admit_non_ssl</span>,
    <span class="ruby-identifier">no_debug_client</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">tcp_ssl_server_method</span> = <span class="ruby-identifier">tcp_ssl_server_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:test__tcp_ssl_server__io_method</span>
  <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">domain</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;localhost&quot;</span>
  <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">8003</span>
  <span class="ruby-identifier">no_debug_client</span> = <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">server_thread</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">tcp_ssl_server_method</span>,
    [
      <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>,
      <span class="ruby-identifier">http_server_port</span>,
      <span class="ruby-identifier">http_ip_addr</span>,
      <span class="ruby-identifier">priv_pemfile</span>,
      <span class="ruby-identifier">cert_pem_file</span>,
      <span class="ruby-identifier">extra_cert_pem_files</span>,
      <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
      <span class="ruby-identifier">debug_tcp_ssl_server_method</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">io_method</span>,
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">admit_non_ssl</span>,
    ]

  <span class="ruby-identifier">thread_2</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> {
    <span class="ruby-identifier">loop</span> {
      <span class="ruby-identifier">response</span> = <span class="ruby-identifier">test__file_read__uri_root</span> [
        <span class="ruby-identifier">domain</span>,
        <span class="ruby-identifier">http_server_port</span>,
        <span class="ruby-identifier">admit_non_ssl</span>,
        <span class="ruby-identifier">no_debug_client</span>.<span class="ruby-identifier">negate_me</span>,
      ]
      <span class="ruby-identifier">sleep</span> <span class="ruby-value">2</span>
    }
  }
  <span class="ruby-identifier">server_thread</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">join</span>

  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_ssl_server__io_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_ssl_server__io_method</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-tcp_ssl_server">#tcp_ssl_server</a>
(calling an <code>io_method</code>, by default <a
href="RubymentModule.html#method-i-io_transform">io_transform</a>, with a
function that processes an http request and returns an http_response, by
default <a
href="RubymentModule.html#method-i-http_OK_response">http_OK_response</a>)
just like <a
href="RubymentModule.html#method-i-test__tcp_ssl_server__non_ssl">test__tcp_ssl_server__non_ssl</a>,
calling directly <a
href="RubymentModule.html#method-i-tcp_ssl_server">tcp_ssl_server</a>, but
making mandatory the server to be ssl one. requires, by default that the
certificate and its</p>

<pre>private key are found in the current dir, which
can be achieved with:
+openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</pre>

<p>but if the files don&#39;t exist, they will be created with a sample self
signed certificate.</p>
          
          

          
          <div class="method-source-code" id="test__tcp_ssl_server__io_method-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3477</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__io_method</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">http_processing_method</span>,
    <span class="ruby-identifier">http_processing_method_args</span>,
    <span class="ruby-identifier">http_server_port</span>,
    <span class="ruby-identifier">http_ip_addr</span>,
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">happy_with_request</span>,
    <span class="ruby-identifier">io_method</span>,
    <span class="ruby-identifier">io_method_debug</span>,
    <span class="ruby-identifier">admit_non_ssl</span>,
    <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
  <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
  <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
  <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
  <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> =
    <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
  <span class="ruby-identifier">ssl_cert_pkey_chain</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>
  <span class="ruby-identifier">priv_pemfile</span>  =   <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">1</span>]
  <span class="ruby-identifier">cert_pem_file</span> =  <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">0</span>]
  <span class="ruby-identifier">extra_cert_pemiles</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">2</span>]
  <span class="ruby-identifier">debug</span> =  <span class="ruby-identifier">debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;yes, debug&quot;</span>
  <span class="ruby-identifier">io_method</span> =  <span class="ruby-identifier">io_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;io_transform&quot;</span>
  <span class="ruby-identifier">io_method_debug</span> =  <span class="ruby-identifier">io_method_debug</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">debug</span>
  <span class="ruby-identifier">happy_with_request</span> = <span class="ruby-identifier">happy_with_request</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">admit_non_ssl</span> = <span class="ruby-identifier">admit_non_ssl</span>.<span class="ruby-identifier">nne</span>
  <span class="ruby-identifier">tcp_ssl_server_args</span> = [
    <span class="ruby-identifier">http_server_port</span>,
    <span class="ruby-identifier">http_ip_addr</span>,
    <span class="ruby-identifier">debug</span>,
    <span class="ruby-identifier">admit_non_ssl</span>,
    <span class="ruby-identifier">io_method</span>,
    [
      <span class="ruby-identifier">io_method_debug</span>,
      <span class="ruby-identifier">happy_with_request</span>,
      <span class="ruby-identifier">http_processing_method</span>,
      <span class="ruby-identifier">http_processing_method_args</span>
    ],
    <span class="ruby-identifier">priv_pemfile</span>,
    <span class="ruby-identifier">cert_pem_file</span>,
    <span class="ruby-identifier">extra_cert_pem_files</span>,
    <span class="ruby-string">&quot;yes, output exceptions&quot;</span>,
  ]
  <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> <span class="ruby-identifier">tcp_ssl_server_args</span>
  [ <span class="ruby-identifier">thread</span> ] <span class="ruby-operator">+</span> <span class="ruby-identifier">tcp_ssl_server_args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_ssl_server__io_transform" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_ssl_server__io_transform</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-tcp_ssl_server">#tcp_ssl_server</a>
(call <a href="RubymentModule.html#method-i-io_transform">io_transform</a>
with a function that processes an http request and returns an
http_response, by default <a
href="RubymentModule.html#method-i-http_OK_response">http_OK_response</a>)
just like <a
href="RubymentModule.html#method-i-test__tcp_ssl_server__non_ssl">test__tcp_ssl_server__non_ssl</a>,
calling directly <a
href="RubymentModule.html#method-i-tcp_ssl_server">tcp_ssl_server</a>, but
making mandatory the server to be ssl one. requires, by default that the
certificate and its</p>

<pre>private key are found in the current dir, which
can be achieved with:
+openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</pre>

<p>but if the files don&#39;t exist, they will be created with a sample self
signed certificate.</p>
          
          

          
          <div class="method-source-code" id="test__tcp_ssl_server__io_transform-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3339</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__io_transform</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
 <span class="ruby-identifier">http_processing_method</span>,
   <span class="ruby-identifier">http_processing_method_args</span>,
   <span class="ruby-identifier">http_server_port</span>,
   <span class="ruby-identifier">http_ip_addr</span>,
   <span class="ruby-identifier">priv_pemfile</span>,
   <span class="ruby-identifier">cert_pem_file</span>,
   <span class="ruby-identifier">extra_cert_pem_files</span>,
   <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
   <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
 <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
 <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
 <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
 <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
 <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> =
   <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
 <span class="ruby-identifier">ssl_cert_pkey_chain</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>
 <span class="ruby-identifier">priv_pemfile</span>  =   <span class="ruby-identifier">priv_pemfile</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">1</span>]
 <span class="ruby-identifier">cert_pem_file</span> =  <span class="ruby-identifier">cert_pem_file</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">0</span>]
 <span class="ruby-identifier">extra_cert_pem_files</span> =  <span class="ruby-identifier">extra_cert_pem_files</span>.<span class="ruby-identifier">nne</span> <span class="ruby-identifier">ssl_cert_pkey_chain</span>[<span class="ruby-value">2</span>]
 <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> [
   <span class="ruby-identifier">http_server_port</span>,
   <span class="ruby-identifier">http_ip_addr</span>,
   <span class="ruby-string">&quot;debug&quot;</span>,
   <span class="ruby-string">&quot;admit non ssl server&quot;</span>.<span class="ruby-identifier">negate_me</span>,
   <span class="ruby-string">&quot;io_transform&quot;</span>,
   [
     <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
     <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>
   ],
   <span class="ruby-identifier">priv_pemfile</span>,
   <span class="ruby-identifier">cert_pem_file</span>,
   <span class="ruby-identifier">extra_cert_pem_files</span>,
   <span class="ruby-string">&quot;yes, output exceptions&quot;</span>,
 ]
 <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
 <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_ssl_server__non_ssl" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_ssl_server__non_ssl</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-tcp_ssl_server">#tcp_ssl_server</a>
(call <a href="RubymentModule.html#method-i-io_transform">io_transform</a>
with a function that processes an http request and returns an
http_response, by default <a
href="RubymentModule.html#method-i-http_OK_response">http_OK_response</a>)
just like <a
href="RubymentModule.html#method-i-test__tcp_server_plain__with_http_OK_response">test__tcp_server_plain__with_http_OK_response</a>
but calling directly <a
href="RubymentModule.html#method-i-tcp_ssl_server">tcp_ssl_server</a></p>
          
          

          
          <div class="method-source-code" id="test__tcp_ssl_server__non_ssl-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__non_ssl</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
 <span class="ruby-identifier">http_processing_method</span>,
   <span class="ruby-identifier">http_processing_method_args</span>,
   <span class="ruby-identifier">http_server_port</span>,
   <span class="ruby-identifier">http_ip_addr</span>,
   <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
 <span class="ruby-identifier">http_processing_method</span> = <span class="ruby-identifier">http_processing_method</span>.<span class="ruby-identifier">nne</span> <span class="ruby-value">:http_OK_response</span>
 <span class="ruby-identifier">http_processing_method_args</span> = <span class="ruby-identifier">http_processing_method_args</span>.<span class="ruby-identifier">nne</span> []
 <span class="ruby-identifier">http_server_port</span> = <span class="ruby-identifier">http_server_port</span>.<span class="ruby-identifier">nne</span>  <span class="ruby-value">8003</span>
 <span class="ruby-identifier">http_ip_addr</span> = <span class="ruby-identifier">http_ip_addr</span>.<span class="ruby-identifier">nne</span> <span class="ruby-string">&quot;0&quot;</span>
 <span class="ruby-identifier">thread</span> =  <span class="ruby-identifier">tcp_ssl_server</span> [
   <span class="ruby-identifier">http_server_port</span>,
   <span class="ruby-identifier">http_ip_addr</span>,
   <span class="ruby-string">&quot;debug&quot;</span>,
   <span class="ruby-string">&quot;admit non ssl server&quot;</span>,
   <span class="ruby-string">&quot;io_transform&quot;</span>,
   [
     <span class="ruby-string">&quot;debug_io_transform&quot;</span>,
     <span class="ruby-string">&quot;default happy_with_request&quot;</span>.<span class="ruby-identifier">to_nil</span>,
     <span class="ruby-identifier">http_processing_method</span>,
     <span class="ruby-identifier">http_processing_method_args</span>
   ],
 ]
 <span class="ruby-identifier">thread</span>.<span class="ruby-identifier">join</span>
 <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tcp_ssl_server__ssl_self_signed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tcp_ssl_server__ssl_self_signed</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-tcp_ssl_server">#tcp_ssl_server</a>
(call <a href="RubymentModule.html#method-i-io_transform">io_transform</a>
with a function that processes an http request and returns an
http_response, by default <a
href="RubymentModule.html#method-i-http_OK_response">http_OK_response</a>)
just like <a
href="RubymentModule.html#method-i-test__tcp_ssl_server__non_ssl">test__tcp_ssl_server__non_ssl</a>,
calling directly <a
href="RubymentModule.html#method-i-tcp_ssl_server">tcp_ssl_server</a>, but
making mandatory the server to be ssl one. requires, by default that the
certificate and its</p>

<pre>private key are found in the current dir, which
can be achieved with:
+openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout pkey.pem -out cert.crt+</pre>

<p>but if the files don&#39;t exist, they will be created with a sample self
signed certificate.</p>
          
          

          
          <div class="method-source-code" id="test__tcp_ssl_server__ssl_self_signed-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3440</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tcp_ssl_server__ssl_self_signed</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
 <span class="ruby-identifier">http_processing_method</span>,
   <span class="ruby-identifier">http_processing_method_args</span>,
   <span class="ruby-identifier">http_server_port</span>,
   <span class="ruby-identifier">http_ip_addr</span>,
   <span class="ruby-identifier">priv_pemfile</span>,
   <span class="ruby-identifier">cert_pem_file</span>,
   <span class="ruby-identifier">extra_cert_pem_files</span>,
   <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
 <span class="ruby-identifier">ssl_cert_pkey_chain_method</span> = <span class="ruby-value">:ssl_sample_self_signed_cert_encrypted</span>
 <span class="ruby-identifier">test__tcp_ssl_server__io_transform</span> [
 <span class="ruby-identifier">http_processing_method</span>,
   <span class="ruby-identifier">http_processing_method_args</span>,
   <span class="ruby-identifier">http_server_port</span>,
   <span class="ruby-identifier">http_ip_addr</span>,
   <span class="ruby-identifier">priv_pemfile</span>,
   <span class="ruby-identifier">cert_pem_file</span>,
   <span class="ruby-identifier">extra_cert_pem_files</span>,
   <span class="ruby-identifier">ssl_cert_pkey_chain_method</span>,
 ]
 <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__tester" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__tester</span><span
            class="method-args">(args=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>generic function for test__ functions</p>
          
          

          
          <div class="method-source-code" id="test__tester-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 4081</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__tester</span> <span class="ruby-identifier">args</span>=[]
  <span class="ruby-identifier">expectation</span> = {}
  <span class="ruby-identifier">actual</span> = {}
  <span class="ruby-identifier">test_cases</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">test_cases</span> <span class="ruby-operator">||=</span> [
   <span class="ruby-comment"># [ :id, :expectation, :actual_params ],</span>
  ]
  <span class="ruby-identifier">test_cases</span>.<span class="ruby-identifier">each_with_index</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">test_case_id</span>, <span class="ruby-identifier">test_expectation</span>, <span class="ruby-identifier">actual_params</span> = <span class="ruby-identifier">test_case</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">send</span> <span class="ruby-identifier">actual_params</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">actual_params</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case_id</span>] = <span class="ruby-identifier">test_expectation</span>
    <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case_id</span>] = <span class="ruby-identifier">result</span>
  }
  <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
    [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
  }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test__transform_call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test__transform_call</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>calls a function with the processing arg @param [Array] <code>args</code>,
an <code>Array</code> whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>processing_arg</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd></dd></dl>
</dd><dt><code>method</code>
<dd><dl class="rdoc-list label-list"><dt>Method, String
<dd></dd></dl>
</dd><dt><code>method_args</code>
<dd><dl class="rdoc-list label-list"><dt>Array
<dd>
<p>args to be given to the <code>transform_method_name</code></p>
</dd></dl>
</dd><dt><code>on_object</code>
<dd><dl class="rdoc-list label-list"><dt>String, Boolean
<dd></dd></dl>
</dd></dl>

<p>@return [String] <code>processing_arg</code></p>
          
          

          
          <div class="method-source-code" id="test__transform_call-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2569</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test__transform_call</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">processing_arg</span>, <span class="ruby-identifier">method</span>, <span class="ruby-identifier">method_args</span>, <span class="ruby-identifier">on_object</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">object_arg</span> = <span class="ruby-identifier">on_object</span>.<span class="ruby-identifier">nne</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">processing_arg</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">to_method</span>(
    [<span class="ruby-identifier">method</span>, <span class="ruby-identifier">object_arg</span>]).<span class="ruby-identifier">call</span>(
      [<span class="ruby-identifier">processing_arg</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">method_args</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test_enc_dec_interactive__ssl_sample_self_signed_cert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test_enc_dec_interactive__ssl_sample_self_signed_cert</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>test for <a
href="RubymentModule.html#method-i-ssl_sample_self_signed_cert_encrypted">#ssl_sample_self_signed_cert_encrypted</a>
note: function name out of standard. kept for open-closed commitment. call
<a
href="RubymentModule.html#method-i-test__enc_dec_interactive__ssl_sample_self_signed_cert">test__enc_dec_interactive__ssl_sample_self_signed_cert</a>
instead</p>
          
          

          
          <div class="method-source-code" id="test_enc_dec_interactive__ssl_sample_self_signed_cert-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3304</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_enc_dec_interactive__ssl_sample_self_signed_cert</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">expectation</span> = {
    <span class="ruby-value">:self_signed_certificate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span>[<span class="ruby-value">0</span>],
    <span class="ruby-value">:private_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert</span>[<span class="ruby-value">1</span>],
  }
  <span class="ruby-identifier">actual</span> = {
    <span class="ruby-value">:self_signed_certificate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span>[<span class="ruby-value">0</span>],
    <span class="ruby-value">:private_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssl_sample_self_signed_cert_encrypted</span>[<span class="ruby-value">1</span>],
  }
  <span class="ruby-identifier">judgement</span> = <span class="ruby-identifier">actual</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">test_case</span><span class="ruby-operator">|</span>
    [<span class="ruby-identifier">expectation</span>[<span class="ruby-identifier">test_case</span>], <span class="ruby-identifier">actual</span>[<span class="ruby-identifier">test_case</span>] , <span class="ruby-identifier">test_case</span>]
  }.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;expect_equal&quot;</span>)).<span class="ruby-identifier">all?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-time_now_hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">time_now_hash</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>generates a hash string based on current time @return [String]
<code>Time.now.hash.abs.to_s</code></p>
          
          

          
          <div class="method-source-code" id="time_now_hash-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 3208</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">time_now_hash</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_class" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_class</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a Class object out of class_name (or itself if it is already a
class)</p>
          
          

          
          <div class="method-source-code" id="to_class-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 564</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_class</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">class_name</span>, <span class="ruby-identifier">future_arg</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">class_object</span> = ( <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Class</span> ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">class_name</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_get</span> <span class="ruby-identifier">class_name</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NameError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nameErrorE</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_method</span><span
            class="method-args">(args = ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a method object out of a string or a method object, in a
polymorphic style. @param [Array] <code>args</code>, an <code>Array</code>
whose elements are expected to be:</p>
<dl class="rdoc-list note-list"><dt><code>method_name_or_method</code>
<dd><dl class="rdoc-list label-list"><dt>String, Method
<dd>
<p>method name or method object</p>
</dd></dl>
</dd></dl>

<p>@return [Method] a method</p>
          
          

          
          <div class="method-source-code" id="to_method-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2540</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_method</span> <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">method_name_or_method</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">args</span>
  (
    <span class="ruby-identifier">to_object_method</span> [<span class="ruby-identifier">object</span>, <span class="ruby-identifier">method_name_or_method</span>]
  ) <span class="ruby-operator">||</span> (
    <span class="ruby-identifier">method_name_or_method</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:call</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">method_name_or_method</span>
  ) <span class="ruby-operator">||</span>
    <span class="ruby-identifier">method</span>(<span class="ruby-identifier">method_name_or_method</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_object_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_object_method</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a Method (object.method if object is given) matching the name. Give
<code>self</code> as object to look up  at the current context @param
[Array] args, whose elements are:</p>
<dl class="rdoc-list note-list"><dt><code>name</code>
<dd><dl class="rdoc-list label-list"><dt>String, nil
<dd></dd></dl>
</dd><dt><code>object</code>
<dd><dl class="rdoc-list label-list"><dt><a href="Object.html">Object</a>
<dd></dd></dl>
</dd></dl>

<p>@returns:</p>

<pre class="ruby"><span class="ruby-identifier">method_object</span> (<span class="ruby-constant">Method</span>)
</pre>
          
          

          
          <div class="method-source-code" id="to_object_method-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 582</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_object_method</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">name</span>, <span class="ruby-identifier">object</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">object</span>.<span class="ruby-identifier">method</span>(<span class="ruby-string">&quot;method&quot;</span>).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NameError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">nameError</span>
    <span class="ruby-comment"># every object (even nil) has :method,</span>
    <span class="ruby-comment"># and every Method has :call: exception</span>
    <span class="ruby-comment"># is thrown in call</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">nameError</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-url_to_str" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">url_to_str</span><span
            class="method-args">(url, rescue_value=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns url contents</p>
          
          

          
          <div class="method-source-code" id="url_to_str-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 655</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">url_to_str</span> <span class="ruby-identifier">url</span>, <span class="ruby-identifier">rescue_value</span>=<span class="ruby-keyword">nil</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;open-uri&#39;</span>
  <span class="ruby-identifier">contents</span> = <span class="ruby-identifier">open</span>(<span class="ruby-identifier">url</span>).<span class="ruby-identifier">read</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">rescue_value</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validate_require" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_require</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a
href="RubymentModule.html#method-i-validate_require">#validate_require</a>
requires a file/gem in the system returns nil if not found args:
[requirement (String), validator_class (Class or String or nil),</p>

<pre>validator_args (Array), validator_method (Method or String)]</pre>

<p>returns: <a href="RubymentModule/Rubyment.html">Rubyment</a>, true or false</p>
          
          

          
          <div class="method-source-code" id="validate_require-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 2199</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">validate_require</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">stderr</span> = <span class="ruby-ivar">@memory</span>[<span class="ruby-value">:stderr</span>]
  <span class="ruby-identifier">requirement</span>, <span class="ruby-identifier">validator_class</span>, <span class="ruby-identifier">validator_args</span>, <span class="ruby-identifier">validator_method</span> = <span class="ruby-identifier">containerize</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">validate_call</span> = <span class="ruby-identifier">validator_class</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">validator_class</span> = <span class="ruby-identifier">to_class</span> <span class="ruby-identifier">validator_class</span>
  <span class="ruby-identifier">validator_method</span> <span class="ruby-operator">||=</span>  <span class="ruby-string">&quot;new&quot;</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">require</span> <span class="ruby-identifier">requirement</span>
    <span class="ruby-identifier">validate_call</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">object_method_args_call</span> [<span class="ruby-identifier">validator_method</span>, <span class="ruby-identifier">validator_class</span>, <span class="ruby-identifier">validator_args</span>]) <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">validate_call</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">LoadError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">e</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-version" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">version</span><span
            class="method-args">(args=ARGV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a version number comprised of a major and a minor number args:</p>
<dl class="rdoc-list label-list"><dt>major_version (String or nil), minor_version (String or nil) 
<dd>
<p>defaults:</p>

<pre>[@memory[:major_version]], @memory[:basic_version]]</pre>

<p>returns: “#{major}.#{minor}”</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="version-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 327</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">version</span> <span class="ruby-identifier">args</span>=<span class="ruby-constant">ARGV</span>
  <span class="ruby-identifier">memory</span> = <span class="ruby-ivar">@memory</span>
  <span class="ruby-identifier">major_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:major_version</span>]
  <span class="ruby-identifier">basic_version</span> = <span class="ruby-identifier">memory</span>[<span class="ruby-value">:basic_version</span>]
  <span class="ruby-identifier">major</span>, <span class="ruby-identifier">minor</span> = <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">major</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">major_version</span>
  <span class="ruby-identifier">minor</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">basic_version</span>
  <span class="ruby-node">&quot;#{major}.#{minor}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-version_at_least" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">version_at_least</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>compares the version of current rubyment with a given version. so users of
rubyment can test if their code will run with the rubyment installed on the
system. @param [splat] args, a list of object whose elements are expected
to be:</p>
<dl class="rdoc-list note-list"><dt><code>major_version</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd><dt><code>minor_version</code>
<dd><dl class="rdoc-list label-list"><dt>String
<dd></dd></dl>
</dd></dl>

<p>@return [Bool] <code>true</code> if rubyment (<code>self</code>) version is
at least the version give as parameter, <code>false</code> otherwise</p>
          
          

          
          <div class="method-source-code" id="version_at_least-source">
            <pre><span class="ruby-comment"># File rubyment.rb, line 346</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">version_at_least</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Version</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">version</span> []) <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Version</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">version</span> <span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

